[
  {
    "discussion_id": "1727363729",
    "pr_number": 14395,
    "pr_file": "manifests/base/applicationset-controller/argocd-applicationset-controller-role.yaml",
    "created_at": "2024-08-22T15:31:46+00:00",
    "commented_code": "verbs:\n       - get\n       - list\n-      - watch\n\\ No newline at end of file\n+      - watch\n+\n+  # argocd-applicationset-controller leader election rules\n+  # TODO: Remove configmaps related rules once `LeaderElectionResourceLock` is set to `leases`\n+  #   - Either explicitly in `cmd/argocd-applicationset-controller/commands/applicationset_controller.go`\n+  #   - Or if `sigs.k8s.io/controller-runtime` is upgraded to `>=v0.12.0` where this is the new default\n+\n+  # Create with resourceNames fails\n+  - apiGroups:\n+      - ''\n+    resources:\n+      - configmaps\n+    verbs:\n+      - create\n+  - apiGroups:\n+      - coordination.k8s.io\n+    resources:\n+      - leases\n+    verbs:\n+      - create\n+  # Limit updates to specific lock\n+  - apiGroups:\n+      - ''\n+    resources:\n+      - configmaps\n+    resourceNames:\n+      # Defined in `cmd/argocd-applicationset-controller/commands/applicationset_controller.go`\n+      - 58ac56fa.applicationsets.argoproj.io\n+    verbs:\n+      - update\n+  - apiGroups:\n+      - coordination.k8s.io",
    "repo_full_name": "argoproj/argo-cd",
    "discussion_comments": [
      {
        "comment_id": "1727363729",
        "repo_full_name": "argoproj/argo-cd",
        "pr_number": 14395,
        "pr_file": "manifests/base/applicationset-controller/argocd-applicationset-controller-role.yaml",
        "discussion_id": "1727363729",
        "commented_code": "@@ -62,4 +62,43 @@ rules:\n     verbs:\n       - get\n       - list\n-      - watch\n\\ No newline at end of file\n+      - watch\n+\n+  # argocd-applicationset-controller leader election rules\n+  # TODO: Remove configmaps related rules once `LeaderElectionResourceLock` is set to `leases`\n+  #   - Either explicitly in `cmd/argocd-applicationset-controller/commands/applicationset_controller.go`\n+  #   - Or if `sigs.k8s.io/controller-runtime` is upgraded to `>=v0.12.0` where this is the new default\n+\n+  # Create with resourceNames fails\n+  - apiGroups:\n+      - ''\n+    resources:\n+      - configmaps\n+    verbs:\n+      - create\n+  - apiGroups:\n+      - coordination.k8s.io\n+    resources:\n+      - leases\n+    verbs:\n+      - create\n+  # Limit updates to specific lock\n+  - apiGroups:\n+      - ''\n+    resources:\n+      - configmaps\n+    resourceNames:\n+      # Defined in `cmd/argocd-applicationset-controller/commands/applicationset_controller.go`\n+      - 58ac56fa.applicationsets.argoproj.io\n+    verbs:\n+      - update\n+  - apiGroups:\n+      - coordination.k8s.io",
        "comment_created_at": "2024-08-22T15:31:46+00:00",
        "comment_author": "agaudreault",
        "comment_body": "The controller already has a cluster role with the permissions in https://github.com/agaudreault/argo-cd/blob/88c3fd61daf9832f12a1766d3ff37a1521d02ca8/manifests/cluster-rbac/applicationset-controller/argocd-applicationset-controller-clusterrole.yaml#L77-L88 \r\n\r\nThese will only be given for cluster install and not namespace install. This PR should consolidate both.",
        "pr_file_module": null
      }
    ]
  }
]