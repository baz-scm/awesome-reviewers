[
  {
    "discussion_id": "1417947961",
    "pr_number": 16289,
    "pr_file": "Library/Homebrew/utils/url.sh",
    "created_at": "2023-12-06T20:34:11+00:00",
    "commented_code": "+# url_get <URL> [key] [key] ...\n+# where:\n+#   URL ~ [scheme://][user[:pass]@]host[:port][path]\n+#   key is one of the element composing the URL\n+url_get() {\n+  [[ ${#} -gt 0 ]] || return",
    "repo_full_name": "Homebrew/brew",
    "discussion_comments": [
      {
        "comment_id": "1417947961",
        "repo_full_name": "Homebrew/brew",
        "pr_number": 16289,
        "pr_file": "Library/Homebrew/utils/url.sh",
        "discussion_id": "1417947961",
        "commented_code": "@@ -0,0 +1,53 @@\n+# url_get <URL> [key] [key] ...\n+# where:\n+#   URL ~ [scheme://][user[:pass]@]host[:port][path]\n+#   key is one of the element composing the URL\n+url_get() {\n+  [[ ${#} -gt 0 ]] || return",
        "comment_created_at": "2023-12-06T20:34:11+00:00",
        "comment_author": "MikeMcQuaid",
        "comment_body": "This shouldn't fail silently.",
        "pr_file_module": null
      },
      {
        "comment_id": "1418515623",
        "repo_full_name": "Homebrew/brew",
        "pr_number": 16289,
        "pr_file": "Library/Homebrew/utils/url.sh",
        "discussion_id": "1417947961",
        "commented_code": "@@ -0,0 +1,53 @@\n+# url_get <URL> [key] [key] ...\n+# where:\n+#   URL ~ [scheme://][user[:pass]@]host[:port][path]\n+#   key is one of the element composing the URL\n+url_get() {\n+  [[ ${#} -gt 0 ]] || return",
        "comment_created_at": "2023-12-07T07:50:24+00:00",
        "comment_author": "sazriel26",
        "comment_body": "If the `return` is executed it will return the status of the test which is NOK (see `${?}` value after calling url_get)\r\n\r\nHowever in `update.sh`, I'd rather check the number of elements in the array which should match the number of elements I have requested on the `url_get`:\r\n```\r\n      eval UPSTREAM_REPOSITORY_URL_PARSED=( $(url_get \"${UPSTREAM_REPOSITORY_URL}\" user pass host path) )\r\n      if [[ ${#UPSTREAM_REPOSITORY_URL_PARSED[@]} -ne 4 ]]; then\r\n        echo \"Failed to parse repository URL=${UPSTREAM_REPOSITORY_URL} \\!\" >&2\r\n        exit\r\n      fi\r\n```\r\n\r\nFor debugging purposes, yes sure that we can add some \"logging\", but looks out of scope according to https://github.com/Homebrew/brew/pull/16289#pullrequestreview-1768569979",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1912524027",
    "pr_number": 19083,
    "pr_file": "Library/Homebrew/cmd/update.sh",
    "created_at": "2025-01-12T19:47:32+00:00",
    "commented_code": "HOMEBREW_SIMULATE_FROM_CURRENT_BRANCH=1\n         ;;\n       --auto-update) export HOMEBREW_UPDATE_AUTO=1 ;;\n-      --*) ;;\n+      --*)\n+        brew help update\n+        exit $?",
    "repo_full_name": "Homebrew/brew",
    "discussion_comments": [
      {
        "comment_id": "1912524027",
        "repo_full_name": "Homebrew/brew",
        "pr_number": 19083,
        "pr_file": "Library/Homebrew/cmd/update.sh",
        "discussion_id": "1912524027",
        "commented_code": "@@ -352,7 +352,10 @@ homebrew-update() {\n         HOMEBREW_SIMULATE_FROM_CURRENT_BRANCH=1\n         ;;\n       --auto-update) export HOMEBREW_UPDATE_AUTO=1 ;;\n-      --*) ;;\n+      --*)\n+        brew help update\n+        exit $?",
        "comment_created_at": "2025-01-12T19:47:32+00:00",
        "comment_author": "reitermarkus",
        "comment_body": "I think this should just `exit 1` with unknown options, and also output the unknown option.",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1774721663",
    "pr_number": 18402,
    "pr_file": "Library/Homebrew/brew.sh",
    "created_at": "2024-09-25T07:50:16+00:00",
    "commented_code": "source \"${HOMEBREW_LIBRARY}/Homebrew/list.sh\"\n     homebrew-list \"$@\" && exit 0\n     ;;\n+  # falls back to cmd/tap.rb on a non-zero return\n+  tap)\n+    source \"${HOMEBREW_LIBRARY}/Homebrew/tap.sh\"\n+    homebrew-tap \"$@\" && exit 0",
    "repo_full_name": "Homebrew/brew",
    "discussion_comments": [
      {
        "comment_id": "1774721663",
        "repo_full_name": "Homebrew/brew",
        "pr_number": 18402,
        "pr_file": "Library/Homebrew/brew.sh",
        "discussion_id": "1774721663",
        "commented_code": "@@ -172,6 +172,11 @@ case \"$@\" in\n     source \"${HOMEBREW_LIBRARY}/Homebrew/list.sh\"\n     homebrew-list \"$@\" && exit 0\n     ;;\n+  # falls back to cmd/tap.rb on a non-zero return\n+  tap)\n+    source \"${HOMEBREW_LIBRARY}/Homebrew/tap.sh\"\n+    homebrew-tap \"$@\" && exit 0",
        "comment_created_at": "2024-09-25T07:50:16+00:00",
        "comment_author": "MikeMcQuaid",
        "comment_body": "How/when will this exit with a non-zero result? Not currently seeing any e.g. `return 1` in there?",
        "pr_file_module": null
      },
      {
        "comment_id": "1774823609",
        "repo_full_name": "Homebrew/brew",
        "pr_number": 18402,
        "pr_file": "Library/Homebrew/brew.sh",
        "discussion_id": "1774721663",
        "commented_code": "@@ -172,6 +172,11 @@ case \"$@\" in\n     source \"${HOMEBREW_LIBRARY}/Homebrew/list.sh\"\n     homebrew-list \"$@\" && exit 0\n     ;;\n+  # falls back to cmd/tap.rb on a non-zero return\n+  tap)\n+    source \"${HOMEBREW_LIBRARY}/Homebrew/tap.sh\"\n+    homebrew-tap \"$@\" && exit 0",
        "comment_created_at": "2024-09-25T08:45:25+00:00",
        "comment_author": "ZhongRuoyu",
        "comment_body": "Whoops, `return 1` was were in the previous iterations (e9b158cd5ca881cc3edd2c80f9cc537b11fcb1c4), but I didn't update this.\r\n",
        "pr_file_module": null
      },
      {
        "comment_id": "1774841379",
        "repo_full_name": "Homebrew/brew",
        "pr_number": 18402,
        "pr_file": "Library/Homebrew/brew.sh",
        "discussion_id": "1774721663",
        "commented_code": "@@ -172,6 +172,11 @@ case \"$@\" in\n     source \"${HOMEBREW_LIBRARY}/Homebrew/list.sh\"\n     homebrew-list \"$@\" && exit 0\n     ;;\n+  # falls back to cmd/tap.rb on a non-zero return\n+  tap)\n+    source \"${HOMEBREW_LIBRARY}/Homebrew/tap.sh\"\n+    homebrew-tap \"$@\" && exit 0",
        "comment_created_at": "2024-09-25T08:56:48+00:00",
        "comment_author": "MikeMcQuaid",
        "comment_body": "@ZhongRuoyu whoops, still not seeing it!",
        "pr_file_module": null
      },
      {
        "comment_id": "1774856064",
        "repo_full_name": "Homebrew/brew",
        "pr_number": 18402,
        "pr_file": "Library/Homebrew/brew.sh",
        "discussion_id": "1774721663",
        "commented_code": "@@ -172,6 +172,11 @@ case \"$@\" in\n     source \"${HOMEBREW_LIBRARY}/Homebrew/list.sh\"\n     homebrew-list \"$@\" && exit 0\n     ;;\n+  # falls back to cmd/tap.rb on a non-zero return\n+  tap)\n+    source \"${HOMEBREW_LIBRARY}/Homebrew/tap.sh\"\n+    homebrew-tap \"$@\" && exit 0",
        "comment_created_at": "2024-09-25T09:06:21+00:00",
        "comment_author": "ZhongRuoyu",
        "comment_body": "Sorry for not having been clear! What I meant is that the current implementation indeed never returns non-zero, and that's intended.\r\n\r\nIn previous iterations, there was argument handling logic in `homebrew-tap` that could return 1. However, as the function `homebrew-tap` is meant for zero-argument usage only (as pointed out in https://github.com/Homebrew/brew/pull/18402#discussion_r1774373847), I removed that logic in e9b158cd5ca881cc3edd2c80f9cc537b11fcb1c4 and made sure at the call site that the function is only called when there are no `brew tap` arguments. I suppose your question is with the comment `falls back to cmd/tap.rb on a non-zero return` above, which I forgot to remove, so I removed it in ea011ae528bd1a67e3be56043b96c3da92073c75.\r\n",
        "pr_file_module": null
      },
      {
        "comment_id": "1774866991",
        "repo_full_name": "Homebrew/brew",
        "pr_number": 18402,
        "pr_file": "Library/Homebrew/brew.sh",
        "discussion_id": "1774721663",
        "commented_code": "@@ -172,6 +172,11 @@ case \"$@\" in\n     source \"${HOMEBREW_LIBRARY}/Homebrew/list.sh\"\n     homebrew-list \"$@\" && exit 0\n     ;;\n+  # falls back to cmd/tap.rb on a non-zero return\n+  tap)\n+    source \"${HOMEBREW_LIBRARY}/Homebrew/tap.sh\"\n+    homebrew-tap \"$@\" && exit 0",
        "comment_created_at": "2024-09-25T09:13:24+00:00",
        "comment_author": "MikeMcQuaid",
        "comment_body": "> made sure at the call site that the function is only called when there are no `brew tap` arguments\r\n\r\nGotcha, I see that now. Might be a little clearer if this is above the wildcard commands and doesn't do `&& exit 0` but instead has `exit 0` be unconditional as there's no `return` status to check here.",
        "pr_file_module": null
      },
      {
        "comment_id": "1774872406",
        "repo_full_name": "Homebrew/brew",
        "pr_number": 18402,
        "pr_file": "Library/Homebrew/brew.sh",
        "discussion_id": "1774721663",
        "commented_code": "@@ -172,6 +172,11 @@ case \"$@\" in\n     source \"${HOMEBREW_LIBRARY}/Homebrew/list.sh\"\n     homebrew-list \"$@\" && exit 0\n     ;;\n+  # falls back to cmd/tap.rb on a non-zero return\n+  tap)\n+    source \"${HOMEBREW_LIBRARY}/Homebrew/tap.sh\"\n+    homebrew-tap \"$@\" && exit 0",
        "comment_created_at": "2024-09-25T09:16:58+00:00",
        "comment_author": "ZhongRuoyu",
        "comment_body": "Done in c17154d2acebcfa085bd0df57d9e1902684c42c3.\r\n",
        "pr_file_module": null
      }
    ]
  }
]