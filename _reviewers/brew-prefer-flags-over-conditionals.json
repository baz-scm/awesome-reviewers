[
  {
    "discussion_id": "1842998002",
    "pr_number": 18773,
    "pr_file": "Library/Homebrew/shims/mac/super/curl-config",
    "created_at": "2024-11-14T23:12:39+00:00",
    "commented_code": "+#!/bin/bash -p\n+\n+# HOMEBREW_LIBRARY is set by bin/brew\n+# HOMEBREW_CURL_CONFIG is set by brew.sh\n+# shellcheck disable=SC2154\n+source \"${HOMEBREW_LIBRARY}/Homebrew/shims/utils.sh\"\n+\n+# Check if HOMEBREW_CURL_CONFIG is set, fallback to system curl-config if not.\n+curl_config_exec=\"${HOMEBREW_CURL_CONFIG:-/usr/bin/curl-config}\"\n+\n+# Intercept --features and append HTTP2 if needed\n+if [[ \"$1\" == \"--features\" ]]\n+then\n+  output=\"$(\"${curl_config_exec}\" \"$@\")\"\n+\n+  # Check if HTTP2 is missing but supported\n+  if [[ ! \"${output}\" =~ HTTP2 ]]\n+  then\n+    curl_version=\"$(\"${HOMEBREW_CURL:-curl}\" -V)\"\n+    if [[ \"${curl_version}\" =~ HTTP/2 ]]\n+    then\n+      output=\"${output} HTTP2\"\n+    fi\n+  fi",
    "repo_full_name": "Homebrew/brew",
    "discussion_comments": [
      {
        "comment_id": "1842998002",
        "repo_full_name": "Homebrew/brew",
        "pr_number": 18773,
        "pr_file": "Library/Homebrew/shims/mac/super/curl-config",
        "discussion_id": "1842998002",
        "commented_code": "@@ -0,0 +1,35 @@\n+#!/bin/bash -p\n+\n+# HOMEBREW_LIBRARY is set by bin/brew\n+# HOMEBREW_CURL_CONFIG is set by brew.sh\n+# shellcheck disable=SC2154\n+source \"${HOMEBREW_LIBRARY}/Homebrew/shims/utils.sh\"\n+\n+# Check if HOMEBREW_CURL_CONFIG is set, fallback to system curl-config if not.\n+curl_config_exec=\"${HOMEBREW_CURL_CONFIG:-/usr/bin/curl-config}\"\n+\n+# Intercept --features and append HTTP2 if needed\n+if [[ \"$1\" == \"--features\" ]]\n+then\n+  output=\"$(\"${curl_config_exec}\" \"$@\")\"\n+\n+  # Check if HTTP2 is missing but supported\n+  if [[ ! \"${output}\" =~ HTTP2 ]]\n+  then\n+    curl_version=\"$(\"${HOMEBREW_CURL:-curl}\" -V)\"\n+    if [[ \"${curl_version}\" =~ HTTP/2 ]]\n+    then\n+      output=\"${output} HTTP2\"\n+    fi\n+  fi",
        "comment_created_at": "2024-11-14T23:12:39+00:00",
        "comment_author": "Bo98",
        "comment_body": "It might be easier and cheaper to just add an `append_to_cccfg` here: https://github.com/Homebrew/brew/blob/main/Library/Homebrew/extend/os/mac/extend/ENV/super.rb#L161 gated to >= 10.13 && < 14, using a letter that isn't already used like `h` or `C` or something. Then here you can check `if [[ \"${HOMEBREW_CCCFG}\" = *h* ]]` before running most of the code here.\r\n\r\nAlso makes it more obvious we can remove it if we drop < macOS 14 support in the far future and means none of the hacks will run in macOS 14 and later which is safer in case there's edge cases we've missed.",
        "pr_file_module": null
      },
      {
        "comment_id": "1844073962",
        "repo_full_name": "Homebrew/brew",
        "pr_number": 18773,
        "pr_file": "Library/Homebrew/shims/mac/super/curl-config",
        "discussion_id": "1842998002",
        "commented_code": "@@ -0,0 +1,35 @@\n+#!/bin/bash -p\n+\n+# HOMEBREW_LIBRARY is set by bin/brew\n+# HOMEBREW_CURL_CONFIG is set by brew.sh\n+# shellcheck disable=SC2154\n+source \"${HOMEBREW_LIBRARY}/Homebrew/shims/utils.sh\"\n+\n+# Check if HOMEBREW_CURL_CONFIG is set, fallback to system curl-config if not.\n+curl_config_exec=\"${HOMEBREW_CURL_CONFIG:-/usr/bin/curl-config}\"\n+\n+# Intercept --features and append HTTP2 if needed\n+if [[ \"$1\" == \"--features\" ]]\n+then\n+  output=\"$(\"${curl_config_exec}\" \"$@\")\"\n+\n+  # Check if HTTP2 is missing but supported\n+  if [[ ! \"${output}\" =~ HTTP2 ]]\n+  then\n+    curl_version=\"$(\"${HOMEBREW_CURL:-curl}\" -V)\"\n+    if [[ \"${curl_version}\" =~ HTTP/2 ]]\n+    then\n+      output=\"${output} HTTP2\"\n+    fi\n+  fi",
        "comment_created_at": "2024-11-15T15:42:56+00:00",
        "comment_author": "chenrui333",
        "comment_body": "make sense 👍 ",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1843405562",
    "pr_number": 18773,
    "pr_file": "Library/Homebrew/shims/mac/super/curl-config",
    "created_at": "2024-11-15T08:55:35+00:00",
    "commented_code": "+#!/bin/bash -p\n+\n+# HOMEBREW_LIBRARY is set by bin/brew\n+# HOMEBREW_CURL_CONFIG is set by brew.sh\n+# shellcheck disable=SC2154\n+source \"${HOMEBREW_LIBRARY}/Homebrew/shims/utils.sh\"\n+\n+# Check if HOMEBREW_CURL_CONFIG is set, fallback to system curl-config if not.\n+curl_config_exec=\"${HOMEBREW_CURL_CONFIG:-/usr/bin/curl-config}\"\n+\n+# Intercept --features and append HTTP2 if needed\n+if [[ \"$1\" == \"--features\" ]]\n+then\n+  output=\"$(\"${curl_config_exec}\" \"$@\")\"\n+\n+  # Check if HTTP2 is missing but supported\n+  if [[ ! \"${output}\" =~ HTTP2 ]]\n+  then\n+    curl_version=\"$(\"${HOMEBREW_CURL:-curl}\" -V)\"\n+    if [[ \"${curl_version}\" =~ HTTP/2 ]]\n+    then\n+      output=\"${output} HTTP2\"",
    "repo_full_name": "Homebrew/brew",
    "discussion_comments": [
      {
        "comment_id": "1843405562",
        "repo_full_name": "Homebrew/brew",
        "pr_number": 18773,
        "pr_file": "Library/Homebrew/shims/mac/super/curl-config",
        "discussion_id": "1843405562",
        "commented_code": "@@ -0,0 +1,35 @@\n+#!/bin/bash -p\n+\n+# HOMEBREW_LIBRARY is set by bin/brew\n+# HOMEBREW_CURL_CONFIG is set by brew.sh\n+# shellcheck disable=SC2154\n+source \"${HOMEBREW_LIBRARY}/Homebrew/shims/utils.sh\"\n+\n+# Check if HOMEBREW_CURL_CONFIG is set, fallback to system curl-config if not.\n+curl_config_exec=\"${HOMEBREW_CURL_CONFIG:-/usr/bin/curl-config}\"\n+\n+# Intercept --features and append HTTP2 if needed\n+if [[ \"$1\" == \"--features\" ]]\n+then\n+  output=\"$(\"${curl_config_exec}\" \"$@\")\"\n+\n+  # Check if HTTP2 is missing but supported\n+  if [[ ! \"${output}\" =~ HTTP2 ]]\n+  then\n+    curl_version=\"$(\"${HOMEBREW_CURL:-curl}\" -V)\"\n+    if [[ \"${curl_version}\" =~ HTTP/2 ]]\n+    then\n+      output=\"${output} HTTP2\"",
        "comment_created_at": "2024-11-15T08:55:35+00:00",
        "comment_author": "MikeMcQuaid",
        "comment_body": "Can you explain why we'd want to claim HTTP2 support is present when `curl` says its not?",
        "pr_file_module": null
      },
      {
        "comment_id": "1844078661",
        "repo_full_name": "Homebrew/brew",
        "pr_number": 18773,
        "pr_file": "Library/Homebrew/shims/mac/super/curl-config",
        "discussion_id": "1843405562",
        "commented_code": "@@ -0,0 +1,35 @@\n+#!/bin/bash -p\n+\n+# HOMEBREW_LIBRARY is set by bin/brew\n+# HOMEBREW_CURL_CONFIG is set by brew.sh\n+# shellcheck disable=SC2154\n+source \"${HOMEBREW_LIBRARY}/Homebrew/shims/utils.sh\"\n+\n+# Check if HOMEBREW_CURL_CONFIG is set, fallback to system curl-config if not.\n+curl_config_exec=\"${HOMEBREW_CURL_CONFIG:-/usr/bin/curl-config}\"\n+\n+# Intercept --features and append HTTP2 if needed\n+if [[ \"$1\" == \"--features\" ]]\n+then\n+  output=\"$(\"${curl_config_exec}\" \"$@\")\"\n+\n+  # Check if HTTP2 is missing but supported\n+  if [[ ! \"${output}\" =~ HTTP2 ]]\n+  then\n+    curl_version=\"$(\"${HOMEBREW_CURL:-curl}\" -V)\"\n+    if [[ \"${curl_version}\" =~ HTTP/2 ]]\n+    then\n+      output=\"${output} HTTP2\"",
        "comment_created_at": "2024-11-15T15:44:23+00:00",
        "comment_author": "chenrui333",
        "comment_body": "> `curl-config --features` did not report HTTP2 prior to macOS 14\r\n\r\neven though curl does support http2\r\n\r\n",
        "pr_file_module": null
      },
      {
        "comment_id": "1844106809",
        "repo_full_name": "Homebrew/brew",
        "pr_number": 18773,
        "pr_file": "Library/Homebrew/shims/mac/super/curl-config",
        "discussion_id": "1843405562",
        "commented_code": "@@ -0,0 +1,35 @@\n+#!/bin/bash -p\n+\n+# HOMEBREW_LIBRARY is set by bin/brew\n+# HOMEBREW_CURL_CONFIG is set by brew.sh\n+# shellcheck disable=SC2154\n+source \"${HOMEBREW_LIBRARY}/Homebrew/shims/utils.sh\"\n+\n+# Check if HOMEBREW_CURL_CONFIG is set, fallback to system curl-config if not.\n+curl_config_exec=\"${HOMEBREW_CURL_CONFIG:-/usr/bin/curl-config}\"\n+\n+# Intercept --features and append HTTP2 if needed\n+if [[ \"$1\" == \"--features\" ]]\n+then\n+  output=\"$(\"${curl_config_exec}\" \"$@\")\"\n+\n+  # Check if HTTP2 is missing but supported\n+  if [[ ! \"${output}\" =~ HTTP2 ]]\n+  then\n+    curl_version=\"$(\"${HOMEBREW_CURL:-curl}\" -V)\"\n+    if [[ \"${curl_version}\" =~ HTTP/2 ]]\n+    then\n+      output=\"${output} HTTP2\"",
        "comment_created_at": "2024-11-15T16:02:50+00:00",
        "comment_author": "MikeMcQuaid",
        "comment_body": "Gotcha, thanks. I'd be tempted to just use Homebrew's `curl` in that case rather than have a shim. Can we use `uses_from_macos \"curl\", since:` instead to handle macOS 13 and below?",
        "pr_file_module": null
      },
      {
        "comment_id": "1845173748",
        "repo_full_name": "Homebrew/brew",
        "pr_number": 18773,
        "pr_file": "Library/Homebrew/shims/mac/super/curl-config",
        "discussion_id": "1843405562",
        "commented_code": "@@ -0,0 +1,35 @@\n+#!/bin/bash -p\n+\n+# HOMEBREW_LIBRARY is set by bin/brew\n+# HOMEBREW_CURL_CONFIG is set by brew.sh\n+# shellcheck disable=SC2154\n+source \"${HOMEBREW_LIBRARY}/Homebrew/shims/utils.sh\"\n+\n+# Check if HOMEBREW_CURL_CONFIG is set, fallback to system curl-config if not.\n+curl_config_exec=\"${HOMEBREW_CURL_CONFIG:-/usr/bin/curl-config}\"\n+\n+# Intercept --features and append HTTP2 if needed\n+if [[ \"$1\" == \"--features\" ]]\n+then\n+  output=\"$(\"${curl_config_exec}\" \"$@\")\"\n+\n+  # Check if HTTP2 is missing but supported\n+  if [[ ! \"${output}\" =~ HTTP2 ]]\n+  then\n+    curl_version=\"$(\"${HOMEBREW_CURL:-curl}\" -V)\"\n+    if [[ \"${curl_version}\" =~ HTTP/2 ]]\n+    then\n+      output=\"${output} HTTP2\"",
        "comment_created_at": "2024-11-16T18:19:12+00:00",
        "comment_author": "chenrui333",
        "comment_body": "yeah, that should also work.",
        "pr_file_module": null
      },
      {
        "comment_id": "1847392522",
        "repo_full_name": "Homebrew/brew",
        "pr_number": 18773,
        "pr_file": "Library/Homebrew/shims/mac/super/curl-config",
        "discussion_id": "1843405562",
        "commented_code": "@@ -0,0 +1,35 @@\n+#!/bin/bash -p\n+\n+# HOMEBREW_LIBRARY is set by bin/brew\n+# HOMEBREW_CURL_CONFIG is set by brew.sh\n+# shellcheck disable=SC2154\n+source \"${HOMEBREW_LIBRARY}/Homebrew/shims/utils.sh\"\n+\n+# Check if HOMEBREW_CURL_CONFIG is set, fallback to system curl-config if not.\n+curl_config_exec=\"${HOMEBREW_CURL_CONFIG:-/usr/bin/curl-config}\"\n+\n+# Intercept --features and append HTTP2 if needed\n+if [[ \"$1\" == \"--features\" ]]\n+then\n+  output=\"$(\"${curl_config_exec}\" \"$@\")\"\n+\n+  # Check if HTTP2 is missing but supported\n+  if [[ ! \"${output}\" =~ HTTP2 ]]\n+  then\n+    curl_version=\"$(\"${HOMEBREW_CURL:-curl}\" -V)\"\n+    if [[ \"${curl_version}\" =~ HTTP/2 ]]\n+    then\n+      output=\"${output} HTTP2\"",
        "comment_created_at": "2024-11-18T23:02:22+00:00",
        "comment_author": "chenrui333",
        "comment_body": "@MikeMcQuaid that hack (`uses_from_macos \"curl\", since: :sonoma`) would actually enable the linkage against system curl, see [this build log](https://github.com/Homebrew/homebrew-core/actions/runs/11872759852/job/33086872512).\r\n\r\nIn other words, I still feel like it is better to patch the curl-config report. I know this would be only for ventura builds. Let me know what you think.\r\n\r\ncc @Bo98 \r\n\r\n(we have already merged the linked PRs on the homebrew-core side)",
        "pr_file_module": null
      },
      {
        "comment_id": "1847899779",
        "repo_full_name": "Homebrew/brew",
        "pr_number": 18773,
        "pr_file": "Library/Homebrew/shims/mac/super/curl-config",
        "discussion_id": "1843405562",
        "commented_code": "@@ -0,0 +1,35 @@\n+#!/bin/bash -p\n+\n+# HOMEBREW_LIBRARY is set by bin/brew\n+# HOMEBREW_CURL_CONFIG is set by brew.sh\n+# shellcheck disable=SC2154\n+source \"${HOMEBREW_LIBRARY}/Homebrew/shims/utils.sh\"\n+\n+# Check if HOMEBREW_CURL_CONFIG is set, fallback to system curl-config if not.\n+curl_config_exec=\"${HOMEBREW_CURL_CONFIG:-/usr/bin/curl-config}\"\n+\n+# Intercept --features and append HTTP2 if needed\n+if [[ \"$1\" == \"--features\" ]]\n+then\n+  output=\"$(\"${curl_config_exec}\" \"$@\")\"\n+\n+  # Check if HTTP2 is missing but supported\n+  if [[ ! \"${output}\" =~ HTTP2 ]]\n+  then\n+    curl_version=\"$(\"${HOMEBREW_CURL:-curl}\" -V)\"\n+    if [[ \"${curl_version}\" =~ HTTP/2 ]]\n+    then\n+      output=\"${output} HTTP2\"",
        "comment_created_at": "2024-11-19T08:38:27+00:00",
        "comment_author": "MikeMcQuaid",
        "comment_body": "> @MikeMcQuaid that hack (`uses_from_macos \"curl\", since: :sonoma`) would actually enable the linkage against system curl, see [this build log](https://github.com/Homebrew/homebrew-core/actions/runs/11872759852/job/33086872512).\r\n\r\n@chenrui333 on which macOS versions would it link against/not link against system `curl`? Thanks!",
        "pr_file_module": null
      },
      {
        "comment_id": "1847900595",
        "repo_full_name": "Homebrew/brew",
        "pr_number": 18773,
        "pr_file": "Library/Homebrew/shims/mac/super/curl-config",
        "discussion_id": "1843405562",
        "commented_code": "@@ -0,0 +1,35 @@\n+#!/bin/bash -p\n+\n+# HOMEBREW_LIBRARY is set by bin/brew\n+# HOMEBREW_CURL_CONFIG is set by brew.sh\n+# shellcheck disable=SC2154\n+source \"${HOMEBREW_LIBRARY}/Homebrew/shims/utils.sh\"\n+\n+# Check if HOMEBREW_CURL_CONFIG is set, fallback to system curl-config if not.\n+curl_config_exec=\"${HOMEBREW_CURL_CONFIG:-/usr/bin/curl-config}\"\n+\n+# Intercept --features and append HTTP2 if needed\n+if [[ \"$1\" == \"--features\" ]]\n+then\n+  output=\"$(\"${curl_config_exec}\" \"$@\")\"\n+\n+  # Check if HTTP2 is missing but supported\n+  if [[ ! \"${output}\" =~ HTTP2 ]]\n+  then\n+    curl_version=\"$(\"${HOMEBREW_CURL:-curl}\" -V)\"\n+    if [[ \"${curl_version}\" =~ HTTP/2 ]]\n+    then\n+      output=\"${output} HTTP2\"",
        "comment_created_at": "2024-11-19T08:39:00+00:00",
        "comment_author": "MikeMcQuaid",
        "comment_body": "> I know this would be only for ventura builds.\r\n\r\nFor one, non-latest macOS version this seems overkill, personally, but I'm open to thoughts from other maintainers.",
        "pr_file_module": null
      },
      {
        "comment_id": "1848539965",
        "repo_full_name": "Homebrew/brew",
        "pr_number": 18773,
        "pr_file": "Library/Homebrew/shims/mac/super/curl-config",
        "discussion_id": "1843405562",
        "commented_code": "@@ -0,0 +1,35 @@\n+#!/bin/bash -p\n+\n+# HOMEBREW_LIBRARY is set by bin/brew\n+# HOMEBREW_CURL_CONFIG is set by brew.sh\n+# shellcheck disable=SC2154\n+source \"${HOMEBREW_LIBRARY}/Homebrew/shims/utils.sh\"\n+\n+# Check if HOMEBREW_CURL_CONFIG is set, fallback to system curl-config if not.\n+curl_config_exec=\"${HOMEBREW_CURL_CONFIG:-/usr/bin/curl-config}\"\n+\n+# Intercept --features and append HTTP2 if needed\n+if [[ \"$1\" == \"--features\" ]]\n+then\n+  output=\"$(\"${curl_config_exec}\" \"$@\")\"\n+\n+  # Check if HTTP2 is missing but supported\n+  if [[ ! \"${output}\" =~ HTTP2 ]]\n+  then\n+    curl_version=\"$(\"${HOMEBREW_CURL:-curl}\" -V)\"\n+    if [[ \"${curl_version}\" =~ HTTP/2 ]]\n+    then\n+      output=\"${output} HTTP2\"",
        "comment_created_at": "2024-11-19T15:08:29+00:00",
        "comment_author": "chenrui333",
        "comment_body": "yeah, this only happens for ventura builds, for sonoma/sequoia builds, it works fine.",
        "pr_file_module": null
      },
      {
        "comment_id": "1848547378",
        "repo_full_name": "Homebrew/brew",
        "pr_number": 18773,
        "pr_file": "Library/Homebrew/shims/mac/super/curl-config",
        "discussion_id": "1843405562",
        "commented_code": "@@ -0,0 +1,35 @@\n+#!/bin/bash -p\n+\n+# HOMEBREW_LIBRARY is set by bin/brew\n+# HOMEBREW_CURL_CONFIG is set by brew.sh\n+# shellcheck disable=SC2154\n+source \"${HOMEBREW_LIBRARY}/Homebrew/shims/utils.sh\"\n+\n+# Check if HOMEBREW_CURL_CONFIG is set, fallback to system curl-config if not.\n+curl_config_exec=\"${HOMEBREW_CURL_CONFIG:-/usr/bin/curl-config}\"\n+\n+# Intercept --features and append HTTP2 if needed\n+if [[ \"$1\" == \"--features\" ]]\n+then\n+  output=\"$(\"${curl_config_exec}\" \"$@\")\"\n+\n+  # Check if HTTP2 is missing but supported\n+  if [[ ! \"${output}\" =~ HTTP2 ]]\n+  then\n+    curl_version=\"$(\"${HOMEBREW_CURL:-curl}\" -V)\"\n+    if [[ \"${curl_version}\" =~ HTTP/2 ]]\n+    then\n+      output=\"${output} HTTP2\"",
        "comment_created_at": "2024-11-19T15:12:41+00:00",
        "comment_author": "MikeMcQuaid",
        "comment_body": "@chenrui333 Thanks, not worth doing for a single OS version IMO, sorry.",
        "pr_file_module": null
      },
      {
        "comment_id": "1855222275",
        "repo_full_name": "Homebrew/brew",
        "pr_number": 18773,
        "pr_file": "Library/Homebrew/shims/mac/super/curl-config",
        "discussion_id": "1843405562",
        "commented_code": "@@ -0,0 +1,35 @@\n+#!/bin/bash -p\n+\n+# HOMEBREW_LIBRARY is set by bin/brew\n+# HOMEBREW_CURL_CONFIG is set by brew.sh\n+# shellcheck disable=SC2154\n+source \"${HOMEBREW_LIBRARY}/Homebrew/shims/utils.sh\"\n+\n+# Check if HOMEBREW_CURL_CONFIG is set, fallback to system curl-config if not.\n+curl_config_exec=\"${HOMEBREW_CURL_CONFIG:-/usr/bin/curl-config}\"\n+\n+# Intercept --features and append HTTP2 if needed\n+if [[ \"$1\" == \"--features\" ]]\n+then\n+  output=\"$(\"${curl_config_exec}\" \"$@\")\"\n+\n+  # Check if HTTP2 is missing but supported\n+  if [[ ! \"${output}\" =~ HTTP2 ]]\n+  then\n+    curl_version=\"$(\"${HOMEBREW_CURL:-curl}\" -V)\"\n+    if [[ \"${curl_version}\" =~ HTTP/2 ]]\n+    then\n+      output=\"${output} HTTP2\"",
        "comment_created_at": "2024-11-23T16:31:07+00:00",
        "comment_author": "chenrui333",
        "comment_body": "understand. 👍 😄 ",
        "pr_file_module": null
      }
    ]
  }
]