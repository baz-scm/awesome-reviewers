---
title: Limit token permissions
description: Always specify the minimum required permissions for the GITHUB_TOKEN
  in GitHub Actions workflows to enhance security. By default, the GITHUB_TOKEN has
  broad permissions that could potentially be exploited if a workflow is compromised.
repository: chef/chef
label: Security
language: Yaml
comments_count: 12
repository_stars: 7860
---

Always specify the minimum required permissions for the GITHUB_TOKEN in GitHub Actions workflows to enhance security. By default, the GITHUB_TOKEN has broad permissions that could potentially be exploited if a workflow is compromised.

Add an explicit permissions block at the workflow level or per job with only the necessary permissions:

```yaml
name: Verify

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

# Add a permissions block at the workflow level
permissions:
  contents: read
  # Only add other permissions as strictly needed

env:
  CHEF_LICENSE: accept-no-persist

jobs:
  linux-matrix:
    # Job configuration follows...
```

This practice follows the principle of least privilege and reduces the potential impact if a workflow is compromised by a malicious pull request or action.


[
  {
    "discussion_id": "2178132199",
    "pr_number": 15076,
    "pr_file": ".github/workflows/verify.yml",
    "created_at": "2025-07-01T17:09:07+00:00",
    "commented_code": "name: Verify\n\non:\n  push:\n    branches: [main, feature/github-actions-migration]  # Add your temp branch here\n  pull_request:\n    branches: [main]\n\nenv:\n  CHEF_LICENSE_SERVER: http://hosted-license-service-lb-8000-606952349.us-west-2.elb.amazonaws.com:8000/\n  CHEF_FOUNDATION_VERSION: ${{ vars.CHEF_FOUNDATION_VERSION || '3.2.12' }}\n  CHEF_LICENSE: accept-no-persist\n\njobs:\n  linux-matrix:\n    name: ${{ matrix.test_type }} - ${{ matrix.os }}\n    runs-on: ubuntu-22.04\n    timeout-minutes: 60\n    strategy:\n      fail-fast: false\n      matrix:\n        os: [rocky-8, rocky-9, rhel-9, debian-9, ubuntu-2004]\n        test_type: [Unit, Integration, Functional]\n    container:\n      image: chefes/omnibus-toolchain-${{ matrix.os }}:3.0.36\n      options: --privileged --user root\n    steps:\n      - name: Check out code\n        uses: actions/checkout@v4\n\n      - name: Container prep\n        run: .expeditor/scripts/bk_container_prep.sh\n\n      - name: Run ${{ matrix.test_type }} tests\n        run: .expeditor/scripts/prep_and_run_tests.sh ${{ matrix.test_type }}\n        env:\n          CHEF_LICENSE_SERVER: ${{ env.CHEF_LICENSE_SERVER }}\n\n  windows-tests:",
    "repo_full_name": "chef/chef",
    "discussion_comments": [
      {
        "comment_id": "2178132199",
        "repo_full_name": "chef/chef",
        "pr_number": 15076,
        "pr_file": ".github/workflows/verify.yml",
        "discussion_id": "2178132199",
        "commented_code": "@@ -0,0 +1,167 @@\n+name: Verify\n+\n+on:\n+  push:\n+    branches: [main, feature/github-actions-migration]  # Add your temp branch here\n+  pull_request:\n+    branches: [main]\n+\n+env:\n+  CHEF_LICENSE_SERVER: http://hosted-license-service-lb-8000-606952349.us-west-2.elb.amazonaws.com:8000/\n+  CHEF_FOUNDATION_VERSION: ${{ vars.CHEF_FOUNDATION_VERSION || '3.2.12' }}\n+  CHEF_LICENSE: accept-no-persist\n+\n+jobs:\n+  linux-matrix:\n+    name: ${{ matrix.test_type }} - ${{ matrix.os }}\n+    runs-on: ubuntu-22.04\n+    timeout-minutes: 60\n+    strategy:\n+      fail-fast: false\n+      matrix:\n+        os: [rocky-8, rocky-9, rhel-9, debian-9, ubuntu-2004]\n+        test_type: [Unit, Integration, Functional]\n+    container:\n+      image: chefes/omnibus-toolchain-${{ matrix.os }}:3.0.36\n+      options: --privileged --user root\n+    steps:\n+      - name: Check out code\n+        uses: actions/checkout@v4\n+\n+      - name: Container prep\n+        run: .expeditor/scripts/bk_container_prep.sh\n+\n+      - name: Run ${{ matrix.test_type }} tests\n+        run: .expeditor/scripts/prep_and_run_tests.sh ${{ matrix.test_type }}\n+        env:\n+          CHEF_LICENSE_SERVER: ${{ env.CHEF_LICENSE_SERVER }}\n+\n+  windows-tests:",
        "comment_created_at": "2025-07-01T17:09:07+00:00",
        "comment_author": "github-advanced-security[bot]",
        "comment_body": "## Workflow does not contain permissions\n\nActions job or workflow does not limit the permissions of the GITHUB_TOKEN. Consider setting an explicit permissions block, using the following as a minimal starting point: {{contents: read}}\n\n[Show more details](https://github.com/chef/chef/security/code-scanning/292)",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2178132200",
    "pr_number": 15076,
    "pr_file": ".github/workflows/verify.yml",
    "created_at": "2025-07-01T17:09:07+00:00",
    "commented_code": "name: Verify\n\non:\n  push:\n    branches: [main, feature/github-actions-migration]  # Add your temp branch here\n  pull_request:\n    branches: [main]\n\nenv:\n  CHEF_LICENSE_SERVER: http://hosted-license-service-lb-8000-606952349.us-west-2.elb.amazonaws.com:8000/\n  CHEF_FOUNDATION_VERSION: ${{ vars.CHEF_FOUNDATION_VERSION || '3.2.12' }}\n  CHEF_LICENSE: accept-no-persist\n\njobs:\n  linux-matrix:\n    name: ${{ matrix.test_type }} - ${{ matrix.os }}\n    runs-on: ubuntu-22.04\n    timeout-minutes: 60\n    strategy:\n      fail-fast: false\n      matrix:\n        os: [rocky-8, rocky-9, rhel-9, debian-9, ubuntu-2004]\n        test_type: [Unit, Integration, Functional]\n    container:\n      image: chefes/omnibus-toolchain-${{ matrix.os }}:3.0.36\n      options: --privileged --user root\n    steps:\n      - name: Check out code\n        uses: actions/checkout@v4\n\n      - name: Container prep\n        run: .expeditor/scripts/bk_container_prep.sh\n\n      - name: Run ${{ matrix.test_type }} tests\n        run: .expeditor/scripts/prep_and_run_tests.sh ${{ matrix.test_type }}\n        env:\n          CHEF_LICENSE_SERVER: ${{ env.CHEF_LICENSE_SERVER }}\n\n  windows-tests:\n    name: ${{ matrix.test_type }} - Windows 2019\n    runs-on: windows-2019\n    timeout-minutes: 120\n    strategy:\n      fail-fast: false\n      matrix:\n        test_type: [Unit, Integration, Functional]\n    steps:\n      - name: Check out code\n        uses: actions/checkout@v4\n\n      - name: Set up Ruby\n        uses: ruby/setup-ruby@v1\n        with:\n          ruby-version: '3.1'\n          bundler-cache: true\n\n      - name: Run ${{ matrix.test_type }} tests\n        shell: pwsh\n        run: .\\.expeditor\\scripts\\prep_and_run_tests.ps1 ${{ matrix.test_type }}\n        env:\n          CHEF_LICENSE_SERVER: ${{ env.CHEF_LICENSE_SERVER }}\n\n  gem-tests:",
    "repo_full_name": "chef/chef",
    "discussion_comments": [
      {
        "comment_id": "2178132200",
        "repo_full_name": "chef/chef",
        "pr_number": 15076,
        "pr_file": ".github/workflows/verify.yml",
        "discussion_id": "2178132200",
        "commented_code": "@@ -0,0 +1,167 @@\n+name: Verify\n+\n+on:\n+  push:\n+    branches: [main, feature/github-actions-migration]  # Add your temp branch here\n+  pull_request:\n+    branches: [main]\n+\n+env:\n+  CHEF_LICENSE_SERVER: http://hosted-license-service-lb-8000-606952349.us-west-2.elb.amazonaws.com:8000/\n+  CHEF_FOUNDATION_VERSION: ${{ vars.CHEF_FOUNDATION_VERSION || '3.2.12' }}\n+  CHEF_LICENSE: accept-no-persist\n+\n+jobs:\n+  linux-matrix:\n+    name: ${{ matrix.test_type }} - ${{ matrix.os }}\n+    runs-on: ubuntu-22.04\n+    timeout-minutes: 60\n+    strategy:\n+      fail-fast: false\n+      matrix:\n+        os: [rocky-8, rocky-9, rhel-9, debian-9, ubuntu-2004]\n+        test_type: [Unit, Integration, Functional]\n+    container:\n+      image: chefes/omnibus-toolchain-${{ matrix.os }}:3.0.36\n+      options: --privileged --user root\n+    steps:\n+      - name: Check out code\n+        uses: actions/checkout@v4\n+\n+      - name: Container prep\n+        run: .expeditor/scripts/bk_container_prep.sh\n+\n+      - name: Run ${{ matrix.test_type }} tests\n+        run: .expeditor/scripts/prep_and_run_tests.sh ${{ matrix.test_type }}\n+        env:\n+          CHEF_LICENSE_SERVER: ${{ env.CHEF_LICENSE_SERVER }}\n+\n+  windows-tests:\n+    name: ${{ matrix.test_type }} - Windows 2019\n+    runs-on: windows-2019\n+    timeout-minutes: 120\n+    strategy:\n+      fail-fast: false\n+      matrix:\n+        test_type: [Unit, Integration, Functional]\n+    steps:\n+      - name: Check out code\n+        uses: actions/checkout@v4\n+\n+      - name: Set up Ruby\n+        uses: ruby/setup-ruby@v1\n+        with:\n+          ruby-version: '3.1'\n+          bundler-cache: true\n+\n+      - name: Run ${{ matrix.test_type }} tests\n+        shell: pwsh\n+        run: .\\.expeditor\\scripts\\prep_and_run_tests.ps1 ${{ matrix.test_type }}\n+        env:\n+          CHEF_LICENSE_SERVER: ${{ env.CHEF_LICENSE_SERVER }}\n+\n+  gem-tests:",
        "comment_created_at": "2025-07-01T17:09:07+00:00",
        "comment_author": "github-advanced-security[bot]",
        "comment_body": "## Workflow does not contain permissions\n\nActions job or workflow does not limit the permissions of the GITHUB_TOKEN. Consider setting an explicit permissions block, using the following as a minimal starting point: {{contents: read}}\n\n[Show more details](https://github.com/chef/chef/security/code-scanning/293)",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2178132204",
    "pr_number": 15076,
    "pr_file": ".github/workflows/verify.yml",
    "created_at": "2025-07-01T17:09:07+00:00",
    "commented_code": "name: Verify\n\non:\n  push:\n    branches: [main, feature/github-actions-migration]  # Add your temp branch here\n  pull_request:\n    branches: [main]\n\nenv:\n  CHEF_LICENSE_SERVER: http://hosted-license-service-lb-8000-606952349.us-west-2.elb.amazonaws.com:8000/\n  CHEF_FOUNDATION_VERSION: ${{ vars.CHEF_FOUNDATION_VERSION || '3.2.12' }}\n  CHEF_LICENSE: accept-no-persist\n\njobs:\n  linux-matrix:\n    name: ${{ matrix.test_type }} - ${{ matrix.os }}\n    runs-on: ubuntu-22.04\n    timeout-minutes: 60\n    strategy:\n      fail-fast: false\n      matrix:\n        os: [rocky-8, rocky-9, rhel-9, debian-9, ubuntu-2004]\n        test_type: [Unit, Integration, Functional]\n    container:\n      image: chefes/omnibus-toolchain-${{ matrix.os }}:3.0.36\n      options: --privileged --user root\n    steps:\n      - name: Check out code\n        uses: actions/checkout@v4\n\n      - name: Container prep\n        run: .expeditor/scripts/bk_container_prep.sh\n\n      - name: Run ${{ matrix.test_type }} tests\n        run: .expeditor/scripts/prep_and_run_tests.sh ${{ matrix.test_type }}\n        env:\n          CHEF_LICENSE_SERVER: ${{ env.CHEF_LICENSE_SERVER }}\n\n  windows-tests:\n    name: ${{ matrix.test_type }} - Windows 2019\n    runs-on: windows-2019\n    timeout-minutes: 120\n    strategy:\n      fail-fast: false\n      matrix:\n        test_type: [Unit, Integration, Functional]\n    steps:\n      - name: Check out code\n        uses: actions/checkout@v4\n\n      - name: Set up Ruby\n        uses: ruby/setup-ruby@v1\n        with:\n          ruby-version: '3.1'\n          bundler-cache: true\n\n      - name: Run ${{ matrix.test_type }} tests\n        shell: pwsh\n        run: .\\.expeditor\\scripts\\prep_and_run_tests.ps1 ${{ matrix.test_type }}\n        env:\n          CHEF_LICENSE_SERVER: ${{ env.CHEF_LICENSE_SERVER }}\n\n  gem-tests:\n    name: ${{ matrix.gem }} gem\n    runs-on: ubuntu-22.04\n    timeout-minutes: 60\n    strategy:\n      fail-fast: false\n      matrix:\n        gem: [chef-zero, cheffish, chefspec, knife-windows, berkshelf]\n        include:\n          - gem: chef-zero\n            test_cmd: bundle exec tasks/bin/run_external_test chef/chef-zero main rake pedant\n            env_vars: |\n              PEDANT_OPTS=--skip-oc_id\n              CHEF_FS=true\n          - gem: cheffish\n            test_cmd: bundle exec tasks/bin/run_external_test chef/cheffish main rake spec\n          - gem: chefspec\n            test_cmd: bundle exec tasks/bin/run_external_test chef/chefspec main rake\n          - gem: knife-windows\n            test_cmd: bundle exec tasks/bin/run_external_test chef/knife-windows main rake spec\n          - gem: berkshelf\n            test_cmd: bundle exec tasks/bin/run_external_test chef/berkshelf main rake\n            pre_install: apt-get update -y && apt-get install -y graphviz\n    container:\n      image: chefes/omnibus-toolchain-ubuntu-1804:3.0.36\n      options: --user root\n    steps:\n      - name: Check out code\n        uses: actions/checkout@v4\n\n      - name: Container prep\n        run: .expeditor/scripts/bk_container_prep.sh\n\n      - name: Set up environment\n        run: |\n          export PATH=\"/root/.rbenv/shims:/opt/chef/bin:/home/ec2-user/.tfenv/bin:/home/ec2-user/.rbenv/shims:/home/ec2-user/.rbenv/bin:/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/usr/bin\"\n          echo \"PATH=$PATH\" >> $GITHUB_ENV\n\n      - name: Pre-install dependencies\n        if: matrix.pre_install\n        run: ${{ matrix.pre_install }}\n\n      - name: Bundle install\n        run: |\n          bundle config set --local without omnibus_package\n          bundle config set --local path 'vendor/bundle'\n          bundle install --jobs=3 --retry=3\n\n      - name: Run ${{ matrix.gem }} tests\n        run: ${{ matrix.test_cmd }}\n        env:\n          CHEF_FOUNDATION_VERSION: ${{ env.CHEF_FOUNDATION_VERSION }}\n          PEDANT_OPTS: ${{ matrix.gem == 'chef-zero' && '--skip-oc_id' || '' }}\n          CHEF_FS: ${{ matrix.gem == 'chef-zero' && 'true' || '' }}\n\n  habitat-linux-plan:",
    "repo_full_name": "chef/chef",
    "discussion_comments": [
      {
        "comment_id": "2178132204",
        "repo_full_name": "chef/chef",
        "pr_number": 15076,
        "pr_file": ".github/workflows/verify.yml",
        "discussion_id": "2178132204",
        "commented_code": "@@ -0,0 +1,167 @@\n+name: Verify\n+\n+on:\n+  push:\n+    branches: [main, feature/github-actions-migration]  # Add your temp branch here\n+  pull_request:\n+    branches: [main]\n+\n+env:\n+  CHEF_LICENSE_SERVER: http://hosted-license-service-lb-8000-606952349.us-west-2.elb.amazonaws.com:8000/\n+  CHEF_FOUNDATION_VERSION: ${{ vars.CHEF_FOUNDATION_VERSION || '3.2.12' }}\n+  CHEF_LICENSE: accept-no-persist\n+\n+jobs:\n+  linux-matrix:\n+    name: ${{ matrix.test_type }} - ${{ matrix.os }}\n+    runs-on: ubuntu-22.04\n+    timeout-minutes: 60\n+    strategy:\n+      fail-fast: false\n+      matrix:\n+        os: [rocky-8, rocky-9, rhel-9, debian-9, ubuntu-2004]\n+        test_type: [Unit, Integration, Functional]\n+    container:\n+      image: chefes/omnibus-toolchain-${{ matrix.os }}:3.0.36\n+      options: --privileged --user root\n+    steps:\n+      - name: Check out code\n+        uses: actions/checkout@v4\n+\n+      - name: Container prep\n+        run: .expeditor/scripts/bk_container_prep.sh\n+\n+      - name: Run ${{ matrix.test_type }} tests\n+        run: .expeditor/scripts/prep_and_run_tests.sh ${{ matrix.test_type }}\n+        env:\n+          CHEF_LICENSE_SERVER: ${{ env.CHEF_LICENSE_SERVER }}\n+\n+  windows-tests:\n+    name: ${{ matrix.test_type }} - Windows 2019\n+    runs-on: windows-2019\n+    timeout-minutes: 120\n+    strategy:\n+      fail-fast: false\n+      matrix:\n+        test_type: [Unit, Integration, Functional]\n+    steps:\n+      - name: Check out code\n+        uses: actions/checkout@v4\n+\n+      - name: Set up Ruby\n+        uses: ruby/setup-ruby@v1\n+        with:\n+          ruby-version: '3.1'\n+          bundler-cache: true\n+\n+      - name: Run ${{ matrix.test_type }} tests\n+        shell: pwsh\n+        run: .\\.expeditor\\scripts\\prep_and_run_tests.ps1 ${{ matrix.test_type }}\n+        env:\n+          CHEF_LICENSE_SERVER: ${{ env.CHEF_LICENSE_SERVER }}\n+\n+  gem-tests:\n+    name: ${{ matrix.gem }} gem\n+    runs-on: ubuntu-22.04\n+    timeout-minutes: 60\n+    strategy:\n+      fail-fast: false\n+      matrix:\n+        gem: [chef-zero, cheffish, chefspec, knife-windows, berkshelf]\n+        include:\n+          - gem: chef-zero\n+            test_cmd: bundle exec tasks/bin/run_external_test chef/chef-zero main rake pedant\n+            env_vars: |\n+              PEDANT_OPTS=--skip-oc_id\n+              CHEF_FS=true\n+          - gem: cheffish\n+            test_cmd: bundle exec tasks/bin/run_external_test chef/cheffish main rake spec\n+          - gem: chefspec\n+            test_cmd: bundle exec tasks/bin/run_external_test chef/chefspec main rake\n+          - gem: knife-windows\n+            test_cmd: bundle exec tasks/bin/run_external_test chef/knife-windows main rake spec\n+          - gem: berkshelf\n+            test_cmd: bundle exec tasks/bin/run_external_test chef/berkshelf main rake\n+            pre_install: apt-get update -y && apt-get install -y graphviz\n+    container:\n+      image: chefes/omnibus-toolchain-ubuntu-1804:3.0.36\n+      options: --user root\n+    steps:\n+      - name: Check out code\n+        uses: actions/checkout@v4\n+\n+      - name: Container prep\n+        run: .expeditor/scripts/bk_container_prep.sh\n+\n+      - name: Set up environment\n+        run: |\n+          export PATH=\"/root/.rbenv/shims:/opt/chef/bin:/home/ec2-user/.tfenv/bin:/home/ec2-user/.rbenv/shims:/home/ec2-user/.rbenv/bin:/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/usr/bin\"\n+          echo \"PATH=$PATH\" >> $GITHUB_ENV\n+\n+      - name: Pre-install dependencies\n+        if: matrix.pre_install\n+        run: ${{ matrix.pre_install }}\n+\n+      - name: Bundle install\n+        run: |\n+          bundle config set --local without omnibus_package\n+          bundle config set --local path 'vendor/bundle'\n+          bundle install --jobs=3 --retry=3\n+\n+      - name: Run ${{ matrix.gem }} tests\n+        run: ${{ matrix.test_cmd }}\n+        env:\n+          CHEF_FOUNDATION_VERSION: ${{ env.CHEF_FOUNDATION_VERSION }}\n+          PEDANT_OPTS: ${{ matrix.gem == 'chef-zero' && '--skip-oc_id' || '' }}\n+          CHEF_FS: ${{ matrix.gem == 'chef-zero' && 'true' || '' }}\n+\n+  habitat-linux-plan:",
        "comment_created_at": "2025-07-01T17:09:07+00:00",
        "comment_author": "github-advanced-security[bot]",
        "comment_body": "## Workflow does not contain permissions\n\nActions job or workflow does not limit the permissions of the GITHUB_TOKEN. Consider setting an explicit permissions block, using the following as a minimal starting point: {{contents: read}}\n\n[Show more details](https://github.com/chef/chef/security/code-scanning/294)",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2178132207",
    "pr_number": 15076,
    "pr_file": ".github/workflows/verify.yml",
    "created_at": "2025-07-01T17:09:07+00:00",
    "commented_code": "name: Verify\n\non:\n  push:\n    branches: [main, feature/github-actions-migration]  # Add your temp branch here\n  pull_request:\n    branches: [main]\n\nenv:\n  CHEF_LICENSE_SERVER: http://hosted-license-service-lb-8000-606952349.us-west-2.elb.amazonaws.com:8000/\n  CHEF_FOUNDATION_VERSION: ${{ vars.CHEF_FOUNDATION_VERSION || '3.2.12' }}\n  CHEF_LICENSE: accept-no-persist\n\njobs:\n  linux-matrix:\n    name: ${{ matrix.test_type }} - ${{ matrix.os }}\n    runs-on: ubuntu-22.04\n    timeout-minutes: 60\n    strategy:\n      fail-fast: false\n      matrix:\n        os: [rocky-8, rocky-9, rhel-9, debian-9, ubuntu-2004]\n        test_type: [Unit, Integration, Functional]\n    container:\n      image: chefes/omnibus-toolchain-${{ matrix.os }}:3.0.36\n      options: --privileged --user root\n    steps:\n      - name: Check out code\n        uses: actions/checkout@v4\n\n      - name: Container prep\n        run: .expeditor/scripts/bk_container_prep.sh\n\n      - name: Run ${{ matrix.test_type }} tests\n        run: .expeditor/scripts/prep_and_run_tests.sh ${{ matrix.test_type }}\n        env:\n          CHEF_LICENSE_SERVER: ${{ env.CHEF_LICENSE_SERVER }}\n\n  windows-tests:\n    name: ${{ matrix.test_type }} - Windows 2019\n    runs-on: windows-2019\n    timeout-minutes: 120\n    strategy:\n      fail-fast: false\n      matrix:\n        test_type: [Unit, Integration, Functional]\n    steps:\n      - name: Check out code\n        uses: actions/checkout@v4\n\n      - name: Set up Ruby\n        uses: ruby/setup-ruby@v1\n        with:\n          ruby-version: '3.1'\n          bundler-cache: true\n\n      - name: Run ${{ matrix.test_type }} tests\n        shell: pwsh\n        run: .\\.expeditor\\scripts\\prep_and_run_tests.ps1 ${{ matrix.test_type }}\n        env:\n          CHEF_LICENSE_SERVER: ${{ env.CHEF_LICENSE_SERVER }}\n\n  gem-tests:\n    name: ${{ matrix.gem }} gem\n    runs-on: ubuntu-22.04\n    timeout-minutes: 60\n    strategy:\n      fail-fast: false\n      matrix:\n        gem: [chef-zero, cheffish, chefspec, knife-windows, berkshelf]\n        include:\n          - gem: chef-zero\n            test_cmd: bundle exec tasks/bin/run_external_test chef/chef-zero main rake pedant\n            env_vars: |\n              PEDANT_OPTS=--skip-oc_id\n              CHEF_FS=true\n          - gem: cheffish\n            test_cmd: bundle exec tasks/bin/run_external_test chef/cheffish main rake spec\n          - gem: chefspec\n            test_cmd: bundle exec tasks/bin/run_external_test chef/chefspec main rake\n          - gem: knife-windows\n            test_cmd: bundle exec tasks/bin/run_external_test chef/knife-windows main rake spec\n          - gem: berkshelf\n            test_cmd: bundle exec tasks/bin/run_external_test chef/berkshelf main rake\n            pre_install: apt-get update -y && apt-get install -y graphviz\n    container:\n      image: chefes/omnibus-toolchain-ubuntu-1804:3.0.36\n      options: --user root\n    steps:\n      - name: Check out code\n        uses: actions/checkout@v4\n\n      - name: Container prep\n        run: .expeditor/scripts/bk_container_prep.sh\n\n      - name: Set up environment\n        run: |\n          export PATH=\"/root/.rbenv/shims:/opt/chef/bin:/home/ec2-user/.tfenv/bin:/home/ec2-user/.rbenv/shims:/home/ec2-user/.rbenv/bin:/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/usr/bin\"\n          echo \"PATH=$PATH\" >> $GITHUB_ENV\n\n      - name: Pre-install dependencies\n        if: matrix.pre_install\n        run: ${{ matrix.pre_install }}\n\n      - name: Bundle install\n        run: |\n          bundle config set --local without omnibus_package\n          bundle config set --local path 'vendor/bundle'\n          bundle install --jobs=3 --retry=3\n\n      - name: Run ${{ matrix.gem }} tests\n        run: ${{ matrix.test_cmd }}\n        env:\n          CHEF_FOUNDATION_VERSION: ${{ env.CHEF_FOUNDATION_VERSION }}\n          PEDANT_OPTS: ${{ matrix.gem == 'chef-zero' && '--skip-oc_id' || '' }}\n          CHEF_FS: ${{ matrix.gem == 'chef-zero' && 'true' || '' }}\n\n  habitat-linux-plan:\n    name: Habitat Linux Plan\n    runs-on: ubuntu-latest\n    timeout-minutes: 60\n    steps:\n      - name: Check out code\n        uses: actions/checkout@v4\n\n      - name: Install Habitat\n        run: sudo ./.expeditor/scripts/install-hab.sh 'x86_64-linux'\n\n      - name: Verify plan\n        run: sudo ./.expeditor/scripts/verify-plan.sh\n\n  habitat-windows-plan:",
    "repo_full_name": "chef/chef",
    "discussion_comments": [
      {
        "comment_id": "2178132207",
        "repo_full_name": "chef/chef",
        "pr_number": 15076,
        "pr_file": ".github/workflows/verify.yml",
        "discussion_id": "2178132207",
        "commented_code": "@@ -0,0 +1,167 @@\n+name: Verify\n+\n+on:\n+  push:\n+    branches: [main, feature/github-actions-migration]  # Add your temp branch here\n+  pull_request:\n+    branches: [main]\n+\n+env:\n+  CHEF_LICENSE_SERVER: http://hosted-license-service-lb-8000-606952349.us-west-2.elb.amazonaws.com:8000/\n+  CHEF_FOUNDATION_VERSION: ${{ vars.CHEF_FOUNDATION_VERSION || '3.2.12' }}\n+  CHEF_LICENSE: accept-no-persist\n+\n+jobs:\n+  linux-matrix:\n+    name: ${{ matrix.test_type }} - ${{ matrix.os }}\n+    runs-on: ubuntu-22.04\n+    timeout-minutes: 60\n+    strategy:\n+      fail-fast: false\n+      matrix:\n+        os: [rocky-8, rocky-9, rhel-9, debian-9, ubuntu-2004]\n+        test_type: [Unit, Integration, Functional]\n+    container:\n+      image: chefes/omnibus-toolchain-${{ matrix.os }}:3.0.36\n+      options: --privileged --user root\n+    steps:\n+      - name: Check out code\n+        uses: actions/checkout@v4\n+\n+      - name: Container prep\n+        run: .expeditor/scripts/bk_container_prep.sh\n+\n+      - name: Run ${{ matrix.test_type }} tests\n+        run: .expeditor/scripts/prep_and_run_tests.sh ${{ matrix.test_type }}\n+        env:\n+          CHEF_LICENSE_SERVER: ${{ env.CHEF_LICENSE_SERVER }}\n+\n+  windows-tests:\n+    name: ${{ matrix.test_type }} - Windows 2019\n+    runs-on: windows-2019\n+    timeout-minutes: 120\n+    strategy:\n+      fail-fast: false\n+      matrix:\n+        test_type: [Unit, Integration, Functional]\n+    steps:\n+      - name: Check out code\n+        uses: actions/checkout@v4\n+\n+      - name: Set up Ruby\n+        uses: ruby/setup-ruby@v1\n+        with:\n+          ruby-version: '3.1'\n+          bundler-cache: true\n+\n+      - name: Run ${{ matrix.test_type }} tests\n+        shell: pwsh\n+        run: .\\.expeditor\\scripts\\prep_and_run_tests.ps1 ${{ matrix.test_type }}\n+        env:\n+          CHEF_LICENSE_SERVER: ${{ env.CHEF_LICENSE_SERVER }}\n+\n+  gem-tests:\n+    name: ${{ matrix.gem }} gem\n+    runs-on: ubuntu-22.04\n+    timeout-minutes: 60\n+    strategy:\n+      fail-fast: false\n+      matrix:\n+        gem: [chef-zero, cheffish, chefspec, knife-windows, berkshelf]\n+        include:\n+          - gem: chef-zero\n+            test_cmd: bundle exec tasks/bin/run_external_test chef/chef-zero main rake pedant\n+            env_vars: |\n+              PEDANT_OPTS=--skip-oc_id\n+              CHEF_FS=true\n+          - gem: cheffish\n+            test_cmd: bundle exec tasks/bin/run_external_test chef/cheffish main rake spec\n+          - gem: chefspec\n+            test_cmd: bundle exec tasks/bin/run_external_test chef/chefspec main rake\n+          - gem: knife-windows\n+            test_cmd: bundle exec tasks/bin/run_external_test chef/knife-windows main rake spec\n+          - gem: berkshelf\n+            test_cmd: bundle exec tasks/bin/run_external_test chef/berkshelf main rake\n+            pre_install: apt-get update -y && apt-get install -y graphviz\n+    container:\n+      image: chefes/omnibus-toolchain-ubuntu-1804:3.0.36\n+      options: --user root\n+    steps:\n+      - name: Check out code\n+        uses: actions/checkout@v4\n+\n+      - name: Container prep\n+        run: .expeditor/scripts/bk_container_prep.sh\n+\n+      - name: Set up environment\n+        run: |\n+          export PATH=\"/root/.rbenv/shims:/opt/chef/bin:/home/ec2-user/.tfenv/bin:/home/ec2-user/.rbenv/shims:/home/ec2-user/.rbenv/bin:/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/usr/bin\"\n+          echo \"PATH=$PATH\" >> $GITHUB_ENV\n+\n+      - name: Pre-install dependencies\n+        if: matrix.pre_install\n+        run: ${{ matrix.pre_install }}\n+\n+      - name: Bundle install\n+        run: |\n+          bundle config set --local without omnibus_package\n+          bundle config set --local path 'vendor/bundle'\n+          bundle install --jobs=3 --retry=3\n+\n+      - name: Run ${{ matrix.gem }} tests\n+        run: ${{ matrix.test_cmd }}\n+        env:\n+          CHEF_FOUNDATION_VERSION: ${{ env.CHEF_FOUNDATION_VERSION }}\n+          PEDANT_OPTS: ${{ matrix.gem == 'chef-zero' && '--skip-oc_id' || '' }}\n+          CHEF_FS: ${{ matrix.gem == 'chef-zero' && 'true' || '' }}\n+\n+  habitat-linux-plan:\n+    name: Habitat Linux Plan\n+    runs-on: ubuntu-latest\n+    timeout-minutes: 60\n+    steps:\n+      - name: Check out code\n+        uses: actions/checkout@v4\n+\n+      - name: Install Habitat\n+        run: sudo ./.expeditor/scripts/install-hab.sh 'x86_64-linux'\n+\n+      - name: Verify plan\n+        run: sudo ./.expeditor/scripts/verify-plan.sh\n+\n+  habitat-windows-plan:",
        "comment_created_at": "2025-07-01T17:09:07+00:00",
        "comment_author": "github-advanced-security[bot]",
        "comment_body": "## Workflow does not contain permissions\n\nActions job or workflow does not limit the permissions of the GITHUB_TOKEN. Consider setting an explicit permissions block, using the following as a minimal starting point: {{contents: read}}\n\n[Show more details](https://github.com/chef/chef/security/code-scanning/295)",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2178132209",
    "pr_number": 15076,
    "pr_file": ".github/workflows/verify.yml",
    "created_at": "2025-07-01T17:09:07+00:00",
    "commented_code": "name: Verify\n\non:\n  push:\n    branches: [main, feature/github-actions-migration]  # Add your temp branch here\n  pull_request:\n    branches: [main]\n\nenv:\n  CHEF_LICENSE_SERVER: http://hosted-license-service-lb-8000-606952349.us-west-2.elb.amazonaws.com:8000/\n  CHEF_FOUNDATION_VERSION: ${{ vars.CHEF_FOUNDATION_VERSION || '3.2.12' }}\n  CHEF_LICENSE: accept-no-persist\n\njobs:\n  linux-matrix:\n    name: ${{ matrix.test_type }} - ${{ matrix.os }}\n    runs-on: ubuntu-22.04\n    timeout-minutes: 60\n    strategy:\n      fail-fast: false\n      matrix:\n        os: [rocky-8, rocky-9, rhel-9, debian-9, ubuntu-2004]\n        test_type: [Unit, Integration, Functional]\n    container:\n      image: chefes/omnibus-toolchain-${{ matrix.os }}:3.0.36\n      options: --privileged --user root\n    steps:\n      - name: Check out code\n        uses: actions/checkout@v4\n\n      - name: Container prep\n        run: .expeditor/scripts/bk_container_prep.sh\n\n      - name: Run ${{ matrix.test_type }} tests\n        run: .expeditor/scripts/prep_and_run_tests.sh ${{ matrix.test_type }}\n        env:\n          CHEF_LICENSE_SERVER: ${{ env.CHEF_LICENSE_SERVER }}\n\n  windows-tests:\n    name: ${{ matrix.test_type }} - Windows 2019\n    runs-on: windows-2019\n    timeout-minutes: 120\n    strategy:\n      fail-fast: false\n      matrix:\n        test_type: [Unit, Integration, Functional]\n    steps:\n      - name: Check out code\n        uses: actions/checkout@v4\n\n      - name: Set up Ruby\n        uses: ruby/setup-ruby@v1\n        with:\n          ruby-version: '3.1'\n          bundler-cache: true\n\n      - name: Run ${{ matrix.test_type }} tests\n        shell: pwsh\n        run: .\\.expeditor\\scripts\\prep_and_run_tests.ps1 ${{ matrix.test_type }}\n        env:\n          CHEF_LICENSE_SERVER: ${{ env.CHEF_LICENSE_SERVER }}\n\n  gem-tests:\n    name: ${{ matrix.gem }} gem\n    runs-on: ubuntu-22.04\n    timeout-minutes: 60\n    strategy:\n      fail-fast: false\n      matrix:\n        gem: [chef-zero, cheffish, chefspec, knife-windows, berkshelf]\n        include:\n          - gem: chef-zero\n            test_cmd: bundle exec tasks/bin/run_external_test chef/chef-zero main rake pedant\n            env_vars: |\n              PEDANT_OPTS=--skip-oc_id\n              CHEF_FS=true\n          - gem: cheffish\n            test_cmd: bundle exec tasks/bin/run_external_test chef/cheffish main rake spec\n          - gem: chefspec\n            test_cmd: bundle exec tasks/bin/run_external_test chef/chefspec main rake\n          - gem: knife-windows\n            test_cmd: bundle exec tasks/bin/run_external_test chef/knife-windows main rake spec\n          - gem: berkshelf\n            test_cmd: bundle exec tasks/bin/run_external_test chef/berkshelf main rake\n            pre_install: apt-get update -y && apt-get install -y graphviz\n    container:\n      image: chefes/omnibus-toolchain-ubuntu-1804:3.0.36\n      options: --user root\n    steps:\n      - name: Check out code\n        uses: actions/checkout@v4\n\n      - name: Container prep\n        run: .expeditor/scripts/bk_container_prep.sh\n\n      - name: Set up environment\n        run: |\n          export PATH=\"/root/.rbenv/shims:/opt/chef/bin:/home/ec2-user/.tfenv/bin:/home/ec2-user/.rbenv/shims:/home/ec2-user/.rbenv/bin:/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/usr/bin\"\n          echo \"PATH=$PATH\" >> $GITHUB_ENV\n\n      - name: Pre-install dependencies\n        if: matrix.pre_install\n        run: ${{ matrix.pre_install }}\n\n      - name: Bundle install\n        run: |\n          bundle config set --local without omnibus_package\n          bundle config set --local path 'vendor/bundle'\n          bundle install --jobs=3 --retry=3\n\n      - name: Run ${{ matrix.gem }} tests\n        run: ${{ matrix.test_cmd }}\n        env:\n          CHEF_FOUNDATION_VERSION: ${{ env.CHEF_FOUNDATION_VERSION }}\n          PEDANT_OPTS: ${{ matrix.gem == 'chef-zero' && '--skip-oc_id' || '' }}\n          CHEF_FS: ${{ matrix.gem == 'chef-zero' && 'true' || '' }}\n\n  habitat-linux-plan:\n    name: Habitat Linux Plan\n    runs-on: ubuntu-latest\n    timeout-minutes: 60\n    steps:\n      - name: Check out code\n        uses: actions/checkout@v4\n\n      - name: Install Habitat\n        run: sudo ./.expeditor/scripts/install-hab.sh 'x86_64-linux'\n\n      - name: Verify plan\n        run: sudo ./.expeditor/scripts/verify-plan.sh\n\n  habitat-windows-plan:\n    name: Habitat Windows Plan\n    runs-on: windows-2019\n    timeout-minutes: 60\n    steps:\n      - name: Check out code\n        uses: actions/checkout@v4\n\n      - name: Verify Windows plan\n        shell: pwsh\n        run: ./.expeditor/scripts/verify-plan.ps1\n\n  verify-summary:",
    "repo_full_name": "chef/chef",
    "discussion_comments": [
      {
        "comment_id": "2178132209",
        "repo_full_name": "chef/chef",
        "pr_number": 15076,
        "pr_file": ".github/workflows/verify.yml",
        "discussion_id": "2178132209",
        "commented_code": "@@ -0,0 +1,167 @@\n+name: Verify\n+\n+on:\n+  push:\n+    branches: [main, feature/github-actions-migration]  # Add your temp branch here\n+  pull_request:\n+    branches: [main]\n+\n+env:\n+  CHEF_LICENSE_SERVER: http://hosted-license-service-lb-8000-606952349.us-west-2.elb.amazonaws.com:8000/\n+  CHEF_FOUNDATION_VERSION: ${{ vars.CHEF_FOUNDATION_VERSION || '3.2.12' }}\n+  CHEF_LICENSE: accept-no-persist\n+\n+jobs:\n+  linux-matrix:\n+    name: ${{ matrix.test_type }} - ${{ matrix.os }}\n+    runs-on: ubuntu-22.04\n+    timeout-minutes: 60\n+    strategy:\n+      fail-fast: false\n+      matrix:\n+        os: [rocky-8, rocky-9, rhel-9, debian-9, ubuntu-2004]\n+        test_type: [Unit, Integration, Functional]\n+    container:\n+      image: chefes/omnibus-toolchain-${{ matrix.os }}:3.0.36\n+      options: --privileged --user root\n+    steps:\n+      - name: Check out code\n+        uses: actions/checkout@v4\n+\n+      - name: Container prep\n+        run: .expeditor/scripts/bk_container_prep.sh\n+\n+      - name: Run ${{ matrix.test_type }} tests\n+        run: .expeditor/scripts/prep_and_run_tests.sh ${{ matrix.test_type }}\n+        env:\n+          CHEF_LICENSE_SERVER: ${{ env.CHEF_LICENSE_SERVER }}\n+\n+  windows-tests:\n+    name: ${{ matrix.test_type }} - Windows 2019\n+    runs-on: windows-2019\n+    timeout-minutes: 120\n+    strategy:\n+      fail-fast: false\n+      matrix:\n+        test_type: [Unit, Integration, Functional]\n+    steps:\n+      - name: Check out code\n+        uses: actions/checkout@v4\n+\n+      - name: Set up Ruby\n+        uses: ruby/setup-ruby@v1\n+        with:\n+          ruby-version: '3.1'\n+          bundler-cache: true\n+\n+      - name: Run ${{ matrix.test_type }} tests\n+        shell: pwsh\n+        run: .\\.expeditor\\scripts\\prep_and_run_tests.ps1 ${{ matrix.test_type }}\n+        env:\n+          CHEF_LICENSE_SERVER: ${{ env.CHEF_LICENSE_SERVER }}\n+\n+  gem-tests:\n+    name: ${{ matrix.gem }} gem\n+    runs-on: ubuntu-22.04\n+    timeout-minutes: 60\n+    strategy:\n+      fail-fast: false\n+      matrix:\n+        gem: [chef-zero, cheffish, chefspec, knife-windows, berkshelf]\n+        include:\n+          - gem: chef-zero\n+            test_cmd: bundle exec tasks/bin/run_external_test chef/chef-zero main rake pedant\n+            env_vars: |\n+              PEDANT_OPTS=--skip-oc_id\n+              CHEF_FS=true\n+          - gem: cheffish\n+            test_cmd: bundle exec tasks/bin/run_external_test chef/cheffish main rake spec\n+          - gem: chefspec\n+            test_cmd: bundle exec tasks/bin/run_external_test chef/chefspec main rake\n+          - gem: knife-windows\n+            test_cmd: bundle exec tasks/bin/run_external_test chef/knife-windows main rake spec\n+          - gem: berkshelf\n+            test_cmd: bundle exec tasks/bin/run_external_test chef/berkshelf main rake\n+            pre_install: apt-get update -y && apt-get install -y graphviz\n+    container:\n+      image: chefes/omnibus-toolchain-ubuntu-1804:3.0.36\n+      options: --user root\n+    steps:\n+      - name: Check out code\n+        uses: actions/checkout@v4\n+\n+      - name: Container prep\n+        run: .expeditor/scripts/bk_container_prep.sh\n+\n+      - name: Set up environment\n+        run: |\n+          export PATH=\"/root/.rbenv/shims:/opt/chef/bin:/home/ec2-user/.tfenv/bin:/home/ec2-user/.rbenv/shims:/home/ec2-user/.rbenv/bin:/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/usr/bin\"\n+          echo \"PATH=$PATH\" >> $GITHUB_ENV\n+\n+      - name: Pre-install dependencies\n+        if: matrix.pre_install\n+        run: ${{ matrix.pre_install }}\n+\n+      - name: Bundle install\n+        run: |\n+          bundle config set --local without omnibus_package\n+          bundle config set --local path 'vendor/bundle'\n+          bundle install --jobs=3 --retry=3\n+\n+      - name: Run ${{ matrix.gem }} tests\n+        run: ${{ matrix.test_cmd }}\n+        env:\n+          CHEF_FOUNDATION_VERSION: ${{ env.CHEF_FOUNDATION_VERSION }}\n+          PEDANT_OPTS: ${{ matrix.gem == 'chef-zero' && '--skip-oc_id' || '' }}\n+          CHEF_FS: ${{ matrix.gem == 'chef-zero' && 'true' || '' }}\n+\n+  habitat-linux-plan:\n+    name: Habitat Linux Plan\n+    runs-on: ubuntu-latest\n+    timeout-minutes: 60\n+    steps:\n+      - name: Check out code\n+        uses: actions/checkout@v4\n+\n+      - name: Install Habitat\n+        run: sudo ./.expeditor/scripts/install-hab.sh 'x86_64-linux'\n+\n+      - name: Verify plan\n+        run: sudo ./.expeditor/scripts/verify-plan.sh\n+\n+  habitat-windows-plan:\n+    name: Habitat Windows Plan\n+    runs-on: windows-2019\n+    timeout-minutes: 60\n+    steps:\n+      - name: Check out code\n+        uses: actions/checkout@v4\n+\n+      - name: Verify Windows plan\n+        shell: pwsh\n+        run: ./.expeditor/scripts/verify-plan.ps1\n+\n+  verify-summary:",
        "comment_created_at": "2025-07-01T17:09:07+00:00",
        "comment_author": "github-advanced-security[bot]",
        "comment_body": "## Workflow does not contain permissions\n\nActions job or workflow does not limit the permissions of the GITHUB_TOKEN. Consider setting an explicit permissions block, using the following as a minimal starting point: {{contents: read}}\n\n[Show more details](https://github.com/chef/chef/security/code-scanning/296)",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2178166822",
    "pr_number": 15076,
    "pr_file": ".github/workflows/verify.yml",
    "created_at": "2025-07-01T17:24:21+00:00",
    "commented_code": "name: Verify\n\non:\n  push:\n    branches: [main, feature/github-actions-migration]  # Add your temp branch here\n  pull_request:\n    branches: [main]\n\nenv:\n  CHEF_LICENSE_SERVER: http://hosted-license-service-lb-8000-606952349.us-west-2.elb.amazonaws.com:8000/\n  CHEF_FOUNDATION_VERSION: ${{ vars.CHEF_FOUNDATION_VERSION || '3.2.12' }}\n  CHEF_LICENSE: accept-no-persist\n\njobs:\n  linux-matrix:\n    name: ${{ matrix.test_type }} - ${{ matrix.os }}\n    runs-on: ubuntu-24.04\n    timeout-minutes: 60\n    strategy:\n      fail-fast: false\n      matrix:\n        os: [rocky-8, rocky-9, rhel-9, debian-9, ubuntu-2004]\n        test_type: [Unit, Integration, Functional]\n    container:\n      image: chefes/omnibus-toolchain-${{ matrix.os }}:3.0.36\n      options: --privileged --user root\n    steps:\n      - name: Check out code\n        uses: actions/checkout@v4\n\n      - name: Container prep\n        run: .expeditor/scripts/bk_container_prep.sh\n\n      - name: Run ${{ matrix.test_type }} tests\n        run: .expeditor/scripts/prep_and_run_tests.sh ${{ matrix.test_type }}\n        env:\n          CHEF_LICENSE_SERVER: ${{ env.CHEF_LICENSE_SERVER }}\n\n  windows-tests:",
    "repo_full_name": "chef/chef",
    "discussion_comments": [
      {
        "comment_id": "2178166822",
        "repo_full_name": "chef/chef",
        "pr_number": 15076,
        "pr_file": ".github/workflows/verify.yml",
        "discussion_id": "2178166822",
        "commented_code": "@@ -0,0 +1,167 @@\n+name: Verify\n+\n+on:\n+  push:\n+    branches: [main, feature/github-actions-migration]  # Add your temp branch here\n+  pull_request:\n+    branches: [main]\n+\n+env:\n+  CHEF_LICENSE_SERVER: http://hosted-license-service-lb-8000-606952349.us-west-2.elb.amazonaws.com:8000/\n+  CHEF_FOUNDATION_VERSION: ${{ vars.CHEF_FOUNDATION_VERSION || '3.2.12' }}\n+  CHEF_LICENSE: accept-no-persist\n+\n+jobs:\n+  linux-matrix:\n+    name: ${{ matrix.test_type }} - ${{ matrix.os }}\n+    runs-on: ubuntu-24.04\n+    timeout-minutes: 60\n+    strategy:\n+      fail-fast: false\n+      matrix:\n+        os: [rocky-8, rocky-9, rhel-9, debian-9, ubuntu-2004]\n+        test_type: [Unit, Integration, Functional]\n+    container:\n+      image: chefes/omnibus-toolchain-${{ matrix.os }}:3.0.36\n+      options: --privileged --user root\n+    steps:\n+      - name: Check out code\n+        uses: actions/checkout@v4\n+\n+      - name: Container prep\n+        run: .expeditor/scripts/bk_container_prep.sh\n+\n+      - name: Run ${{ matrix.test_type }} tests\n+        run: .expeditor/scripts/prep_and_run_tests.sh ${{ matrix.test_type }}\n+        env:\n+          CHEF_LICENSE_SERVER: ${{ env.CHEF_LICENSE_SERVER }}\n+\n+  windows-tests:",
        "comment_created_at": "2025-07-01T17:24:21+00:00",
        "comment_author": "github-advanced-security[bot]",
        "comment_body": "## Workflow does not contain permissions\n\nActions job or workflow does not limit the permissions of the GITHUB_TOKEN. Consider setting an explicit permissions block, using the following as a minimal starting point: {{contents: read}}\n\n[Show more details](https://github.com/chef/chef/security/code-scanning/298)",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2178450773",
    "pr_number": 15076,
    "pr_file": ".github/workflows/verify.yml",
    "created_at": "2025-07-01T20:20:39+00:00",
    "commented_code": "name: Verify\n\non:\n  push:\n    branches: [main, feature/github-actions-migration]  # Add your temp branch here\n  pull_request:\n    branches: [main]\n\nenv:\n  CHEF_LICENSE_SERVER: http://hosted-license-service-lb-8000-606952349.us-west-2.elb.amazonaws.com:8000/\n  CHEF_FOUNDATION_VERSION: ${{ vars.CHEF_FOUNDATION_VERSION || '3.2.12' }}\n  CHEF_LICENSE: accept-no-persist\n\njobs:\n  linux-matrix:\n    name: ${{ matrix.test_type }} - ${{ matrix.os }}\n    runs-on: ubuntu-22.04\n    timeout-minutes: 60\n    strategy:\n      fail-fast: false\n      matrix:\n        os: [rocky-8, rocky-9, rhel-9, debian-9, ubuntu-2004]\n        test_type: [Unit, Integration, Functional]\n    container:\n      image: chefes/omnibus-toolchain-${{ matrix.os }}:3.0.36\n      options: --privileged --user root\n    steps:\n      - name: Check out code\n        uses: actions/checkout@v4\n        # Skip checkout actions for debian-9 due to GLIBC incompatibility\n        if: matrix.os != 'debian-9'\n\n      - name: Manual checkout for Debian 9\n        if: matrix.os == 'debian-9'\n        run: |\n          # Clone the repository with full history to ensure all refs are available\n          git clone --no-checkout https://github.com/${{ github.repository }} .\n\n          # Fetch the specific ref if it's not available\n          git fetch origin ${{ github.ref }}:${{ github.ref }} || true\n          git fetch origin ${{ github.sha }} || true\n\n          git checkout ${{ github.sha }}\n\n      - name: Container prep\n        run: .expeditor/scripts/bk_container_prep.sh\n\n      - name: Run ${{ matrix.test_type }} tests\n        run: .expeditor/scripts/prep_and_run_tests.sh ${{ matrix.test_type }}\n        env:\n          CHEF_LICENSE_SERVER: ${{ env.CHEF_LICENSE_SERVER }}\n\n  windows-tests:\n    name: ${{ matrix.test_type }} - Windows 2022\n    runs-on: windows-2022\n    timeout-minutes: 120\n    strategy:\n      fail-fast: false\n      matrix:\n        test_type: [Unit, Integration, Functional]\n    steps:\n      - name: Check out code\n        uses: actions/checkout@v4\n\n      - name: Set up Ruby\n        uses: ruby/setup-ruby@v1\n        with:\n          ruby-version: '3.1'\n          bundler-cache: true\n\n      - name: Run ${{ matrix.test_type }} tests\n        shell: pwsh\n        run: .\\.expeditor\\scripts\\prep_and_run_tests.ps1 ${{ matrix.test_type }}\n        env:\n          CHEF_LICENSE_SERVER: ${{ env.CHEF_LICENSE_SERVER }}\n\n  gem-tests:",
    "repo_full_name": "chef/chef",
    "discussion_comments": [
      {
        "comment_id": "2178450773",
        "repo_full_name": "chef/chef",
        "pr_number": 15076,
        "pr_file": ".github/workflows/verify.yml",
        "discussion_id": "2178450773",
        "commented_code": "@@ -0,0 +1,181 @@\n+name: Verify\n+\n+on:\n+  push:\n+    branches: [main, feature/github-actions-migration]  # Add your temp branch here\n+  pull_request:\n+    branches: [main]\n+\n+env:\n+  CHEF_LICENSE_SERVER: http://hosted-license-service-lb-8000-606952349.us-west-2.elb.amazonaws.com:8000/\n+  CHEF_FOUNDATION_VERSION: ${{ vars.CHEF_FOUNDATION_VERSION || '3.2.12' }}\n+  CHEF_LICENSE: accept-no-persist\n+\n+jobs:\n+  linux-matrix:\n+    name: ${{ matrix.test_type }} - ${{ matrix.os }}\n+    runs-on: ubuntu-22.04\n+    timeout-minutes: 60\n+    strategy:\n+      fail-fast: false\n+      matrix:\n+        os: [rocky-8, rocky-9, rhel-9, debian-9, ubuntu-2004]\n+        test_type: [Unit, Integration, Functional]\n+    container:\n+      image: chefes/omnibus-toolchain-${{ matrix.os }}:3.0.36\n+      options: --privileged --user root\n+    steps:\n+      - name: Check out code\n+        uses: actions/checkout@v4\n+        # Skip checkout actions for debian-9 due to GLIBC incompatibility\n+        if: matrix.os != 'debian-9'\n+\n+      - name: Manual checkout for Debian 9\n+        if: matrix.os == 'debian-9'\n+        run: |\n+          # Clone the repository with full history to ensure all refs are available\n+          git clone --no-checkout https://github.com/${{ github.repository }} .\n+\n+          # Fetch the specific ref if it's not available\n+          git fetch origin ${{ github.ref }}:${{ github.ref }} || true\n+          git fetch origin ${{ github.sha }} || true\n+\n+          git checkout ${{ github.sha }}\n+\n+      - name: Container prep\n+        run: .expeditor/scripts/bk_container_prep.sh\n+\n+      - name: Run ${{ matrix.test_type }} tests\n+        run: .expeditor/scripts/prep_and_run_tests.sh ${{ matrix.test_type }}\n+        env:\n+          CHEF_LICENSE_SERVER: ${{ env.CHEF_LICENSE_SERVER }}\n+\n+  windows-tests:\n+    name: ${{ matrix.test_type }} - Windows 2022\n+    runs-on: windows-2022\n+    timeout-minutes: 120\n+    strategy:\n+      fail-fast: false\n+      matrix:\n+        test_type: [Unit, Integration, Functional]\n+    steps:\n+      - name: Check out code\n+        uses: actions/checkout@v4\n+\n+      - name: Set up Ruby\n+        uses: ruby/setup-ruby@v1\n+        with:\n+          ruby-version: '3.1'\n+          bundler-cache: true\n+\n+      - name: Run ${{ matrix.test_type }} tests\n+        shell: pwsh\n+        run: .\\.expeditor\\scripts\\prep_and_run_tests.ps1 ${{ matrix.test_type }}\n+        env:\n+          CHEF_LICENSE_SERVER: ${{ env.CHEF_LICENSE_SERVER }}\n+\n+  gem-tests:",
        "comment_created_at": "2025-07-01T20:20:39+00:00",
        "comment_author": "github-advanced-security[bot]",
        "comment_body": "## Workflow does not contain permissions\n\nActions job or workflow does not limit the permissions of the GITHUB_TOKEN. Consider setting an explicit permissions block, using the following as a minimal starting point: {{contents: read}}\n\n[Show more details](https://github.com/chef/chef/security/code-scanning/299)",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2178450775",
    "pr_number": 15076,
    "pr_file": ".github/workflows/verify.yml",
    "created_at": "2025-07-01T20:20:39+00:00",
    "commented_code": "name: Verify\n\non:\n  push:\n    branches: [main, feature/github-actions-migration]  # Add your temp branch here\n  pull_request:\n    branches: [main]\n\nenv:\n  CHEF_LICENSE_SERVER: http://hosted-license-service-lb-8000-606952349.us-west-2.elb.amazonaws.com:8000/\n  CHEF_FOUNDATION_VERSION: ${{ vars.CHEF_FOUNDATION_VERSION || '3.2.12' }}\n  CHEF_LICENSE: accept-no-persist\n\njobs:\n  linux-matrix:\n    name: ${{ matrix.test_type }} - ${{ matrix.os }}\n    runs-on: ubuntu-22.04\n    timeout-minutes: 60\n    strategy:\n      fail-fast: false\n      matrix:\n        os: [rocky-8, rocky-9, rhel-9, debian-9, ubuntu-2004]\n        test_type: [Unit, Integration, Functional]\n    container:\n      image: chefes/omnibus-toolchain-${{ matrix.os }}:3.0.36\n      options: --privileged --user root\n    steps:\n      - name: Check out code\n        uses: actions/checkout@v4\n        # Skip checkout actions for debian-9 due to GLIBC incompatibility\n        if: matrix.os != 'debian-9'\n\n      - name: Manual checkout for Debian 9\n        if: matrix.os == 'debian-9'\n        run: |\n          # Clone the repository with full history to ensure all refs are available\n          git clone --no-checkout https://github.com/${{ github.repository }} .\n\n          # Fetch the specific ref if it's not available\n          git fetch origin ${{ github.ref }}:${{ github.ref }} || true\n          git fetch origin ${{ github.sha }} || true\n\n          git checkout ${{ github.sha }}\n\n      - name: Container prep\n        run: .expeditor/scripts/bk_container_prep.sh\n\n      - name: Run ${{ matrix.test_type }} tests\n        run: .expeditor/scripts/prep_and_run_tests.sh ${{ matrix.test_type }}\n        env:\n          CHEF_LICENSE_SERVER: ${{ env.CHEF_LICENSE_SERVER }}\n\n  windows-tests:\n    name: ${{ matrix.test_type }} - Windows 2022\n    runs-on: windows-2022\n    timeout-minutes: 120\n    strategy:\n      fail-fast: false\n      matrix:\n        test_type: [Unit, Integration, Functional]\n    steps:\n      - name: Check out code\n        uses: actions/checkout@v4\n\n      - name: Set up Ruby\n        uses: ruby/setup-ruby@v1\n        with:\n          ruby-version: '3.1'\n          bundler-cache: true\n\n      - name: Run ${{ matrix.test_type }} tests\n        shell: pwsh\n        run: .\\.expeditor\\scripts\\prep_and_run_tests.ps1 ${{ matrix.test_type }}\n        env:\n          CHEF_LICENSE_SERVER: ${{ env.CHEF_LICENSE_SERVER }}\n\n  gem-tests:\n    name: ${{ matrix.gem }} gem\n    runs-on: ubuntu-22.04\n    timeout-minutes: 60\n    strategy:\n      fail-fast: false\n      matrix:\n        gem: [chef-zero, cheffish, chefspec, knife-windows, berkshelf]\n        include:\n          - gem: chef-zero\n            test_cmd: bundle exec tasks/bin/run_external_test chef/chef-zero main rake pedant\n            env_vars: |\n              PEDANT_OPTS=--skip-oc_id\n              CHEF_FS=true\n          - gem: cheffish\n            test_cmd: bundle exec tasks/bin/run_external_test chef/cheffish main rake spec\n          - gem: chefspec\n            test_cmd: bundle exec tasks/bin/run_external_test chef/chefspec main rake\n          - gem: knife-windows\n            test_cmd: bundle exec tasks/bin/run_external_test chef/knife-windows main rake spec\n          - gem: berkshelf\n            test_cmd: bundle exec tasks/bin/run_external_test chef/berkshelf main rake\n            pre_install: apt-get update -y && apt-get install -y graphviz\n    container:\n      image: chefes/omnibus-toolchain-ubuntu-2204:3.0.36\n      options: --user root\n    steps:\n      - name: Check out code\n        uses: actions/checkout@v4\n\n      - name: Container prep\n        run: .expeditor/scripts/bk_container_prep.sh\n\n      - name: Set up environment\n        run: |\n          export PATH=\"/root/.rbenv/shims:/opt/chef/bin:/home/ec2-user/.tfenv/bin:/home/ec2-user/.rbenv/shims:/home/ec2-user/.rbenv/bin:/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/usr/bin\"\n          echo \"PATH=$PATH\" >> $GITHUB_ENV\n\n      - name: Pre-install dependencies\n        if: matrix.pre_install\n        run: ${{ matrix.pre_install }}\n\n      - name: Bundle install\n        run: |\n          bundle config set --local without omnibus_package\n          bundle config set --local path 'vendor/bundle'\n          bundle install --jobs=3 --retry=3\n\n      - name: Run ${{ matrix.gem }} tests\n        run: ${{ matrix.test_cmd }}\n        env:\n          CHEF_FOUNDATION_VERSION: ${{ env.CHEF_FOUNDATION_VERSION }}\n          PEDANT_OPTS: ${{ matrix.gem == 'chef-zero' && '--skip-oc_id' || '' }}\n          CHEF_FS: ${{ matrix.gem == 'chef-zero' && 'true' || '' }}\n\n  habitat-linux-plan:\n    name: Habitat Linux Plan\n    runs-on: ubuntu-latest\n    timeout-minutes: 60\n    steps:\n      - name: Check out code\n        uses: actions/checkout@v4\n\n      - name: Install Habitat\n        run: sudo ./.expeditor/scripts/install-hab.sh 'x86_64-linux'\n\n      - name: Verify plan\n        run: sudo ./.expeditor/scripts/verify-plan.sh\n\n  habitat-windows-plan:\n    name: Habitat Windows Plan\n    runs-on: windows-2022\n    timeout-minutes: 60\n    steps:\n      - name: Check out code\n        uses: actions/checkout@v4\n\n      - name: Verify Windows plan\n        shell: pwsh\n        run: ./.expeditor/scripts/verify-plan.ps1\n\n  verify-summary:",
    "repo_full_name": "chef/chef",
    "discussion_comments": [
      {
        "comment_id": "2178450775",
        "repo_full_name": "chef/chef",
        "pr_number": 15076,
        "pr_file": ".github/workflows/verify.yml",
        "discussion_id": "2178450775",
        "commented_code": "@@ -0,0 +1,181 @@\n+name: Verify\n+\n+on:\n+  push:\n+    branches: [main, feature/github-actions-migration]  # Add your temp branch here\n+  pull_request:\n+    branches: [main]\n+\n+env:\n+  CHEF_LICENSE_SERVER: http://hosted-license-service-lb-8000-606952349.us-west-2.elb.amazonaws.com:8000/\n+  CHEF_FOUNDATION_VERSION: ${{ vars.CHEF_FOUNDATION_VERSION || '3.2.12' }}\n+  CHEF_LICENSE: accept-no-persist\n+\n+jobs:\n+  linux-matrix:\n+    name: ${{ matrix.test_type }} - ${{ matrix.os }}\n+    runs-on: ubuntu-22.04\n+    timeout-minutes: 60\n+    strategy:\n+      fail-fast: false\n+      matrix:\n+        os: [rocky-8, rocky-9, rhel-9, debian-9, ubuntu-2004]\n+        test_type: [Unit, Integration, Functional]\n+    container:\n+      image: chefes/omnibus-toolchain-${{ matrix.os }}:3.0.36\n+      options: --privileged --user root\n+    steps:\n+      - name: Check out code\n+        uses: actions/checkout@v4\n+        # Skip checkout actions for debian-9 due to GLIBC incompatibility\n+        if: matrix.os != 'debian-9'\n+\n+      - name: Manual checkout for Debian 9\n+        if: matrix.os == 'debian-9'\n+        run: |\n+          # Clone the repository with full history to ensure all refs are available\n+          git clone --no-checkout https://github.com/${{ github.repository }} .\n+\n+          # Fetch the specific ref if it's not available\n+          git fetch origin ${{ github.ref }}:${{ github.ref }} || true\n+          git fetch origin ${{ github.sha }} || true\n+\n+          git checkout ${{ github.sha }}\n+\n+      - name: Container prep\n+        run: .expeditor/scripts/bk_container_prep.sh\n+\n+      - name: Run ${{ matrix.test_type }} tests\n+        run: .expeditor/scripts/prep_and_run_tests.sh ${{ matrix.test_type }}\n+        env:\n+          CHEF_LICENSE_SERVER: ${{ env.CHEF_LICENSE_SERVER }}\n+\n+  windows-tests:\n+    name: ${{ matrix.test_type }} - Windows 2022\n+    runs-on: windows-2022\n+    timeout-minutes: 120\n+    strategy:\n+      fail-fast: false\n+      matrix:\n+        test_type: [Unit, Integration, Functional]\n+    steps:\n+      - name: Check out code\n+        uses: actions/checkout@v4\n+\n+      - name: Set up Ruby\n+        uses: ruby/setup-ruby@v1\n+        with:\n+          ruby-version: '3.1'\n+          bundler-cache: true\n+\n+      - name: Run ${{ matrix.test_type }} tests\n+        shell: pwsh\n+        run: .\\.expeditor\\scripts\\prep_and_run_tests.ps1 ${{ matrix.test_type }}\n+        env:\n+          CHEF_LICENSE_SERVER: ${{ env.CHEF_LICENSE_SERVER }}\n+\n+  gem-tests:\n+    name: ${{ matrix.gem }} gem\n+    runs-on: ubuntu-22.04\n+    timeout-minutes: 60\n+    strategy:\n+      fail-fast: false\n+      matrix:\n+        gem: [chef-zero, cheffish, chefspec, knife-windows, berkshelf]\n+        include:\n+          - gem: chef-zero\n+            test_cmd: bundle exec tasks/bin/run_external_test chef/chef-zero main rake pedant\n+            env_vars: |\n+              PEDANT_OPTS=--skip-oc_id\n+              CHEF_FS=true\n+          - gem: cheffish\n+            test_cmd: bundle exec tasks/bin/run_external_test chef/cheffish main rake spec\n+          - gem: chefspec\n+            test_cmd: bundle exec tasks/bin/run_external_test chef/chefspec main rake\n+          - gem: knife-windows\n+            test_cmd: bundle exec tasks/bin/run_external_test chef/knife-windows main rake spec\n+          - gem: berkshelf\n+            test_cmd: bundle exec tasks/bin/run_external_test chef/berkshelf main rake\n+            pre_install: apt-get update -y && apt-get install -y graphviz\n+    container:\n+      image: chefes/omnibus-toolchain-ubuntu-2204:3.0.36\n+      options: --user root\n+    steps:\n+      - name: Check out code\n+        uses: actions/checkout@v4\n+\n+      - name: Container prep\n+        run: .expeditor/scripts/bk_container_prep.sh\n+\n+      - name: Set up environment\n+        run: |\n+          export PATH=\"/root/.rbenv/shims:/opt/chef/bin:/home/ec2-user/.tfenv/bin:/home/ec2-user/.rbenv/shims:/home/ec2-user/.rbenv/bin:/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/usr/bin\"\n+          echo \"PATH=$PATH\" >> $GITHUB_ENV\n+\n+      - name: Pre-install dependencies\n+        if: matrix.pre_install\n+        run: ${{ matrix.pre_install }}\n+\n+      - name: Bundle install\n+        run: |\n+          bundle config set --local without omnibus_package\n+          bundle config set --local path 'vendor/bundle'\n+          bundle install --jobs=3 --retry=3\n+\n+      - name: Run ${{ matrix.gem }} tests\n+        run: ${{ matrix.test_cmd }}\n+        env:\n+          CHEF_FOUNDATION_VERSION: ${{ env.CHEF_FOUNDATION_VERSION }}\n+          PEDANT_OPTS: ${{ matrix.gem == 'chef-zero' && '--skip-oc_id' || '' }}\n+          CHEF_FS: ${{ matrix.gem == 'chef-zero' && 'true' || '' }}\n+\n+  habitat-linux-plan:\n+    name: Habitat Linux Plan\n+    runs-on: ubuntu-latest\n+    timeout-minutes: 60\n+    steps:\n+      - name: Check out code\n+        uses: actions/checkout@v4\n+\n+      - name: Install Habitat\n+        run: sudo ./.expeditor/scripts/install-hab.sh 'x86_64-linux'\n+\n+      - name: Verify plan\n+        run: sudo ./.expeditor/scripts/verify-plan.sh\n+\n+  habitat-windows-plan:\n+    name: Habitat Windows Plan\n+    runs-on: windows-2022\n+    timeout-minutes: 60\n+    steps:\n+      - name: Check out code\n+        uses: actions/checkout@v4\n+\n+      - name: Verify Windows plan\n+        shell: pwsh\n+        run: ./.expeditor/scripts/verify-plan.ps1\n+\n+  verify-summary:",
        "comment_created_at": "2025-07-01T20:20:39+00:00",
        "comment_author": "github-advanced-security[bot]",
        "comment_body": "## Workflow does not contain permissions\n\nActions job or workflow does not limit the permissions of the GITHUB_TOKEN. Consider setting an explicit permissions block, using the following as a minimal starting point: {{contents: read}}\n\n[Show more details](https://github.com/chef/chef/security/code-scanning/300)",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2073245958",
    "pr_number": 14794,
    "pr_file": ".github/workflows/kitchen.yml",
    "created_at": "2025-05-05T11:06:01+00:00",
    "commented_code": "working-directory: kitchen-tests\n\njobs:\n  # Test-kitchen-enterprise currently supports only linux platforms, \n  # Hence we are testing on Windows using test-kitchen\n  win_x86_64:\n    name: win_x86_64(test-kitchen legacy)\n    strategy:\n      fail-fast: false\n      matrix:\n~        os:\n~          - windows-2019\n~          - windows-2022\n~    runs-on: ${{ matrix.os }}\n~    env:\n~      CHEF_LICENSE: accept-no-persist\n~      KITCHEN_LOCAL_YAML: kitchen.exec.windows.yml\n~    steps:\n~    - uses: actions/checkout@v4\n~    - name: Install Chef\n~      uses: actionshub/chef-install@3.0.0\n    - name: Kitchen Test\n      run: kitchen test end-to-end-${{ matrix.os }}\n\n  # Habitat does not support Mac yet. Hence we're testing on Mac systems using test-kitchen\n  mac_x86_64:\n    name: mac_x86_64(test-kitchen legacy)\n    strategy:\n      fail-fast: false\n      matrix:\n~        os:\n~          - macos-13\n~    runs-on: ${{ matrix.os }}\n~    env:\n~      CHEF_LICENSE: accept-no-persist\n~      KITCHEN_LOCAL_YAML: kitchen.exec.macos.yml\n~    steps:\n~      - name: Check out code\n~        uses: actions/checkout@v4\n~        with:\n~            clean: true\n~      - name: Install Chef\n~        uses: actionshub/chef-install@3.0.0\n~      - name: Kitchen Test\n        run: kitchen test end-to-end-${{ matrix.os }}\n\n  mac_arm64:\n    name: mac_arm64(test-kitchen legacy)\n    strategy:\n      fail-fast: false\n      matrix:\n~        os:\n~          - macos-14 # currently macos-latest\n~          - macos-15\n~    runs-on: ${{ matrix.os }}\n~    env:\n~      CHEF_LICENSE: accept-no-persist\n~      KITCHEN_LOCAL_YAML: kitchen.exec.macos.yml\n~    steps:\n~      - name: Check out code\n~        uses: actions/checkout@v4\n~        with:\n~          clean: true\n~      - name: Install Chef\n~        uses: actionshub/chef-install@3.0.0\n      - name: Kitchen Test\n        run: kitchen test end-to-end-${{ matrix.os }}\n\n  # This block does end-to-end recipe using test-kitchen-enterprise using Habitat package of chef19\n  docr_lnx_x86_64:\n    name: docr_lnx_x86_64(test-kitchen-enterprise)\n    strategy:\n      fail-fast: false\n      matrix:\n~        os:\n~          - amazonlinux-2023\n~          - almalinux-8\n~          - almalinux-9\n~          - debian-11\n~          - debian-12\n~          - fedora-40\n~          # fedora-latest\n~          - opensuse-leap-15\n~          - oraclelinux-8\n~          - oraclelinux-9\n~          - rockylinux-8\n~          - rockylinux-9\n~          - ubuntu-2004\n~          - ubuntu-2204\n~          # - ubuntu-2404\n~    runs-on: ubuntu-latest\n~    env:\n~      FORCE_FFI_YAJL: ext\n~      CHEF_LICENSE: accept-no-persist\n~      KITCHEN_LOCAL_YAML: kitchen.dokken.yml\n    steps:\n      - name: Check out code\n        uses: actions/checkout@v4\n      - name: Install Chef\n        uses: actionshub/chef-install@3.0.0\n      - name: Install chef-test-kitchen-enterprise\n        run: |\n          curl https://raw.githubusercontent.com/habitat-sh/habitat/main/components/hab/install.sh | sudo bash -s -- -c stable\n          sudo hab license accept\n          sudo hab --version\n          sudo hab pkg install --binlink --force chef/chef-test-kitchen-enterprise --channel unstable\n          sudo kitchen --version\n          sudo hab pkg install --binlink --force chef/chef-cli --channel unstable\n      - name: Kitchen Test\n        run: kitchen test end-to-end-${{ matrix.os }}\n\n  # chef-test-kitchen-enterprise RC1 currently supports only kitchen-dokken driver hence in this block we \n  # will continue testing with test-kitchen\n  vm_lnx_x86_64:\n    name: vm_lnx_x86_64(test-kitchen legacy)\n    strategy:\n      fail-fast: false\n      matrix:\n~        os:\n~          - amazonlinux-2\n~          - amazonlinux-2023\n~          - almalinux-8\n~          - almalinux-9\n~          - debian-11\n~          - debian-12\n~          - fedora-40\n~          # - fedora-latest\n~          - opensuse-leap-15\n~          - oracle-7\n~          - oracle-8\n~          - oracle-9\n~          - rockylinux-8\n~          - rockylinux-9\n~          - ubuntu-2004\n~          - ubuntu-2204\n~          # - ubuntu-2404\n~    runs-on: ubuntu-22.04\n~    env:\n~      CHEF_LICENSE: accept-no-persist\n~      KITCHEN_LOCAL_YAML: kitchen.linux.ci.yml\n~    steps:\n~      - uses: actions/checkout@v4\n~      - name: Install Vagrant and VirtualBox\n~        run: |\n~          wget -O- https://apt.releases.hashicorp.com/gpg | gpg --dearmor | sudo tee /usr/share/keyrings/hashicorp-archive-keyring.gpg\n~          wget -O- https://www.virtualbox.org/download/oracle_vbox_2016.asc | gpg --dearmor | sudo tee /usr/share/keyrings/oracle-virtualbox-2016.gpg\n~          echo \"deb [signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com $(lsb_release -cs) main\" | sudo tee /etc/apt/sources.list.d/hashicorp.list\n~          echo \"deb [arch=amd64 signed-by=/usr/share/keyrings/oracle-virtualbox-2016.gpg] https://download.virtualbox.org/virtualbox/debian $(lsb_release -cs) contrib\" | sudo tee /etc/apt/sources.list.d/virtualbox.list\n~          sudo apt-get update\n~          sudo apt-get install -y vagrant virtualbox-7.1\n~          sudo vagrant --version\n~          sudo VBoxManage --version\n~      - name: Install Chef\n~        uses: actionshub/chef-install@3.0.0\n~      - name: Kitchen Test\n~        run: |\n~          # To debug, uncomment these\n~          #export VAGRANT_LOG=debug\n~          #export VBOX_LOG=all.e.l.f\n          #export VBOX_LOG_DEST=stdout\n          #export K_DEBUG_OPTS=\"--log-level=debug\"\n          export LOGNAME=$USER\n          kitchen test end-to-end-${{ matrix.os }} $K_DEBUG_OPTS\n          kitchen test end-to-end-${{ matrix.os }} $K_DEBUG_OPTS",
    "repo_full_name": "chef/chef",
    "discussion_comments": [
      {
        "comment_id": "2073245958",
        "repo_full_name": "chef/chef",
        "pr_number": 14794,
        "pr_file": ".github/workflows/kitchen.yml",
        "discussion_id": "2073245958",
        "commented_code": "@@ -16,144 +16,161 @@\n     working-directory: kitchen-tests\n \n jobs:\n+  # Test-kitchen-enterprise currently supports only linux platforms, \n+  # Hence we are testing on Windows using test-kitchen\n   win_x86_64:\n+    name: win_x86_64(test-kitchen legacy)\n     strategy:\n       fail-fast: false\n       matrix:\n~        os:\n~          - windows-2019\n~          - windows-2022\n~    runs-on: ${{ matrix.os }}\n~    env:\n~      CHEF_LICENSE: accept-no-persist\n~      KITCHEN_LOCAL_YAML: kitchen.exec.windows.yml\n~    steps:\n~    - uses: actions/checkout@v4\n~    - name: Install Chef\n~      uses: actionshub/chef-install@3.0.0\n     - name: Kitchen Test\n       run: kitchen test end-to-end-${{ matrix.os }}\n \n+  # Habitat does not support Mac yet. Hence we're testing on Mac systems using test-kitchen\n   mac_x86_64:\n+    name: mac_x86_64(test-kitchen legacy)\n     strategy:\n       fail-fast: false\n       matrix:\n~        os:\n~          - macos-13\n~    runs-on: ${{ matrix.os }}\n~    env:\n~      CHEF_LICENSE: accept-no-persist\n~      KITCHEN_LOCAL_YAML: kitchen.exec.macos.yml\n~    steps:\n~      - name: Check out code\n~        uses: actions/checkout@v4\n~        with:\n~            clean: true\n~      - name: Install Chef\n~        uses: actionshub/chef-install@3.0.0\n~      - name: Kitchen Test\n         run: kitchen test end-to-end-${{ matrix.os }}\n \n   mac_arm64:\n+    name: mac_arm64(test-kitchen legacy)\n     strategy:\n       fail-fast: false\n       matrix:\n~        os:\n~          - macos-14 # currently macos-latest\n~          - macos-15\n~    runs-on: ${{ matrix.os }}\n~    env:\n~      CHEF_LICENSE: accept-no-persist\n~      KITCHEN_LOCAL_YAML: kitchen.exec.macos.yml\n~    steps:\n~      - name: Check out code\n~        uses: actions/checkout@v4\n~        with:\n~          clean: true\n~      - name: Install Chef\n~        uses: actionshub/chef-install@3.0.0\n       - name: Kitchen Test\n         run: kitchen test end-to-end-${{ matrix.os }}\n \n+  # This block does end-to-end recipe using test-kitchen-enterprise using Habitat package of chef19\n   docr_lnx_x86_64:\n+    name: docr_lnx_x86_64(test-kitchen-enterprise)\n     strategy:\n       fail-fast: false\n       matrix:\n~        os:\n~          - amazonlinux-2023\n~          - almalinux-8\n~          - almalinux-9\n~          - debian-11\n~          - debian-12\n~          - fedora-40\n~          # fedora-latest\n~          - opensuse-leap-15\n~          - oraclelinux-8\n~          - oraclelinux-9\n~          - rockylinux-8\n~          - rockylinux-9\n~          - ubuntu-2004\n~          - ubuntu-2204\n~          # - ubuntu-2404\n~    runs-on: ubuntu-latest\n~    env:\n~      FORCE_FFI_YAJL: ext\n~      CHEF_LICENSE: accept-no-persist\n~      KITCHEN_LOCAL_YAML: kitchen.dokken.yml\n     steps:\n       - name: Check out code\n         uses: actions/checkout@v4\n-      - name: Install Chef\n-        uses: actionshub/chef-install@3.0.0\n+      - name: Install chef-test-kitchen-enterprise\n+        run: |\n+          curl https://raw.githubusercontent.com/habitat-sh/habitat/main/components/hab/install.sh | sudo bash -s -- -c stable\n+          sudo hab license accept\n+          sudo hab --version\n+          sudo hab pkg install --binlink --force chef/chef-test-kitchen-enterprise --channel unstable\n+          sudo kitchen --version\n+          sudo hab pkg install --binlink --force chef/chef-cli --channel unstable\n       - name: Kitchen Test\n         run: kitchen test end-to-end-${{ matrix.os }}\n \n+  # chef-test-kitchen-enterprise RC1 currently supports only kitchen-dokken driver hence in this block we \n+  # will continue testing with test-kitchen\n   vm_lnx_x86_64:\n+    name: vm_lnx_x86_64(test-kitchen legacy)\n     strategy:\n       fail-fast: false\n       matrix:\n~        os:\n~          - amazonlinux-2\n~          - amazonlinux-2023\n~          - almalinux-8\n~          - almalinux-9\n~          - debian-11\n~          - debian-12\n~          - fedora-40\n~          # - fedora-latest\n~          - opensuse-leap-15\n~          - oracle-7\n~          - oracle-8\n~          - oracle-9\n~          - rockylinux-8\n~          - rockylinux-9\n~          - ubuntu-2004\n~          - ubuntu-2204\n~          # - ubuntu-2404\n~    runs-on: ubuntu-22.04\n~    env:\n~      CHEF_LICENSE: accept-no-persist\n~      KITCHEN_LOCAL_YAML: kitchen.linux.ci.yml\n~    steps:\n~      - uses: actions/checkout@v4\n~      - name: Install Vagrant and VirtualBox\n~        run: |\n~          wget -O- https://apt.releases.hashicorp.com/gpg | gpg --dearmor | sudo tee /usr/share/keyrings/hashicorp-archive-keyring.gpg\n~          wget -O- https://www.virtualbox.org/download/oracle_vbox_2016.asc | gpg --dearmor | sudo tee /usr/share/keyrings/oracle-virtualbox-2016.gpg\n~          echo \"deb [signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com $(lsb_release -cs) main\" | sudo tee /etc/apt/sources.list.d/hashicorp.list\n~          echo \"deb [arch=amd64 signed-by=/usr/share/keyrings/oracle-virtualbox-2016.gpg] https://download.virtualbox.org/virtualbox/debian $(lsb_release -cs) contrib\" | sudo tee /etc/apt/sources.list.d/virtualbox.list\n~          sudo apt-get update\n~          sudo apt-get install -y vagrant virtualbox-7.1\n~          sudo vagrant --version\n~          sudo VBoxManage --version\n~      - name: Install Chef\n~        uses: actionshub/chef-install@3.0.0\n~      - name: Kitchen Test\n~        run: |\n~          # To debug, uncomment these\n~          #export VAGRANT_LOG=debug\n~          #export VBOX_LOG=all.e.l.f\n           #export VBOX_LOG_DEST=stdout\n           #export K_DEBUG_OPTS=\"--log-level=debug\"\n           export LOGNAME=$USER\n-          kitchen test end-to-end-${{ matrix.os }} $K_DEBUG_OPTS\n+          kitchen test end-to-end-${{ matrix.os }} $K_DEBUG_OPTS",
        "comment_created_at": "2025-05-05T11:06:01+00:00",
        "comment_author": "github-advanced-security[bot]",
        "comment_body": "## Workflow does not contain permissions\n\nActions job or workflow does not limit the permissions of the GITHUB_TOKEN. Consider setting an explicit permissions block, using the following as a minimal starting point: {{contents: read}}\n\n[Show more details](https://github.com/chef/chef/security/code-scanning/267)",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2167257073",
    "pr_number": 15068,
    "pr_file": ".github/workflows/verify.yml",
    "created_at": "2025-06-25T17:30:23+00:00",
    "commented_code": "name: Verify Pipeline\n\non:\n  workflow_dispatch:\n    inputs:\n      base_image_tag:\n        description: 'Base image tag version'\n        required: true\n        default: '3.0.36'\n        type: string\n      custom_env_var:\n        description: 'Custom environment variable'\n        required: false\n        default: 'production'\n        type: string\n      chef_license:\n        description: 'Chef license acceptance'\n        required: true\n        default: 'accept-no-persist'\n        type: string\n  push:\n    branches: [main]\n  pull_request:\n    branches: [main]\n\nenv:\n  BASE_IMAGE_TAG: ${{ inputs.base_image_tag || '3.0.36' }}\n  CUSTOM_ENV: ${{ inputs.custom_env_var || 'production' }}\n  CHEF_LICENSE: ${{ inputs.chef_license || 'accept-no-persist' }}\n\njobs:\n  # Linux Tests - Matrix for different test types and OS combinations\n  linux-tests:\n    name: Linux ${{ matrix.test_type }} - ${{ matrix.os }}\n    runs-on: ubuntu-22.04\n    strategy:\n      fail-fast: false\n      matrix:\n        test_type: [Unit, Integration, Functional]\n        os:\n          - rocky-8\n          - rocky-9\n          - rhel-9\n          - debian-9\n          - ubuntu-1804\n          - ubuntu-2004\n          - ubuntu-2204\n          - centos-7\n          - amazonlinux-2\n          - rockylinux-8\n          - almalinux-9\n    container:\n      image: chefes/omnibus-toolchain-${{ matrix.os }}:${{ env.BASE_IMAGE_TAG }}\n      options: --user root\n    steps:\n      - name: Check out code\n        uses: actions/checkout@v4\n\n      - name: Configure Git safe directory\n        run: |\n          git config --global --add safe.directory /__w/*/\n\n      - name: Display Environment Info\n        run: |\n          echo \"Running ${{ matrix.test_type }} tests on ${{ matrix.os }}\"\n          echo \"Base Image Tag: ${{ env.BASE_IMAGE_TAG }}\"\n          echo \"Custom Environment: ${{ env.CUSTOM_ENV }}\"\n          echo \"Chef License: ${{ env.CHEF_LICENSE }}\"\n          cat /etc/os-release || echo \"OS release info not available\"\n\n      - name: Install Dependencies\n        run: |\n          ./.expeditor/bk_container_prep.sh\n\n      - name: Run ${{ matrix.test_type }} Tests\n        run: |\n          ./.expeditor/scripts/prep_and_run_tests.sh \"${{ matrix.test_type }}\"\n        env:\n          TEST_TYPE: ${{ matrix.test_type }}\n          OS_TYPE: ${{ matrix.os }}\n          CHEF_LICENSE: ${{ env.CHEF_LICENSE }}\n          CUSTOM_ENV_VAR: ${{ env.CUSTOM_ENV }}\n\n  # Windows Tests - Matrix for different test types and Windows versions\n  windows-tests:",
    "repo_full_name": "chef/chef",
    "discussion_comments": [
      {
        "comment_id": "2167257073",
        "repo_full_name": "chef/chef",
        "pr_number": 15068,
        "pr_file": ".github/workflows/verify.yml",
        "discussion_id": "2167257073",
        "commented_code": "@@ -0,0 +1,161 @@\n+name: Verify Pipeline\n+\n+on:\n+  workflow_dispatch:\n+    inputs:\n+      base_image_tag:\n+        description: 'Base image tag version'\n+        required: true\n+        default: '3.0.36'\n+        type: string\n+      custom_env_var:\n+        description: 'Custom environment variable'\n+        required: false\n+        default: 'production'\n+        type: string\n+      chef_license:\n+        description: 'Chef license acceptance'\n+        required: true\n+        default: 'accept-no-persist'\n+        type: string\n+  push:\n+    branches: [main]\n+  pull_request:\n+    branches: [main]\n+\n+env:\n+  BASE_IMAGE_TAG: ${{ inputs.base_image_tag || '3.0.36' }}\n+  CUSTOM_ENV: ${{ inputs.custom_env_var || 'production' }}\n+  CHEF_LICENSE: ${{ inputs.chef_license || 'accept-no-persist' }}\n+\n+jobs:\n+  # Linux Tests - Matrix for different test types and OS combinations\n+  linux-tests:\n+    name: Linux ${{ matrix.test_type }} - ${{ matrix.os }}\n+    runs-on: ubuntu-22.04\n+    strategy:\n+      fail-fast: false\n+      matrix:\n+        test_type: [Unit, Integration, Functional]\n+        os:\n+          - rocky-8\n+          - rocky-9\n+          - rhel-9\n+          - debian-9\n+          - ubuntu-1804\n+          - ubuntu-2004\n+          - ubuntu-2204\n+          - centos-7\n+          - amazonlinux-2\n+          - rockylinux-8\n+          - almalinux-9\n+    container:\n+      image: chefes/omnibus-toolchain-${{ matrix.os }}:${{ env.BASE_IMAGE_TAG }}\n+      options: --user root\n+    steps:\n+      - name: Check out code\n+        uses: actions/checkout@v4\n+\n+      - name: Configure Git safe directory\n+        run: |\n+          git config --global --add safe.directory /__w/*/\n+\n+      - name: Display Environment Info\n+        run: |\n+          echo \"Running ${{ matrix.test_type }} tests on ${{ matrix.os }}\"\n+          echo \"Base Image Tag: ${{ env.BASE_IMAGE_TAG }}\"\n+          echo \"Custom Environment: ${{ env.CUSTOM_ENV }}\"\n+          echo \"Chef License: ${{ env.CHEF_LICENSE }}\"\n+          cat /etc/os-release || echo \"OS release info not available\"\n+\n+      - name: Install Dependencies\n+        run: |\n+          ./.expeditor/bk_container_prep.sh\n+\n+      - name: Run ${{ matrix.test_type }} Tests\n+        run: |\n+          ./.expeditor/scripts/prep_and_run_tests.sh \"${{ matrix.test_type }}\"\n+        env:\n+          TEST_TYPE: ${{ matrix.test_type }}\n+          OS_TYPE: ${{ matrix.os }}\n+          CHEF_LICENSE: ${{ env.CHEF_LICENSE }}\n+          CUSTOM_ENV_VAR: ${{ env.CUSTOM_ENV }}\n+\n+  # Windows Tests - Matrix for different test types and Windows versions\n+  windows-tests:",
        "comment_created_at": "2025-06-25T17:30:23+00:00",
        "comment_author": "github-advanced-security[bot]",
        "comment_body": "## Workflow does not contain permissions\n\nActions job or workflow does not limit the permissions of the GITHUB_TOKEN. Consider setting an explicit permissions block, using the following as a minimal starting point: {{contents: read}}\n\n[Show more details](https://github.com/chef/chef/security/code-scanning/289)",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2167257077",
    "pr_number": 15068,
    "pr_file": ".github/workflows/verify.yml",
    "created_at": "2025-06-25T17:30:23+00:00",
    "commented_code": "name: Verify Pipeline\n\non:\n  workflow_dispatch:\n    inputs:\n      base_image_tag:\n        description: 'Base image tag version'\n        required: true\n        default: '3.0.36'\n        type: string\n      custom_env_var:\n        description: 'Custom environment variable'\n        required: false\n        default: 'production'\n        type: string\n      chef_license:\n        description: 'Chef license acceptance'\n        required: true\n        default: 'accept-no-persist'\n        type: string\n  push:\n    branches: [main]\n  pull_request:\n    branches: [main]\n\nenv:\n  BASE_IMAGE_TAG: ${{ inputs.base_image_tag || '3.0.36' }}\n  CUSTOM_ENV: ${{ inputs.custom_env_var || 'production' }}\n  CHEF_LICENSE: ${{ inputs.chef_license || 'accept-no-persist' }}\n\njobs:\n  # Linux Tests - Matrix for different test types and OS combinations\n  linux-tests:\n    name: Linux ${{ matrix.test_type }} - ${{ matrix.os }}\n    runs-on: ubuntu-22.04\n    strategy:\n      fail-fast: false\n      matrix:\n        test_type: [Unit, Integration, Functional]\n        os:\n          - rocky-8\n          - rocky-9\n          - rhel-9\n          - debian-9\n          - ubuntu-1804\n          - ubuntu-2004\n          - ubuntu-2204\n          - centos-7\n          - amazonlinux-2\n          - rockylinux-8\n          - almalinux-9\n    container:\n      image: chefes/omnibus-toolchain-${{ matrix.os }}:${{ env.BASE_IMAGE_TAG }}\n      options: --user root\n    steps:\n      - name: Check out code\n        uses: actions/checkout@v4\n\n      - name: Configure Git safe directory\n        run: |\n          git config --global --add safe.directory /__w/*/\n\n      - name: Display Environment Info\n        run: |\n          echo \"Running ${{ matrix.test_type }} tests on ${{ matrix.os }}\"\n          echo \"Base Image Tag: ${{ env.BASE_IMAGE_TAG }}\"\n          echo \"Custom Environment: ${{ env.CUSTOM_ENV }}\"\n          echo \"Chef License: ${{ env.CHEF_LICENSE }}\"\n          cat /etc/os-release || echo \"OS release info not available\"\n\n      - name: Install Dependencies\n        run: |\n          ./.expeditor/bk_container_prep.sh\n\n      - name: Run ${{ matrix.test_type }} Tests\n        run: |\n          ./.expeditor/scripts/prep_and_run_tests.sh \"${{ matrix.test_type }}\"\n        env:\n          TEST_TYPE: ${{ matrix.test_type }}\n          OS_TYPE: ${{ matrix.os }}\n          CHEF_LICENSE: ${{ env.CHEF_LICENSE }}\n          CUSTOM_ENV_VAR: ${{ env.CUSTOM_ENV }}\n\n  # Windows Tests - Matrix for different test types and Windows versions\n  windows-tests:\n    name: Windows ${{ matrix.test_type }} - ${{ matrix.os }}\n    runs-on: ${{ matrix.os }}\n    strategy:\n      fail-fast: false\n      matrix:\n        test_type: [Unit, Integration, Functional]\n        os:\n          - windows-2019\n          - windows-2022\n          - windows-latest\n    steps:\n      - name: Check out code\n        uses: actions/checkout@v4\n\n      - name: Set up Ruby\n        uses: ruby/setup-ruby@v1\n        with:\n          ruby-version: '3.1'\n          bundler-cache: true\n\n      - name: Display Environment Info\n        shell: pwsh\n        run: |\n          Write-Host \"Running ${{ matrix.test_type }} tests on ${{ matrix.os }}\"\n          Write-Host \"Base Image Tag: ${{ env.BASE_IMAGE_TAG }}\"\n          Write-Host \"Custom Environment: ${{ env.CUSTOM_ENV }}\"\n          Write-Host \"Chef License: ${{ env.CHEF_LICENSE }}\"\n          Get-ComputerInfo | Select-Object WindowsProductName, WindowsVersion\n\n      - name: Install Dependencies\n        shell: pwsh\n        run: |\n          bundle config set --local without development\n          bundle install --jobs=3 --retry=3\n\n      - name: Run ${{ matrix.test_type }} Tests\n        shell: pwsh\n        run: |\n          switch (\"${{ matrix.test_type }}\") {\n            \"Unit\" {\n              Write-Host \"Running Unit Tests...\"\n              try { bundle exec rake spec:unit } catch { Write-Host \"Unit tests script not found\" }\n            }\n            \"Integration\" {\n              Write-Host \"Running Integration Tests...\"\n              try { bundle exec rake spec:integration } catch { Write-Host \"Integration tests script not found\" }\n            }\n            \"Functional\" {\n              Write-Host \"Running Functional Tests...\"\n              try { bundle exec rake spec:functional } catch { Write-Host \"Functional tests script not found\" }\n            }\n          }\n        env:\n          TEST_TYPE: ${{ matrix.test_type }}\n          OS_TYPE: ${{ matrix.os }}\n          CHEF_LICENSE: ${{ env.CHEF_LICENSE }}\n          CUSTOM_ENV_VAR: ${{ env.CUSTOM_ENV }}\n\n  # Summary job that depends on all test jobs\n  test-summary:",
    "repo_full_name": "chef/chef",
    "discussion_comments": [
      {
        "comment_id": "2167257077",
        "repo_full_name": "chef/chef",
        "pr_number": 15068,
        "pr_file": ".github/workflows/verify.yml",
        "discussion_id": "2167257077",
        "commented_code": "@@ -0,0 +1,161 @@\n+name: Verify Pipeline\n+\n+on:\n+  workflow_dispatch:\n+    inputs:\n+      base_image_tag:\n+        description: 'Base image tag version'\n+        required: true\n+        default: '3.0.36'\n+        type: string\n+      custom_env_var:\n+        description: 'Custom environment variable'\n+        required: false\n+        default: 'production'\n+        type: string\n+      chef_license:\n+        description: 'Chef license acceptance'\n+        required: true\n+        default: 'accept-no-persist'\n+        type: string\n+  push:\n+    branches: [main]\n+  pull_request:\n+    branches: [main]\n+\n+env:\n+  BASE_IMAGE_TAG: ${{ inputs.base_image_tag || '3.0.36' }}\n+  CUSTOM_ENV: ${{ inputs.custom_env_var || 'production' }}\n+  CHEF_LICENSE: ${{ inputs.chef_license || 'accept-no-persist' }}\n+\n+jobs:\n+  # Linux Tests - Matrix for different test types and OS combinations\n+  linux-tests:\n+    name: Linux ${{ matrix.test_type }} - ${{ matrix.os }}\n+    runs-on: ubuntu-22.04\n+    strategy:\n+      fail-fast: false\n+      matrix:\n+        test_type: [Unit, Integration, Functional]\n+        os:\n+          - rocky-8\n+          - rocky-9\n+          - rhel-9\n+          - debian-9\n+          - ubuntu-1804\n+          - ubuntu-2004\n+          - ubuntu-2204\n+          - centos-7\n+          - amazonlinux-2\n+          - rockylinux-8\n+          - almalinux-9\n+    container:\n+      image: chefes/omnibus-toolchain-${{ matrix.os }}:${{ env.BASE_IMAGE_TAG }}\n+      options: --user root\n+    steps:\n+      - name: Check out code\n+        uses: actions/checkout@v4\n+\n+      - name: Configure Git safe directory\n+        run: |\n+          git config --global --add safe.directory /__w/*/\n+\n+      - name: Display Environment Info\n+        run: |\n+          echo \"Running ${{ matrix.test_type }} tests on ${{ matrix.os }}\"\n+          echo \"Base Image Tag: ${{ env.BASE_IMAGE_TAG }}\"\n+          echo \"Custom Environment: ${{ env.CUSTOM_ENV }}\"\n+          echo \"Chef License: ${{ env.CHEF_LICENSE }}\"\n+          cat /etc/os-release || echo \"OS release info not available\"\n+\n+      - name: Install Dependencies\n+        run: |\n+          ./.expeditor/bk_container_prep.sh\n+\n+      - name: Run ${{ matrix.test_type }} Tests\n+        run: |\n+          ./.expeditor/scripts/prep_and_run_tests.sh \"${{ matrix.test_type }}\"\n+        env:\n+          TEST_TYPE: ${{ matrix.test_type }}\n+          OS_TYPE: ${{ matrix.os }}\n+          CHEF_LICENSE: ${{ env.CHEF_LICENSE }}\n+          CUSTOM_ENV_VAR: ${{ env.CUSTOM_ENV }}\n+\n+  # Windows Tests - Matrix for different test types and Windows versions\n+  windows-tests:\n+    name: Windows ${{ matrix.test_type }} - ${{ matrix.os }}\n+    runs-on: ${{ matrix.os }}\n+    strategy:\n+      fail-fast: false\n+      matrix:\n+        test_type: [Unit, Integration, Functional]\n+        os:\n+          - windows-2019\n+          - windows-2022\n+          - windows-latest\n+    steps:\n+      - name: Check out code\n+        uses: actions/checkout@v4\n+\n+      - name: Set up Ruby\n+        uses: ruby/setup-ruby@v1\n+        with:\n+          ruby-version: '3.1'\n+          bundler-cache: true\n+\n+      - name: Display Environment Info\n+        shell: pwsh\n+        run: |\n+          Write-Host \"Running ${{ matrix.test_type }} tests on ${{ matrix.os }}\"\n+          Write-Host \"Base Image Tag: ${{ env.BASE_IMAGE_TAG }}\"\n+          Write-Host \"Custom Environment: ${{ env.CUSTOM_ENV }}\"\n+          Write-Host \"Chef License: ${{ env.CHEF_LICENSE }}\"\n+          Get-ComputerInfo | Select-Object WindowsProductName, WindowsVersion\n+\n+      - name: Install Dependencies\n+        shell: pwsh\n+        run: |\n+          bundle config set --local without development\n+          bundle install --jobs=3 --retry=3\n+\n+      - name: Run ${{ matrix.test_type }} Tests\n+        shell: pwsh\n+        run: |\n+          switch (\"${{ matrix.test_type }}\") {\n+            \"Unit\" {\n+              Write-Host \"Running Unit Tests...\"\n+              try { bundle exec rake spec:unit } catch { Write-Host \"Unit tests script not found\" }\n+            }\n+            \"Integration\" {\n+              Write-Host \"Running Integration Tests...\"\n+              try { bundle exec rake spec:integration } catch { Write-Host \"Integration tests script not found\" }\n+            }\n+            \"Functional\" {\n+              Write-Host \"Running Functional Tests...\"\n+              try { bundle exec rake spec:functional } catch { Write-Host \"Functional tests script not found\" }\n+            }\n+          }\n+        env:\n+          TEST_TYPE: ${{ matrix.test_type }}\n+          OS_TYPE: ${{ matrix.os }}\n+          CHEF_LICENSE: ${{ env.CHEF_LICENSE }}\n+          CUSTOM_ENV_VAR: ${{ env.CUSTOM_ENV }}\n+\n+  # Summary job that depends on all test jobs\n+  test-summary:",
        "comment_created_at": "2025-06-25T17:30:23+00:00",
        "comment_author": "github-advanced-security[bot]",
        "comment_body": "## Workflow does not contain permissions\n\nActions job or workflow does not limit the permissions of the GITHUB_TOKEN. Consider setting an explicit permissions block, using the following as a minimal starting point: {{contents: read}}\n\n[Show more details](https://github.com/chef/chef/security/code-scanning/290)",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2167257081",
    "pr_number": 15068,
    "pr_file": ".github/workflows/verify.yml",
    "created_at": "2025-06-25T17:30:23+00:00",
    "commented_code": "name: Verify Pipeline\n\non:\n  workflow_dispatch:\n    inputs:\n      base_image_tag:\n        description: 'Base image tag version'\n        required: true\n        default: '3.0.36'\n        type: string\n      custom_env_var:\n        description: 'Custom environment variable'\n        required: false\n        default: 'production'\n        type: string\n      chef_license:\n        description: 'Chef license acceptance'\n        required: true\n        default: 'accept-no-persist'\n        type: string\n  push:\n    branches: [main]\n  pull_request:\n    branches: [main]\n\nenv:\n  BASE_IMAGE_TAG: ${{ inputs.base_image_tag || '3.0.36' }}\n  CUSTOM_ENV: ${{ inputs.custom_env_var || 'production' }}\n  CHEF_LICENSE: ${{ inputs.chef_license || 'accept-no-persist' }}\n\njobs:\n  # Linux Tests - Matrix for different test types and OS combinations\n  linux-tests:\n    name: Linux ${{ matrix.test_type }} - ${{ matrix.os }}\n    runs-on: ubuntu-22.04\n    strategy:\n      fail-fast: false\n      matrix:\n        test_type: [Unit, Integration, Functional]\n        os:\n          - rocky-8\n          - rocky-9\n          - rhel-9\n          - debian-9\n          - ubuntu-1804\n          - ubuntu-2004\n          - ubuntu-2204\n          - centos-7\n          - amazonlinux-2\n          - rockylinux-8\n          - almalinux-9\n    container:\n      image: chefes/omnibus-toolchain-${{ matrix.os }}:${{ env.BASE_IMAGE_TAG }}\n      options: --user root\n    steps:\n      - name: Check out code\n        uses: actions/checkout@v4\n\n      - name: Configure Git safe directory\n        run: |\n          git config --global --add safe.directory /__w/*/\n\n      - name: Display Environment Info\n        run: |\n          echo \"Running ${{ matrix.test_type }} tests on ${{ matrix.os }}\"\n          echo \"Base Image Tag: ${{ env.BASE_IMAGE_TAG }}\"\n          echo \"Custom Environment: ${{ env.CUSTOM_ENV }}\"\n          echo \"Chef License: ${{ env.CHEF_LICENSE }}\"\n          cat /etc/os-release || echo \"OS release info not available\"\n\n      - name: Install Dependencies\n        run: |\n          ./.expeditor/bk_container_prep.sh\n\n      - name: Run ${{ matrix.test_type }} Tests\n        run: |\n          ./.expeditor/scripts/prep_and_run_tests.sh \"${{ matrix.test_type }}\"\n        env:\n          TEST_TYPE: ${{ matrix.test_type }}\n          OS_TYPE: ${{ matrix.os }}\n          CHEF_LICENSE: ${{ env.CHEF_LICENSE }}\n          CUSTOM_ENV_VAR: ${{ env.CUSTOM_ENV }}\n\n  # Windows Tests - Matrix for different test types and Windows versions\n  windows-tests:\n    name: Windows ${{ matrix.test_type }} - ${{ matrix.os }}\n    runs-on: ${{ matrix.os }}\n    strategy:\n      fail-fast: false\n      matrix:\n        test_type: [Unit, Integration, Functional]\n        os:\n          - windows-2019\n          - windows-2022\n          - windows-latest\n    steps:\n      - name: Check out code\n        uses: actions/checkout@v4\n\n      - name: Set up Ruby\n        uses: ruby/setup-ruby@v1\n        with:\n          ruby-version: '3.1'\n          bundler-cache: true\n\n      - name: Display Environment Info\n        shell: pwsh\n        run: |\n          Write-Host \"Running ${{ matrix.test_type }} tests on ${{ matrix.os }}\"\n          Write-Host \"Base Image Tag: ${{ env.BASE_IMAGE_TAG }}\"\n          Write-Host \"Custom Environment: ${{ env.CUSTOM_ENV }}\"\n          Write-Host \"Chef License: ${{ env.CHEF_LICENSE }}\"\n          Get-ComputerInfo | Select-Object WindowsProductName, WindowsVersion\n\n      - name: Install Dependencies\n        shell: pwsh\n        run: |\n          bundle config set --local without development\n          bundle install --jobs=3 --retry=3\n\n      - name: Run ${{ matrix.test_type }} Tests\n        shell: pwsh\n        run: |\n          switch (\"${{ matrix.test_type }}\") {\n            \"Unit\" {\n              Write-Host \"Running Unit Tests...\"\n              try { bundle exec rake spec:unit } catch { Write-Host \"Unit tests script not found\" }\n            }\n            \"Integration\" {\n              Write-Host \"Running Integration Tests...\"\n              try { bundle exec rake spec:integration } catch { Write-Host \"Integration tests script not found\" }\n            }\n            \"Functional\" {\n              Write-Host \"Running Functional Tests...\"\n              try { bundle exec rake spec:functional } catch { Write-Host \"Functional tests script not found\" }\n            }\n          }\n        env:\n          TEST_TYPE: ${{ matrix.test_type }}\n          OS_TYPE: ${{ matrix.os }}\n          CHEF_LICENSE: ${{ env.CHEF_LICENSE }}\n          CUSTOM_ENV_VAR: ${{ env.CUSTOM_ENV }}\n\n  # Summary job that depends on all test jobs\n  test-summary:\n    name: Test Summary\n    runs-on: ubuntu-latest\n    needs: [linux-tests, windows-tests]\n    if: always()\n    steps:\n      - name: Check test results\n        run: |\n          echo \"Linux tests result: ${{ needs.linux-tests.result }}\"\n          echo \"Windows tests result: ${{ needs.windows-tests.result }}\"\n\n          if [[ \"${{ needs.linux-tests.result }}\" == \"failure\" || \"${{ needs.windows-tests.result }}\" == \"failure\" ]]; then\n            echo \"Some tests failed\"\n            exit 1\n          else\n            echo \"All tests passed or were skipped\"\n          fi",
    "repo_full_name": "chef/chef",
    "discussion_comments": [
      {
        "comment_id": "2167257081",
        "repo_full_name": "chef/chef",
        "pr_number": 15068,
        "pr_file": ".github/workflows/verify.yml",
        "discussion_id": "2167257081",
        "commented_code": "@@ -0,0 +1,161 @@\n+name: Verify Pipeline\n+\n+on:\n+  workflow_dispatch:\n+    inputs:\n+      base_image_tag:\n+        description: 'Base image tag version'\n+        required: true\n+        default: '3.0.36'\n+        type: string\n+      custom_env_var:\n+        description: 'Custom environment variable'\n+        required: false\n+        default: 'production'\n+        type: string\n+      chef_license:\n+        description: 'Chef license acceptance'\n+        required: true\n+        default: 'accept-no-persist'\n+        type: string\n+  push:\n+    branches: [main]\n+  pull_request:\n+    branches: [main]\n+\n+env:\n+  BASE_IMAGE_TAG: ${{ inputs.base_image_tag || '3.0.36' }}\n+  CUSTOM_ENV: ${{ inputs.custom_env_var || 'production' }}\n+  CHEF_LICENSE: ${{ inputs.chef_license || 'accept-no-persist' }}\n+\n+jobs:\n+  # Linux Tests - Matrix for different test types and OS combinations\n+  linux-tests:\n+    name: Linux ${{ matrix.test_type }} - ${{ matrix.os }}\n+    runs-on: ubuntu-22.04\n+    strategy:\n+      fail-fast: false\n+      matrix:\n+        test_type: [Unit, Integration, Functional]\n+        os:\n+          - rocky-8\n+          - rocky-9\n+          - rhel-9\n+          - debian-9\n+          - ubuntu-1804\n+          - ubuntu-2004\n+          - ubuntu-2204\n+          - centos-7\n+          - amazonlinux-2\n+          - rockylinux-8\n+          - almalinux-9\n+    container:\n+      image: chefes/omnibus-toolchain-${{ matrix.os }}:${{ env.BASE_IMAGE_TAG }}\n+      options: --user root\n+    steps:\n+      - name: Check out code\n+        uses: actions/checkout@v4\n+\n+      - name: Configure Git safe directory\n+        run: |\n+          git config --global --add safe.directory /__w/*/\n+\n+      - name: Display Environment Info\n+        run: |\n+          echo \"Running ${{ matrix.test_type }} tests on ${{ matrix.os }}\"\n+          echo \"Base Image Tag: ${{ env.BASE_IMAGE_TAG }}\"\n+          echo \"Custom Environment: ${{ env.CUSTOM_ENV }}\"\n+          echo \"Chef License: ${{ env.CHEF_LICENSE }}\"\n+          cat /etc/os-release || echo \"OS release info not available\"\n+\n+      - name: Install Dependencies\n+        run: |\n+          ./.expeditor/bk_container_prep.sh\n+\n+      - name: Run ${{ matrix.test_type }} Tests\n+        run: |\n+          ./.expeditor/scripts/prep_and_run_tests.sh \"${{ matrix.test_type }}\"\n+        env:\n+          TEST_TYPE: ${{ matrix.test_type }}\n+          OS_TYPE: ${{ matrix.os }}\n+          CHEF_LICENSE: ${{ env.CHEF_LICENSE }}\n+          CUSTOM_ENV_VAR: ${{ env.CUSTOM_ENV }}\n+\n+  # Windows Tests - Matrix for different test types and Windows versions\n+  windows-tests:\n+    name: Windows ${{ matrix.test_type }} - ${{ matrix.os }}\n+    runs-on: ${{ matrix.os }}\n+    strategy:\n+      fail-fast: false\n+      matrix:\n+        test_type: [Unit, Integration, Functional]\n+        os:\n+          - windows-2019\n+          - windows-2022\n+          - windows-latest\n+    steps:\n+      - name: Check out code\n+        uses: actions/checkout@v4\n+\n+      - name: Set up Ruby\n+        uses: ruby/setup-ruby@v1\n+        with:\n+          ruby-version: '3.1'\n+          bundler-cache: true\n+\n+      - name: Display Environment Info\n+        shell: pwsh\n+        run: |\n+          Write-Host \"Running ${{ matrix.test_type }} tests on ${{ matrix.os }}\"\n+          Write-Host \"Base Image Tag: ${{ env.BASE_IMAGE_TAG }}\"\n+          Write-Host \"Custom Environment: ${{ env.CUSTOM_ENV }}\"\n+          Write-Host \"Chef License: ${{ env.CHEF_LICENSE }}\"\n+          Get-ComputerInfo | Select-Object WindowsProductName, WindowsVersion\n+\n+      - name: Install Dependencies\n+        shell: pwsh\n+        run: |\n+          bundle config set --local without development\n+          bundle install --jobs=3 --retry=3\n+\n+      - name: Run ${{ matrix.test_type }} Tests\n+        shell: pwsh\n+        run: |\n+          switch (\"${{ matrix.test_type }}\") {\n+            \"Unit\" {\n+              Write-Host \"Running Unit Tests...\"\n+              try { bundle exec rake spec:unit } catch { Write-Host \"Unit tests script not found\" }\n+            }\n+            \"Integration\" {\n+              Write-Host \"Running Integration Tests...\"\n+              try { bundle exec rake spec:integration } catch { Write-Host \"Integration tests script not found\" }\n+            }\n+            \"Functional\" {\n+              Write-Host \"Running Functional Tests...\"\n+              try { bundle exec rake spec:functional } catch { Write-Host \"Functional tests script not found\" }\n+            }\n+          }\n+        env:\n+          TEST_TYPE: ${{ matrix.test_type }}\n+          OS_TYPE: ${{ matrix.os }}\n+          CHEF_LICENSE: ${{ env.CHEF_LICENSE }}\n+          CUSTOM_ENV_VAR: ${{ env.CUSTOM_ENV }}\n+\n+  # Summary job that depends on all test jobs\n+  test-summary:\n+    name: Test Summary\n+    runs-on: ubuntu-latest\n+    needs: [linux-tests, windows-tests]\n+    if: always()\n+    steps:\n+      - name: Check test results\n+        run: |\n+          echo \"Linux tests result: ${{ needs.linux-tests.result }}\"\n+          echo \"Windows tests result: ${{ needs.windows-tests.result }}\"\n+\n+          if [[ \"${{ needs.linux-tests.result }}\" == \"failure\" || \"${{ needs.windows-tests.result }}\" == \"failure\" ]]; then\n+            echo \"Some tests failed\"\n+            exit 1\n+          else\n+            echo \"All tests passed or were skipped\"\n+          fi",
        "comment_created_at": "2025-06-25T17:30:23+00:00",
        "comment_author": "github-advanced-security[bot]",
        "comment_body": "## Workflow does not contain permissions\n\nActions job or workflow does not limit the permissions of the GITHUB_TOKEN. Consider setting an explicit permissions block, using the following as a minimal starting point: {{}}\n\n[Show more details](https://github.com/chef/chef/security/code-scanning/291)",
        "pr_file_module": null
      }
    ]
  }
]
