[
  {
    "discussion_id": "952823237",
    "pr_number": 9776,
    "pr_file": "Makefile",
    "created_at": "2022-08-23T16:03:48+00:00",
    "commented_code": "#   See the License for the specific language governing permissions and\n #   limitations under the License.\n \n-ifneq (, $(BUILDX_BIN))\n-\texport BUILDX_CMD = $(BUILDX_BIN)\n-else ifneq (, $(shell docker buildx version))\n-\texport BUILDX_CMD = docker buildx\n-else ifneq (, $(shell which buildx))\n-\texport BUILDX_CMD = $(which buildx)\n-else\n-\t$(error \"Buildx is required: https://github.com/docker/buildx#installing\")\n-endif\n+PKG := github.com/docker/compose/v2\n+VERSION ?= $(shell git describe --match 'v[0-9]*' --dirty='.m' --always --tags)\n+\n+CGO_ENABLED ?= 0\n+LDFLAGS ?= -s -w -X ${PKG}/internal.Version=${VERSION}",
    "repo_full_name": "docker/compose",
    "discussion_comments": [
      {
        "comment_id": "952823237",
        "repo_full_name": "docker/compose",
        "pr_number": 9776,
        "pr_file": "Makefile",
        "discussion_id": "952823237",
        "commented_code": "@@ -12,15 +12,12 @@\n #   See the License for the specific language governing permissions and\n #   limitations under the License.\n \n-ifneq (, $(BUILDX_BIN))\n-\texport BUILDX_CMD = $(BUILDX_BIN)\n-else ifneq (, $(shell docker buildx version))\n-\texport BUILDX_CMD = docker buildx\n-else ifneq (, $(shell which buildx))\n-\texport BUILDX_CMD = $(which buildx)\n-else\n-\t$(error \"Buildx is required: https://github.com/docker/buildx#installing\")\n-endif\n+PKG := github.com/docker/compose/v2\n+VERSION ?= $(shell git describe --match 'v[0-9]*' --dirty='.m' --always --tags)\n+\n+CGO_ENABLED ?= 0\n+LDFLAGS ?= -s -w -X ${PKG}/internal.Version=${VERSION}",
        "comment_created_at": "2022-08-23T16:03:48+00:00",
        "comment_author": "thaJeztah",
        "comment_body": "Perhaps it would be good to use a different variable name for this; I know that some tools (`rpm`, `deb` packaging) also set `LDFLAGS` as environment variable, and in those cases it's important to reset them.\r\n\r\nWe could use something similar a containerd, which uses `GO_LDFLAGS` (as well as some other `GO_` prefixed variables to prevent conflicts); https://github.com/containerd/containerd/blob/be91a219c2ac5e65c00bbe85c5dff0827d41958b/Makefile#L92-L102\r\n",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "274490423",
    "pr_number": 6641,
    "pr_file": "Dockerfile.alpine",
    "created_at": "2019-04-11T15:42:43+00:00",
    "commented_code": "+FROM python:3.7.3-alpine3.9 AS build\n+\n+ARG DOCKER_COMPOSE_GITSHA=unknown\n+ENV DOCKER_COMPOSE_GITSHA=$DOCKER_COMPOSE_GITSHA",
    "repo_full_name": "docker/compose",
    "discussion_comments": [
      {
        "comment_id": "274490423",
        "repo_full_name": "docker/compose",
        "pr_number": 6641,
        "pr_file": "Dockerfile.alpine",
        "discussion_id": "274490423",
        "commented_code": "@@ -0,0 +1,42 @@\n+FROM python:3.7.3-alpine3.9 AS build\n+\n+ARG DOCKER_COMPOSE_GITSHA=unknown\n+ENV DOCKER_COMPOSE_GITSHA=$DOCKER_COMPOSE_GITSHA",
        "comment_created_at": "2019-04-11T15:42:43+00:00",
        "comment_author": "thaJeztah",
        "comment_body": "It's often a good idea to use a different name for the `ARG` than for the `ENV`. Both act in the same \"space\" (both are set as (environment) variables, which can lead to run situations where the `ENV` is always overridden by the `ARG` (I can find some examples, don't have them at hand)\r\n\r\nSo, might want to consider, e.g.;\r\n\r\n```Dockerfile\r\nARG GIT_COMMIT=unknown\r\nENV DOCKER_COMPOSE_GITSHA=$GIT_COMMIT\r\n```\r\n\r\n(or vice-versa)",
        "pr_file_module": null
      },
      {
        "comment_id": "274914935",
        "repo_full_name": "docker/compose",
        "pr_number": 6641,
        "pr_file": "Dockerfile.alpine",
        "discussion_id": "274490423",
        "commented_code": "@@ -0,0 +1,42 @@\n+FROM python:3.7.3-alpine3.9 AS build\n+\n+ARG DOCKER_COMPOSE_GITSHA=unknown\n+ENV DOCKER_COMPOSE_GITSHA=$DOCKER_COMPOSE_GITSHA",
        "comment_created_at": "2019-04-12T13:52:19+00:00",
        "comment_author": "ulyssessouza",
        "comment_body": "Done",
        "pr_file_module": null
      }
    ]
  }
]