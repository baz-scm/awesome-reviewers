[
  {
    "discussion_id": "275000772",
    "pr_number": 6641,
    "pr_file": "Dockerfile",
    "created_at": "2019-04-12T17:36:49+00:00",
    "commented_code": "-FROM docker:18.06.1 as docker\n-FROM python:3.7.2-stretch\n+ARG DOCKER_VERSION=18.09.5\n+ARG PYTHON_VERSION=3.7.3\n+ARG ALPINE_VERSION=3.9\n+ARG DEBIAN_VERSION=stretch-slim\n+ARG BUILD_PLATFORM=alpine\n \n-RUN set -ex; \\\n-    apt-get update -qq; \\\n-    apt-get install -y \\\n-        locales \\\n-        python-dev \\\n-        git\n+FROM docker:${DOCKER_VERSION} AS docker-cli\n \n-COPY --from=docker /usr/local/bin/docker /usr/local/bin/docker\n+FROM python:${PYTHON_VERSION}-alpine${ALPINE_VERSION} AS build-alpine\n+RUN apk add --no-cache \\\n+    bash \\\n+    build-base \\\n+    ca-certificates \\\n+    curl \\\n+    gcc \\\n+    git \\\n+    libc-dev \\\n+    libffi-dev \\\n+    libgcc \\\n+    make \\\n+    musl-dev \\\n+    openssl \\\n+    openssl-dev \\\n+    python2 \\\n+    python2-dev \\\n+    zlib-dev\n+ENV BUILD_BOOTLOADER=1\n \n-# Python3 requires a valid locale\n-RUN echo \"en_US.UTF-8 UTF-8\" > /etc/locale.gen && locale-gen\n-ENV LANG en_US.UTF-8\n+FROM python:${PYTHON_VERSION}-slim-stretch AS build-debian\n+RUN apt-get update && apt-get install -y \\\n+    curl \\\n+    gcc \\\n+    git \\\n+    libc-dev \\\n+    libgcc-6-dev \\\n+    make \\\n+    openssl \\\n+    python2.7-dev\n \n-RUN useradd -d /home/user -m -s /bin/bash user\n+FROM build-${BUILD_PLATFORM} AS build\n WORKDIR /code/\n-\n # FIXME(chris-crone): virtualenv 16.3.0 breaks build, force 16.2.0 until fixed\n-RUN pip install virtualenv==16.2.0\n-RUN pip install tox==2.9.1\n+RUN pip install virtualenv==16.2.0 tox==2.1.1\n \n-ADD requirements.txt /code/\n-ADD requirements-dev.txt /code/\n-ADD .pre-commit-config.yaml /code/\n-ADD setup.py /code/\n-ADD tox.ini /code/\n-ADD compose /code/compose/\n-ADD README.md /code/\n+ARG GIT_COMMIT=unknown\n+ENV DOCKER_COMPOSE_GITSHA=$GIT_COMMIT",
    "repo_full_name": "docker/compose",
    "discussion_comments": [
      {
        "comment_id": "275000772",
        "repo_full_name": "docker/compose",
        "pr_number": 6641,
        "pr_file": "Dockerfile",
        "discussion_id": "275000772",
        "commented_code": "@@ -1,36 +1,68 @@\n-FROM docker:18.06.1 as docker\n-FROM python:3.7.2-stretch\n+ARG DOCKER_VERSION=18.09.5\n+ARG PYTHON_VERSION=3.7.3\n+ARG ALPINE_VERSION=3.9\n+ARG DEBIAN_VERSION=stretch-slim\n+ARG BUILD_PLATFORM=alpine\n \n-RUN set -ex; \\\n-    apt-get update -qq; \\\n-    apt-get install -y \\\n-        locales \\\n-        python-dev \\\n-        git\n+FROM docker:${DOCKER_VERSION} AS docker-cli\n \n-COPY --from=docker /usr/local/bin/docker /usr/local/bin/docker\n+FROM python:${PYTHON_VERSION}-alpine${ALPINE_VERSION} AS build-alpine\n+RUN apk add --no-cache \\\n+    bash \\\n+    build-base \\\n+    ca-certificates \\\n+    curl \\\n+    gcc \\\n+    git \\\n+    libc-dev \\\n+    libffi-dev \\\n+    libgcc \\\n+    make \\\n+    musl-dev \\\n+    openssl \\\n+    openssl-dev \\\n+    python2 \\\n+    python2-dev \\\n+    zlib-dev\n+ENV BUILD_BOOTLOADER=1\n \n-# Python3 requires a valid locale\n-RUN echo \"en_US.UTF-8 UTF-8\" > /etc/locale.gen && locale-gen\n-ENV LANG en_US.UTF-8\n+FROM python:${PYTHON_VERSION}-slim-stretch AS build-debian\n+RUN apt-get update && apt-get install -y \\\n+    curl \\\n+    gcc \\\n+    git \\\n+    libc-dev \\\n+    libgcc-6-dev \\\n+    make \\\n+    openssl \\\n+    python2.7-dev\n \n-RUN useradd -d /home/user -m -s /bin/bash user\n+FROM build-${BUILD_PLATFORM} AS build\n WORKDIR /code/\n-\n # FIXME(chris-crone): virtualenv 16.3.0 breaks build, force 16.2.0 until fixed\n-RUN pip install virtualenv==16.2.0\n-RUN pip install tox==2.9.1\n+RUN pip install virtualenv==16.2.0 tox==2.1.1\n \n-ADD requirements.txt /code/\n-ADD requirements-dev.txt /code/\n-ADD .pre-commit-config.yaml /code/\n-ADD setup.py /code/\n-ADD tox.ini /code/\n-ADD compose /code/compose/\n-ADD README.md /code/\n+ARG GIT_COMMIT=unknown\n+ENV DOCKER_COMPOSE_GITSHA=$GIT_COMMIT",
        "comment_created_at": "2019-04-12T17:36:49+00:00",
        "comment_author": "thaJeztah",
        "comment_body": "I _think_ this `ENV` is only used by `script/build/linux-entrypoint`, so better to move it lower to prevent unwanted cache-busts",
        "pr_file_module": null
      },
      {
        "comment_id": "275271833",
        "repo_full_name": "docker/compose",
        "pr_number": 6641,
        "pr_file": "Dockerfile",
        "discussion_id": "275000772",
        "commented_code": "@@ -1,36 +1,68 @@\n-FROM docker:18.06.1 as docker\n-FROM python:3.7.2-stretch\n+ARG DOCKER_VERSION=18.09.5\n+ARG PYTHON_VERSION=3.7.3\n+ARG ALPINE_VERSION=3.9\n+ARG DEBIAN_VERSION=stretch-slim\n+ARG BUILD_PLATFORM=alpine\n \n-RUN set -ex; \\\n-    apt-get update -qq; \\\n-    apt-get install -y \\\n-        locales \\\n-        python-dev \\\n-        git\n+FROM docker:${DOCKER_VERSION} AS docker-cli\n \n-COPY --from=docker /usr/local/bin/docker /usr/local/bin/docker\n+FROM python:${PYTHON_VERSION}-alpine${ALPINE_VERSION} AS build-alpine\n+RUN apk add --no-cache \\\n+    bash \\\n+    build-base \\\n+    ca-certificates \\\n+    curl \\\n+    gcc \\\n+    git \\\n+    libc-dev \\\n+    libffi-dev \\\n+    libgcc \\\n+    make \\\n+    musl-dev \\\n+    openssl \\\n+    openssl-dev \\\n+    python2 \\\n+    python2-dev \\\n+    zlib-dev\n+ENV BUILD_BOOTLOADER=1\n \n-# Python3 requires a valid locale\n-RUN echo \"en_US.UTF-8 UTF-8\" > /etc/locale.gen && locale-gen\n-ENV LANG en_US.UTF-8\n+FROM python:${PYTHON_VERSION}-slim-stretch AS build-debian\n+RUN apt-get update && apt-get install -y \\\n+    curl \\\n+    gcc \\\n+    git \\\n+    libc-dev \\\n+    libgcc-6-dev \\\n+    make \\\n+    openssl \\\n+    python2.7-dev\n \n-RUN useradd -d /home/user -m -s /bin/bash user\n+FROM build-${BUILD_PLATFORM} AS build\n WORKDIR /code/\n-\n # FIXME(chris-crone): virtualenv 16.3.0 breaks build, force 16.2.0 until fixed\n-RUN pip install virtualenv==16.2.0\n-RUN pip install tox==2.9.1\n+RUN pip install virtualenv==16.2.0 tox==2.1.1\n \n-ADD requirements.txt /code/\n-ADD requirements-dev.txt /code/\n-ADD .pre-commit-config.yaml /code/\n-ADD setup.py /code/\n-ADD tox.ini /code/\n-ADD compose /code/compose/\n-ADD README.md /code/\n+ARG GIT_COMMIT=unknown\n+ENV DOCKER_COMPOSE_GITSHA=$GIT_COMMIT",
        "comment_created_at": "2019-04-15T09:17:33+00:00",
        "comment_author": "ulyssessouza",
        "comment_body": "Done",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "275376460",
    "pr_number": 6641,
    "pr_file": "Dockerfile",
    "created_at": "2019-04-15T14:05:02+00:00",
    "commented_code": "-FROM docker:18.06.1 as docker\n-FROM python:3.7.2-stretch\n+ARG DOCKER_VERSION=18.09.5\n+ARG PYTHON_VERSION=3.7.3\n+ARG ALPINE_VERSION=3.9\n+ARG DEBIAN_VERSION=stretch-slim\n+ARG BUILD_PLATFORM=alpine\n \n-RUN set -ex; \\\n-    apt-get update -qq; \\\n-    apt-get install -y \\\n-        locales \\\n-        python-dev \\\n-        git\n+FROM docker:${DOCKER_VERSION} AS docker-cli\n \n-COPY --from=docker /usr/local/bin/docker /usr/local/bin/docker\n+FROM python:${PYTHON_VERSION}-alpine${ALPINE_VERSION} AS build-alpine\n+RUN apk add --no-cache \\\n+    bash \\\n+    build-base \\\n+    ca-certificates \\\n+    curl \\\n+    gcc \\\n+    git \\\n+    libc-dev \\\n+    libffi-dev \\\n+    libgcc \\\n+    make \\\n+    musl-dev \\\n+    openssl \\\n+    openssl-dev \\\n+    python2 \\\n+    python2-dev \\\n+    zlib-dev\n+ENV BUILD_BOOTLOADER=1\n \n-# Python3 requires a valid locale\n-RUN echo \"en_US.UTF-8 UTF-8\" > /etc/locale.gen && locale-gen\n-ENV LANG en_US.UTF-8\n+FROM python:${PYTHON_VERSION}-slim-stretch AS build-debian\n+RUN apt-get update && apt-get install -y \\\n+    curl \\\n+    gcc \\\n+    git \\\n+    libc-dev \\\n+    libgcc-6-dev \\\n+    make \\\n+    openssl \\\n+    python2.7-dev\n \n-RUN useradd -d /home/user -m -s /bin/bash user\n+FROM build-${BUILD_PLATFORM} AS build\n+COPY --from=docker-cli /usr/local/bin/docker /usr/local/bin/docker\n WORKDIR /code/\n-\n # FIXME(chris-crone): virtualenv 16.3.0 breaks build, force 16.2.0 until fixed\n RUN pip install virtualenv==16.2.0\n-RUN pip install tox==2.9.1\n-\n-ADD requirements.txt /code/\n-ADD requirements-dev.txt /code/\n-ADD .pre-commit-config.yaml /code/\n-ADD setup.py /code/\n-ADD tox.ini /code/\n-ADD compose /code/compose/\n-ADD README.md /code/\n+RUN pip install tox==2.1.1\n+\n+COPY requirements.txt .\n+COPY requirements-dev.txt .\n+COPY .pre-commit-config.yaml .\n+COPY tox.ini .\n+COPY setup.py .\n+COPY README.md .\n+COPY compose compose/\n RUN tox --notest\n+COPY . .\n+ARG GIT_COMMIT=unknown\n+ENV DOCKER_COMPOSE_GITSHA=$GIT_COMMIT\n+RUN script/build/linux-entrypoint\n+COPY docker-compose-entrypoint.sh /usr/local/bin/",
    "repo_full_name": "docker/compose",
    "discussion_comments": [
      {
        "comment_id": "275376460",
        "repo_full_name": "docker/compose",
        "pr_number": 6641,
        "pr_file": "Dockerfile",
        "discussion_id": "275376460",
        "commented_code": "@@ -1,36 +1,70 @@\n-FROM docker:18.06.1 as docker\n-FROM python:3.7.2-stretch\n+ARG DOCKER_VERSION=18.09.5\n+ARG PYTHON_VERSION=3.7.3\n+ARG ALPINE_VERSION=3.9\n+ARG DEBIAN_VERSION=stretch-slim\n+ARG BUILD_PLATFORM=alpine\n \n-RUN set -ex; \\\n-    apt-get update -qq; \\\n-    apt-get install -y \\\n-        locales \\\n-        python-dev \\\n-        git\n+FROM docker:${DOCKER_VERSION} AS docker-cli\n \n-COPY --from=docker /usr/local/bin/docker /usr/local/bin/docker\n+FROM python:${PYTHON_VERSION}-alpine${ALPINE_VERSION} AS build-alpine\n+RUN apk add --no-cache \\\n+    bash \\\n+    build-base \\\n+    ca-certificates \\\n+    curl \\\n+    gcc \\\n+    git \\\n+    libc-dev \\\n+    libffi-dev \\\n+    libgcc \\\n+    make \\\n+    musl-dev \\\n+    openssl \\\n+    openssl-dev \\\n+    python2 \\\n+    python2-dev \\\n+    zlib-dev\n+ENV BUILD_BOOTLOADER=1\n \n-# Python3 requires a valid locale\n-RUN echo \"en_US.UTF-8 UTF-8\" > /etc/locale.gen && locale-gen\n-ENV LANG en_US.UTF-8\n+FROM python:${PYTHON_VERSION}-slim-stretch AS build-debian\n+RUN apt-get update && apt-get install -y \\\n+    curl \\\n+    gcc \\\n+    git \\\n+    libc-dev \\\n+    libgcc-6-dev \\\n+    make \\\n+    openssl \\\n+    python2.7-dev\n \n-RUN useradd -d /home/user -m -s /bin/bash user\n+FROM build-${BUILD_PLATFORM} AS build\n+COPY --from=docker-cli /usr/local/bin/docker /usr/local/bin/docker\n WORKDIR /code/\n-\n # FIXME(chris-crone): virtualenv 16.3.0 breaks build, force 16.2.0 until fixed\n RUN pip install virtualenv==16.2.0\n-RUN pip install tox==2.9.1\n-\n-ADD requirements.txt /code/\n-ADD requirements-dev.txt /code/\n-ADD .pre-commit-config.yaml /code/\n-ADD setup.py /code/\n-ADD tox.ini /code/\n-ADD compose /code/compose/\n-ADD README.md /code/\n+RUN pip install tox==2.1.1\n+\n+COPY requirements.txt .\n+COPY requirements-dev.txt .\n+COPY .pre-commit-config.yaml .\n+COPY tox.ini .\n+COPY setup.py .\n+COPY README.md .\n+COPY compose compose/\n RUN tox --notest\n+COPY . .\n+ARG GIT_COMMIT=unknown\n+ENV DOCKER_COMPOSE_GITSHA=$GIT_COMMIT\n+RUN script/build/linux-entrypoint\n+COPY docker-compose-entrypoint.sh /usr/local/bin/",
        "comment_created_at": "2019-04-15T14:05:02+00:00",
        "comment_author": "thaJeztah",
        "comment_body": "very minor nit; this file likely doesn't change much, so could be moved before the `COPY . . `, or even before the `COPY requirements.txt` (ordering from \"less frequently changing\" to \"most frequently changing\").\r\n\r\nIf this script (and `ENTRYPOINT` below is only used for `runtime`, might consider moving both to the start of the `runtime` stage)",
        "pr_file_module": null
      },
      {
        "comment_id": "275422430",
        "repo_full_name": "docker/compose",
        "pr_number": 6641,
        "pr_file": "Dockerfile",
        "discussion_id": "275376460",
        "commented_code": "@@ -1,36 +1,70 @@\n-FROM docker:18.06.1 as docker\n-FROM python:3.7.2-stretch\n+ARG DOCKER_VERSION=18.09.5\n+ARG PYTHON_VERSION=3.7.3\n+ARG ALPINE_VERSION=3.9\n+ARG DEBIAN_VERSION=stretch-slim\n+ARG BUILD_PLATFORM=alpine\n \n-RUN set -ex; \\\n-    apt-get update -qq; \\\n-    apt-get install -y \\\n-        locales \\\n-        python-dev \\\n-        git\n+FROM docker:${DOCKER_VERSION} AS docker-cli\n \n-COPY --from=docker /usr/local/bin/docker /usr/local/bin/docker\n+FROM python:${PYTHON_VERSION}-alpine${ALPINE_VERSION} AS build-alpine\n+RUN apk add --no-cache \\\n+    bash \\\n+    build-base \\\n+    ca-certificates \\\n+    curl \\\n+    gcc \\\n+    git \\\n+    libc-dev \\\n+    libffi-dev \\\n+    libgcc \\\n+    make \\\n+    musl-dev \\\n+    openssl \\\n+    openssl-dev \\\n+    python2 \\\n+    python2-dev \\\n+    zlib-dev\n+ENV BUILD_BOOTLOADER=1\n \n-# Python3 requires a valid locale\n-RUN echo \"en_US.UTF-8 UTF-8\" > /etc/locale.gen && locale-gen\n-ENV LANG en_US.UTF-8\n+FROM python:${PYTHON_VERSION}-slim-stretch AS build-debian\n+RUN apt-get update && apt-get install -y \\\n+    curl \\\n+    gcc \\\n+    git \\\n+    libc-dev \\\n+    libgcc-6-dev \\\n+    make \\\n+    openssl \\\n+    python2.7-dev\n \n-RUN useradd -d /home/user -m -s /bin/bash user\n+FROM build-${BUILD_PLATFORM} AS build\n+COPY --from=docker-cli /usr/local/bin/docker /usr/local/bin/docker\n WORKDIR /code/\n-\n # FIXME(chris-crone): virtualenv 16.3.0 breaks build, force 16.2.0 until fixed\n RUN pip install virtualenv==16.2.0\n-RUN pip install tox==2.9.1\n-\n-ADD requirements.txt /code/\n-ADD requirements-dev.txt /code/\n-ADD .pre-commit-config.yaml /code/\n-ADD setup.py /code/\n-ADD tox.ini /code/\n-ADD compose /code/compose/\n-ADD README.md /code/\n+RUN pip install tox==2.1.1\n+\n+COPY requirements.txt .\n+COPY requirements-dev.txt .\n+COPY .pre-commit-config.yaml .\n+COPY tox.ini .\n+COPY setup.py .\n+COPY README.md .\n+COPY compose compose/\n RUN tox --notest\n+COPY . .\n+ARG GIT_COMMIT=unknown\n+ENV DOCKER_COMPOSE_GITSHA=$GIT_COMMIT\n+RUN script/build/linux-entrypoint\n+COPY docker-compose-entrypoint.sh /usr/local/bin/",
        "comment_created_at": "2019-04-15T15:37:48+00:00",
        "comment_author": "ulyssessouza",
        "comment_body": "Done",
        "pr_file_module": null
      }
    ]
  }
]