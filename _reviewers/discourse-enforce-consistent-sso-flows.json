[
  {
    "discussion_id": "2286311241",
    "pr_number": 34424,
    "pr_file": "app/assets/javascripts/discourse/app/routes/login.js",
    "created_at": "2025-08-19T20:53:39+00:00",
    "commented_code": "}\n     }\n \n-    // When Discourse Connect is enabled, redirect to the SSO endpoint\n-    if (auth_immediately && enable_discourse_connect) {\n-      const returnPath = cookie(\"destination_url\")\n-        ? getURL(\"/\")\n-        : encodeURIComponent(url);\n-      window.location = getURL(`/session/sso?return_path=${returnPath}`);\n+    // Handle DiscourseConnect first...\n+    if (enable_discourse_connect) {\n+      if (auth_immediately || !login_required) {\n+        const returnPath = cookie(\"destination_url\")\n+          ? getURL(\"/\")\n+          : encodeURIComponent(url);\n+        window.location = getURL(`/session/sso?return_path=${returnPath}`);\n+      } else {\n+        router.replaceWith(\"discovery.login-required\");\n+      }",
    "repo_full_name": "discourse/discourse",
    "discussion_comments": [
      {
        "comment_id": "2286311241",
        "repo_full_name": "discourse/discourse",
        "pr_number": 34424,
        "pr_file": "app/assets/javascripts/discourse/app/routes/login.js",
        "discussion_id": "2286311241",
        "commented_code": "@@ -56,12 +56,16 @@ export default class extends DiscourseRoute {\n       }\n     }\n \n-    // When Discourse Connect is enabled, redirect to the SSO endpoint\n-    if (auth_immediately && enable_discourse_connect) {\n-      const returnPath = cookie(\"destination_url\")\n-        ? getURL(\"/\")\n-        : encodeURIComponent(url);\n-      window.location = getURL(`/session/sso?return_path=${returnPath}`);\n+    // Handle DiscourseConnect first...\n+    if (enable_discourse_connect) {\n+      if (auth_immediately || !login_required) {\n+        const returnPath = cookie(\"destination_url\")\n+          ? getURL(\"/\")\n+          : encodeURIComponent(url);\n+        window.location = getURL(`/session/sso?return_path=${returnPath}`);\n+      } else {\n+        router.replaceWith(\"discovery.login-required\");\n+      }",
        "comment_created_at": "2025-08-19T20:53:39+00:00",
        "comment_author": "pmusaraj",
        "comment_body": "I think we can simplify this, regardless of `auth_immediately` or `login_required`, we should redirect to the SSO here on the `/login` or `/signup` routes for DiscourseConnect. When DiscourseConnect is enabled, it is the only auth mechanism, so there is no value in respecting `auth_immediately` in this route. \n\nOn the \"/\" endpoint, it still decides whether a splash screen is shown (`auth_immediately=false`) or not (`auth_immediately=true`) for login required sites. ",
        "pr_file_module": null
      }
    ]
  }
]