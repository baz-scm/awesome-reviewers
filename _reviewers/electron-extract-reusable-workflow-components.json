[
  {
    "discussion_id": "2008101843",
    "pr_number": 45881,
    "pr_file": ".github/actions/checkout/action.yml",
    "created_at": "2025-03-21T18:17:34+00:00",
    "commented_code": "uses: ./src/electron/.github/actions/set-chromium-cookie\n   - name: Install Build Tools\n     uses: ./src/electron/.github/actions/install-build-tools\n-  - name: Get Depot Tools\n-    shell: bash\n-    run: |\n-      if [[ ! -d depot_tools ]]; then\n-        git clone --depth=1 https://chromium.googlesource.com/chromium/tools/depot_tools.git\n-\n-        # Ensure depot_tools does not update.\n-        test -d depot_tools && cd depot_tools\n-        touch .disable_auto_update\n-      fi\n-  - name: Add Depot Tools to PATH\n-    shell: bash\n-    run: echo \"$(pwd)/depot_tools\" >> $GITHUB_PATH\n   - name: Generate DEPS Hash\n     shell: bash\n     run: |\n       node src/electron/script/generate-deps-hash.js\n-      echo \"DEPSHASH=v1-src-cache-$(cat src/electron/.depshash)\" >> $GITHUB_ENV\n+      DEPSHASH=\"v1-src-cache-$(cat src/electron/.depshash)\"\n+      echo \"DEPSHASH=$DEPSHASH\" >> $GITHUB_ENV\n+      echo \"CACHE_FILE=$DEPSHASH.tar\" >> $GITHUB_ENV\n+      if [ \"${{ inputs.target-platform }}\" = \"win\" ]; then\n+        echo \"CACHE_DRIVE=/mnt/win-cache\" >> $GITHUB_ENV\n+      else\n+        echo \"CACHE_DRIVE=/mnt/cross-instance-cache\" >> $GITHUB_ENV\n+      fi\n   - name: Generate SAS Key\n     if: ${{ inputs.generate-sas-token == 'true' }}\n     shell: bash\n     run: |\n-      curl --unix-socket /var/run/sas/sas.sock --fail \"http://foo/$DEPSHASH.tar\" > sas-token\n+      curl --unix-socket /var/run/sas/sas.sock --fail \"http://foo/$CACHE_FILE?platform=${{ inputs.target-platform }}\" > sas-token\n   - name: Save SAS Key\n     if: ${{ inputs.generate-sas-token == 'true' }}\n-    uses: actions/cache/save@1bd1e32a3bdc45362d1e726936510720a7c30a57\n+    uses: actions/cache/save@d4323d4df104b026a6aa633fdb11d772146be0bf\n     with:\n-      path: |\n-        sas-token\n-      key: sas-key-${{ github.run_number }}-${{ github.run_attempt }}\n+      path: sas-token\n+      key: sas-key-${{ inputs.target-platform }}-${{ github.run_number }}-${{ github.run_attempt }}\n+      enableCrossOsArchive: true",
    "repo_full_name": "electron/electron",
    "discussion_comments": [
      {
        "comment_id": "2008101843",
        "repo_full_name": "electron/electron",
        "pr_number": 45881,
        "pr_file": ".github/actions/checkout/action.yml",
        "discussion_id": "2008101843",
        "commented_code": "@@ -22,36 +24,30 @@ runs:\n     uses: ./src/electron/.github/actions/set-chromium-cookie\n   - name: Install Build Tools\n     uses: ./src/electron/.github/actions/install-build-tools\n-  - name: Get Depot Tools\n-    shell: bash\n-    run: |\n-      if [[ ! -d depot_tools ]]; then\n-        git clone --depth=1 https://chromium.googlesource.com/chromium/tools/depot_tools.git\n-\n-        # Ensure depot_tools does not update.\n-        test -d depot_tools && cd depot_tools\n-        touch .disable_auto_update\n-      fi\n-  - name: Add Depot Tools to PATH\n-    shell: bash\n-    run: echo \"$(pwd)/depot_tools\" >> $GITHUB_PATH\n   - name: Generate DEPS Hash\n     shell: bash\n     run: |\n       node src/electron/script/generate-deps-hash.js\n-      echo \"DEPSHASH=v1-src-cache-$(cat src/electron/.depshash)\" >> $GITHUB_ENV\n+      DEPSHASH=\"v1-src-cache-$(cat src/electron/.depshash)\"\n+      echo \"DEPSHASH=$DEPSHASH\" >> $GITHUB_ENV\n+      echo \"CACHE_FILE=$DEPSHASH.tar\" >> $GITHUB_ENV\n+      if [ \"${{ inputs.target-platform }}\" = \"win\" ]; then\n+        echo \"CACHE_DRIVE=/mnt/win-cache\" >> $GITHUB_ENV\n+      else\n+        echo \"CACHE_DRIVE=/mnt/cross-instance-cache\" >> $GITHUB_ENV\n+      fi\n   - name: Generate SAS Key\n     if: ${{ inputs.generate-sas-token == 'true' }}\n     shell: bash\n     run: |\n-      curl --unix-socket /var/run/sas/sas.sock --fail \"http://foo/$DEPSHASH.tar\" > sas-token\n+      curl --unix-socket /var/run/sas/sas.sock --fail \"http://foo/$CACHE_FILE?platform=${{ inputs.target-platform }}\" > sas-token\n   - name: Save SAS Key\n     if: ${{ inputs.generate-sas-token == 'true' }}\n-    uses: actions/cache/save@1bd1e32a3bdc45362d1e726936510720a7c30a57\n+    uses: actions/cache/save@d4323d4df104b026a6aa633fdb11d772146be0bf\n     with:\n-      path: |\n-        sas-token\n-      key: sas-key-${{ github.run_number }}-${{ github.run_attempt }}\n+      path: sas-token\n+      key: sas-key-${{ inputs.target-platform }}-${{ github.run_number }}-${{ github.run_attempt }}\n+      enableCrossOsArchive: true",
        "comment_created_at": "2025-03-21T18:17:34+00:00",
        "comment_author": "VerteDinde",
        "comment_body": "Not a blocker, but just curious, why add `enableCrossOsArchive` here, did the cache/save action require setting it explicitly?",
        "pr_file_module": null
      },
      {
        "comment_id": "2008110562",
        "repo_full_name": "electron/electron",
        "pr_number": 45881,
        "pr_file": ".github/actions/checkout/action.yml",
        "discussion_id": "2008101843",
        "commented_code": "@@ -22,36 +24,30 @@ runs:\n     uses: ./src/electron/.github/actions/set-chromium-cookie\n   - name: Install Build Tools\n     uses: ./src/electron/.github/actions/install-build-tools\n-  - name: Get Depot Tools\n-    shell: bash\n-    run: |\n-      if [[ ! -d depot_tools ]]; then\n-        git clone --depth=1 https://chromium.googlesource.com/chromium/tools/depot_tools.git\n-\n-        # Ensure depot_tools does not update.\n-        test -d depot_tools && cd depot_tools\n-        touch .disable_auto_update\n-      fi\n-  - name: Add Depot Tools to PATH\n-    shell: bash\n-    run: echo \"$(pwd)/depot_tools\" >> $GITHUB_PATH\n   - name: Generate DEPS Hash\n     shell: bash\n     run: |\n       node src/electron/script/generate-deps-hash.js\n-      echo \"DEPSHASH=v1-src-cache-$(cat src/electron/.depshash)\" >> $GITHUB_ENV\n+      DEPSHASH=\"v1-src-cache-$(cat src/electron/.depshash)\"\n+      echo \"DEPSHASH=$DEPSHASH\" >> $GITHUB_ENV\n+      echo \"CACHE_FILE=$DEPSHASH.tar\" >> $GITHUB_ENV\n+      if [ \"${{ inputs.target-platform }}\" = \"win\" ]; then\n+        echo \"CACHE_DRIVE=/mnt/win-cache\" >> $GITHUB_ENV\n+      else\n+        echo \"CACHE_DRIVE=/mnt/cross-instance-cache\" >> $GITHUB_ENV\n+      fi\n   - name: Generate SAS Key\n     if: ${{ inputs.generate-sas-token == 'true' }}\n     shell: bash\n     run: |\n-      curl --unix-socket /var/run/sas/sas.sock --fail \"http://foo/$DEPSHASH.tar\" > sas-token\n+      curl --unix-socket /var/run/sas/sas.sock --fail \"http://foo/$CACHE_FILE?platform=${{ inputs.target-platform }}\" > sas-token\n   - name: Save SAS Key\n     if: ${{ inputs.generate-sas-token == 'true' }}\n-    uses: actions/cache/save@1bd1e32a3bdc45362d1e726936510720a7c30a57\n+    uses: actions/cache/save@d4323d4df104b026a6aa633fdb11d772146be0bf\n     with:\n-      path: |\n-        sas-token\n-      key: sas-key-${{ github.run_number }}-${{ github.run_attempt }}\n+      path: sas-token\n+      key: sas-key-${{ inputs.target-platform }}-${{ github.run_number }}-${{ github.run_attempt }}\n+      enableCrossOsArchive: true",
        "comment_created_at": "2025-03-21T18:23:54+00:00",
        "comment_author": "jkleinsc",
        "comment_body": "@VerteDinde yes.  Due to the cache being saved on Linux and restored on Windows.  See\r\nhttps://github.com/actions/cache?tab=readme-ov-file#inputs",
        "pr_file_module": null
      },
      {
        "comment_id": "2103076524",
        "repo_full_name": "electron/electron",
        "pr_number": 45881,
        "pr_file": ".github/actions/checkout/action.yml",
        "discussion_id": "2008101843",
        "commented_code": "@@ -22,36 +24,30 @@ runs:\n     uses: ./src/electron/.github/actions/set-chromium-cookie\n   - name: Install Build Tools\n     uses: ./src/electron/.github/actions/install-build-tools\n-  - name: Get Depot Tools\n-    shell: bash\n-    run: |\n-      if [[ ! -d depot_tools ]]; then\n-        git clone --depth=1 https://chromium.googlesource.com/chromium/tools/depot_tools.git\n-\n-        # Ensure depot_tools does not update.\n-        test -d depot_tools && cd depot_tools\n-        touch .disable_auto_update\n-      fi\n-  - name: Add Depot Tools to PATH\n-    shell: bash\n-    run: echo \"$(pwd)/depot_tools\" >> $GITHUB_PATH\n   - name: Generate DEPS Hash\n     shell: bash\n     run: |\n       node src/electron/script/generate-deps-hash.js\n-      echo \"DEPSHASH=v1-src-cache-$(cat src/electron/.depshash)\" >> $GITHUB_ENV\n+      DEPSHASH=\"v1-src-cache-$(cat src/electron/.depshash)\"\n+      echo \"DEPSHASH=$DEPSHASH\" >> $GITHUB_ENV\n+      echo \"CACHE_FILE=$DEPSHASH.tar\" >> $GITHUB_ENV\n+      if [ \"${{ inputs.target-platform }}\" = \"win\" ]; then\n+        echo \"CACHE_DRIVE=/mnt/win-cache\" >> $GITHUB_ENV\n+      else\n+        echo \"CACHE_DRIVE=/mnt/cross-instance-cache\" >> $GITHUB_ENV\n+      fi\n   - name: Generate SAS Key\n     if: ${{ inputs.generate-sas-token == 'true' }}\n     shell: bash\n     run: |\n-      curl --unix-socket /var/run/sas/sas.sock --fail \"http://foo/$DEPSHASH.tar\" > sas-token\n+      curl --unix-socket /var/run/sas/sas.sock --fail \"http://foo/$CACHE_FILE?platform=${{ inputs.target-platform }}\" > sas-token\n   - name: Save SAS Key\n     if: ${{ inputs.generate-sas-token == 'true' }}\n-    uses: actions/cache/save@1bd1e32a3bdc45362d1e726936510720a7c30a57\n+    uses: actions/cache/save@d4323d4df104b026a6aa633fdb11d772146be0bf\n     with:\n-      path: |\n-        sas-token\n-      key: sas-key-${{ github.run_number }}-${{ github.run_attempt }}\n+      path: sas-token\n+      key: sas-key-${{ inputs.target-platform }}-${{ github.run_number }}-${{ github.run_attempt }}\n+      enableCrossOsArchive: true",
        "comment_created_at": "2025-05-22T17:30:00+00:00",
        "comment_author": "biggerstar",
        "comment_body": "I also encountered this problem at https://github.com/electron/electron/pull/46236\r\nHere, does /var/run/sas refer to any file storage service or cloud storage service within the local Intranet?\r\nI installed docker on both mac and ubuntu22 linux, and found that there is no sas service. I would like to ask how sas came about, thanks \u2764\ufe0f",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1878506887",
    "pr_number": 44136,
    "pr_file": ".github/workflows/pipeline-electron-lint.yml",
    "created_at": "2024-12-10T17:16:58+00:00",
    "commented_code": "with:\n         path: src/electron\n         fetch-depth: 0\n+        ref: ${{ github.event.pull_request.head.sha }}\n+    - name: Get yarn cache directory path",
    "repo_full_name": "electron/electron",
    "discussion_comments": [
      {
        "comment_id": "1878506887",
        "repo_full_name": "electron/electron",
        "pr_number": 44136,
        "pr_file": ".github/workflows/pipeline-electron-lint.yml",
        "discussion_id": "1878506887",
        "commented_code": "@@ -24,10 +24,22 @@ jobs:\n       with:\n         path: src/electron\n         fetch-depth: 0\n+        ref: ${{ github.event.pull_request.head.sha }}\n+    - name: Get yarn cache directory path",
        "comment_created_at": "2024-12-10T17:16:58+00:00",
        "comment_author": "MarshallOfSound",
        "comment_body": "I stand by my comment elsewhere that this is typically slower on unix than Just Installing",
        "pr_file_module": null
      },
      {
        "comment_id": "1878508018",
        "repo_full_name": "electron/electron",
        "pr_number": 44136,
        "pr_file": ".github/workflows/pipeline-electron-lint.yml",
        "discussion_id": "1878506887",
        "commented_code": "@@ -24,10 +24,22 @@ jobs:\n       with:\n         path: src/electron\n         fetch-depth: 0\n+        ref: ${{ github.event.pull_request.head.sha }}\n+    - name: Get yarn cache directory path",
        "comment_created_at": "2024-12-10T17:17:50+00:00",
        "comment_author": "MarshallOfSound",
        "comment_body": "If we're keeping this though we definitely shouldnt be duplicating it everywhere, extract \"install dependencies\" to a common action",
        "pr_file_module": null
      }
    ]
  }
]