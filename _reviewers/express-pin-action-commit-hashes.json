[
  {
    "discussion_id": "1493811506",
    "pr_number": 5492,
    "pr_file": ".github/workflows/integration-tests.yml",
    "created_at": "2024-02-18T17:33:44+00:00",
    "commented_code": "+name: Integration Tests\n+\n+on:\n+    - pull_request\n+    - push\n+\n+jobs:\n+  dispatch:\n+    runs-on: ubuntu-latest\n+    steps:\n+      - name: Get the branch name\n+        id: get_branch\n+        run: echo ::set-output name=branch::$(echo ${GITHUB_HEAD_REF:-${GITHUB_REF#refs/heads/}})\n+\n+      - name: Get the originating repository\n+        id: get_repo\n+        run: |\n+          if [[ \"${{ github.event_name }}\" == \"pull_request\" ]]; then\n+            echo ::set-output name=repo::${{ github.event.pull_request.head.repo.full_name }}\n+          else\n+            echo ::set-output name=repo::${{ github.repository }}\n+          fi\n+\n+      - name: Repository Dispatch\n+        uses: peter-evans/repository-dispatch@v1",
    "repo_full_name": "expressjs/express",
    "discussion_comments": [
      {
        "comment_id": "1493811506",
        "repo_full_name": "expressjs/express",
        "pr_number": 5492,
        "pr_file": ".github/workflows/integration-tests.yml",
        "discussion_id": "1493811506",
        "commented_code": "@@ -0,0 +1,30 @@\n+name: Integration Tests\n+\n+on:\n+    - pull_request\n+    - push\n+\n+jobs:\n+  dispatch:\n+    runs-on: ubuntu-latest\n+    steps:\n+      - name: Get the branch name\n+        id: get_branch\n+        run: echo ::set-output name=branch::$(echo ${GITHUB_HEAD_REF:-${GITHUB_REF#refs/heads/}})\n+\n+      - name: Get the originating repository\n+        id: get_repo\n+        run: |\n+          if [[ \"${{ github.event_name }}\" == \"pull_request\" ]]; then\n+            echo ::set-output name=repo::${{ github.event.pull_request.head.repo.full_name }}\n+          else\n+            echo ::set-output name=repo::${{ github.repository }}\n+          fi\n+\n+      - name: Repository Dispatch\n+        uses: peter-evans/repository-dispatch@v1",
        "comment_created_at": "2024-02-18T17:33:44+00:00",
        "comment_author": "wesleytodd",
        "comment_body": "This is very risky. First any push that `peter-evans` & collaborators does do the `v1` tag will automagically run in our env and secondly we give this action access to the PAT. If we are going to rely on any third-party actions we need to commit hash pin them (which is it's own sort of maintenance pain).",
        "pr_file_module": null
      },
      {
        "comment_id": "1493812288",
        "repo_full_name": "expressjs/express",
        "pr_number": 5492,
        "pr_file": ".github/workflows/integration-tests.yml",
        "discussion_id": "1493811506",
        "commented_code": "@@ -0,0 +1,30 @@\n+name: Integration Tests\n+\n+on:\n+    - pull_request\n+    - push\n+\n+jobs:\n+  dispatch:\n+    runs-on: ubuntu-latest\n+    steps:\n+      - name: Get the branch name\n+        id: get_branch\n+        run: echo ::set-output name=branch::$(echo ${GITHUB_HEAD_REF:-${GITHUB_REF#refs/heads/}})\n+\n+      - name: Get the originating repository\n+        id: get_repo\n+        run: |\n+          if [[ \"${{ github.event_name }}\" == \"pull_request\" ]]; then\n+            echo ::set-output name=repo::${{ github.event.pull_request.head.repo.full_name }}\n+          else\n+            echo ::set-output name=repo::${{ github.repository }}\n+          fi\n+\n+      - name: Repository Dispatch\n+        uses: peter-evans/repository-dispatch@v1",
        "comment_created_at": "2024-02-18T17:39:21+00:00",
        "comment_author": "wesleytodd",
        "comment_body": "Cool, so now that it is pinned, do we have a plan for how we want to update it? I went and read the source, it is pretty straight forward so that is good, but do we need to add dependabot or something similar to update these hashes?",
        "pr_file_module": null
      },
      {
        "comment_id": "1493812570",
        "repo_full_name": "expressjs/express",
        "pr_number": 5492,
        "pr_file": ".github/workflows/integration-tests.yml",
        "discussion_id": "1493811506",
        "commented_code": "@@ -0,0 +1,30 @@\n+name: Integration Tests\n+\n+on:\n+    - pull_request\n+    - push\n+\n+jobs:\n+  dispatch:\n+    runs-on: ubuntu-latest\n+    steps:\n+      - name: Get the branch name\n+        id: get_branch\n+        run: echo ::set-output name=branch::$(echo ${GITHUB_HEAD_REF:-${GITHUB_REF#refs/heads/}})\n+\n+      - name: Get the originating repository\n+        id: get_repo\n+        run: |\n+          if [[ \"${{ github.event_name }}\" == \"pull_request\" ]]; then\n+            echo ::set-output name=repo::${{ github.event.pull_request.head.repo.full_name }}\n+          else\n+            echo ::set-output name=repo::${{ github.repository }}\n+          fi\n+\n+      - name: Repository Dispatch\n+        uses: peter-evans/repository-dispatch@v1",
        "comment_created_at": "2024-02-18T17:40:41+00:00",
        "comment_author": "UlisesGascon",
        "comment_body": "Great point! I added the pin in b6d2038 (also upgraded to 3.0.0). I used a fine token with only access to `ulisesgascon/express-examples` (`expressjs/examples` in the near future) with content write and read level permissions.\r\n\r\nManaging upgrades will be easier than expected as #5435 will generate PRs that supports the pinned version format.",
        "pr_file_module": null
      },
      {
        "comment_id": "1493812607",
        "repo_full_name": "expressjs/express",
        "pr_number": 5492,
        "pr_file": ".github/workflows/integration-tests.yml",
        "discussion_id": "1493811506",
        "commented_code": "@@ -0,0 +1,30 @@\n+name: Integration Tests\n+\n+on:\n+    - pull_request\n+    - push\n+\n+jobs:\n+  dispatch:\n+    runs-on: ubuntu-latest\n+    steps:\n+      - name: Get the branch name\n+        id: get_branch\n+        run: echo ::set-output name=branch::$(echo ${GITHUB_HEAD_REF:-${GITHUB_REF#refs/heads/}})\n+\n+      - name: Get the originating repository\n+        id: get_repo\n+        run: |\n+          if [[ \"${{ github.event_name }}\" == \"pull_request\" ]]; then\n+            echo ::set-output name=repo::${{ github.event.pull_request.head.repo.full_name }}\n+          else\n+            echo ::set-output name=repo::${{ github.repository }}\n+          fi\n+\n+      - name: Repository Dispatch\n+        uses: peter-evans/repository-dispatch@v1",
        "comment_created_at": "2024-02-18T17:40:55+00:00",
        "comment_author": "wesleytodd",
        "comment_body": "hmmm, this seems suspicious though, won't this log the token? https://github.com/peter-evans/repository-dispatch/blob/main/src/main.ts#L23",
        "pr_file_module": null
      },
      {
        "comment_id": "1496318049",
        "repo_full_name": "expressjs/express",
        "pr_number": 5492,
        "pr_file": ".github/workflows/integration-tests.yml",
        "discussion_id": "1493811506",
        "commented_code": "@@ -0,0 +1,30 @@\n+name: Integration Tests\n+\n+on:\n+    - pull_request\n+    - push\n+\n+jobs:\n+  dispatch:\n+    runs-on: ubuntu-latest\n+    steps:\n+      - name: Get the branch name\n+        id: get_branch\n+        run: echo ::set-output name=branch::$(echo ${GITHUB_HEAD_REF:-${GITHUB_REF#refs/heads/}})\n+\n+      - name: Get the originating repository\n+        id: get_repo\n+        run: |\n+          if [[ \"${{ github.event_name }}\" == \"pull_request\" ]]; then\n+            echo ::set-output name=repo::${{ github.event.pull_request.head.repo.full_name }}\n+          else\n+            echo ::set-output name=repo::${{ github.repository }}\n+          fi\n+\n+      - name: Repository Dispatch\n+        uses: peter-evans/repository-dispatch@v1",
        "comment_created_at": "2024-02-20T18:32:28+00:00",
        "comment_author": "dwelch2344",
        "comment_body": "@wesleytodd yes, though it'd be redacted via GHA (most likely). However, that's a non-starter IMO. \r\n\r\nI believe my team recently implemented this without using this dispatch method, complete with \"waiting\" and access to the results. Let me sync with them and see if there's a solution to be distilled there (or if it was trivially easy) ",
        "pr_file_module": null
      },
      {
        "comment_id": "1496357175",
        "repo_full_name": "expressjs/express",
        "pr_number": 5492,
        "pr_file": ".github/workflows/integration-tests.yml",
        "discussion_id": "1493811506",
        "commented_code": "@@ -0,0 +1,30 @@\n+name: Integration Tests\n+\n+on:\n+    - pull_request\n+    - push\n+\n+jobs:\n+  dispatch:\n+    runs-on: ubuntu-latest\n+    steps:\n+      - name: Get the branch name\n+        id: get_branch\n+        run: echo ::set-output name=branch::$(echo ${GITHUB_HEAD_REF:-${GITHUB_REF#refs/heads/}})\n+\n+      - name: Get the originating repository\n+        id: get_repo\n+        run: |\n+          if [[ \"${{ github.event_name }}\" == \"pull_request\" ]]; then\n+            echo ::set-output name=repo::${{ github.event.pull_request.head.repo.full_name }}\n+          else\n+            echo ::set-output name=repo::${{ github.repository }}\n+          fi\n+\n+      - name: Repository Dispatch\n+        uses: peter-evans/repository-dispatch@v1",
        "comment_created_at": "2024-02-20T19:09:00+00:00",
        "comment_author": "UlisesGascon",
        "comment_body": "@dwelch2344 is right and I will love to know more about the sync ðŸ‘ .\r\n\r\n@wesleytodd, I assume that you can't access to the logs in https://github.com/UlisesGascon/express/actions/runs/7950651381/job/21703181190 (last run), but in this screenshot we can see the token redacted.\r\n![Screenshot 2024-02-20 at 19 59 31](https://github.com/expressjs/express/assets/5110813/7b8f4cf1-603d-4c7f-b3e6-61aee3cff27b)\r\n\r\n> Warning: If a secret was used in the job, GitHub automatically redacts secrets printed to the log. You should avoid printing secrets to the log intentionally. [Documentation](https://docs.github.com/en/actions/security-guides/using-secrets-in-github-actions)\r\n\r\n",
        "pr_file_module": null
      },
      {
        "comment_id": "1496406676",
        "repo_full_name": "expressjs/express",
        "pr_number": 5492,
        "pr_file": ".github/workflows/integration-tests.yml",
        "discussion_id": "1493811506",
        "commented_code": "@@ -0,0 +1,30 @@\n+name: Integration Tests\n+\n+on:\n+    - pull_request\n+    - push\n+\n+jobs:\n+  dispatch:\n+    runs-on: ubuntu-latest\n+    steps:\n+      - name: Get the branch name\n+        id: get_branch\n+        run: echo ::set-output name=branch::$(echo ${GITHUB_HEAD_REF:-${GITHUB_REF#refs/heads/}})\n+\n+      - name: Get the originating repository\n+        id: get_repo\n+        run: |\n+          if [[ \"${{ github.event_name }}\" == \"pull_request\" ]]; then\n+            echo ::set-output name=repo::${{ github.event.pull_request.head.repo.full_name }}\n+          else\n+            echo ::set-output name=repo::${{ github.repository }}\n+          fi\n+\n+      - name: Repository Dispatch\n+        uses: peter-evans/repository-dispatch@v1",
        "comment_created_at": "2024-02-20T19:55:00+00:00",
        "comment_author": "wesleytodd",
        "comment_body": "Ok cool, I think it is also reasonable to PR to them to just remove it explicitly from the debug log. I didn't go look at the runs I was just poking around the code as I would do with any added dependency and that line stood out to me. It is good that GHA redacts that, so that resolves that concern for me.\r\n\r\nFor the dependabot thing, I raised my concern there and we can have that conversation independent of this landing. Consider my concerned addressed but would also be interested in the details from @dwelch2344 so we can leave this thread open for now.",
        "pr_file_module": null
      },
      {
        "comment_id": "1570973074",
        "repo_full_name": "expressjs/express",
        "pr_number": 5492,
        "pr_file": ".github/workflows/integration-tests.yml",
        "discussion_id": "1493811506",
        "commented_code": "@@ -0,0 +1,30 @@\n+name: Integration Tests\n+\n+on:\n+    - pull_request\n+    - push\n+\n+jobs:\n+  dispatch:\n+    runs-on: ubuntu-latest\n+    steps:\n+      - name: Get the branch name\n+        id: get_branch\n+        run: echo ::set-output name=branch::$(echo ${GITHUB_HEAD_REF:-${GITHUB_REF#refs/heads/}})\n+\n+      - name: Get the originating repository\n+        id: get_repo\n+        run: |\n+          if [[ \"${{ github.event_name }}\" == \"pull_request\" ]]; then\n+            echo ::set-output name=repo::${{ github.event.pull_request.head.repo.full_name }}\n+          else\n+            echo ::set-output name=repo::${{ github.repository }}\n+          fi\n+\n+      - name: Repository Dispatch\n+        uses: peter-evans/repository-dispatch@v1",
        "comment_created_at": "2024-04-18T15:26:21+00:00",
        "comment_author": "UlisesGascon",
        "comment_body": "I removed the external dependency and used curl to manage the lifecycle (https://github.com/expressjs/express/pull/5492/commits/41cecb0c57c8b4372d99d775fbae3082729cd229). I will add screenshots in a moment",
        "pr_file_module": null
      }
    ]
  }
]