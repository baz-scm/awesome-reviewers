[
  {
    "discussion_id": "2291034202",
    "pr_number": 1992,
    "pr_file": "apps/api/src/scraper/scrapeURL/lib/extractDataAttributes.ts",
    "created_at": "2025-08-21T13:16:02+00:00",
    "commented_code": "+import { load } from \"cheerio\";",
    "repo_full_name": "firecrawl/firecrawl",
    "discussion_comments": [
      {
        "comment_id": "2291034202",
        "repo_full_name": "firecrawl/firecrawl",
        "pr_number": 1992,
        "pr_file": "apps/api/src/scraper/scrapeURL/lib/extractDataAttributes.ts",
        "discussion_id": "2291034202",
        "commented_code": "@@ -0,0 +1,72 @@\n+import { load } from \"cheerio\";",
        "comment_created_at": "2025-08-21T13:16:02+00:00",
        "comment_author": "mogery",
        "comment_body": "Logic should be moved to `html-transformer` Rust shared library if you're up for it, since cheerio can freeze the event loop.",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1905173062",
    "pr_number": 1045,
    "pr_file": "apps/api/src/services/notification/email_notification.ts",
    "created_at": "2025-01-07T09:39:13+00:00",
    "commented_code": "},\n   );\n }\n+\n+\n+export async function sendNotificationWithCustomDays(\n+  team_id: string,\n+  notificationType: NotificationType,\n+  daysBetweenEmails: number,\n+  bypassRecentChecks: boolean = false,\n+) {\n+  return withAuth(async (\n+    team_id: string,\n+    notificationType: NotificationType,\n+    daysBetweenEmails: number,\n+    bypassRecentChecks: boolean,\n+  ) => {\n+    const now = new Date();\n+    const pastDate = new Date(now.getTime() - daysBetweenEmails * 24 * 60 * 60 * 1000);\n+\n+    const { data: recentNotifications, error: recentNotificationsError } = await supabase_service\n+      .from(\"user_notifications\")\n+      .select(\"*\")\n+      .eq(\"team_id\", team_id)\n+      .eq(\"notification_type\", notificationType)\n+      .gte(\"sent_date\", pastDate.toISOString());",
    "repo_full_name": "firecrawl/firecrawl",
    "discussion_comments": [
      {
        "comment_id": "1905173062",
        "repo_full_name": "firecrawl/firecrawl",
        "pr_number": 1045,
        "pr_file": "apps/api/src/services/notification/email_notification.ts",
        "discussion_id": "1905173062",
        "commented_code": "@@ -183,3 +191,89 @@ export async function sendNotificationInternal(\n     },\n   );\n }\n+\n+\n+export async function sendNotificationWithCustomDays(\n+  team_id: string,\n+  notificationType: NotificationType,\n+  daysBetweenEmails: number,\n+  bypassRecentChecks: boolean = false,\n+) {\n+  return withAuth(async (\n+    team_id: string,\n+    notificationType: NotificationType,\n+    daysBetweenEmails: number,\n+    bypassRecentChecks: boolean,\n+  ) => {\n+    const now = new Date();\n+    const pastDate = new Date(now.getTime() - daysBetweenEmails * 24 * 60 * 60 * 1000);\n+\n+    const { data: recentNotifications, error: recentNotificationsError } = await supabase_service\n+      .from(\"user_notifications\")\n+      .select(\"*\")\n+      .eq(\"team_id\", team_id)\n+      .eq(\"notification_type\", notificationType)\n+      .gte(\"sent_date\", pastDate.toISOString());",
        "comment_created_at": "2025-01-07T09:39:13+00:00",
        "comment_author": "mogery",
        "comment_body": "Nonononononono. Absolutely not. We are not doing a DB query on every single CC job insert over 2x. This must be moved to Redis.",
        "pr_file_module": null
      },
      {
        "comment_id": "1905571813",
        "repo_full_name": "firecrawl/firecrawl",
        "pr_number": 1045,
        "pr_file": "apps/api/src/services/notification/email_notification.ts",
        "discussion_id": "1905173062",
        "commented_code": "@@ -183,3 +191,89 @@ export async function sendNotificationInternal(\n     },\n   );\n }\n+\n+\n+export async function sendNotificationWithCustomDays(\n+  team_id: string,\n+  notificationType: NotificationType,\n+  daysBetweenEmails: number,\n+  bypassRecentChecks: boolean = false,\n+) {\n+  return withAuth(async (\n+    team_id: string,\n+    notificationType: NotificationType,\n+    daysBetweenEmails: number,\n+    bypassRecentChecks: boolean,\n+  ) => {\n+    const now = new Date();\n+    const pastDate = new Date(now.getTime() - daysBetweenEmails * 24 * 60 * 60 * 1000);\n+\n+    const { data: recentNotifications, error: recentNotificationsError } = await supabase_service\n+      .from(\"user_notifications\")\n+      .select(\"*\")\n+      .eq(\"team_id\", team_id)\n+      .eq(\"notification_type\", notificationType)\n+      .gte(\"sent_date\", pastDate.toISOString());",
        "comment_created_at": "2025-01-07T14:52:22+00:00",
        "comment_author": "nickscamara",
        "comment_body": "you're right.. didn't realize how often that hits",
        "pr_file_module": null
      }
    ]
  }
]