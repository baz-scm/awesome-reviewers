---
title: Use modern PHPUnit attributes
description: 'Prefer modern PHPUnit attributes over PHPDoc annotations for improved
  type safety, IDE support, and code readability in tests. Replace legacy annotation-style
  test decorators with their attribute counterparts:'
repository: laravel/framework
label: Testing
language: PHP
comments_count: 7
repository_stars: 33763
---

Prefer modern PHPUnit attributes over PHPDoc annotations for improved type safety, IDE support, and code readability in tests. Replace legacy annotation-style test decorators with their attribute counterparts:

- Use `#[DataProvider]` for test data organization:
```php
#[DataProvider('provideStrSanitizeTestStrings')]
public function testSanitize(?string $subject, ?string $expected, ?HtmlSanitizerConfig $config)
{
    $this->assertSame($expected, Str::sanitize($subject, $config));
}

public static function provideStrSanitizeTestStrings()
{
    return [
        'non-empty string is returned as is' => ['Hello', 'Hello', null],
        'XSS attack is sanitized' => ['<script>alert("XSS")</script>', '', null],
        // more test cases...
    ];
}
```

- Use `#[RequiresPhp('8.4.0')]` or similar attributes instead of manual version checks:
```php
// Instead of:
if (PHP_VERSION_ID < 80400) {
    $this->markTestSkipped('Property Hooks are not available to test in PHP...');
}

// Use:
#[RequiresPhp('8.4.0')]
class DatabaseEloquentWithPropertyHooksTest extends TestCase
{
    // Test methods...
}
```

- For simpler test data cases, consider `#[TestWith]`:
```php
#[TestWith(['Hello', 'Hello', null])]
#[TestWith([123, '123', null])]
#[TestWith([null, null, null])]
public function testSanitize(?string $subject, ?string $expected, ?HtmlSanitizerConfig $config)
{
    $this->assertSame($expected, Str::sanitize($subject, $config));
}
```

This approach improves code maintainability, provides better type hinting to IDEs, and follows modern PHP testing practices.


[
  {
    "discussion_id": "2174034287",
    "pr_number": 56169,
    "pr_file": "tests/Database/DatabaseEloquentBuilderFindOrFailWithEnumTest.php",
    "created_at": "2025-06-30T00:51:48+00:00",
    "commented_code": "<?php\n\nnamespace Illuminate\\Tests\\Database;\n\nuse Illuminate\\Database\\Eloquent\\Model;\nuse Illuminate\\Database\\Eloquent\\ModelNotFoundException;\nuse Illuminate\\Database\\Schema\\Blueprint;\nuse Illuminate\\Support\\Facades\\Schema;\nuse Orchestra\\Testbench\\TestCase;\nuse PHPUnit\\Framework\\Attributes\\Test;\n\nclass DatabaseEloquentBuilderFindOrFailWithEnumTest extends TestCase\n{\n    protected function setUp(): void\n    {\n        parent::setUp();\n\n        $this->createSchema();\n    }\n\n    protected function tearDown(): void\n    {\n        Schema::drop('test_models');\n\n        parent::tearDown();\n    }\n\n    protected function getEnvironmentSetUp($app)\n    {\n        $app['config']->set('database.default', 'testing');\n    }\n\n    #[Test]\n    public function it_finds_existing_model_when_using_enum_id()",
    "repo_full_name": "laravel/framework",
    "discussion_comments": [
      {
        "comment_id": "2174034287",
        "repo_full_name": "laravel/framework",
        "pr_number": 56169,
        "pr_file": "tests/Database/DatabaseEloquentBuilderFindOrFailWithEnumTest.php",
        "discussion_id": "2174034287",
        "commented_code": "@@ -0,0 +1,74 @@\n+<?php\n+\n+namespace Illuminate\\Tests\\Database;\n+\n+use Illuminate\\Database\\Eloquent\\Model;\n+use Illuminate\\Database\\Eloquent\\ModelNotFoundException;\n+use Illuminate\\Database\\Schema\\Blueprint;\n+use Illuminate\\Support\\Facades\\Schema;\n+use Orchestra\\Testbench\\TestCase;\n+use PHPUnit\\Framework\\Attributes\\Test;\n+\n+class DatabaseEloquentBuilderFindOrFailWithEnumTest extends TestCase\n+{\n+    protected function setUp(): void\n+    {\n+        parent::setUp();\n+\n+        $this->createSchema();\n+    }\n+\n+    protected function tearDown(): void\n+    {\n+        Schema::drop('test_models');\n+\n+        parent::tearDown();\n+    }\n+\n+    protected function getEnvironmentSetUp($app)\n+    {\n+        $app['config']->set('database.default', 'testing');\n+    }\n+\n+    #[Test]\n+    public function it_finds_existing_model_when_using_enum_id()",
        "comment_created_at": "2025-06-30T00:51:48+00:00",
        "comment_author": "crynobone",
        "comment_body": "We don't use `Test` attribute in the framework, prefix the method name with `test` and use studly case.",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2044226331",
    "pr_number": 55412,
    "pr_file": "tests/Database/DatabaseEloquentWithPropertyHooksTest.php",
    "created_at": "2025-04-15T10:38:23+00:00",
    "commented_code": "<?php\n\nnamespace Illuminate\\Tests\\Database;\n\nuse Illuminate\\Database\\Capsule\\Manager as DB;\nuse Illuminate\\Database\\Eloquent\\Model;\nuse Illuminate\\Tests\\Database\\Fixtures\\Models\\EloquentModelWithAllPropertyHooks;\nuse Illuminate\\Tests\\Database\\Fixtures\\Models\\EloquentModelWithAppendedPropertyHooks;\nuse Illuminate\\Tests\\Database\\Fixtures\\Models\\EloquentModelWithGetterPropertyHook;\nuse Illuminate\\Tests\\Database\\Fixtures\\Models\\EloquentModelWithPrecedentPropertyHook;\nuse Illuminate\\Tests\\Database\\Fixtures\\Models\\EloquentModelWithPropertyHooks;\nuse Illuminate\\Tests\\Database\\Fixtures\\Models\\EloquentModelWithSetterPropertyHook;\nuse PHPUnit\\Framework\\TestCase;\n\nclass DatabaseEloquentWithPropertyHooksTest extends TestCase\n{\n    protected function setUp(): void\n    {\n        parent::setUp();\n\n        if (PHP_VERSION_ID < 80400) {\n            $this->markTestSkipped(\n                'Property Hooks are not available to test in PHP '.PHP_MAJOR_VERSION.'.'.PHP_MINOR_VERSION,\n            );\n        }",
    "repo_full_name": "laravel/framework",
    "discussion_comments": [
      {
        "comment_id": "2044226331",
        "repo_full_name": "laravel/framework",
        "pr_number": 55412,
        "pr_file": "tests/Database/DatabaseEloquentWithPropertyHooksTest.php",
        "discussion_id": "2044226331",
        "commented_code": "@@ -0,0 +1,178 @@\n+<?php\n+\n+namespace Illuminate\\Tests\\Database;\n+\n+use Illuminate\\Database\\Capsule\\Manager as DB;\n+use Illuminate\\Database\\Eloquent\\Model;\n+use Illuminate\\Tests\\Database\\Fixtures\\Models\\EloquentModelWithAllPropertyHooks;\n+use Illuminate\\Tests\\Database\\Fixtures\\Models\\EloquentModelWithAppendedPropertyHooks;\n+use Illuminate\\Tests\\Database\\Fixtures\\Models\\EloquentModelWithGetterPropertyHook;\n+use Illuminate\\Tests\\Database\\Fixtures\\Models\\EloquentModelWithPrecedentPropertyHook;\n+use Illuminate\\Tests\\Database\\Fixtures\\Models\\EloquentModelWithPropertyHooks;\n+use Illuminate\\Tests\\Database\\Fixtures\\Models\\EloquentModelWithSetterPropertyHook;\n+use PHPUnit\\Framework\\TestCase;\n+\n+class DatabaseEloquentWithPropertyHooksTest extends TestCase\n+{\n+    protected function setUp(): void\n+    {\n+        parent::setUp();\n+\n+        if (PHP_VERSION_ID < 80400) {\n+            $this->markTestSkipped(\n+                'Property Hooks are not available to test in PHP '.PHP_MAJOR_VERSION.'.'.PHP_MINOR_VERSION,\n+            );\n+        }",
        "comment_created_at": "2025-04-15T10:38:23+00:00",
        "comment_author": "shaedrich",
        "comment_body": "You could alternatively use [PHPUnit's attribute annotations](https://docs.phpunit.de/en/10.5/attributes.html#requiresphp) to achieve this if you like:\r\n```suggestion\r\n#[RequiresPhp('8.4.0')]\r\nclass DatabaseEloquentWithPropertyHooksTest extends TestCase\r\n{\r\n    protected function setUp(): void\r\n    {\r\n        parent::setUp();\r\n```",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2013914054",
    "pr_number": 55173,
    "pr_file": "tests/Database/DatabaseEloquentModelTest.php",
    "created_at": "2025-03-26T11:11:12+00:00",
    "commented_code": "$this->assertTrue($model->hasCast('enumAttribute', StringStatus::class));\n    }\n\n    public function testHasCastsOnBcmathNumber()\n    {\n        if (! $this->isBcMathNumberSupported()) {\n            $this->markTestSkipped('Requires BcMath\\Number class.');\n        }",
    "repo_full_name": "laravel/framework",
    "discussion_comments": [
      {
        "comment_id": "2013914054",
        "repo_full_name": "laravel/framework",
        "pr_number": 55173,
        "pr_file": "tests/Database/DatabaseEloquentModelTest.php",
        "discussion_id": "2013914054",
        "commented_code": "@@ -533,6 +534,35 @@ public function testHasCastsOnEnumAttribute()\n         $this->assertTrue($model->hasCast('enumAttribute', StringStatus::class));\n     }\n \n+    public function testHasCastsOnBcmathNumber()\n+    {\n+        if (! $this->isBcMathNumberSupported()) {\n+            $this->markTestSkipped('Requires BcMath\\Number class.');\n+        }",
        "comment_created_at": "2025-03-26T11:11:12+00:00",
        "comment_author": "shaedrich",
        "comment_body": "Alternatively, you could use with attributes:\r\n```suggestion\r\n    #[RequiresPhp('^8.4')]\r\n    public function testHasCastsOnBcmathNumber()\r\n    {\r\n```\r\nor\r\n```suggestion\r\n    #[RequiresPhpExtension('bcmath')]\r\n    public function testHasCastsOnBcmathNumber()\r\n    {\r\n```\r\nor\r\n```suggestion\r\n    #[RequiresMethod(Number::class, '__construct')]\r\n    public function testHasCastsOnBcmathNumber()\r\n    {\r\n```",
        "pr_file_module": null
      },
      {
        "comment_id": "2013957686",
        "repo_full_name": "laravel/framework",
        "pr_number": 55173,
        "pr_file": "tests/Database/DatabaseEloquentModelTest.php",
        "discussion_id": "2013914054",
        "commented_code": "@@ -533,6 +534,35 @@ public function testHasCastsOnEnumAttribute()\n         $this->assertTrue($model->hasCast('enumAttribute', StringStatus::class));\n     }\n \n+    public function testHasCastsOnBcmathNumber()\n+    {\n+        if (! $this->isBcMathNumberSupported()) {\n+            $this->markTestSkipped('Requires BcMath\\Number class.');\n+        }",
        "comment_created_at": "2025-03-26T11:41:46+00:00",
        "comment_author": "KentarouTakeda",
        "comment_body": "Thank you for letting me know something I didn't know. That's a good way to write it!\r\n\r\nI considered the possibility of testing using polyfills, so I decided to check with `RequiresMethod`.",
        "pr_file_module": null
      },
      {
        "comment_id": "2014338557",
        "repo_full_name": "laravel/framework",
        "pr_number": 55173,
        "pr_file": "tests/Database/DatabaseEloquentModelTest.php",
        "discussion_id": "2013914054",
        "commented_code": "@@ -533,6 +534,35 @@ public function testHasCastsOnEnumAttribute()\n         $this->assertTrue($model->hasCast('enumAttribute', StringStatus::class));\n     }\n \n+    public function testHasCastsOnBcmathNumber()\n+    {\n+        if (! $this->isBcMathNumberSupported()) {\n+            $this->markTestSkipped('Requires BcMath\\Number class.');\n+        }",
        "comment_created_at": "2025-03-26T14:41:53+00:00",
        "comment_author": "shaedrich",
        "comment_body": "You're welcome\u2014always happy to introduce someone to something new \ud83d\udc4d\ud83c\udffb ",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1923828069",
    "pr_number": 54285,
    "pr_file": "tests/Support/SupportStrTest.php",
    "created_at": "2025-01-21T14:26:55+00:00",
    "commented_code": "$this->assertSame($expected, Str::chopEnd($subject, $needle));\n        }\n    }\n\n    public function testSanitize()\n    {\n        foreach ([\n            ['Hello', 'Hello', null],\n            [123, '123', null],\n            [null, null, null],\n            ['', '', null],\n            ['Hello<script>alert(\"XSS\")</script>', 'Hello', null],\n            ['<script>alert(\"XSS\")</script>', '', null],\n            ['<span data-attr=\"foo\"></span>', '<span></span>', null],\n            ['<img src=\"https://laravel.com/does-not-exist.jpg\" onerror=\"alert(1)\" />', '<img src=\"https://laravel.com/does-not-exist.jpg\" />', null],\n            ['<a href=\"javascript:alert(1)\">Click me</a>', '<a>Click me</a>', null],\n            ['<img src=\"/does-not-exist.jpg\" />', '<img src=\"/does-not-exist.jpg\" />', (new HtmlSanitizerConfig)->allowElement('img', 'src')->allowRelativeMedias()],\n            ['<img src=\"http://laravel.com/safe.jpg\" />', '<img src=\"https://laravel.com/safe.jpg\" />', (new HtmlSanitizerConfig)->allowElement('img', 'src')->forceHttpsUrls()],\n            ['<span data-attr=\"foo\"></span>', '<span data-attr=\"foo\"></span>', (new HtmlSanitizerConfig)->allowElement('span')->allowAttribute('data-attr', '*')],\n        ] as $value) {\n            [$subject, $expected, $config] = $value;\n\n            $this->assertSame($expected, Str::sanitize($subject, $config));\n        }\n    }",
    "repo_full_name": "laravel/framework",
    "discussion_comments": [
      {
        "comment_id": "1923828069",
        "repo_full_name": "laravel/framework",
        "pr_number": 54285,
        "pr_file": "tests/Support/SupportStrTest.php",
        "discussion_id": "1923828069",
        "commented_code": "@@ -1635,6 +1636,28 @@ public function testChopEnd()\n             $this->assertSame($expected, Str::chopEnd($subject, $needle));\n         }\n     }\n+\n+    public function testSanitize()\n+    {\n+        foreach ([\n+            ['Hello', 'Hello', null],\n+            [123, '123', null],\n+            [null, null, null],\n+            ['', '', null],\n+            ['Hello<script>alert(\"XSS\")</script>', 'Hello', null],\n+            ['<script>alert(\"XSS\")</script>', '', null],\n+            ['<span data-attr=\"foo\"></span>', '<span></span>', null],\n+            ['<img src=\"https://laravel.com/does-not-exist.jpg\" onerror=\"alert(1)\" />', '<img src=\"https://laravel.com/does-not-exist.jpg\" />', null],\n+            ['<a href=\"javascript:alert(1)\">Click me</a>', '<a>Click me</a>', null],\n+            ['<img src=\"/does-not-exist.jpg\" />', '<img src=\"/does-not-exist.jpg\" />', (new HtmlSanitizerConfig)->allowElement('img', 'src')->allowRelativeMedias()],\n+            ['<img src=\"http://laravel.com/safe.jpg\" />', '<img src=\"https://laravel.com/safe.jpg\" />', (new HtmlSanitizerConfig)->allowElement('img', 'src')->forceHttpsUrls()],\n+            ['<span data-attr=\"foo\"></span>', '<span data-attr=\"foo\"></span>', (new HtmlSanitizerConfig)->allowElement('span')->allowAttribute('data-attr', '*')],\n+        ] as $value) {\n+            [$subject, $expected, $config] = $value;\n+\n+            $this->assertSame($expected, Str::sanitize($subject, $config));\n+        }\n+    }",
        "comment_created_at": "2025-01-21T14:26:55+00:00",
        "comment_author": "shaedrich",
        "comment_body": "You can use the [`#[DataProvider]` attribute](https://docs.phpunit.de/en/11.5/attributes.html#data-provider) here\r\n```suggestion\r\n    #[DataProvider('provideStrSanatizeTestStrings')\r\n    public function testSanitize(?string $subject, ?string $expected, ?HtmlSanitizerConfig $config)\r\n    {\r\n        $this->assertSame($expected, Str::sanitize($subject, $config));\r\n    }\r\n    \r\n    public static function provideStrSanatizeTestStrings()\r\n    {\r\n        return [\r\n            'non-empty string is returned as is' => ['Hello', 'Hello', null],\r\n            'stringified number' => [123, '123', null],\r\n            'null is returned as is' => [null, null, null],\r\n            'empty string is returned as is' => ['', '', null],\r\n            'XSS attack in string is sanitized' => ['Hello<script>alert(\"XSS\")</script>', 'Hello', null],\r\n            'XSS attack is sanitized to empty string' => ['<script>alert(\"XSS\")</script>', '', null],\r\n            'data attribute in HTML element is sanitized' => ['<span data-attr=\"foo\"></span>', '<span></span>', null],\r\n            'event handler in HTML element is sanitized' => ['<img src=\"https://laravel.com/does-not-exist.jpg\" onerror=\"alert(1)\" />', '<img src=\"https://laravel.com/does-not-exist.jpg\" />', null],\r\n            'inline JavaScript in HTML hyperlink element is sanitized' => ['<a href=\"javascript:alert(1)\">Click me</a>', '<a>Click me</a>', null],\r\n            'HTML image element is returned as is' => ['<img src=\"/does-not-exist.jpg\" />', '<img src=\"/does-not-exist.jpg\" />', (new HtmlSanitizerConfig)->allowElement('img', 'src')->allowRelativeMedias()],\r\n            'HTML image element src URL is rewritten to use TLS' => ['<img src=\"http://laravel.com/safe.jpg\" />', '<img src=\"https://laravel.com/safe.jpg\" />', (new HtmlSanitizerConfig)->allowElement('img', 'src')->forceHttpsUrls()],\r\n            'data attribute in HTML element is not sanitized' => ['<span data-attr=\"foo\"></span>', '<span data-attr=\"foo\"></span>', (new HtmlSanitizerConfig)->allowElement('span')->allowAttribute('data-attr', '*')],\r\n        ];\r\n    }\r\n```",
        "pr_file_module": null
      },
      {
        "comment_id": "1923834352",
        "repo_full_name": "laravel/framework",
        "pr_number": 54285,
        "pr_file": "tests/Support/SupportStrTest.php",
        "discussion_id": "1923828069",
        "commented_code": "@@ -1635,6 +1636,28 @@ public function testChopEnd()\n             $this->assertSame($expected, Str::chopEnd($subject, $needle));\n         }\n     }\n+\n+    public function testSanitize()\n+    {\n+        foreach ([\n+            ['Hello', 'Hello', null],\n+            [123, '123', null],\n+            [null, null, null],\n+            ['', '', null],\n+            ['Hello<script>alert(\"XSS\")</script>', 'Hello', null],\n+            ['<script>alert(\"XSS\")</script>', '', null],\n+            ['<span data-attr=\"foo\"></span>', '<span></span>', null],\n+            ['<img src=\"https://laravel.com/does-not-exist.jpg\" onerror=\"alert(1)\" />', '<img src=\"https://laravel.com/does-not-exist.jpg\" />', null],\n+            ['<a href=\"javascript:alert(1)\">Click me</a>', '<a>Click me</a>', null],\n+            ['<img src=\"/does-not-exist.jpg\" />', '<img src=\"/does-not-exist.jpg\" />', (new HtmlSanitizerConfig)->allowElement('img', 'src')->allowRelativeMedias()],\n+            ['<img src=\"http://laravel.com/safe.jpg\" />', '<img src=\"https://laravel.com/safe.jpg\" />', (new HtmlSanitizerConfig)->allowElement('img', 'src')->forceHttpsUrls()],\n+            ['<span data-attr=\"foo\"></span>', '<span data-attr=\"foo\"></span>', (new HtmlSanitizerConfig)->allowElement('span')->allowAttribute('data-attr', '*')],\n+        ] as $value) {\n+            [$subject, $expected, $config] = $value;\n+\n+            $this->assertSame($expected, Str::sanitize($subject, $config));\n+        }\n+    }",
        "comment_created_at": "2025-01-21T14:30:35+00:00",
        "comment_author": "shaedrich",
        "comment_body": "Alternatively, you can use the [`[#TestWith]` attribute](https://docs.phpunit.de/en/11.5/attributes.html#testwith):\r\n```suggestion\r\n    #[TestWith(['Hello', 'Hello', null])\r\n    #[TestWith([123, '123', null])\r\n    #[TestWith([null, null, null])\r\n    #[TestWith(['', '', null])\r\n    #[TestWith(['Hello<script>alert(\"XSS\")</script>', 'Hello', null])\r\n    #[TestWith(['<script>alert(\"XSS\")</script>', '', null])\r\n    #[TestWith(['<span data-attr=\"foo\"></span>', '<span></span>', null])\r\n    #[TestWith(['<img src=\"https://laravel.com/does-not-exist.jpg\" onerror=\"alert(1)\" />', '<img src=\"https://laravel.com/does-not-exist.jpg\" />', null])\r\n    #[TestWith(['<a href=\"javascript:alert(1)\">Click me</a>', '<a>Click me</a>', null])\r\n    #[TestWith(['<img src=\"/does-not-exist.jpg\" />', '<img src=\"/does-not-exist.jpg\" />', (new HtmlSanitizerConfig)->allowElement('img', 'src')->allowRelativeMedias()])\r\n    #[TestWith(['<img src=\"http://laravel.com/safe.jpg\" />', '<img src=\"https://laravel.com/safe.jpg\" />', (new HtmlSanitizerConfig)->allowElement('img', 'src')->forceHttpsUrls()])\r\n    #[TestWith(['<span data-attr=\"foo\"></span>', '<span data-attr=\"foo\"></span>', (new HtmlSanitizerConfig)->allowElement('span')->allowAttribute('data-attr', '*')])\r\n    public function testSanitize(?string $subject, ?string $expected, ?HtmlSanitizerConfig $config)\r\n    {\r\n        this->assertSame($expected, Str::sanitize($subject, $config));\r\n    }\r\n```",
        "pr_file_module": null
      },
      {
        "comment_id": "1923872921",
        "repo_full_name": "laravel/framework",
        "pr_number": 54285,
        "pr_file": "tests/Support/SupportStrTest.php",
        "discussion_id": "1923828069",
        "commented_code": "@@ -1635,6 +1636,28 @@ public function testChopEnd()\n             $this->assertSame($expected, Str::chopEnd($subject, $needle));\n         }\n     }\n+\n+    public function testSanitize()\n+    {\n+        foreach ([\n+            ['Hello', 'Hello', null],\n+            [123, '123', null],\n+            [null, null, null],\n+            ['', '', null],\n+            ['Hello<script>alert(\"XSS\")</script>', 'Hello', null],\n+            ['<script>alert(\"XSS\")</script>', '', null],\n+            ['<span data-attr=\"foo\"></span>', '<span></span>', null],\n+            ['<img src=\"https://laravel.com/does-not-exist.jpg\" onerror=\"alert(1)\" />', '<img src=\"https://laravel.com/does-not-exist.jpg\" />', null],\n+            ['<a href=\"javascript:alert(1)\">Click me</a>', '<a>Click me</a>', null],\n+            ['<img src=\"/does-not-exist.jpg\" />', '<img src=\"/does-not-exist.jpg\" />', (new HtmlSanitizerConfig)->allowElement('img', 'src')->allowRelativeMedias()],\n+            ['<img src=\"http://laravel.com/safe.jpg\" />', '<img src=\"https://laravel.com/safe.jpg\" />', (new HtmlSanitizerConfig)->allowElement('img', 'src')->forceHttpsUrls()],\n+            ['<span data-attr=\"foo\"></span>', '<span data-attr=\"foo\"></span>', (new HtmlSanitizerConfig)->allowElement('span')->allowAttribute('data-attr', '*')],\n+        ] as $value) {\n+            [$subject, $expected, $config] = $value;\n+\n+            $this->assertSame($expected, Str::sanitize($subject, $config));\n+        }\n+    }",
        "comment_created_at": "2025-01-21T14:53:07+00:00",
        "comment_author": "jannescb",
        "comment_body": "Thanks!\r\n\r\nI added/slightly modified your suggestions \ud83d\udc4d ",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1919808012",
    "pr_number": 54226,
    "pr_file": "tests/Validation/ValidationEmailRuleTest.php",
    "created_at": "2025-01-17T09:26:19+00:00",
    "commented_code": "$customValidationMessage ? [self::ATTRIBUTE.'.email' => $customValidationMessage] : []\n            );\n\n            $this->assertSame($expectToPass, $v->passes());\n            $this->assertSame($expectToPass, $v->passes(), 'Expected email input '.$value.' to '.($expectToPass ? 'pass' : 'fail').'.');",
    "repo_full_name": "laravel/framework",
    "discussion_comments": [
      {
        "comment_id": "1919808012",
        "repo_full_name": "laravel/framework",
        "pr_number": 54226,
        "pr_file": "tests/Validation/ValidationEmailRuleTest.php",
        "discussion_id": "1919808012",
        "commented_code": "@@ -80,11 +81,12 @@ protected function assertValidationRules($rule, $values, $expectToPass, $expecte\n                 $customValidationMessage ? [self::ATTRIBUTE.'.email' => $customValidationMessage] : []\n             );\n \n-            $this->assertSame($expectToPass, $v->passes());\n+            $this->assertSame($expectToPass, $v->passes(), 'Expected email input '.$value.' to '.($expectToPass ? 'pass' : 'fail').'.');",
        "comment_created_at": "2025-01-17T09:26:19+00:00",
        "comment_author": "shaedrich",
        "comment_body": "You might want to use a [`#[DataProvider]`](https://docs.phpunit.de/en/10.5/attributes.html#data-provider) for this",
        "pr_file_module": null
      },
      {
        "comment_id": "1919924762",
        "repo_full_name": "laravel/framework",
        "pr_number": 54226,
        "pr_file": "tests/Validation/ValidationEmailRuleTest.php",
        "discussion_id": "1919808012",
        "commented_code": "@@ -80,11 +81,12 @@ protected function assertValidationRules($rule, $values, $expectToPass, $expecte\n                 $customValidationMessage ? [self::ATTRIBUTE.'.email' => $customValidationMessage] : []\n             );\n \n-            $this->assertSame($expectToPass, $v->passes());\n+            $this->assertSame($expectToPass, $v->passes(), 'Expected email input '.$value.' to '.($expectToPass ? 'pass' : 'fail').'.');",
        "comment_created_at": "2025-01-17T10:44:46+00:00",
        "comment_author": "SanderMuller",
        "comment_body": "Good point, updated to `#[TestWith]`",
        "pr_file_module": null
      },
      {
        "comment_id": "1920378618",
        "repo_full_name": "laravel/framework",
        "pr_number": 54226,
        "pr_file": "tests/Validation/ValidationEmailRuleTest.php",
        "discussion_id": "1919808012",
        "commented_code": "@@ -80,11 +81,12 @@ protected function assertValidationRules($rule, $values, $expectToPass, $expecte\n                 $customValidationMessage ? [self::ATTRIBUTE.'.email' => $customValidationMessage] : []\n             );\n \n-            $this->assertSame($expectToPass, $v->passes());\n+            $this->assertSame($expectToPass, $v->passes(), 'Expected email input '.$value.' to '.($expectToPass ? 'pass' : 'fail').'.');",
        "comment_created_at": "2025-01-17T15:42:51+00:00",
        "comment_author": "shaedrich",
        "comment_body": "Nice, never used it but looks neat \ud83d\udc4d\ud83c\udffb ",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1919809801",
    "pr_number": 54226,
    "pr_file": "tests/Validation/ValidationEmailRuleTest.php",
    "created_at": "2025-01-17T09:27:32+00:00",
    "commented_code": "$this->assertValidationRules($rule, $values, true);\n    }\n\n    public function testStrict()\n    public function testRfcCompliantStrict()\n    {\n        $emailThatFailsBothNonStrictButFailsInStrict = 'username@sub..example.com';\n        $emailThatPassesNonStrictButFailsInStrict = '\"has space\"@example.com';\n        $emailThatPassesBothNonStrictAndInStrict = 'plainaddress@example.com';\n\n        $this->fails(\n            (new Email())->rfcCompliant(true),\n            'invalid.@example.com',\n            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n            (new Email())->rfcCompliant(strict: true),\n            $emailThatPassesNonStrictButFailsInStrict,\n            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n        );\n\n        $this->fails(\n            Rule::email()->rfcCompliant(true),\n            'invalid.@example.com',\n            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n            Rule::email()->rfcCompliant(strict: true),\n            $emailThatPassesNonStrictButFailsInStrict,\n            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n        );\n\n        $this->fails(\n            (new Email())->rfcCompliant(true),\n            'username@sub..example.com',\n            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n            (new Email())->rfcCompliant(strict: true),\n            $emailThatFailsBothNonStrictButFailsInStrict,\n            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n        );\n\n        $this->fails(\n            Rule::email()->rfcCompliant(true),\n            'username@sub..example.com',\n            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n            Rule::email()->rfcCompliant(strict: true),\n            $emailThatFailsBothNonStrictButFailsInStrict,\n            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n        );\n\n        $this->passes(\n            (new Email())->rfcCompliant(true),\n            'plainaddress@example.com',\n            (new Email())->rfcCompliant(strict: true),\n            $emailThatPassesBothNonStrictAndInStrict\n        );\n\n        $this->passes(\n            Rule::email()->rfcCompliant(true),\n            'plainaddress@example.com',\n            Rule::email()->rfcCompliant(strict: true),\n            $emailThatPassesBothNonStrictAndInStrict\n        );\n    }\n\n    public function testDns()\n    public function testValidateMxRecord()\n    {\n        $this->fails(\n            (new Email())->validateMxRecord(),\n            'plainaddress@example.com',\n            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n        );\n\n        $this->fails(\n            Rule::email()->validateMxRecord(),\n            'plainaddress@example.com',\n            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n        );\n\n        $this->passes(\n            (new Email())->validateMxRecord(),\n            'taylor@laravel.com',\n            'taylor@laravel.com'\n        );\n\n        $this->passes(\n            Rule::email()->validateMxRecord(),\n            'taylor@laravel.com',\n            'taylor@laravel.com'\n        );\n    }\n\n    public function testSpoof()\n    public function testPreventSpoofing()\n    {\n        $this->fails(\n            (new Email())->preventSpoofing(),\n            'admin@exam\u0440le.com',// Contains a Cyrillic '\u0440' (U+0440), not a Latin 'p'\n            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n        );\n\n        $this->fails(\n            Rule::email()->preventSpoofing(),\n            'admin@exam\u0440le.com',// Contains a Cyrillic '\u0440' (U+0440), not a Latin 'p'\n            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n        );\n\n        $spoofingEmail = 'admin@exam'.\"\\u{0440}\".'le.com';\n        $this->fails(\n            (new Email())->preventSpoofing(),\n            $spoofingEmail,\n            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n        );\n\n        $this->fails(\n            Rule::email()->preventSpoofing(),\n            $spoofingEmail,\n            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n        );\n\n        $this->passes(\n            (new Email())->preventSpoofing(),\n            'admin@example.com',\n            'admin@example.com'\n        );\n\n        $this->passes(\n            Rule::email()->preventSpoofing(),\n            'admin@example.com',\n            'admin@example.com'\n        );\n\n        $this->passes(\n            (new Email())->preventSpoofing(),\n            'test\ud83d\udc68\u200d\ud83d\udcbb@domain.com',\n            'test\ud83d\udc68\u200d\ud83d\udcbb@domain.com'\n        );\n\n        $this->passes(\n            Rule::email()->preventSpoofing(),\n            'test\ud83d\udc68\u200d\ud83d\udcbb@domain.com',\n            'test\ud83d\udc68\u200d\ud83d\udcbb@domain.com'\n        );\n    }\n\n    public function testFilter()\n    public function testWithNativeValidation()\n    {\n        $this->fails(\n            (new Email())->withNativeValidation(),\n            't\u00e9st@domain.com',\n            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n        );\n\n        $this->fails(\n            Rule::email()->withNativeValidation(),\n            't\u00e9st@domain.com',\n            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n        );\n\n        $this->passes(\n            (new Email())->withNativeValidation(),\n            'admin@example.com',\n            'admin@example.com'\n        );\n\n        $this->passes(\n            Rule::email()->withNativeValidation(),\n            'admin@example.com',\n            'admin@example.com'\n        );\n    }\n\n    public function testFilterUnicode()\n    public function testWithNativeValidationAllowUnicode()\n    {\n        $this->fails(\n            (new Email())->withNativeValidation(true),\n            (new Email())->withNativeValidation(allowUnicode: true),\n            'invalid.@example.com',\n            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n        );\n\n        $this->fails(\n            Rule::email()->withNativeValidation(true),\n            Rule::email()->withNativeValidation(allowUnicode: true),\n            'invalid.@example.com',\n            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n        );\n\n        $this->passes(\n            (new Email())->withNativeValidation(true),\n            't\u00e9st@domain.com',\n            (new Email())->withNativeValidation(allowUnicode: true),\n            't\u00e9st@domain.com'\n        );\n\n        $this->passes(\n            Rule::email()->withNativeValidation(true),\n            't\u00e9st@domain.com',\n            Rule::email()->withNativeValidation(allowUnicode: true),\n            't\u00e9st@domain.com'\n        );\n\n        $this->passes(\n            (new Email())->withNativeValidation(true),\n            'admin@example.com',\n            (new Email())->withNativeValidation(allowUnicode: true),\n            'admin@example.com'\n        );\n\n        $this->passes(\n            Rule::email()->withNativeValidation(true),\n            'admin@example.com',\n            Rule::email()->withNativeValidation(allowUnicode: true),\n            'admin@example.com'\n        );\n    }\n\n    public function testRfc()\n    public function testRfcCompliantNonStrict()\n    {\n        $this->fails(\n            (new Email())->rfcCompliant(),\n            'invalid.@example.com',\n            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n        );\n\n        $this->fails(\n            Rule::email()->rfcCompliant(),\n            'invalid.@example.com',\n            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n        );\n\n        $this->fails(\n            (new Email())->rfcCompliant(),\n            'test\ud83d\udc68\u200d\ud83d\udcbb@domain.com',\n            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n        );\n\n        $this->fails(\n            Rule::email()->rfcCompliant(),\n            'test\ud83d\udc68\u200d\ud83d\udcbb@domain.com',\n            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n        );\n\n        $this->passes(\n            (new Email())->rfcCompliant(),\n            'admin@example.com',\n            'admin@example.com'\n        );\n\n        $this->passes(\n            Rule::email()->rfcCompliant(),\n            'admin@example.com',\n            'admin@example.com'\n        );\n\n        $this->passes(\n            (new Email())->rfcCompliant(),\n            't\u00e9st@domain.com',\n            't\u00e9st@domain.com'\n        );\n\n        $this->passes(\n            Rule::email()->rfcCompliant(),\n            't\u00e9st@domain.com',\n            't\u00e9st@domain.com'\n        );\n    }\n\n    public function testPassesRfcCompliantButNotRfcCompliantStrict()\n    {\n        $emailsThatPassOnRfcCompliantButFailOnStrict = [\n            '\"has space\"@example.com',              // Quoted local part with space\n            'some(comment)@example.com',            // Comment in local part\n            'abc.\"test\"@example.com',               // Mixed quoted/unquoted local part\n            '\"escaped\\\\\\\"quote\"@example.com',       // Escaped quote inside quoted local part\n            'test@example',                         // Domain without TLD\n            'test@localhost',                       // Domain without TLD\n            'name@[127.0.0.1]',                     // Local-part with domain-literal IPv4 address\n            'user@[IPv6:::1]',                      // Domain-literal with unusual IPv6 short form\n            'a@[IPv6:2001:db8::1]',                 // Domain-literal with normal IPv6\n            'user@[IPv6:::]',                       // invalid shorthand IPv6\n            '\"ab\\\\(c\"@example.com',\n        ];",
    "repo_full_name": "laravel/framework",
    "discussion_comments": [
      {
        "comment_id": "1919809801",
        "repo_full_name": "laravel/framework",
        "pr_number": 54226,
        "pr_file": "tests/Validation/ValidationEmailRuleTest.php",
        "discussion_id": "1919809801",
        "commented_code": "@@ -99,291 +101,692 @@ protected function passes($rule, $values)\n         $this->assertValidationRules($rule, $values, true);\n     }\n \n-    public function testStrict()\n+    public function testRfcCompliantStrict()\n     {\n+        $emailThatFailsBothNonStrictButFailsInStrict = 'username@sub..example.com';\n+        $emailThatPassesNonStrictButFailsInStrict = '\"has space\"@example.com';\n+        $emailThatPassesBothNonStrictAndInStrict = 'plainaddress@example.com';\n+\n         $this->fails(\n-            (new Email())->rfcCompliant(true),\n-            'invalid.@example.com',\n-            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n+            (new Email())->rfcCompliant(strict: true),\n+            $emailThatPassesNonStrictButFailsInStrict,\n+            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n         );\n \n         $this->fails(\n-            Rule::email()->rfcCompliant(true),\n-            'invalid.@example.com',\n-            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n+            Rule::email()->rfcCompliant(strict: true),\n+            $emailThatPassesNonStrictButFailsInStrict,\n+            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n         );\n \n         $this->fails(\n-            (new Email())->rfcCompliant(true),\n-            'username@sub..example.com',\n-            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n+            (new Email())->rfcCompliant(strict: true),\n+            $emailThatFailsBothNonStrictButFailsInStrict,\n+            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n         );\n \n         $this->fails(\n-            Rule::email()->rfcCompliant(true),\n-            'username@sub..example.com',\n-            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n+            Rule::email()->rfcCompliant(strict: true),\n+            $emailThatFailsBothNonStrictButFailsInStrict,\n+            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n         );\n \n         $this->passes(\n-            (new Email())->rfcCompliant(true),\n-            'plainaddress@example.com',\n+            (new Email())->rfcCompliant(strict: true),\n+            $emailThatPassesBothNonStrictAndInStrict\n         );\n \n         $this->passes(\n-            Rule::email()->rfcCompliant(true),\n-            'plainaddress@example.com',\n+            Rule::email()->rfcCompliant(strict: true),\n+            $emailThatPassesBothNonStrictAndInStrict\n         );\n     }\n \n-    public function testDns()\n+    public function testValidateMxRecord()\n     {\n         $this->fails(\n             (new Email())->validateMxRecord(),\n             'plainaddress@example.com',\n-            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n+            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n         );\n \n         $this->fails(\n             Rule::email()->validateMxRecord(),\n             'plainaddress@example.com',\n-            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n+            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n         );\n \n         $this->passes(\n             (new Email())->validateMxRecord(),\n-            'taylor@laravel.com',\n+            'taylor@laravel.com'\n         );\n \n         $this->passes(\n             Rule::email()->validateMxRecord(),\n-            'taylor@laravel.com',\n+            'taylor@laravel.com'\n         );\n     }\n \n-    public function testSpoof()\n+    public function testPreventSpoofing()\n     {\n         $this->fails(\n             (new Email())->preventSpoofing(),\n             'admin@exam\u0440le.com',// Contains a Cyrillic '\u0440' (U+0440), not a Latin 'p'\n-            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n+            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n         );\n \n         $this->fails(\n             Rule::email()->preventSpoofing(),\n             'admin@exam\u0440le.com',// Contains a Cyrillic '\u0440' (U+0440), not a Latin 'p'\n-            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n+            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n         );\n \n         $spoofingEmail = 'admin@exam'.\"\\u{0440}\".'le.com';\n         $this->fails(\n             (new Email())->preventSpoofing(),\n             $spoofingEmail,\n-            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n+            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n         );\n \n         $this->fails(\n             Rule::email()->preventSpoofing(),\n             $spoofingEmail,\n-            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n+            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n         );\n \n         $this->passes(\n             (new Email())->preventSpoofing(),\n-            'admin@example.com',\n+            'admin@example.com'\n         );\n \n         $this->passes(\n             Rule::email()->preventSpoofing(),\n-            'admin@example.com',\n+            'admin@example.com'\n         );\n \n         $this->passes(\n             (new Email())->preventSpoofing(),\n-            'test\ud83d\udc68\u200d\ud83d\udcbb@domain.com',\n+            'test\ud83d\udc68\u200d\ud83d\udcbb@domain.com'\n         );\n \n         $this->passes(\n             Rule::email()->preventSpoofing(),\n-            'test\ud83d\udc68\u200d\ud83d\udcbb@domain.com',\n+            'test\ud83d\udc68\u200d\ud83d\udcbb@domain.com'\n         );\n     }\n \n-    public function testFilter()\n+    public function testWithNativeValidation()\n     {\n         $this->fails(\n             (new Email())->withNativeValidation(),\n             't\u00e9st@domain.com',\n-            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n+            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n         );\n \n         $this->fails(\n             Rule::email()->withNativeValidation(),\n             't\u00e9st@domain.com',\n-            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n+            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n         );\n \n         $this->passes(\n             (new Email())->withNativeValidation(),\n-            'admin@example.com',\n+            'admin@example.com'\n         );\n \n         $this->passes(\n             Rule::email()->withNativeValidation(),\n-            'admin@example.com',\n+            'admin@example.com'\n         );\n     }\n \n-    public function testFilterUnicode()\n+    public function testWithNativeValidationAllowUnicode()\n     {\n         $this->fails(\n-            (new Email())->withNativeValidation(true),\n+            (new Email())->withNativeValidation(allowUnicode: true),\n             'invalid.@example.com',\n-            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n+            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n         );\n \n         $this->fails(\n-            Rule::email()->withNativeValidation(true),\n+            Rule::email()->withNativeValidation(allowUnicode: true),\n             'invalid.@example.com',\n-            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n+            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n         );\n \n         $this->passes(\n-            (new Email())->withNativeValidation(true),\n-            't\u00e9st@domain.com',\n+            (new Email())->withNativeValidation(allowUnicode: true),\n+            't\u00e9st@domain.com'\n         );\n \n         $this->passes(\n-            Rule::email()->withNativeValidation(true),\n-            't\u00e9st@domain.com',\n+            Rule::email()->withNativeValidation(allowUnicode: true),\n+            't\u00e9st@domain.com'\n         );\n \n         $this->passes(\n-            (new Email())->withNativeValidation(true),\n-            'admin@example.com',\n+            (new Email())->withNativeValidation(allowUnicode: true),\n+            'admin@example.com'\n         );\n \n         $this->passes(\n-            Rule::email()->withNativeValidation(true),\n-            'admin@example.com',\n+            Rule::email()->withNativeValidation(allowUnicode: true),\n+            'admin@example.com'\n         );\n     }\n \n-    public function testRfc()\n+    public function testRfcCompliantNonStrict()\n     {\n         $this->fails(\n             (new Email())->rfcCompliant(),\n             'invalid.@example.com',\n-            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n+            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n         );\n \n         $this->fails(\n             Rule::email()->rfcCompliant(),\n             'invalid.@example.com',\n-            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n+            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n         );\n \n         $this->fails(\n             (new Email())->rfcCompliant(),\n             'test\ud83d\udc68\u200d\ud83d\udcbb@domain.com',\n-            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n+            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n         );\n \n         $this->fails(\n             Rule::email()->rfcCompliant(),\n             'test\ud83d\udc68\u200d\ud83d\udcbb@domain.com',\n-            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n+            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n         );\n \n         $this->passes(\n             (new Email())->rfcCompliant(),\n-            'admin@example.com',\n+            'admin@example.com'\n         );\n \n         $this->passes(\n             Rule::email()->rfcCompliant(),\n-            'admin@example.com',\n+            'admin@example.com'\n         );\n \n         $this->passes(\n             (new Email())->rfcCompliant(),\n-            't\u00e9st@domain.com',\n+            't\u00e9st@domain.com'\n         );\n \n         $this->passes(\n             Rule::email()->rfcCompliant(),\n-            't\u00e9st@domain.com',\n+            't\u00e9st@domain.com'\n         );\n     }\n \n+    public function testPassesRfcCompliantButNotRfcCompliantStrict()\n+    {\n+        $emailsThatPassOnRfcCompliantButFailOnStrict = [\n+            '\"has space\"@example.com',              // Quoted local part with space\n+            'some(comment)@example.com',            // Comment in local part\n+            'abc.\"test\"@example.com',               // Mixed quoted/unquoted local part\n+            '\"escaped\\\\\\\"quote\"@example.com',       // Escaped quote inside quoted local part\n+            'test@example',                         // Domain without TLD\n+            'test@localhost',                       // Domain without TLD\n+            'name@[127.0.0.1]',                     // Local-part with domain-literal IPv4 address\n+            'user@[IPv6:::1]',                      // Domain-literal with unusual IPv6 short form\n+            'a@[IPv6:2001:db8::1]',                 // Domain-literal with normal IPv6\n+            'user@[IPv6:::]',                       // invalid shorthand IPv6\n+            '\"ab\\\\(c\"@example.com',\n+        ];",
        "comment_created_at": "2025-01-17T09:27:32+00:00",
        "comment_author": "shaedrich",
        "comment_body": "same here",
        "pr_file_module": null
      },
      {
        "comment_id": "1919811653",
        "repo_full_name": "laravel/framework",
        "pr_number": 54226,
        "pr_file": "tests/Validation/ValidationEmailRuleTest.php",
        "discussion_id": "1919809801",
        "commented_code": "@@ -99,291 +101,692 @@ protected function passes($rule, $values)\n         $this->assertValidationRules($rule, $values, true);\n     }\n \n-    public function testStrict()\n+    public function testRfcCompliantStrict()\n     {\n+        $emailThatFailsBothNonStrictButFailsInStrict = 'username@sub..example.com';\n+        $emailThatPassesNonStrictButFailsInStrict = '\"has space\"@example.com';\n+        $emailThatPassesBothNonStrictAndInStrict = 'plainaddress@example.com';\n+\n         $this->fails(\n-            (new Email())->rfcCompliant(true),\n-            'invalid.@example.com',\n-            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n+            (new Email())->rfcCompliant(strict: true),\n+            $emailThatPassesNonStrictButFailsInStrict,\n+            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n         );\n \n         $this->fails(\n-            Rule::email()->rfcCompliant(true),\n-            'invalid.@example.com',\n-            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n+            Rule::email()->rfcCompliant(strict: true),\n+            $emailThatPassesNonStrictButFailsInStrict,\n+            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n         );\n \n         $this->fails(\n-            (new Email())->rfcCompliant(true),\n-            'username@sub..example.com',\n-            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n+            (new Email())->rfcCompliant(strict: true),\n+            $emailThatFailsBothNonStrictButFailsInStrict,\n+            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n         );\n \n         $this->fails(\n-            Rule::email()->rfcCompliant(true),\n-            'username@sub..example.com',\n-            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n+            Rule::email()->rfcCompliant(strict: true),\n+            $emailThatFailsBothNonStrictButFailsInStrict,\n+            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n         );\n \n         $this->passes(\n-            (new Email())->rfcCompliant(true),\n-            'plainaddress@example.com',\n+            (new Email())->rfcCompliant(strict: true),\n+            $emailThatPassesBothNonStrictAndInStrict\n         );\n \n         $this->passes(\n-            Rule::email()->rfcCompliant(true),\n-            'plainaddress@example.com',\n+            Rule::email()->rfcCompliant(strict: true),\n+            $emailThatPassesBothNonStrictAndInStrict\n         );\n     }\n \n-    public function testDns()\n+    public function testValidateMxRecord()\n     {\n         $this->fails(\n             (new Email())->validateMxRecord(),\n             'plainaddress@example.com',\n-            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n+            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n         );\n \n         $this->fails(\n             Rule::email()->validateMxRecord(),\n             'plainaddress@example.com',\n-            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n+            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n         );\n \n         $this->passes(\n             (new Email())->validateMxRecord(),\n-            'taylor@laravel.com',\n+            'taylor@laravel.com'\n         );\n \n         $this->passes(\n             Rule::email()->validateMxRecord(),\n-            'taylor@laravel.com',\n+            'taylor@laravel.com'\n         );\n     }\n \n-    public function testSpoof()\n+    public function testPreventSpoofing()\n     {\n         $this->fails(\n             (new Email())->preventSpoofing(),\n             'admin@exam\u0440le.com',// Contains a Cyrillic '\u0440' (U+0440), not a Latin 'p'\n-            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n+            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n         );\n \n         $this->fails(\n             Rule::email()->preventSpoofing(),\n             'admin@exam\u0440le.com',// Contains a Cyrillic '\u0440' (U+0440), not a Latin 'p'\n-            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n+            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n         );\n \n         $spoofingEmail = 'admin@exam'.\"\\u{0440}\".'le.com';\n         $this->fails(\n             (new Email())->preventSpoofing(),\n             $spoofingEmail,\n-            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n+            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n         );\n \n         $this->fails(\n             Rule::email()->preventSpoofing(),\n             $spoofingEmail,\n-            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n+            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n         );\n \n         $this->passes(\n             (new Email())->preventSpoofing(),\n-            'admin@example.com',\n+            'admin@example.com'\n         );\n \n         $this->passes(\n             Rule::email()->preventSpoofing(),\n-            'admin@example.com',\n+            'admin@example.com'\n         );\n \n         $this->passes(\n             (new Email())->preventSpoofing(),\n-            'test\ud83d\udc68\u200d\ud83d\udcbb@domain.com',\n+            'test\ud83d\udc68\u200d\ud83d\udcbb@domain.com'\n         );\n \n         $this->passes(\n             Rule::email()->preventSpoofing(),\n-            'test\ud83d\udc68\u200d\ud83d\udcbb@domain.com',\n+            'test\ud83d\udc68\u200d\ud83d\udcbb@domain.com'\n         );\n     }\n \n-    public function testFilter()\n+    public function testWithNativeValidation()\n     {\n         $this->fails(\n             (new Email())->withNativeValidation(),\n             't\u00e9st@domain.com',\n-            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n+            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n         );\n \n         $this->fails(\n             Rule::email()->withNativeValidation(),\n             't\u00e9st@domain.com',\n-            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n+            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n         );\n \n         $this->passes(\n             (new Email())->withNativeValidation(),\n-            'admin@example.com',\n+            'admin@example.com'\n         );\n \n         $this->passes(\n             Rule::email()->withNativeValidation(),\n-            'admin@example.com',\n+            'admin@example.com'\n         );\n     }\n \n-    public function testFilterUnicode()\n+    public function testWithNativeValidationAllowUnicode()\n     {\n         $this->fails(\n-            (new Email())->withNativeValidation(true),\n+            (new Email())->withNativeValidation(allowUnicode: true),\n             'invalid.@example.com',\n-            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n+            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n         );\n \n         $this->fails(\n-            Rule::email()->withNativeValidation(true),\n+            Rule::email()->withNativeValidation(allowUnicode: true),\n             'invalid.@example.com',\n-            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n+            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n         );\n \n         $this->passes(\n-            (new Email())->withNativeValidation(true),\n-            't\u00e9st@domain.com',\n+            (new Email())->withNativeValidation(allowUnicode: true),\n+            't\u00e9st@domain.com'\n         );\n \n         $this->passes(\n-            Rule::email()->withNativeValidation(true),\n-            't\u00e9st@domain.com',\n+            Rule::email()->withNativeValidation(allowUnicode: true),\n+            't\u00e9st@domain.com'\n         );\n \n         $this->passes(\n-            (new Email())->withNativeValidation(true),\n-            'admin@example.com',\n+            (new Email())->withNativeValidation(allowUnicode: true),\n+            'admin@example.com'\n         );\n \n         $this->passes(\n-            Rule::email()->withNativeValidation(true),\n-            'admin@example.com',\n+            Rule::email()->withNativeValidation(allowUnicode: true),\n+            'admin@example.com'\n         );\n     }\n \n-    public function testRfc()\n+    public function testRfcCompliantNonStrict()\n     {\n         $this->fails(\n             (new Email())->rfcCompliant(),\n             'invalid.@example.com',\n-            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n+            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n         );\n \n         $this->fails(\n             Rule::email()->rfcCompliant(),\n             'invalid.@example.com',\n-            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n+            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n         );\n \n         $this->fails(\n             (new Email())->rfcCompliant(),\n             'test\ud83d\udc68\u200d\ud83d\udcbb@domain.com',\n-            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n+            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n         );\n \n         $this->fails(\n             Rule::email()->rfcCompliant(),\n             'test\ud83d\udc68\u200d\ud83d\udcbb@domain.com',\n-            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.'],\n+            ['The '.self::ATTRIBUTE_REPLACED.' must be a valid email address.']\n         );\n \n         $this->passes(\n             (new Email())->rfcCompliant(),\n-            'admin@example.com',\n+            'admin@example.com'\n         );\n \n         $this->passes(\n             Rule::email()->rfcCompliant(),\n-            'admin@example.com',\n+            'admin@example.com'\n         );\n \n         $this->passes(\n             (new Email())->rfcCompliant(),\n-            't\u00e9st@domain.com',\n+            't\u00e9st@domain.com'\n         );\n \n         $this->passes(\n             Rule::email()->rfcCompliant(),\n-            't\u00e9st@domain.com',\n+            't\u00e9st@domain.com'\n         );\n     }\n \n+    public function testPassesRfcCompliantButNotRfcCompliantStrict()\n+    {\n+        $emailsThatPassOnRfcCompliantButFailOnStrict = [\n+            '\"has space\"@example.com',              // Quoted local part with space\n+            'some(comment)@example.com',            // Comment in local part\n+            'abc.\"test\"@example.com',               // Mixed quoted/unquoted local part\n+            '\"escaped\\\\\\\"quote\"@example.com',       // Escaped quote inside quoted local part\n+            'test@example',                         // Domain without TLD\n+            'test@localhost',                       // Domain without TLD\n+            'name@[127.0.0.1]',                     // Local-part with domain-literal IPv4 address\n+            'user@[IPv6:::1]',                      // Domain-literal with unusual IPv6 short form\n+            'a@[IPv6:2001:db8::1]',                 // Domain-literal with normal IPv6\n+            'user@[IPv6:::]',                       // invalid shorthand IPv6\n+            '\"ab\\\\(c\"@example.com',\n+        ];",
        "comment_created_at": "2025-01-17T09:28:34+00:00",
        "comment_author": "shaedrich",
        "comment_body": "All of these arrays could alternatively be put into fixture files \ud83e\udd14 ",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1639068204",
    "pr_number": 51799,
    "pr_file": "tests/Http/HttpClientTest.php",
    "created_at": "2024-06-14T00:18:24+00:00",
    "commented_code": "});\n    }\n\n    public function testWithBaseUrl()\n    /**\n     * @dataProvider baseUriWithRefProvider\n     */",
    "repo_full_name": "laravel/framework",
    "discussion_comments": [
      {
        "comment_id": "1639068204",
        "repo_full_name": "laravel/framework",
        "pr_number": 51799,
        "pr_file": "tests/Http/HttpClientTest.php",
        "discussion_id": "1639068204",
        "commented_code": "@@ -985,23 +985,62 @@ public function testGetWithArrayQueryParamEncodes()\n         });\n     }\n \n-    public function testWithBaseUrl()\n+    /**\n+     * @dataProvider baseUriWithRefProvider\n+     */",
        "comment_created_at": "2024-06-14T00:18:24+00:00",
        "comment_author": "crynobone",
        "comment_body": "Please use PHPUnit `DataProvider` attribute over `@dataProvider` annotation.",
        "pr_file_module": null
      }
    ]
  }
]
