[
  {
    "discussion_id": "1991516565",
    "pr_number": 6678,
    "pr_file": "flatpak/com.mitchellh.ghostty.yml",
    "created_at": "2025-03-12T13:34:01+00:00",
    "commented_code": "+app-id: com.mitchellh.ghostty\n+runtime: org.gnome.Platform\n+runtime-version: \"47\"\n+sdk: org.gnome.Sdk\n+sdk-extensions:\n+  - org.freedesktop.Sdk.Extension.ziglang\n+default-branch: tip\n+command: ghostty\n+finish-args:\n+  # 3D rendering\n+  - --device=dri\n+  # Windowing\n+  - --share=ipc\n+  - --socket=fallback-x11\n+  - --socket=wayland\n+  # Allow user to specify additional config files in home by default\n+  - --filesystem=home:ro\n+  # So we can escape the sandbox\n+  - --talk-name=org.freedesktop.Flatpak\n+cleanup:\n+  - /include\n+  - /lib/girepository-1.0\n+  - /lib/pkgconfig\n+  - /share/gir-1.0\n+  - /share/pkgconfig\n+  - /share/vala\n+  - '*.la'\n+  - '*.a'\n+  - '*.so'\n+\n+modules:\n+  - name: bzip2-redirect\n+    buildsystem: simple\n+    build-commands:\n+      - install -dm755 /app/lib\n+      - echo \"INPUT(libbz2.so)\" > /app/lib/libbzip2.so",
    "repo_full_name": "ghostty-org/ghostty",
    "discussion_comments": [
      {
        "comment_id": "1991516565",
        "repo_full_name": "ghostty-org/ghostty",
        "pr_number": 6678,
        "pr_file": "flatpak/com.mitchellh.ghostty.yml",
        "discussion_id": "1991516565",
        "commented_code": "@@ -0,0 +1,113 @@\n+app-id: com.mitchellh.ghostty\n+runtime: org.gnome.Platform\n+runtime-version: \"47\"\n+sdk: org.gnome.Sdk\n+sdk-extensions:\n+  - org.freedesktop.Sdk.Extension.ziglang\n+default-branch: tip\n+command: ghostty\n+finish-args:\n+  # 3D rendering\n+  - --device=dri\n+  # Windowing\n+  - --share=ipc\n+  - --socket=fallback-x11\n+  - --socket=wayland\n+  # Allow user to specify additional config files in home by default\n+  - --filesystem=home:ro\n+  # So we can escape the sandbox\n+  - --talk-name=org.freedesktop.Flatpak\n+cleanup:\n+  - /include\n+  - /lib/girepository-1.0\n+  - /lib/pkgconfig\n+  - /share/gir-1.0\n+  - /share/pkgconfig\n+  - /share/vala\n+  - '*.la'\n+  - '*.a'\n+  - '*.so'\n+\n+modules:\n+  - name: bzip2-redirect\n+    buildsystem: simple\n+    build-commands:\n+      - install -dm755 /app/lib\n+      - echo \"INPUT(libbz2.so)\" > /app/lib/libbzip2.so",
        "comment_created_at": "2025-03-12T13:34:01+00:00",
        "comment_author": "yorickpeterse",
        "comment_body": "What's this for? At least when running https://github.com/yorickpeterse/ghostty-flatpak locally I didn't get any errors related to libbzip2.",
        "pr_file_module": null
      },
      {
        "comment_id": "1991534112",
        "repo_full_name": "ghostty-org/ghostty",
        "pr_number": 6678,
        "pr_file": "flatpak/com.mitchellh.ghostty.yml",
        "discussion_id": "1991516565",
        "commented_code": "@@ -0,0 +1,113 @@\n+app-id: com.mitchellh.ghostty\n+runtime: org.gnome.Platform\n+runtime-version: \"47\"\n+sdk: org.gnome.Sdk\n+sdk-extensions:\n+  - org.freedesktop.Sdk.Extension.ziglang\n+default-branch: tip\n+command: ghostty\n+finish-args:\n+  # 3D rendering\n+  - --device=dri\n+  # Windowing\n+  - --share=ipc\n+  - --socket=fallback-x11\n+  - --socket=wayland\n+  # Allow user to specify additional config files in home by default\n+  - --filesystem=home:ro\n+  # So we can escape the sandbox\n+  - --talk-name=org.freedesktop.Flatpak\n+cleanup:\n+  - /include\n+  - /lib/girepository-1.0\n+  - /lib/pkgconfig\n+  - /share/gir-1.0\n+  - /share/pkgconfig\n+  - /share/vala\n+  - '*.la'\n+  - '*.a'\n+  - '*.so'\n+\n+modules:\n+  - name: bzip2-redirect\n+    buildsystem: simple\n+    build-commands:\n+      - install -dm755 /app/lib\n+      - echo \"INPUT(libbz2.so)\" > /app/lib/libbzip2.so",
        "comment_created_at": "2025-03-12T13:42:59+00:00",
        "comment_author": "alaviss",
        "comment_body": "You'll only see the issue if freetype system integration is enabled (and it wasn't on your build). Zig wouldn't be able to find bzip2 because it's not available as a pkg-config thing in Flatpak SDK and the library name is `libbz2` instead of `libbzip2`.\r\n\r\nThe file itself is a tiny linker script to redirect the linker to the right file.",
        "pr_file_module": null
      },
      {
        "comment_id": "1991739764",
        "repo_full_name": "ghostty-org/ghostty",
        "pr_number": 6678,
        "pr_file": "flatpak/com.mitchellh.ghostty.yml",
        "discussion_id": "1991516565",
        "commented_code": "@@ -0,0 +1,113 @@\n+app-id: com.mitchellh.ghostty\n+runtime: org.gnome.Platform\n+runtime-version: \"47\"\n+sdk: org.gnome.Sdk\n+sdk-extensions:\n+  - org.freedesktop.Sdk.Extension.ziglang\n+default-branch: tip\n+command: ghostty\n+finish-args:\n+  # 3D rendering\n+  - --device=dri\n+  # Windowing\n+  - --share=ipc\n+  - --socket=fallback-x11\n+  - --socket=wayland\n+  # Allow user to specify additional config files in home by default\n+  - --filesystem=home:ro\n+  # So we can escape the sandbox\n+  - --talk-name=org.freedesktop.Flatpak\n+cleanup:\n+  - /include\n+  - /lib/girepository-1.0\n+  - /lib/pkgconfig\n+  - /share/gir-1.0\n+  - /share/pkgconfig\n+  - /share/vala\n+  - '*.la'\n+  - '*.a'\n+  - '*.so'\n+\n+modules:\n+  - name: bzip2-redirect\n+    buildsystem: simple\n+    build-commands:\n+      - install -dm755 /app/lib\n+      - echo \"INPUT(libbz2.so)\" > /app/lib/libbzip2.so",
        "comment_created_at": "2025-03-12T15:19:41+00:00",
        "comment_author": "tristan957",
        "comment_body": "Instead of the linker script solution, can we just add a PR to check for the library name here?\r\n\r\nhttps://github.com/ghostty-org/ghostty/blob/95daca616db5c24d7bb37fd5a3ac2f8762bb4ead/src/build/SharedDeps.zig#L117",
        "pr_file_module": null
      },
      {
        "comment_id": "1991757213",
        "repo_full_name": "ghostty-org/ghostty",
        "pr_number": 6678,
        "pr_file": "flatpak/com.mitchellh.ghostty.yml",
        "discussion_id": "1991516565",
        "commented_code": "@@ -0,0 +1,113 @@\n+app-id: com.mitchellh.ghostty\n+runtime: org.gnome.Platform\n+runtime-version: \"47\"\n+sdk: org.gnome.Sdk\n+sdk-extensions:\n+  - org.freedesktop.Sdk.Extension.ziglang\n+default-branch: tip\n+command: ghostty\n+finish-args:\n+  # 3D rendering\n+  - --device=dri\n+  # Windowing\n+  - --share=ipc\n+  - --socket=fallback-x11\n+  - --socket=wayland\n+  # Allow user to specify additional config files in home by default\n+  - --filesystem=home:ro\n+  # So we can escape the sandbox\n+  - --talk-name=org.freedesktop.Flatpak\n+cleanup:\n+  - /include\n+  - /lib/girepository-1.0\n+  - /lib/pkgconfig\n+  - /share/gir-1.0\n+  - /share/pkgconfig\n+  - /share/vala\n+  - '*.la'\n+  - '*.a'\n+  - '*.so'\n+\n+modules:\n+  - name: bzip2-redirect\n+    buildsystem: simple\n+    build-commands:\n+      - install -dm755 /app/lib\n+      - echo \"INPUT(libbz2.so)\" > /app/lib/libbzip2.so",
        "comment_created_at": "2025-03-12T15:28:12+00:00",
        "comment_author": "alaviss",
        "comment_body": "That's not feasible I believe. Many distributions (incl. homebrew) provide a pkg-config for `bzip2`, but none for `bz2`, so it is a good idea to keep it as is.",
        "pr_file_module": null
      },
      {
        "comment_id": "1991787226",
        "repo_full_name": "ghostty-org/ghostty",
        "pr_number": 6678,
        "pr_file": "flatpak/com.mitchellh.ghostty.yml",
        "discussion_id": "1991516565",
        "commented_code": "@@ -0,0 +1,113 @@\n+app-id: com.mitchellh.ghostty\n+runtime: org.gnome.Platform\n+runtime-version: \"47\"\n+sdk: org.gnome.Sdk\n+sdk-extensions:\n+  - org.freedesktop.Sdk.Extension.ziglang\n+default-branch: tip\n+command: ghostty\n+finish-args:\n+  # 3D rendering\n+  - --device=dri\n+  # Windowing\n+  - --share=ipc\n+  - --socket=fallback-x11\n+  - --socket=wayland\n+  # Allow user to specify additional config files in home by default\n+  - --filesystem=home:ro\n+  # So we can escape the sandbox\n+  - --talk-name=org.freedesktop.Flatpak\n+cleanup:\n+  - /include\n+  - /lib/girepository-1.0\n+  - /lib/pkgconfig\n+  - /share/gir-1.0\n+  - /share/pkgconfig\n+  - /share/vala\n+  - '*.la'\n+  - '*.a'\n+  - '*.so'\n+\n+modules:\n+  - name: bzip2-redirect\n+    buildsystem: simple\n+    build-commands:\n+      - install -dm755 /app/lib\n+      - echo \"INPUT(libbz2.so)\" > /app/lib/libbzip2.so",
        "comment_created_at": "2025-03-12T15:43:26+00:00",
        "comment_author": "tristan957",
        "comment_body": "The Zig build system doesn't allow you to pass the equivalent of `-lbz2`?",
        "pr_file_module": null
      },
      {
        "comment_id": "1991790458",
        "repo_full_name": "ghostty-org/ghostty",
        "pr_number": 6678,
        "pr_file": "flatpak/com.mitchellh.ghostty.yml",
        "discussion_id": "1991516565",
        "commented_code": "@@ -0,0 +1,113 @@\n+app-id: com.mitchellh.ghostty\n+runtime: org.gnome.Platform\n+runtime-version: \"47\"\n+sdk: org.gnome.Sdk\n+sdk-extensions:\n+  - org.freedesktop.Sdk.Extension.ziglang\n+default-branch: tip\n+command: ghostty\n+finish-args:\n+  # 3D rendering\n+  - --device=dri\n+  # Windowing\n+  - --share=ipc\n+  - --socket=fallback-x11\n+  - --socket=wayland\n+  # Allow user to specify additional config files in home by default\n+  - --filesystem=home:ro\n+  # So we can escape the sandbox\n+  - --talk-name=org.freedesktop.Flatpak\n+cleanup:\n+  - /include\n+  - /lib/girepository-1.0\n+  - /lib/pkgconfig\n+  - /share/gir-1.0\n+  - /share/pkgconfig\n+  - /share/vala\n+  - '*.la'\n+  - '*.a'\n+  - '*.so'\n+\n+modules:\n+  - name: bzip2-redirect\n+    buildsystem: simple\n+    build-commands:\n+      - install -dm755 /app/lib\n+      - echo \"INPUT(libbz2.so)\" > /app/lib/libbzip2.so",
        "comment_created_at": "2025-03-12T15:45:08+00:00",
        "comment_author": "alaviss",
        "comment_body": "It doesn't look like alternatives (e.g. try `bz2` if `bzip2` not available) are possible to me at least.",
        "pr_file_module": null
      },
      {
        "comment_id": "1991847319",
        "repo_full_name": "ghostty-org/ghostty",
        "pr_number": 6678,
        "pr_file": "flatpak/com.mitchellh.ghostty.yml",
        "discussion_id": "1991516565",
        "commented_code": "@@ -0,0 +1,113 @@\n+app-id: com.mitchellh.ghostty\n+runtime: org.gnome.Platform\n+runtime-version: \"47\"\n+sdk: org.gnome.Sdk\n+sdk-extensions:\n+  - org.freedesktop.Sdk.Extension.ziglang\n+default-branch: tip\n+command: ghostty\n+finish-args:\n+  # 3D rendering\n+  - --device=dri\n+  # Windowing\n+  - --share=ipc\n+  - --socket=fallback-x11\n+  - --socket=wayland\n+  # Allow user to specify additional config files in home by default\n+  - --filesystem=home:ro\n+  # So we can escape the sandbox\n+  - --talk-name=org.freedesktop.Flatpak\n+cleanup:\n+  - /include\n+  - /lib/girepository-1.0\n+  - /lib/pkgconfig\n+  - /share/gir-1.0\n+  - /share/pkgconfig\n+  - /share/vala\n+  - '*.la'\n+  - '*.a'\n+  - '*.so'\n+\n+modules:\n+  - name: bzip2-redirect\n+    buildsystem: simple\n+    build-commands:\n+      - install -dm755 /app/lib\n+      - echo \"INPUT(libbz2.so)\" > /app/lib/libbzip2.so",
        "comment_created_at": "2025-03-12T16:15:04+00:00",
        "comment_author": "tristan957",
        "comment_body": "Yeah I don't know enough about the Zig build system to say for sure unfortunately. Hopefully someone else can step in to assist, but linker script is still fine if it can't.",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1992362822",
    "pr_number": 6678,
    "pr_file": "flatpak/com.mitchellh.ghostty.Devel.yml",
    "created_at": "2025-03-12T22:07:11+00:00",
    "commented_code": "+app-id: com.mitchellh.ghostty.Devel\n+runtime: org.gnome.Platform\n+runtime-version: \"47\" # maybe use gnome-nightly master?",
    "repo_full_name": "ghostty-org/ghostty",
    "discussion_comments": [
      {
        "comment_id": "1992362822",
        "repo_full_name": "ghostty-org/ghostty",
        "pr_number": 6678,
        "pr_file": "flatpak/com.mitchellh.ghostty.Devel.yml",
        "discussion_id": "1992362822",
        "commented_code": "@@ -0,0 +1,63 @@\n+app-id: com.mitchellh.ghostty.Devel\n+runtime: org.gnome.Platform\n+runtime-version: \"47\" # maybe use gnome-nightly master?",
        "comment_created_at": "2025-03-12T22:07:11+00:00",
        "comment_author": "tristan957",
        "comment_body": "I'm down for this pending what @jcollie and @pluiedev think",
        "pr_file_module": null
      },
      {
        "comment_id": "1992365761",
        "repo_full_name": "ghostty-org/ghostty",
        "pr_number": 6678,
        "pr_file": "flatpak/com.mitchellh.ghostty.Devel.yml",
        "discussion_id": "1992362822",
        "commented_code": "@@ -0,0 +1,63 @@\n+app-id: com.mitchellh.ghostty.Devel\n+runtime: org.gnome.Platform\n+runtime-version: \"47\" # maybe use gnome-nightly master?",
        "comment_created_at": "2025-03-12T22:10:30+00:00",
        "comment_author": "jcollie",
        "comment_body": "Hmm, if developing Gnome/GTK were the primary object sure, but since this is about developing Ghostty we should probably stick to a released version of Gnome. 48 is very close to release so if there was like a 48-rc channel I'd be OK with that.",
        "pr_file_module": null
      },
      {
        "comment_id": "1992366517",
        "repo_full_name": "ghostty-org/ghostty",
        "pr_number": 6678,
        "pr_file": "flatpak/com.mitchellh.ghostty.Devel.yml",
        "discussion_id": "1992362822",
        "commented_code": "@@ -0,0 +1,63 @@\n+app-id: com.mitchellh.ghostty.Devel\n+runtime: org.gnome.Platform\n+runtime-version: \"47\" # maybe use gnome-nightly master?",
        "comment_created_at": "2025-03-12T22:11:20+00:00",
        "comment_author": "pluiedev",
        "comment_body": "I agree. 48-rc/beta/etc if possible, 47 otherwise",
        "pr_file_module": null
      },
      {
        "comment_id": "1992373675",
        "repo_full_name": "ghostty-org/ghostty",
        "pr_number": 6678,
        "pr_file": "flatpak/com.mitchellh.ghostty.Devel.yml",
        "discussion_id": "1992362822",
        "commented_code": "@@ -0,0 +1,63 @@\n+app-id: com.mitchellh.ghostty.Devel\n+runtime: org.gnome.Platform\n+runtime-version: \"47\" # maybe use gnome-nightly master?",
        "comment_created_at": "2025-03-12T22:18:23+00:00",
        "comment_author": "yorickpeterse",
        "comment_body": "If the goal is to reuse this manifest for Flathub, using RCs might be a problem as one wouldn't want a stable release of the Flatpak package to depend on RC/beta releases.\r\n\r\nIt might be better to just depend on a stable release and bump it every 3-6 months or something along those lines.",
        "pr_file_module": null
      },
      {
        "comment_id": "1992377997",
        "repo_full_name": "ghostty-org/ghostty",
        "pr_number": 6678,
        "pr_file": "flatpak/com.mitchellh.ghostty.Devel.yml",
        "discussion_id": "1992362822",
        "commented_code": "@@ -0,0 +1,63 @@\n+app-id: com.mitchellh.ghostty.Devel\n+runtime: org.gnome.Platform\n+runtime-version: \"47\" # maybe use gnome-nightly master?",
        "comment_created_at": "2025-03-12T22:23:50+00:00",
        "comment_author": "alaviss",
        "comment_body": "This one is a development manifest (`.Devel`), I don't think it will ever make it to Flathub.\r\n\r\nThe regular one will still use stable.\r\n\r\nI guess with the current consensus I'll remove the comment since GNOME doesn't publish rc runtimes.",
        "pr_file_module": null
      },
      {
        "comment_id": "1992379517",
        "repo_full_name": "ghostty-org/ghostty",
        "pr_number": 6678,
        "pr_file": "flatpak/com.mitchellh.ghostty.Devel.yml",
        "discussion_id": "1992362822",
        "commented_code": "@@ -0,0 +1,63 @@\n+app-id: com.mitchellh.ghostty.Devel\n+runtime: org.gnome.Platform\n+runtime-version: \"47\" # maybe use gnome-nightly master?",
        "comment_created_at": "2025-03-12T22:25:25+00:00",
        "comment_author": "yorickpeterse",
        "comment_body": "Oops, I completely missed the `.Devel` bit. Sorry for the noise! :man_facepalming: ",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1957211454",
    "pr_number": 5791,
    "pr_file": ".github/workflows/test.yml",
    "created_at": "2025-02-15T23:53:59+00:00",
    "commented_code": "- name: Test ${{ matrix.pkg }} Build\n         run: |\n           nix develop -c sh -c \"cd pkg/${{ matrix.pkg }} ; zig build test\"\n+\n+  test-debian-12:\n+    strategy:\n+      fail-fast: false\n+      matrix:\n+        platform: [\"linux/amd64\", \"linux/arm64\"]\n+    name: Test build on Debian 12 ${{ matrix.platform }}\n+    runs-on: namespace-profile-ghostty-sm\n+    needs: test\n+    steps:\n+      - name: Checkout code\n+        uses: actions/checkout@v4\n+\n+      - name: Install and configure Namespace CLI\n+        uses: namespacelabs/nscloud-setup@v0\n+\n+      - name: Configure Namespace powered Buildx\n+        uses: namespacelabs/nscloud-setup-buildx-action@v0\n+\n+      - name: Build and push\n+        uses: docker/build-push-action@v6\n+        with:\n+          context: .\n+          file: src/build/docker/debian/Dockerfile\n+          build-args: DISTRO_VERSION=12",
    "repo_full_name": "ghostty-org/ghostty",
    "discussion_comments": [
      {
        "comment_id": "1957211454",
        "repo_full_name": "ghostty-org/ghostty",
        "pr_number": 5791,
        "pr_file": ".github/workflows/test.yml",
        "discussion_id": "1957211454",
        "commented_code": "@@ -626,3 +626,29 @@ jobs:\n       - name: Test ${{ matrix.pkg }} Build\n         run: |\n           nix develop -c sh -c \"cd pkg/${{ matrix.pkg }} ; zig build test\"\n+\n+  test-debian-12:\n+    strategy:\n+      fail-fast: false\n+      matrix:\n+        platform: [\"linux/amd64\", \"linux/arm64\"]\n+    name: Test build on Debian 12 ${{ matrix.platform }}\n+    runs-on: namespace-profile-ghostty-sm\n+    needs: test\n+    steps:\n+      - name: Checkout code\n+        uses: actions/checkout@v4\n+\n+      - name: Install and configure Namespace CLI\n+        uses: namespacelabs/nscloud-setup@v0\n+\n+      - name: Configure Namespace powered Buildx\n+        uses: namespacelabs/nscloud-setup-buildx-action@v0\n+\n+      - name: Build and push\n+        uses: docker/build-push-action@v6\n+        with:\n+          context: .\n+          file: src/build/docker/debian/Dockerfile\n+          build-args: DISTRO_VERSION=12",
        "comment_created_at": "2025-02-15T23:53:59+00:00",
        "comment_author": "mitchellh",
        "comment_body": "Let's pass the Zig version in here as well and put that as a top-level workflow env. The number of places we hardcode the Zig version we use is too damn high. \r\n\r\nLonger term it'd probably be better to make a `setup` job that extracts it from our source code (eventually the build.zig.zon but we don't use that yet).",
        "pr_file_module": null
      },
      {
        "comment_id": "1957212212",
        "repo_full_name": "ghostty-org/ghostty",
        "pr_number": 5791,
        "pr_file": ".github/workflows/test.yml",
        "discussion_id": "1957211454",
        "commented_code": "@@ -626,3 +626,29 @@ jobs:\n       - name: Test ${{ matrix.pkg }} Build\n         run: |\n           nix develop -c sh -c \"cd pkg/${{ matrix.pkg }} ; zig build test\"\n+\n+  test-debian-12:\n+    strategy:\n+      fail-fast: false\n+      matrix:\n+        platform: [\"linux/amd64\", \"linux/arm64\"]\n+    name: Test build on Debian 12 ${{ matrix.platform }}\n+    runs-on: namespace-profile-ghostty-sm\n+    needs: test\n+    steps:\n+      - name: Checkout code\n+        uses: actions/checkout@v4\n+\n+      - name: Install and configure Namespace CLI\n+        uses: namespacelabs/nscloud-setup@v0\n+\n+      - name: Configure Namespace powered Buildx\n+        uses: namespacelabs/nscloud-setup-buildx-action@v0\n+\n+      - name: Build and push\n+        uses: docker/build-push-action@v6\n+        with:\n+          context: .\n+          file: src/build/docker/debian/Dockerfile\n+          build-args: DISTRO_VERSION=12",
        "comment_created_at": "2025-02-16T00:01:17+00:00",
        "comment_author": "jcollie",
        "comment_body": "Fixed.",
        "pr_file_module": null
      }
    ]
  }
]