[
  {
    "discussion_id": "2224058713",
    "pr_number": 3257,
    "pr_file": "crates/goose-cli/src/cli/main.rs",
    "created_at": "2025-07-23T00:18:38+00:00",
    "commented_code": "provider,\n             model,\n         }) => {\n+            // Check if this is a recipe execution for telemetry tracking\n+            let is_recipe_execution = recipe.is_some();\n+            let recipe_name_for_telemetry = recipe.clone().unwrap_or_default();\n+",
    "repo_full_name": "block/goose",
    "discussion_comments": [
      {
        "comment_id": "2224058713",
        "repo_full_name": "block/goose",
        "pr_number": 3257,
        "pr_file": "crates/goose-cli/src/cli/main.rs",
        "discussion_id": "2224058713",
        "commented_code": "@@ -837,6 +755,10 @@ pub async fn cli() -> Result<()> {\n             provider,\n             model,\n         }) => {\n+            // Check if this is a recipe execution for telemetry tracking\n+            let is_recipe_execution = recipe.is_some();\n+            let recipe_name_for_telemetry = recipe.clone().unwrap_or_default();\n+",
        "comment_created_at": "2025-07-23T00:18:38+00:00",
        "comment_author": "jamadeo",
        "comment_body": "still seems like you could just do `if let Some(recipe_name) = recipe` below instead of these",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2224062587",
    "pr_number": 3257,
    "pr_file": "crates/goose-cli/src/cli/main.rs",
    "created_at": "2025-07-23T00:22:32+00:00",
    "commented_code": "}\n             };\n \n-            let mut session = build_session(SessionBuilderConfig {\n-                identifier: identifier.map(extract_identifier),\n-                resume,\n-                no_session,\n-                extensions,\n-                remote_extensions,\n-                streamable_http_extensions,\n-                builtins,\n-                extensions_override: input_config.extensions_override,\n-                additional_system_prompt: input_config.additional_system_prompt,\n-                settings: recipe_info\n+            if is_recipe_execution {\n+                let recipe_version = match crate::recipes::recipe::load_recipe(\n+                    &recipe_name_for_telemetry,\n+                    params.clone(),\n+                ) {\n+                    Ok(recipe) => recipe.version,\n+                    Err(_) => \"unknown\".to_string(),\n+                };",
    "repo_full_name": "block/goose",
    "discussion_comments": [
      {
        "comment_id": "2224062587",
        "repo_full_name": "block/goose",
        "pr_number": 3257,
        "pr_file": "crates/goose-cli/src/cli/main.rs",
        "discussion_id": "2224062587",
        "commented_code": "@@ -896,51 +821,127 @@ pub async fn cli() -> Result<()> {\n                 }\n             };\n \n-            let mut session = build_session(SessionBuilderConfig {\n-                identifier: identifier.map(extract_identifier),\n-                resume,\n-                no_session,\n-                extensions,\n-                remote_extensions,\n-                streamable_http_extensions,\n-                builtins,\n-                extensions_override: input_config.extensions_override,\n-                additional_system_prompt: input_config.additional_system_prompt,\n-                settings: recipe_info\n+            if is_recipe_execution {\n+                let recipe_version = match crate::recipes::recipe::load_recipe(\n+                    &recipe_name_for_telemetry,\n+                    params.clone(),\n+                ) {\n+                    Ok(recipe) => recipe.version,\n+                    Err(_) => \"unknown\".to_string(),\n+                };",
        "comment_created_at": "2025-07-23T00:22:32+00:00",
        "comment_author": "jamadeo",
        "comment_body": "could do\n\n.map(|r| r.version).unwrap_or(\"unknown\".to_string())",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2219923705",
    "pr_number": 3554,
    "pr_file": "crates/goose/src/agents/agent.rs",
    "created_at": "2025-07-21T18:15:18+00:00",
    "commented_code": "break;\n                 }\n \n-                // Check for MCP notifications from subagents\n+                if let Some(token) = &cancel_token {\n+                    if token.is_cancelled() {",
    "repo_full_name": "block/goose",
    "discussion_comments": [
      {
        "comment_id": "2219923705",
        "repo_full_name": "block/goose",
        "pr_number": 3554,
        "pr_file": "crates/goose/src/agents/agent.rs",
        "discussion_id": "2219923705",
        "commented_code": "@@ -749,45 +716,63 @@ impl Agent {\n                     break;\n                 }\n \n-                // Check for MCP notifications from subagents\n+                if let Some(token) = &cancel_token {\n+                    if token.is_cancelled() {",
        "comment_created_at": "2025-07-21T18:15:18+00:00",
        "comment_author": "jamadeo",
        "comment_body": "can this be\n\n`cancel_token.is_some_and(|token| token.is_cancelled())`\n\n?",
        "pr_file_module": null
      },
      {
        "comment_id": "2220041181",
        "repo_full_name": "block/goose",
        "pr_number": 3554,
        "pr_file": "crates/goose/src/agents/agent.rs",
        "discussion_id": "2219923705",
        "commented_code": "@@ -749,45 +716,63 @@ impl Agent {\n                     break;\n                 }\n \n-                // Check for MCP notifications from subagents\n+                if let Some(token) = &cancel_token {\n+                    if token.is_cancelled() {",
        "comment_created_at": "2025-07-21T19:17:37+00:00",
        "comment_author": "DOsinga",
        "comment_body": "the AIs say you need an `as_ref()` in there still ",
        "pr_file_module": null
      }
    ]
  }
]