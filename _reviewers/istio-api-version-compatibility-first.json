[
  {
    "discussion_id": "1029904372",
    "pr_number": 42042,
    "pr_file": "pilot/pkg/security/authz/builder/testdata/http/allow-empty-rule-in.yaml",
    "created_at": "2022-11-22T23:17:59+00:00",
    "commented_code": "-apiVersion: security.istio.io/v1beta1\n+apiVersion: security.istio.io/v1",
    "repo_full_name": "istio/istio",
    "discussion_comments": [
      {
        "comment_id": "1029904372",
        "repo_full_name": "istio/istio",
        "pr_number": 42042,
        "pr_file": "pilot/pkg/security/authz/builder/testdata/http/allow-empty-rule-in.yaml",
        "discussion_id": "1029904372",
        "commented_code": "@@ -1,4 +1,4 @@\n-apiVersion: security.istio.io/v1beta1\n+apiVersion: security.istio.io/v1",
        "comment_created_at": "2022-11-22T23:17:59+00:00",
        "comment_author": "howardjohn",
        "comment_body": "These don't need to change; current prior art from networking is to use the oldest version everywhere (its strictly better - same schema but more compatible, and requires no noise from changing a bunch of files)",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "824269289",
    "pr_number": 37872,
    "pr_file": "manifests/charts/gateways/istio-egress/templates/autoscale.yaml",
    "created_at": "2022-03-10T23:38:24+00:00",
    "commented_code": "{{ $gateway := index .Values \"gateways\" \"istio-egressgateway\" }}\n {{- if and $gateway.autoscaleEnabled $gateway.autoscaleMin $gateway.autoscaleMax }}\n-apiVersion: autoscaling/v2beta1\n+apiVersion: autoscaling/v2beta2",
    "repo_full_name": "istio/istio",
    "discussion_comments": [
      {
        "comment_id": "824269289",
        "repo_full_name": "istio/istio",
        "pr_number": 37872,
        "pr_file": "manifests/charts/gateways/istio-egress/templates/autoscale.yaml",
        "discussion_id": "824269289",
        "commented_code": "@@ -1,6 +1,6 @@\n {{ $gateway := index .Values \"gateways\" \"istio-egressgateway\" }}\n {{- if and $gateway.autoscaleEnabled $gateway.autoscaleMin $gateway.autoscaleMax }}\n-apiVersion: autoscaling/v2beta1\n+apiVersion: autoscaling/v2beta2",
        "comment_created_at": "2022-03-10T23:38:24+00:00",
        "comment_author": "howardjohn",
        "comment_body": "v2beta2 just pushes us back 1 release to 1.26. So we may need to have support for v2beta2 and v2 unfortunately... Or just v2beta1 and v2 possibly. See https://kubernetes.io/docs/reference/using-api/deprecation-guide/#horizontalpodautoscaler-v126",
        "pr_file_module": null
      },
      {
        "comment_id": "824269442",
        "repo_full_name": "istio/istio",
        "pr_number": 37872,
        "pr_file": "manifests/charts/gateways/istio-egress/templates/autoscale.yaml",
        "discussion_id": "824269289",
        "commented_code": "@@ -1,6 +1,6 @@\n {{ $gateway := index .Values \"gateways\" \"istio-egressgateway\" }}\n {{- if and $gateway.autoscaleEnabled $gateway.autoscaleMin $gateway.autoscaleMax }}\n-apiVersion: autoscaling/v2beta1\n+apiVersion: autoscaling/v2beta2",
        "comment_created_at": "2022-03-10T23:38:40+00:00",
        "comment_author": "howardjohn",
        "comment_body": "Which can just be a simple `if` in the api version I think - the schema is probably the same",
        "pr_file_module": null
      },
      {
        "comment_id": "824309995",
        "repo_full_name": "istio/istio",
        "pr_number": 37872,
        "pr_file": "manifests/charts/gateways/istio-egress/templates/autoscale.yaml",
        "discussion_id": "824269289",
        "commented_code": "@@ -1,6 +1,6 @@\n {{ $gateway := index .Values \"gateways\" \"istio-egressgateway\" }}\n {{- if and $gateway.autoscaleEnabled $gateway.autoscaleMin $gateway.autoscaleMax }}\n-apiVersion: autoscaling/v2beta1\n+apiVersion: autoscaling/v2beta2",
        "comment_created_at": "2022-03-11T01:16:56+00:00",
        "comment_author": "richardwxn",
        "comment_body": "yep I think the schema is the same between v2beta2 and v2 ",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "854612616",
    "pr_number": 37872,
    "pr_file": "manifests/addons/values-kiali.yaml",
    "created_at": "2022-04-20T22:31:47+00:00",
    "commented_code": "accessible_namespaces:\n   - '**'\n   ingress_enabled: false\n+  hpa:\n+    api_version: autoscaling/v2",
    "repo_full_name": "istio/istio",
    "discussion_comments": [
      {
        "comment_id": "854612616",
        "repo_full_name": "istio/istio",
        "pr_number": 37872,
        "pr_file": "manifests/addons/values-kiali.yaml",
        "discussion_id": "854612616",
        "commented_code": "@@ -7,5 +7,7 @@ deployment:\n   accessible_namespaces:\n   - '**'\n   ingress_enabled: false\n+  hpa:\n+    api_version: autoscaling/v2",
        "comment_created_at": "2022-04-20T22:31:47+00:00",
        "comment_author": "howardjohn",
        "comment_body": "This one is a bit trickier since it ends up as plain YAML.. but this will break users. Maybe we should be more conservative for now and use v2beta2 for a bit here?",
        "pr_file_module": null
      },
      {
        "comment_id": "863268267",
        "repo_full_name": "istio/istio",
        "pr_number": 37872,
        "pr_file": "manifests/addons/values-kiali.yaml",
        "discussion_id": "854612616",
        "commented_code": "@@ -7,5 +7,7 @@ deployment:\n   accessible_namespaces:\n   - '**'\n   ingress_enabled: false\n+  hpa:\n+    api_version: autoscaling/v2",
        "comment_created_at": "2022-05-03T00:01:49+00:00",
        "comment_author": "richardwxn",
        "comment_body": "done",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "864007197",
    "pr_number": 37872,
    "pr_file": "manifests/charts/gateways/istio-egress/templates/autoscale.yaml",
    "created_at": "2022-05-03T17:19:24+00:00",
    "commented_code": "{{ $gateway := index .Values \"gateways\" \"istio-egressgateway\" }}\n {{- if and $gateway.autoscaleEnabled $gateway.autoscaleMin $gateway.autoscaleMax }}\n-apiVersion: autoscaling/v2beta1\n+{{- if and .Values.global.autoscalingv2API (semverCompare \">=1.23-0\" .Capabilities.KubeVersion.GitVersion)}}\n+apiVersion: autoscaling/v2",
    "repo_full_name": "istio/istio",
    "discussion_comments": [
      {
        "comment_id": "864007197",
        "repo_full_name": "istio/istio",
        "pr_number": 37872,
        "pr_file": "manifests/charts/gateways/istio-egress/templates/autoscale.yaml",
        "discussion_id": "864007197",
        "commented_code": "@@ -1,6 +1,7 @@\n {{ $gateway := index .Values \"gateways\" \"istio-egressgateway\" }}\n {{- if and $gateway.autoscaleEnabled $gateway.autoscaleMin $gateway.autoscaleMax }}\n-apiVersion: autoscaling/v2beta1\n+{{- if and .Values.global.autoscalingv2API (semverCompare \">=1.23-0\" .Capabilities.KubeVersion.GitVersion)}}\n+apiVersion: autoscaling/v2",
        "comment_created_at": "2022-05-03T17:19:24+00:00",
        "comment_author": "howardjohn",
        "comment_body": "I think we still need the v2beta2 option?\r\n\r\n* v2beta1: using legacy IOP config. Never used for helm (unless they touch the internal autoscalingv2API flag, but they shouldn't\r\n* v2beta2: anyone else on <1.23\r\n* v2: anyone else >=1.23",
        "pr_file_module": null
      },
      {
        "comment_id": "864289195",
        "repo_full_name": "istio/istio",
        "pr_number": 37872,
        "pr_file": "manifests/charts/gateways/istio-egress/templates/autoscale.yaml",
        "discussion_id": "864007197",
        "commented_code": "@@ -1,6 +1,7 @@\n {{ $gateway := index .Values \"gateways\" \"istio-egressgateway\" }}\n {{- if and $gateway.autoscaleEnabled $gateway.autoscaleMin $gateway.autoscaleMax }}\n-apiVersion: autoscaling/v2beta1\n+{{- if and .Values.global.autoscalingv2API (semverCompare \">=1.23-0\" .Capabilities.KubeVersion.GitVersion)}}\n+apiVersion: autoscaling/v2",
        "comment_created_at": "2022-05-03T21:52:58+00:00",
        "comment_author": "richardwxn",
        "comment_body": "My original thought was to combine case1 and 2 together, so only if  >=1.23 and not using legacy IOP config would be v2, others are v2beta1.\r\n\r\nBut what you suggest works too, we already need v2beta2 for helm, so 3 versions are needed anyways.  v2beta1 is going to be removed in 1.25 while v2beta2 for 1.26, so the latter slightly better, giving user one more release to migrate",
        "pr_file_module": null
      }
    ]
  }
]