[
  {
    "discussion_id": "1662591461",
    "pr_number": 51792,
    "pr_file": "releasenotes/notes/remove-pilot-tracing.yaml",
    "created_at": "2024-07-02T13:58:59+00:00",
    "commented_code": "+apiVersion: release-notes/v2\n+kind: feature\n+area: telemetry\n+releaseNotes:\n+  - |\n+    **Removed** pilot flag `PILOT_TRACE_SAMPLING`.\n+\n+upgradeNotes:\n+  - title: Removed pilot flag `PILOT_TRACE_SAMPLING` supported in Istio.\n+    content: |\n+      If you are using the pilot environment flag `PILOT_TRACE_SAMPLING`, you should\n+      replace it with `defaultConfig.tracing.sampling` in the [MeshConfig](https://istio.io/latest/docs/reference/config/istio.mesh.v1alpha1/#ProxyConfig)\n+      or `randomSamplingPercentage`in [Telemetry API](https://istio.io/latest/docs/reference/config/telemetry/).",
    "repo_full_name": "istio/istio",
    "discussion_comments": [
      {
        "comment_id": "1662591461",
        "repo_full_name": "istio/istio",
        "pr_number": 51792,
        "pr_file": "releasenotes/notes/remove-pilot-tracing.yaml",
        "discussion_id": "1662591461",
        "commented_code": "@@ -0,0 +1,13 @@\n+apiVersion: release-notes/v2\n+kind: feature\n+area: telemetry\n+releaseNotes:\n+  - |\n+    **Removed** pilot flag `PILOT_TRACE_SAMPLING`.\n+\n+upgradeNotes:\n+  - title: Removed pilot flag `PILOT_TRACE_SAMPLING` supported in Istio.\n+    content: |\n+      If you are using the pilot environment flag `PILOT_TRACE_SAMPLING`, you should\n+      replace it with `defaultConfig.tracing.sampling` in the [MeshConfig](https://istio.io/latest/docs/reference/config/istio.mesh.v1alpha1/#ProxyConfig)\n+      or `randomSamplingPercentage`in [Telemetry API](https://istio.io/latest/docs/reference/config/telemetry/).",
        "comment_created_at": "2024-07-02T13:58:59+00:00",
        "comment_author": "costinm",
        "comment_body": "- I don't see any code using Telemetry API to program Istiod itself. \r\n- TelemetryAPI is based on label selectors - Istiod can be external or run in another managed environment \r\n- The MeshConfig.tracing.sampling is supposed to be replaced by Telemetry API for sidecars - I don't think we should provide multiple options, we already have too many. If you want to use Telemetry API - we should just tell users to use the v1 API, not the alpha legacy one.\r\n-  also the needs/expectations for Istiod are quite different from the 'default for all envoys in the mesh'\r\n\r\nIMO we should just use the env variables defined by OTel - they are considered stable and that's how users expect to configure any app using the OTel SDK. \r\n\r\nTelemetry API would be the right thing to use for HTTP/gRPC straces - if Istiod was behind a Waypoint or Gateway. I am trying to bring back that mode ( I had a very old PR), Istiod is the perfect user of ambient and/or having a Gatweay in front, that would take care of this kind of tracing - but we still have the 'native' tracing using the SDK.",
        "pr_file_module": null
      },
      {
        "comment_id": "1662597309",
        "repo_full_name": "istio/istio",
        "pr_number": 51792,
        "pr_file": "releasenotes/notes/remove-pilot-tracing.yaml",
        "discussion_id": "1662591461",
        "commented_code": "@@ -0,0 +1,13 @@\n+apiVersion: release-notes/v2\n+kind: feature\n+area: telemetry\n+releaseNotes:\n+  - |\n+    **Removed** pilot flag `PILOT_TRACE_SAMPLING`.\n+\n+upgradeNotes:\n+  - title: Removed pilot flag `PILOT_TRACE_SAMPLING` supported in Istio.\n+    content: |\n+      If you are using the pilot environment flag `PILOT_TRACE_SAMPLING`, you should\n+      replace it with `defaultConfig.tracing.sampling` in the [MeshConfig](https://istio.io/latest/docs/reference/config/istio.mesh.v1alpha1/#ProxyConfig)\n+      or `randomSamplingPercentage`in [Telemetry API](https://istio.io/latest/docs/reference/config/telemetry/).",
        "comment_created_at": "2024-07-02T14:02:26+00:00",
        "comment_author": "howardjohn",
        "comment_body": "> I don't see any code using Telemetry API to program Istiod itself.\r\n\r\n`PILOT_TRACE_SAMPLING` is not about programming Istiod-internal traces, its about setting the trace sampling for Envoys.",
        "pr_file_module": null
      },
      {
        "comment_id": "1663233926",
        "repo_full_name": "istio/istio",
        "pr_number": 51792,
        "pr_file": "releasenotes/notes/remove-pilot-tracing.yaml",
        "discussion_id": "1662591461",
        "commented_code": "@@ -0,0 +1,13 @@\n+apiVersion: release-notes/v2\n+kind: feature\n+area: telemetry\n+releaseNotes:\n+  - |\n+    **Removed** pilot flag `PILOT_TRACE_SAMPLING`.\n+\n+upgradeNotes:\n+  - title: Removed pilot flag `PILOT_TRACE_SAMPLING` supported in Istio.\n+    content: |\n+      If you are using the pilot environment flag `PILOT_TRACE_SAMPLING`, you should\n+      replace it with `defaultConfig.tracing.sampling` in the [MeshConfig](https://istio.io/latest/docs/reference/config/istio.mesh.v1alpha1/#ProxyConfig)\n+      or `randomSamplingPercentage`in [Telemetry API](https://istio.io/latest/docs/reference/config/telemetry/).",
        "comment_created_at": "2024-07-02T22:31:42+00:00",
        "comment_author": "zirain",
        "comment_body": "The name is misleading, I need to pause every time I read this code. ",
        "pr_file_module": null
      },
      {
        "comment_id": "1664469431",
        "repo_full_name": "istio/istio",
        "pr_number": 51792,
        "pr_file": "releasenotes/notes/remove-pilot-tracing.yaml",
        "discussion_id": "1662591461",
        "commented_code": "@@ -0,0 +1,13 @@\n+apiVersion: release-notes/v2\n+kind: feature\n+area: telemetry\n+releaseNotes:\n+  - |\n+    **Removed** pilot flag `PILOT_TRACE_SAMPLING`.\n+\n+upgradeNotes:\n+  - title: Removed pilot flag `PILOT_TRACE_SAMPLING` supported in Istio.\n+    content: |\n+      If you are using the pilot environment flag `PILOT_TRACE_SAMPLING`, you should\n+      replace it with `defaultConfig.tracing.sampling` in the [MeshConfig](https://istio.io/latest/docs/reference/config/istio.mesh.v1alpha1/#ProxyConfig)\n+      or `randomSamplingPercentage`in [Telemetry API](https://istio.io/latest/docs/reference/config/telemetry/).",
        "comment_created_at": "2024-07-03T16:32:03+00:00",
        "comment_author": "costinm",
        "comment_body": "I don't know why I am even surprised by this after spending days trying to figure out the cert signing interfaces...\r\n\r\nCan you put in some comment \"for setting pilot tracing, we are using XXX ( or link to some doc - I remember John added OTLP tracing for pilot but forgot how to set it up...)\" - and in the release note just mention the v1 telemetry API ( not mesh config )",
        "pr_file_module": null
      },
      {
        "comment_id": "1664886219",
        "repo_full_name": "istio/istio",
        "pr_number": 51792,
        "pr_file": "releasenotes/notes/remove-pilot-tracing.yaml",
        "discussion_id": "1662591461",
        "commented_code": "@@ -0,0 +1,13 @@\n+apiVersion: release-notes/v2\n+kind: feature\n+area: telemetry\n+releaseNotes:\n+  - |\n+    **Removed** pilot flag `PILOT_TRACE_SAMPLING`.\n+\n+upgradeNotes:\n+  - title: Removed pilot flag `PILOT_TRACE_SAMPLING` supported in Istio.\n+    content: |\n+      If you are using the pilot environment flag `PILOT_TRACE_SAMPLING`, you should\n+      replace it with `defaultConfig.tracing.sampling` in the [MeshConfig](https://istio.io/latest/docs/reference/config/istio.mesh.v1alpha1/#ProxyConfig)\n+      or `randomSamplingPercentage`in [Telemetry API](https://istio.io/latest/docs/reference/config/telemetry/).",
        "comment_created_at": "2024-07-03T22:44:40+00:00",
        "comment_author": "zirain",
        "comment_body": "Let me try to find out thing about OTLP tracing for pilot(I never know about it).\r\n\r\nmeshconfig is still useful when users use defaultProviers only(without Telemetry resource).",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2016641827",
    "pr_number": 55676,
    "pr_file": "releasenotes/notes/55676.yaml",
    "created_at": "2025-03-27T13:39:59+00:00",
    "commented_code": "+apiVersion: release-notes/v2\n+kind: bug-fix\n+area: telemetry\n+issues:\n+  - 55637\n+releaseNotes:\n+  - |\n+    **Added** an environment variable `PILOT_SPAWN_UPSTREAM_SPAN_FOR_GATEWAY` for reporting both server and client span for gateway.",
    "repo_full_name": "istio/istio",
    "discussion_comments": [
      {
        "comment_id": "2016641827",
        "repo_full_name": "istio/istio",
        "pr_number": 55676,
        "pr_file": "releasenotes/notes/55676.yaml",
        "discussion_id": "2016641827",
        "commented_code": "@@ -0,0 +1,8 @@\n+apiVersion: release-notes/v2\n+kind: bug-fix\n+area: telemetry\n+issues:\n+  - 55637\n+releaseNotes:\n+  - |\n+    **Added** an environment variable `PILOT_SPAWN_UPSTREAM_SPAN_FOR_GATEWAY` for reporting both server and client span for gateway.",
        "comment_created_at": "2025-03-27T13:39:59+00:00",
        "comment_author": "dhawton",
        "comment_body": "```suggestion\r\n  - **Added** environment variable `PILOT_SPAWN_UPSTREAM_SPAN_FOR_GATEWAY`, which separates tracing span for both server and client gateways. This currently defaults to false but will become default in the future.\r\n```",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1467094242",
    "pr_number": 48833,
    "pr_file": "releasenotes/notes/48833.yaml",
    "created_at": "2024-01-26T00:03:29+00:00",
    "commented_code": "+apiVersion: release-notes/v2\n+kind: feature\n+area: telemetry\n+releaseNotes:\n+  - |\n+    **Added** support for disable bootstrap tracing configuration, this feature is disabled by default and can be\n+    enabled by setting the `DISABLE_BOOTSTRAP_TRACING` environment variable in istiod and proxy.",
    "repo_full_name": "istio/istio",
    "discussion_comments": [
      {
        "comment_id": "1467094242",
        "repo_full_name": "istio/istio",
        "pr_number": 48833,
        "pr_file": "releasenotes/notes/48833.yaml",
        "discussion_id": "1467094242",
        "commented_code": "@@ -0,0 +1,7 @@\n+apiVersion: release-notes/v2\n+kind: feature\n+area: telemetry\n+releaseNotes:\n+  - |\n+    **Added** support for disable bootstrap tracing configuration, this feature is disabled by default and can be\n+    enabled by setting the `DISABLE_BOOTSTRAP_TRACING` environment variable in istiod and proxy.",
        "comment_created_at": "2024-01-26T00:03:29+00:00",
        "comment_author": "linsun",
        "comment_body": "Add a reason why someone would want to do it?",
        "pr_file_module": null
      },
      {
        "comment_id": "1467116533",
        "repo_full_name": "istio/istio",
        "pr_number": 48833,
        "pr_file": "releasenotes/notes/48833.yaml",
        "discussion_id": "1467094242",
        "commented_code": "@@ -0,0 +1,7 @@\n+apiVersion: release-notes/v2\n+kind: feature\n+area: telemetry\n+releaseNotes:\n+  - |\n+    **Added** support for disable bootstrap tracing configuration, this feature is disabled by default and can be\n+    enabled by setting the `DISABLE_BOOTSTRAP_TRACING` environment variable in istiod and proxy.",
        "comment_created_at": "2024-01-26T00:36:03+00:00",
        "comment_author": "kyessenov",
        "comment_body": "The main reason is that you don't have to restart proxies to change tracing.",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1416119312",
    "pr_number": 47892,
    "pr_file": "manifests/charts/istio-control/istio-discovery/templates/telemetryv2_1.21.yaml",
    "created_at": "2023-12-05T18:30:15+00:00",
    "commented_code": "-{{- if and .Values.telemetry.enabled .Values.telemetry.v2.enabled }}\n-{{ $customProm := not (include \"default-prometheus\" . | eq \"true\") }}\n-{{ $customSdMetrics := not (include \"default-sd-metrics\" . | eq \"true\") }}\n-{{ $customSdLogs := not (include \"default-sd-logs\" . | eq \"true\") }}\n----\n-# Note: http stats filter is wasm enabled only in sidecars.\n-{{- if and .Values.telemetry.v2.prometheus.enabled $customProm }}\n-apiVersion: networking.istio.io/v1alpha3\n-kind: EnvoyFilter\n-metadata:\n-  name: stats-filter-1.21{{- if not (eq .Values.revision \"\") }}-{{ .Values.revision }}{{- end }}\n-  {{- if .Values.meshConfig.rootNamespace }}\n-  namespace: {{ .Values.meshConfig.rootNamespace }}\n-  {{- else }}\n-  namespace: {{ .Release.Namespace }}\n-  {{- end }}\n-  labels:\n-    istio.io/rev: {{ .Values.revision | default \"default\" }}\n-spec:\n-  priority: -1\n-  configPatches:\n-    - applyTo: HTTP_FILTER\n-      match:\n-        context: SIDECAR_OUTBOUND\n-        proxy:\n-          proxyVersion: '^1\\.21.*'\n-        listener:\n-          filterChain:\n-            filter:\n-              name: \"envoy.filters.network.http_connection_manager\"\n-              subFilter:\n-                name: \"envoy.filters.http.router\"\n-      patch:\n-        operation: INSERT_BEFORE\n-        value:\n-          name: istio.stats",
    "repo_full_name": "istio/istio",
    "discussion_comments": [
      {
        "comment_id": "1416119312",
        "repo_full_name": "istio/istio",
        "pr_number": 47892,
        "pr_file": "manifests/charts/istio-control/istio-discovery/templates/telemetryv2_1.21.yaml",
        "discussion_id": "1416119312",
        "commented_code": "@@ -1,486 +0,0 @@\n-{{- if and .Values.telemetry.enabled .Values.telemetry.v2.enabled }}\n-{{ $customProm := not (include \"default-prometheus\" . | eq \"true\") }}\n-{{ $customSdMetrics := not (include \"default-sd-metrics\" . | eq \"true\") }}\n-{{ $customSdLogs := not (include \"default-sd-logs\" . | eq \"true\") }}\n----\n-# Note: http stats filter is wasm enabled only in sidecars.\n-{{- if and .Values.telemetry.v2.prometheus.enabled $customProm }}\n-apiVersion: networking.istio.io/v1alpha3\n-kind: EnvoyFilter\n-metadata:\n-  name: stats-filter-1.21{{- if not (eq .Values.revision \"\") }}-{{ .Values.revision }}{{- end }}\n-  {{- if .Values.meshConfig.rootNamespace }}\n-  namespace: {{ .Values.meshConfig.rootNamespace }}\n-  {{- else }}\n-  namespace: {{ .Release.Namespace }}\n-  {{- end }}\n-  labels:\n-    istio.io/rev: {{ .Values.revision | default \"default\" }}\n-spec:\n-  priority: -1\n-  configPatches:\n-    - applyTo: HTTP_FILTER\n-      match:\n-        context: SIDECAR_OUTBOUND\n-        proxy:\n-          proxyVersion: '^1\\.21.*'\n-        listener:\n-          filterChain:\n-            filter:\n-              name: \"envoy.filters.network.http_connection_manager\"\n-              subFilter:\n-                name: \"envoy.filters.http.router\"\n-      patch:\n-        operation: INSERT_BEFORE\n-        value:\n-          name: istio.stats",
        "comment_created_at": "2023-12-05T18:30:15+00:00",
        "comment_author": "lei-tang",
        "comment_body": "The EnvoyFilters in this file adds istio.stats and istio.stackdriver filters to sidecar and gateway. With this file removed, how are these filters added? Are they added by Istio telemetry API, or some other mechanisms?\r\nAre there changes to UX?  ",
        "pr_file_module": null
      },
      {
        "comment_id": "1416122967",
        "repo_full_name": "istio/istio",
        "pr_number": 47892,
        "pr_file": "manifests/charts/istio-control/istio-discovery/templates/telemetryv2_1.21.yaml",
        "discussion_id": "1416119312",
        "commented_code": "@@ -1,486 +0,0 @@\n-{{- if and .Values.telemetry.enabled .Values.telemetry.v2.enabled }}\n-{{ $customProm := not (include \"default-prometheus\" . | eq \"true\") }}\n-{{ $customSdMetrics := not (include \"default-sd-metrics\" . | eq \"true\") }}\n-{{ $customSdLogs := not (include \"default-sd-logs\" . | eq \"true\") }}\n----\n-# Note: http stats filter is wasm enabled only in sidecars.\n-{{- if and .Values.telemetry.v2.prometheus.enabled $customProm }}\n-apiVersion: networking.istio.io/v1alpha3\n-kind: EnvoyFilter\n-metadata:\n-  name: stats-filter-1.21{{- if not (eq .Values.revision \"\") }}-{{ .Values.revision }}{{- end }}\n-  {{- if .Values.meshConfig.rootNamespace }}\n-  namespace: {{ .Values.meshConfig.rootNamespace }}\n-  {{- else }}\n-  namespace: {{ .Release.Namespace }}\n-  {{- end }}\n-  labels:\n-    istio.io/rev: {{ .Values.revision | default \"default\" }}\n-spec:\n-  priority: -1\n-  configPatches:\n-    - applyTo: HTTP_FILTER\n-      match:\n-        context: SIDECAR_OUTBOUND\n-        proxy:\n-          proxyVersion: '^1\\.21.*'\n-        listener:\n-          filterChain:\n-            filter:\n-              name: \"envoy.filters.network.http_connection_manager\"\n-              subFilter:\n-                name: \"envoy.filters.http.router\"\n-      patch:\n-        operation: INSERT_BEFORE\n-        value:\n-          name: istio.stats",
        "comment_created_at": "2023-12-05T18:32:59+00:00",
        "comment_author": "howardjohn",
        "comment_body": "These EnvoyFilters were already unused in 99% of scenarios and instead set via https://github.com/istio/istio/blob/cd981f42ba33497af1e5ec7b596838295e7f5355/manifests/charts/istio-control/istio-discovery/templates/configmap.yaml#L24 since 1.18. (fwiw on our MCP product, this has been the case since launch)\r\n\r\nThere is no change to behavior for almost all users. For the very very few users using audit log or access log policy (as discussed in the other thread), there is a slightly different enablement mechanism; the docs will be updated for this.",
        "pr_file_module": null
      }
    ]
  }
]