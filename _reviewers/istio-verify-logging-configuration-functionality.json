[
  {
    "discussion_id": "1414398861",
    "pr_number": 48132,
    "pr_file": "tests/integration/telemetry/stackdriver/testdata/security_authz_dry_run/server_access_log_allow_no_policy.json.tmpl",
    "created_at": "2023-12-04T19:38:02+00:00",
    "commented_code": "\"source_namespace\": \"{{ .EchoNamespace }}\",\n       \"destination_service_name\": \"srv\",\n       \"destination_version\": \"v1\",\n-      \"log_sampled\": \"true\",\n+      \"log_sampled\": \"false\",",
    "repo_full_name": "istio/istio",
    "discussion_comments": [
      {
        "comment_id": "1414398861",
        "repo_full_name": "istio/istio",
        "pr_number": 48132,
        "pr_file": "tests/integration/telemetry/stackdriver/testdata/security_authz_dry_run/server_access_log_allow_no_policy.json.tmpl",
        "discussion_id": "1414398861",
        "commented_code": "@@ -19,7 +19,7 @@\n       \"source_namespace\": \"{{ .EchoNamespace }}\",\n       \"destination_service_name\": \"srv\",\n       \"destination_version\": \"v1\",\n-      \"log_sampled\": \"true\",\n+      \"log_sampled\": \"false\",",
        "comment_created_at": "2023-12-04T19:38:02+00:00",
        "comment_author": "kyessenov",
        "comment_body": "What's the reason for the change in value here?",
        "pr_file_module": null
      },
      {
        "comment_id": "1414442086",
        "repo_full_name": "istio/istio",
        "pr_number": 48132,
        "pr_file": "tests/integration/telemetry/stackdriver/testdata/security_authz_dry_run/server_access_log_allow_no_policy.json.tmpl",
        "discussion_id": "1414398861",
        "commented_code": "@@ -19,7 +19,7 @@\n       \"source_namespace\": \"{{ .EchoNamespace }}\",\n       \"destination_service_name\": \"srv\",\n       \"destination_version\": \"v1\",\n-      \"log_sampled\": \"true\",\n+      \"log_sampled\": \"false\",",
        "comment_created_at": "2023-12-04T20:19:41+00:00",
        "comment_author": "howardjohn",
        "comment_body": "This is a part of the removal of the \"access logging policy\". I discussed this briefly with you on chat.\r\n\r\nI don't see any real purpose for this field/filter. We just set this field, its not _actually_ sampled as far as I can tell -- the `log_sampled=false` requests still go to the real SD backend(!).\r\n\r\nIf we do want it still, we can add it as an environment var like we did with the AUDIT mode, but it doesn't seem useful. From my (imperfect) research, it has no usage, nor can I come up with even theoretical ideas on how it could be useful.",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1409966215",
    "pr_number": 47892,
    "pr_file": "tests/integration/telemetry/stackdriver/testdata/server_access_log.json.tmpl",
    "created_at": "2023-11-29T22:56:43+00:00",
    "commented_code": "\"source_version\": \"v1\",\n         \"source_workload\": \"clt-{{ .ClusterName }}-v1\",\n         \"protocol\": \"grpc\",\n-        \"log_sampled\": \"true\",\n+        \"log_sampled\": \"false\",",
    "repo_full_name": "istio/istio",
    "discussion_comments": [
      {
        "comment_id": "1409966215",
        "repo_full_name": "istio/istio",
        "pr_number": 47892,
        "pr_file": "tests/integration/telemetry/stackdriver/testdata/server_access_log.json.tmpl",
        "discussion_id": "1409966215",
        "commented_code": "@@ -26,7 +26,7 @@\n         \"source_version\": \"v1\",\n         \"source_workload\": \"clt-{{ .ClusterName }}-v1\",\n         \"protocol\": \"grpc\",\n-        \"log_sampled\": \"true\",\n+        \"log_sampled\": \"false\",",
        "comment_created_at": "2023-11-29T22:56:43+00:00",
        "comment_author": "howardjohn",
        "comment_body": "this is from removal of \"access log policy\"",
        "pr_file_module": null
      },
      {
        "comment_id": "1414691711",
        "repo_full_name": "istio/istio",
        "pr_number": 47892,
        "pr_file": "tests/integration/telemetry/stackdriver/testdata/server_access_log.json.tmpl",
        "discussion_id": "1409966215",
        "commented_code": "@@ -26,7 +26,7 @@\n         \"source_version\": \"v1\",\n         \"source_workload\": \"clt-{{ .ClusterName }}-v1\",\n         \"protocol\": \"grpc\",\n-        \"log_sampled\": \"true\",\n+        \"log_sampled\": \"false\",",
        "comment_created_at": "2023-12-05T00:24:10+00:00",
        "comment_author": "kyessenov",
        "comment_body": "Does ASM use this setting? We need some coverage - but not sure if this is tested here or elsewhere.",
        "pr_file_module": null
      },
      {
        "comment_id": "1414692975",
        "repo_full_name": "istio/istio",
        "pr_number": 47892,
        "pr_file": "tests/integration/telemetry/stackdriver/testdata/server_access_log.json.tmpl",
        "discussion_id": "1409966215",
        "commented_code": "@@ -26,7 +26,7 @@\n         \"source_version\": \"v1\",\n         \"source_workload\": \"clt-{{ .ClusterName }}-v1\",\n         \"protocol\": \"grpc\",\n-        \"log_sampled\": \"true\",\n+        \"log_sampled\": \"false\",",
        "comment_created_at": "2023-12-05T00:26:20+00:00",
        "comment_author": "howardjohn",
        "comment_body": "There's no docs, and it's impossible to use on MCP. I don't think there's any usage based on ~15min of digging",
        "pr_file_module": null
      },
      {
        "comment_id": "1414693151",
        "repo_full_name": "istio/istio",
        "pr_number": 47892,
        "pr_file": "tests/integration/telemetry/stackdriver/testdata/server_access_log.json.tmpl",
        "discussion_id": "1409966215",
        "commented_code": "@@ -26,7 +26,7 @@\n         \"source_version\": \"v1\",\n         \"source_workload\": \"clt-{{ .ClusterName }}-v1\",\n         \"protocol\": \"grpc\",\n-        \"log_sampled\": \"true\",\n+        \"log_sampled\": \"false\",",
        "comment_created_at": "2023-12-05T00:26:37+00:00",
        "comment_author": "howardjohn",
        "comment_body": "Seems like a half baked featured that was never completed from what I can tell ",
        "pr_file_module": null
      },
      {
        "comment_id": "1414693696",
        "repo_full_name": "istio/istio",
        "pr_number": 47892,
        "pr_file": "tests/integration/telemetry/stackdriver/testdata/server_access_log.json.tmpl",
        "discussion_id": "1409966215",
        "commented_code": "@@ -26,7 +26,7 @@\n         \"source_version\": \"v1\",\n         \"source_workload\": \"clt-{{ .ClusterName }}-v1\",\n         \"protocol\": \"grpc\",\n-        \"log_sampled\": \"true\",\n+        \"log_sampled\": \"false\",",
        "comment_created_at": "2023-12-05T00:27:37+00:00",
        "comment_author": "kyessenov",
        "comment_body": "@lei-tang can you confirm? this has a high potential of a surprise bill if it's used and we miss it.",
        "pr_file_module": null
      },
      {
        "comment_id": "1414694537",
        "repo_full_name": "istio/istio",
        "pr_number": 47892,
        "pr_file": "tests/integration/telemetry/stackdriver/testdata/server_access_log.json.tmpl",
        "discussion_id": "1409966215",
        "commented_code": "@@ -26,7 +26,7 @@\n         \"source_version\": \"v1\",\n         \"source_workload\": \"clt-{{ .ClusterName }}-v1\",\n         \"protocol\": \"grpc\",\n-        \"log_sampled\": \"true\",\n+        \"log_sampled\": \"false\",",
        "comment_created_at": "2023-12-05T00:29:09+00:00",
        "comment_author": "howardjohn",
        "comment_body": "even if it is somehow configured, I am fairly sure it bills exactly the same. It's purely an opaque label .\r\n\r\nWhich doesn't make much sense, so either I am missing something or the feature was never really completed ",
        "pr_file_module": null
      },
      {
        "comment_id": "1414696116",
        "repo_full_name": "istio/istio",
        "pr_number": 47892,
        "pr_file": "tests/integration/telemetry/stackdriver/testdata/server_access_log.json.tmpl",
        "discussion_id": "1409966215",
        "commented_code": "@@ -26,7 +26,7 @@\n         \"source_version\": \"v1\",\n         \"source_workload\": \"clt-{{ .ClusterName }}-v1\",\n         \"protocol\": \"grpc\",\n-        \"log_sampled\": \"true\",\n+        \"log_sampled\": \"false\",",
        "comment_created_at": "2023-12-05T00:32:06+00:00",
        "comment_author": "kyessenov",
        "comment_body": "The bill for access logs is substantial. Let's make sure that \"Telemetry API\" always configures \"ERRORS_ONLY\" on outbound which requires the sampler I think.",
        "pr_file_module": null
      },
      {
        "comment_id": "1414701849",
        "repo_full_name": "istio/istio",
        "pr_number": 47892,
        "pr_file": "tests/integration/telemetry/stackdriver/testdata/server_access_log.json.tmpl",
        "discussion_id": "1409966215",
        "commented_code": "@@ -26,7 +26,7 @@\n         \"source_version\": \"v1\",\n         \"source_workload\": \"clt-{{ .ClusterName }}-v1\",\n         \"protocol\": \"grpc\",\n-        \"log_sampled\": \"true\",\n+        \"log_sampled\": \"false\",",
        "comment_created_at": "2023-12-05T00:41:16+00:00",
        "comment_author": "howardjohn",
        "comment_body": "I'll double check what the mode is but just to clarify, this PR only changes behavior if someone is configured an undocumented and unsupported config to set access_logging_policy (not possible in MCP, either)\r\n\r\nFor anyone else there is no change at all. \r\n\r\neven if they did set it, though, it has nothing to do with billing as far as I can tell. It does *not* sample despite the name it only sets a bool flag that has no impact",
        "pr_file_module": null
      },
      {
        "comment_id": "1414712574",
        "repo_full_name": "istio/istio",
        "pr_number": 47892,
        "pr_file": "tests/integration/telemetry/stackdriver/testdata/server_access_log.json.tmpl",
        "discussion_id": "1409966215",
        "commented_code": "@@ -26,7 +26,7 @@\n         \"source_version\": \"v1\",\n         \"source_workload\": \"clt-{{ .ClusterName }}-v1\",\n         \"protocol\": \"grpc\",\n-        \"log_sampled\": \"true\",\n+        \"log_sampled\": \"false\",",
        "comment_created_at": "2023-12-05T00:58:11+00:00",
        "comment_author": "lei-tang",
        "comment_body": "\"Set an access log policy\" with incluster control plane is documented at: https://cloud.google.com/service-mesh/docs/observability/accessing-logs#set_an_access_log_policy.\r\n\r\nIf this feature is removed, documents need to be updated.\r\n",
        "pr_file_module": null
      },
      {
        "comment_id": "1414718986",
        "repo_full_name": "istio/istio",
        "pr_number": 47892,
        "pr_file": "tests/integration/telemetry/stackdriver/testdata/server_access_log.json.tmpl",
        "discussion_id": "1409966215",
        "commented_code": "@@ -26,7 +26,7 @@\n         \"source_version\": \"v1\",\n         \"source_workload\": \"clt-{{ .ClusterName }}-v1\",\n         \"protocol\": \"grpc\",\n-        \"log_sampled\": \"true\",\n+        \"log_sampled\": \"false\",",
        "comment_created_at": "2023-12-05T01:10:14+00:00",
        "comment_author": "howardjohn",
        "comment_body": "Thanks I did not find that during my search (largely because it never actually says *how* to configure it, so I assume no one actually knows).\r\n\r\nEven with this, the feature does not work and isn't usable with MCP, so I cannot imagine anyone is using it. I would still encourage us to move forward with this PR as-is and I will take a follow-up to update the docs.\r\n\r\nIf there is a disagreement I can add it back, but we are maintaining a ton of code that does nothing ",
        "pr_file_module": null
      },
      {
        "comment_id": "1414733985",
        "repo_full_name": "istio/istio",
        "pr_number": 47892,
        "pr_file": "tests/integration/telemetry/stackdriver/testdata/server_access_log.json.tmpl",
        "discussion_id": "1409966215",
        "commented_code": "@@ -26,7 +26,7 @@\n         \"source_version\": \"v1\",\n         \"source_workload\": \"clt-{{ .ClusterName }}-v1\",\n         \"protocol\": \"grpc\",\n-        \"log_sampled\": \"true\",\n+        \"log_sampled\": \"false\",",
        "comment_created_at": "2023-12-05T01:26:44+00:00",
        "comment_author": "lei-tang",
        "comment_body": "If this feature is not used by customers, it sounds good to me to remove this feature. If it has usage, I think a feature deprecation procedure may need to be followed.\r\n \r\nXinnan (@richardwxn) is the expert on feature usage data. Xinnan, do you know the usage data for this feature? ",
        "pr_file_module": null
      },
      {
        "comment_id": "1414832781",
        "repo_full_name": "istio/istio",
        "pr_number": 47892,
        "pr_file": "tests/integration/telemetry/stackdriver/testdata/server_access_log.json.tmpl",
        "discussion_id": "1409966215",
        "commented_code": "@@ -26,7 +26,7 @@\n         \"source_version\": \"v1\",\n         \"source_workload\": \"clt-{{ .ClusterName }}-v1\",\n         \"protocol\": \"grpc\",\n-        \"log_sampled\": \"true\",\n+        \"log_sampled\": \"false\",",
        "comment_created_at": "2023-12-05T03:37:58+00:00",
        "comment_author": "kyessenov",
        "comment_body": "> Even with this, the feature does not work and isn't usable with MCP, so I cannot imagine anyone is using it. I would still encourage us to move forward with this PR as-is and I will take a follow-up to update the docs.\r\n\r\nI vaguely remember a user explicitly requested it and is well aware how this works. We have to check the usage first.\r\n",
        "pr_file_module": null
      },
      {
        "comment_id": "1415904095",
        "repo_full_name": "istio/istio",
        "pr_number": 47892,
        "pr_file": "tests/integration/telemetry/stackdriver/testdata/server_access_log.json.tmpl",
        "discussion_id": "1409966215",
        "commented_code": "@@ -26,7 +26,7 @@\n         \"source_version\": \"v1\",\n         \"source_workload\": \"clt-{{ .ClusterName }}-v1\",\n         \"protocol\": \"grpc\",\n-        \"log_sampled\": \"true\",\n+        \"log_sampled\": \"false\",",
        "comment_created_at": "2023-12-05T16:19:59+00:00",
        "comment_author": "howardjohn",
        "comment_body": "Thanks for pushing on this - I think I was wrong.\r\n\r\nI went through the docs, and they were incorrect initially, and now provide no information on how to configure it. Here is some options, in my order of preference:\r\n\r\n1. Remove everything, as this PR does. Users can manually apply the EnvoyFilter if they need this.\r\n2. Remove everything, as this PR does, but add a pilot env var to set this.\r\n3. Keep just access_log_policy EnvoyFilter\r\n\r\nIn all cases I will also go back and add the tests back for this feature.",
        "pr_file_module": null
      },
      {
        "comment_id": "1416006618",
        "repo_full_name": "istio/istio",
        "pr_number": 47892,
        "pr_file": "tests/integration/telemetry/stackdriver/testdata/server_access_log.json.tmpl",
        "discussion_id": "1409966215",
        "commented_code": "@@ -26,7 +26,7 @@\n         \"source_version\": \"v1\",\n         \"source_workload\": \"clt-{{ .ClusterName }}-v1\",\n         \"protocol\": \"grpc\",\n-        \"log_sampled\": \"true\",\n+        \"log_sampled\": \"false\",",
        "comment_created_at": "2023-12-05T17:07:01+00:00",
        "comment_author": "kyessenov",
        "comment_body": "Access log policy only works with stackdriver, so it can also be tied to stackdriver provider API. But I'm fine with any installation time method or leave EnvoyFilter for it as-is.",
        "pr_file_module": null
      },
      {
        "comment_id": "1416026287",
        "repo_full_name": "istio/istio",
        "pr_number": 47892,
        "pr_file": "tests/integration/telemetry/stackdriver/testdata/server_access_log.json.tmpl",
        "discussion_id": "1409966215",
        "commented_code": "@@ -26,7 +26,7 @@\n         \"source_version\": \"v1\",\n         \"source_workload\": \"clt-{{ .ClusterName }}-v1\",\n         \"protocol\": \"grpc\",\n-        \"log_sampled\": \"true\",\n+        \"log_sampled\": \"false\",",
        "comment_created_at": "2023-12-05T17:18:38+00:00",
        "comment_author": "howardjohn",
        "comment_body": "Done, I did option (1) and added the test back with this enabled.",
        "pr_file_module": null
      },
      {
        "comment_id": "1416092918",
        "repo_full_name": "istio/istio",
        "pr_number": 47892,
        "pr_file": "tests/integration/telemetry/stackdriver/testdata/server_access_log.json.tmpl",
        "discussion_id": "1409966215",
        "commented_code": "@@ -26,7 +26,7 @@\n         \"source_version\": \"v1\",\n         \"source_workload\": \"clt-{{ .ClusterName }}-v1\",\n         \"protocol\": \"grpc\",\n-        \"log_sampled\": \"true\",\n+        \"log_sampled\": \"false\",",
        "comment_created_at": "2023-12-05T18:09:19+00:00",
        "comment_author": "lei-tang",
        "comment_body": "As with Option 1, user manually applies the EnvoyFilter. I think a user guide is needed, including the content of the EnvoyFilter for access_log_policy.",
        "pr_file_module": null
      },
      {
        "comment_id": "1416094516",
        "repo_full_name": "istio/istio",
        "pr_number": 47892,
        "pr_file": "tests/integration/telemetry/stackdriver/testdata/server_access_log.json.tmpl",
        "discussion_id": "1409966215",
        "commented_code": "@@ -26,7 +26,7 @@\n         \"source_version\": \"v1\",\n         \"source_workload\": \"clt-{{ .ClusterName }}-v1\",\n         \"protocol\": \"grpc\",\n-        \"log_sampled\": \"true\",\n+        \"log_sampled\": \"false\",",
        "comment_created_at": "2023-12-05T18:10:39+00:00",
        "comment_author": "howardjohn",
        "comment_body": "The user guide today already says \"go figure it out\". It doesn't say _how_ to do it at all. So I can improve the doc, but to be clear its already ~broken.",
        "pr_file_module": null
      }
    ]
  }
]