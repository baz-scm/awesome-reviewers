[
  {
    "discussion_id": "1714244089",
    "pr_number": 16768,
    "pr_file": "docker/docker_official_images/3.8.0/jvm/Dockerfile",
    "created_at": "2024-08-12T19:01:20+00:00",
    "commented_code": "FROM eclipse-temurin:21-jre-alpine AS build-jsa\n \n-USER root\n-\n-# Get Kafka from https://archive.apache.org/dist/kafka, url passed as env var, for version 3.7.0\n-ENV kafka_url https://archive.apache.org/dist/kafka/3.7.0/kafka_2.13-3.7.0.tgz\n+# Get Kafka from https://archive.apache.org/dist/kafka, url passed as env var, for version 3.8.0\n+ENV kafka_url https://archive.apache.org/dist/kafka/3.8.0/kafka_2.13-3.8.0.tgz\n+ENV GPG_KEY CF9500821E9557AEB04E026C05EEA67F87749E61\n \n COPY jsa_launch /etc/kafka/docker/jsa_launch\n \n RUN set -eux ; \\\n-    apk update ; \\\n-    apk upgrade ; \\\n     apk add --no-cache wget gcompat gpg gpg-agent procps bash; \\\n-    mkdir opt/kafka; \\\n     wget -nv -O kafka.tgz \"$kafka_url\"; \\\n     wget -nv -O kafka.tgz.asc \"$kafka_url.asc\"; \\\n-    tar xfz kafka.tgz -C /opt/kafka --strip-components 1; \\\n-    wget -nv -O KEYS https://downloads.apache.org/kafka/KEYS; \\\n-    gpg --import KEYS; \\\n+    for server in ha.pool.sks-keyservers.net $(shuf -e \\\n+                          hkp://p80.pool.sks-keyservers.net:80 \\\n+                          keyserver.ubuntu.com \\\n+                          hkp://keyserver.ubuntu.com:80 \\\n+                          pgp.mit.edu \\\n+                          hkp://keys.openpgp.org) ; do \\\n+      gpg --batch --keyserver \"$server\" --recv-keys \"$GPG_KEY\" && break || : ; \\\n+    done && \\",
    "repo_full_name": "apache/kafka",
    "discussion_comments": [
      {
        "comment_id": "1714244089",
        "repo_full_name": "apache/kafka",
        "pr_number": 16768,
        "pr_file": "docker/docker_official_images/3.8.0/jvm/Dockerfile",
        "discussion_id": "1714244089",
        "commented_code": "@@ -18,58 +18,63 @@\n \n FROM eclipse-temurin:21-jre-alpine AS build-jsa\n \n-USER root\n-\n-# Get Kafka from https://archive.apache.org/dist/kafka, url passed as env var, for version 3.7.0\n-ENV kafka_url https://archive.apache.org/dist/kafka/3.7.0/kafka_2.13-3.7.0.tgz\n+# Get Kafka from https://archive.apache.org/dist/kafka, url passed as env var, for version 3.8.0\n+ENV kafka_url https://archive.apache.org/dist/kafka/3.8.0/kafka_2.13-3.8.0.tgz\n+ENV GPG_KEY CF9500821E9557AEB04E026C05EEA67F87749E61\n \n COPY jsa_launch /etc/kafka/docker/jsa_launch\n \n RUN set -eux ; \\\n-    apk update ; \\\n-    apk upgrade ; \\\n     apk add --no-cache wget gcompat gpg gpg-agent procps bash; \\\n-    mkdir opt/kafka; \\\n     wget -nv -O kafka.tgz \"$kafka_url\"; \\\n     wget -nv -O kafka.tgz.asc \"$kafka_url.asc\"; \\\n-    tar xfz kafka.tgz -C /opt/kafka --strip-components 1; \\\n-    wget -nv -O KEYS https://downloads.apache.org/kafka/KEYS; \\\n-    gpg --import KEYS; \\\n+    for server in ha.pool.sks-keyservers.net $(shuf -e \\\n+                          hkp://p80.pool.sks-keyservers.net:80 \\\n+                          keyserver.ubuntu.com \\\n+                          hkp://keyserver.ubuntu.com:80 \\\n+                          pgp.mit.edu \\\n+                          hkp://keys.openpgp.org) ; do \\\n+      gpg --batch --keyserver \"$server\" --recv-keys \"$GPG_KEY\" && break || : ; \\\n+    done && \\",
        "comment_created_at": "2024-08-12T19:01:20+00:00",
        "comment_author": "whalelines",
        "comment_body": "See the first example under https://github.com/docker-library/official-images?tab=readme-ov-file#image-build",
        "pr_file_module": null
      },
      {
        "comment_id": "1715412057",
        "repo_full_name": "apache/kafka",
        "pr_number": 16768,
        "pr_file": "docker/docker_official_images/3.8.0/jvm/Dockerfile",
        "discussion_id": "1714244089",
        "commented_code": "@@ -18,58 +18,63 @@\n \n FROM eclipse-temurin:21-jre-alpine AS build-jsa\n \n-USER root\n-\n-# Get Kafka from https://archive.apache.org/dist/kafka, url passed as env var, for version 3.7.0\n-ENV kafka_url https://archive.apache.org/dist/kafka/3.7.0/kafka_2.13-3.7.0.tgz\n+# Get Kafka from https://archive.apache.org/dist/kafka, url passed as env var, for version 3.8.0\n+ENV kafka_url https://archive.apache.org/dist/kafka/3.8.0/kafka_2.13-3.8.0.tgz\n+ENV GPG_KEY CF9500821E9557AEB04E026C05EEA67F87749E61\n \n COPY jsa_launch /etc/kafka/docker/jsa_launch\n \n RUN set -eux ; \\\n-    apk update ; \\\n-    apk upgrade ; \\\n     apk add --no-cache wget gcompat gpg gpg-agent procps bash; \\\n-    mkdir opt/kafka; \\\n     wget -nv -O kafka.tgz \"$kafka_url\"; \\\n     wget -nv -O kafka.tgz.asc \"$kafka_url.asc\"; \\\n-    tar xfz kafka.tgz -C /opt/kafka --strip-components 1; \\\n-    wget -nv -O KEYS https://downloads.apache.org/kafka/KEYS; \\\n-    gpg --import KEYS; \\\n+    for server in ha.pool.sks-keyservers.net $(shuf -e \\\n+                          hkp://p80.pool.sks-keyservers.net:80 \\\n+                          keyserver.ubuntu.com \\\n+                          hkp://keyserver.ubuntu.com:80 \\\n+                          pgp.mit.edu \\\n+                          hkp://keys.openpgp.org) ; do \\\n+      gpg --batch --keyserver \"$server\" --recv-keys \"$GPG_KEY\" && break || : ; \\\n+    done && \\",
        "comment_created_at": "2024-08-13T14:35:20+00:00",
        "comment_author": "KrishVora2912",
        "comment_body": "Thanks for the review @whalelines !\r\n\r\nI went through the example, and made relevant changes to the Dockerfile:\r\n1. used GNUPGHOME\r\n2. Used only 2 keyservers - hkp://keys.openpgp.org and keyserver.ubuntu.com and removed the rest outdated keyservers\r\n3. Hardcoded the GPG_KEY inside the command itself\r\n4. Like [flink-docker](https://github.com/apache/flink-docker/blob/master/1.20/scala_2.12-java17-ubuntu/Dockerfile#L41), used the practice of adding `gpgconf --kill all` as part of verification commands.\r\n5. wget uses kafka_url env variable, which downloads from a https source\r\n\r\nPlease let us know if these changes are okay, and if any more are needed. \r\nThank you again!",
        "pr_file_module": null
      }
    ]
  }
]