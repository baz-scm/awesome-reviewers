[
  {
    "discussion_id": "2034798259",
    "pr_number": 6367,
    "pr_file": "packages/shared/clickhouse/migrations/clustered/0015_add_scores_session_index.up.sql",
    "created_at": "2025-04-09T08:37:44+00:00",
    "commented_code": "+ALTER TABLE scores ON CLUSTER default ADD INDEX IF NOT EXISTS idx_project_session (project_id, session_id) TYPE bloom_filter(0.001) GRANULARITY 1;\n+ALTER TABLE scores ON CLUSTER default MATERIALIZE INDEX IF EXISTS idx_project_session;",
    "repo_full_name": "langfuse/langfuse",
    "discussion_comments": [
      {
        "comment_id": "2034798259",
        "repo_full_name": "langfuse/langfuse",
        "pr_number": 6367,
        "pr_file": "packages/shared/clickhouse/migrations/clustered/0015_add_scores_session_index.up.sql",
        "discussion_id": "2034798259",
        "commented_code": "@@ -0,0 +1,2 @@\n+ALTER TABLE scores ON CLUSTER default ADD INDEX IF NOT EXISTS idx_project_session (project_id, session_id) TYPE bloom_filter(0.001) GRANULARITY 1;\n+ALTER TABLE scores ON CLUSTER default MATERIALIZE INDEX IF EXISTS idx_project_session;",
        "comment_created_at": "2025-04-09T08:37:44+00:00",
        "comment_author": "marliessophie",
        "comment_body": "I assume I need this second line because it guarantees that the index is completely built and available for use immediately after the migration? ",
        "pr_file_module": null
      },
      {
        "comment_id": "2035470337",
        "repo_full_name": "langfuse/langfuse",
        "pr_number": 6367,
        "pr_file": "packages/shared/clickhouse/migrations/clustered/0015_add_scores_session_index.up.sql",
        "discussion_id": "2034798259",
        "commented_code": "@@ -0,0 +1,2 @@\n+ALTER TABLE scores ON CLUSTER default ADD INDEX IF NOT EXISTS idx_project_session (project_id, session_id) TYPE bloom_filter(0.001) GRANULARITY 1;\n+ALTER TABLE scores ON CLUSTER default MATERIALIZE INDEX IF EXISTS idx_project_session;",
        "comment_created_at": "2025-04-09T14:12:09+00:00",
        "comment_author": "maxdeichmann",
        "comment_body": "Correct.",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2035493869",
    "pr_number": 6367,
    "pr_file": "packages/shared/clickhouse/migrations/clustered/0012_drop_scores_trace_id_index.down.sql",
    "created_at": "2025-04-09T14:23:59+00:00",
    "commented_code": "+ALTER TABLE scores ON CLUSTER default ADD INDEX IF NOT EXISTS idx_project_trace_observation (project_id, trace_id, observation_id) TYPE bloom_filter(0.001) GRANULARITY 1;",
    "repo_full_name": "langfuse/langfuse",
    "discussion_comments": [
      {
        "comment_id": "2035493869",
        "repo_full_name": "langfuse/langfuse",
        "pr_number": 6367,
        "pr_file": "packages/shared/clickhouse/migrations/clustered/0012_drop_scores_trace_id_index.down.sql",
        "discussion_id": "2035493869",
        "commented_code": "@@ -0,0 +1 @@\n+ALTER TABLE scores ON CLUSTER default ADD INDEX IF NOT EXISTS idx_project_trace_observation (project_id, trace_id, observation_id) TYPE bloom_filter(0.001) GRANULARITY 1;",
        "comment_created_at": "2025-04-09T14:23:59+00:00",
        "comment_author": "maxdeichmann",
        "comment_body": "You also need to materialize the index in this file.",
        "pr_file_module": null
      }
    ]
  }
]