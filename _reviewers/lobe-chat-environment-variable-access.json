[
  {
    "discussion_id": "2127761458",
    "pr_number": 8074,
    "pr_file": "src/libs/next-auth/sso-providers/google.ts",
    "created_at": "2025-06-05T01:15:35+00:00",
    "commented_code": "+import Google from 'next-auth/providers/google';\n+\n+import { authEnv } from '@/config/auth';\n+\n+import { CommonProviderConfig } from './sso.config';\n+\n+const provider = {\n+  id: 'google',\n+  provider: Google({\n+    ...CommonProviderConfig,\n+    authorization: {\n+      params: {\n+        scope:\n+          'openid https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email openid',\n+      },\n+    },\n+    // TODO(NextAuth ENVs Migration): Remove once nextauth envs migration time end\n+    clientId: authEnv.AUTH_GOOGLE_CLIENT_ID ?? process.env.AUTH_GOOGLE_CLIENT_ID,",
    "repo_full_name": "lobehub/lobe-chat",
    "discussion_comments": [
      {
        "comment_id": "2127761458",
        "repo_full_name": "lobehub/lobe-chat",
        "pr_number": 8074,
        "pr_file": "src/libs/next-auth/sso-providers/google.ts",
        "discussion_id": "2127761458",
        "commented_code": "@@ -0,0 +1,23 @@\n+import Google from 'next-auth/providers/google';\n+\n+import { authEnv } from '@/config/auth';\n+\n+import { CommonProviderConfig } from './sso.config';\n+\n+const provider = {\n+  id: 'google',\n+  provider: Google({\n+    ...CommonProviderConfig,\n+    authorization: {\n+      params: {\n+        scope:\n+          'openid https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email openid',\n+      },\n+    },\n+    // TODO(NextAuth ENVs Migration): Remove once nextauth envs migration time end\n+    clientId: authEnv.AUTH_GOOGLE_CLIENT_ID ?? process.env.AUTH_GOOGLE_CLIENT_ID,",
        "comment_created_at": "2025-06-05T01:15:35+00:00",
        "comment_author": "arvinxx",
        "comment_body": "just `process.env.AUTH_GOOGLE_CLIENT_ID` , no need the authEnv.AUTH_GOOGLE_CLIENT_ID",
        "pr_file_module": null
      },
      {
        "comment_id": "2128336148",
        "repo_full_name": "lobehub/lobe-chat",
        "pr_number": 8074,
        "pr_file": "src/libs/next-auth/sso-providers/google.ts",
        "discussion_id": "2127761458",
        "commented_code": "@@ -0,0 +1,23 @@\n+import Google from 'next-auth/providers/google';\n+\n+import { authEnv } from '@/config/auth';\n+\n+import { CommonProviderConfig } from './sso.config';\n+\n+const provider = {\n+  id: 'google',\n+  provider: Google({\n+    ...CommonProviderConfig,\n+    authorization: {\n+      params: {\n+        scope:\n+          'openid https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email openid',\n+      },\n+    },\n+    // TODO(NextAuth ENVs Migration): Remove once nextauth envs migration time end\n+    clientId: authEnv.AUTH_GOOGLE_CLIENT_ID ?? process.env.AUTH_GOOGLE_CLIENT_ID,",
        "comment_created_at": "2025-06-05T09:06:47+00:00",
        "comment_author": "beliven-daniele-sarnari",
        "comment_body": "Done, thanks for pointing it out",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1648847802",
    "pr_number": 2966,
    "pr_file": "src/libs/agent-runtime/cloudflare/index.ts",
    "created_at": "2024-06-21T11:36:53+00:00",
    "commented_code": "+import { ModelProvider } from '../types';\n+import { LobeOpenAICompatibleFactory } from '../utils/openaiCompatibleFactory';\n+\n+export interface LobeCloudflareParams {\n+    accountID?: string;\n+    apiKey?: string;\n+  }\n+\n+export const LobeCloudflareAI = LobeOpenAICompatibleFactory({\n+  baseURL: `https://api.cloudflare.com/client/v4/accounts/${process.env.CLOUDFLARE_ACCOUNT_ID}/ai/v1`,",
    "repo_full_name": "lobehub/lobe-chat",
    "discussion_comments": [
      {
        "comment_id": "1648847802",
        "repo_full_name": "lobehub/lobe-chat",
        "pr_number": 2966,
        "pr_file": "src/libs/agent-runtime/cloudflare/index.ts",
        "discussion_id": "1648847802",
        "commented_code": "@@ -0,0 +1,15 @@\n+import { ModelProvider } from '../types';\n+import { LobeOpenAICompatibleFactory } from '../utils/openaiCompatibleFactory';\n+\n+export interface LobeCloudflareParams {\n+    accountID?: string;\n+    apiKey?: string;\n+  }\n+\n+export const LobeCloudflareAI = LobeOpenAICompatibleFactory({\n+  baseURL: `https://api.cloudflare.com/client/v4/accounts/${process.env.CLOUDFLARE_ACCOUNT_ID}/ai/v1`,",
        "comment_created_at": "2024-06-21T11:36:53+00:00",
        "comment_author": "arvinxx",
        "comment_body": "\u8fd9\u91cc\u8981\u7528 `llmEnv.XXX`",
        "pr_file_module": null
      },
      {
        "comment_id": "1648983750",
        "repo_full_name": "lobehub/lobe-chat",
        "pr_number": 2966,
        "pr_file": "src/libs/agent-runtime/cloudflare/index.ts",
        "discussion_id": "1648847802",
        "commented_code": "@@ -0,0 +1,15 @@\n+import { ModelProvider } from '../types';\n+import { LobeOpenAICompatibleFactory } from '../utils/openaiCompatibleFactory';\n+\n+export interface LobeCloudflareParams {\n+    accountID?: string;\n+    apiKey?: string;\n+  }\n+\n+export const LobeCloudflareAI = LobeOpenAICompatibleFactory({\n+  baseURL: `https://api.cloudflare.com/client/v4/accounts/${process.env.CLOUDFLARE_ACCOUNT_ID}/ai/v1`,",
        "comment_created_at": "2024-06-21T13:41:48+00:00",
        "comment_author": "sxjeru",
        "comment_body": "\u6362\u6210 llmEnv.CLOUDFLARE_ACCOUNT_ID \u4e4b\u540e\u62a5\u4e0b\u8ff0\u9519\u8bef\uff1a\r\n`Error: \u274c Attempted to access a server-side environment variable on the client\r\n\r\n\u8bf7\u6559\u4e00\u4e0b\u6709\u4ec0\u4e48\u529e\u6cd5\u80fd\u8ba9\u8bbe\u7f6e\u9875\u7684 Cloudflare Account ID \u540c\u6b65\u5230\u6b64\u5904 baseURL\uff1f\r\n\u914d\u7f6e\u9879\u5199\u5728 src/app/api/chat/agentRuntime.ts \r\n```\r\ncase ModelProvider.Cloudflare: {\r\n      const { CLOUDFLARE_API_KEY, CLOUDFLARE_ACCOUNT_ID } = getLLMConfig();\r\n      const apiKey = apiKeyManager.pick(payload?.apiKey || CLOUDFLARE_API_KEY);\r\n      const accountID = payload.apiKey && payload.cloudflareAccountID ? payload.cloudflareAccountID : CLOUDFLARE_ACCOUNT_ID;\r\n      return { accountID, apiKey };\r\n```",
        "pr_file_module": null
      },
      {
        "comment_id": "1660769827",
        "repo_full_name": "lobehub/lobe-chat",
        "pr_number": 2966,
        "pr_file": "src/libs/agent-runtime/cloudflare/index.ts",
        "discussion_id": "1648847802",
        "commented_code": "@@ -0,0 +1,15 @@\n+import { ModelProvider } from '../types';\n+import { LobeOpenAICompatibleFactory } from '../utils/openaiCompatibleFactory';\n+\n+export interface LobeCloudflareParams {\n+    accountID?: string;\n+    apiKey?: string;\n+  }\n+\n+export const LobeCloudflareAI = LobeOpenAICompatibleFactory({\n+  baseURL: `https://api.cloudflare.com/client/v4/accounts/${process.env.CLOUDFLARE_ACCOUNT_ID}/ai/v1`,",
        "comment_created_at": "2024-07-01T09:42:07+00:00",
        "comment_author": "arvinxx",
        "comment_body": "accountId \u4f5c\u4e3a\u53c2\u6570\u4f20\u7ed9 server\u7aef\u3002\u7136\u540e server \u7aef\u7684 LobeCloudflareAI \u521d\u59cb\u5316\u65f6\u5019 baseURL \u7684\u903b\u8f91\u53d8\u6210 accountId \u62fc\u63a5\u7684\uff1f",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1631842806",
    "pr_number": 2804,
    "pr_file": "src/config/llm.ts",
    "created_at": "2024-06-08T02:57:05+00:00",
    "commented_code": null,
    "repo_full_name": "lobehub/lobe-chat",
    "discussion_comments": [
      {
        "comment_id": "1631842806",
        "repo_full_name": "lobehub/lobe-chat",
        "pr_number": 2804,
        "pr_file": "src/config/llm.ts",
        "discussion_id": "1631842806",
        "commented_code": null,
        "comment_created_at": "2024-06-08T02:57:05+00:00",
        "comment_author": "arvinxx",
        "comment_body": "Add the server API KEY environment variable here, there are usually two: `ENABLED_XXX` and `XXXX_API_KEY`\r\n\r\n\u5728\u6b64\u5904\u6dfb\u52a0\u670d\u52a1\u7aef API KEY \u73af\u5883\u53d8\u91cf\uff0c\u4e00\u822c\u4f1a\u6709\u4e24\u4e2a\uff1a `ENABLED_XXX` \u548c `XXXX_API_KEY` \u3002",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1953714404",
    "pr_number": 5927,
    "pr_file": "src/server/modules/ContentChunk/index.ts",
    "created_at": "2025-02-13T02:59:38+00:00",
    "commented_code": null,
    "repo_full_name": "lobehub/lobe-chat",
    "discussion_comments": [
      {
        "comment_id": "1953714404",
        "repo_full_name": "lobehub/lobe-chat",
        "pr_number": 5927,
        "pr_file": "src/server/modules/ContentChunk/index.ts",
        "discussion_id": "1953714404",
        "commented_code": null,
        "comment_created_at": "2025-02-13T02:59:38+00:00",
        "comment_author": "arvinxx",
        "comment_body": "\u4e0d\u8981\u4f7f\u7528 getEnvironment\uff0c\u76ee\u524d\u6211\u4eec\u662f\u901a\u8fc7 `@t3-oss/env-nextjs` \u8fd9\u4e2a\u5305\uff0c\u5b83\u5df2\u7ecf\u5185\u7f6e\u4e86\u4f60\u7684 getEnvironment \u903b\u8f91\u3002\u56e0\u6b64\u53ea\u9700\u8981\u76f4\u63a5\u5728 knowledgeEnv \u6587\u4ef6\u4e2d\u5b9a\u4e49 `USE_UNSTRUCTURED_FOR_PDF` \u5373\u53ef\r\n\r\nhttps://github.com/lobehub/lobe-chat/blob/c67fb3347fdef64d4d0b70665860d1a19e39b7f0/src/config/knowledge.ts",
        "pr_file_module": null
      },
      {
        "comment_id": "1953963578",
        "repo_full_name": "lobehub/lobe-chat",
        "pr_number": 5927,
        "pr_file": "src/server/modules/ContentChunk/index.ts",
        "discussion_id": "1953714404",
        "commented_code": null,
        "comment_created_at": "2025-02-13T07:34:47+00:00",
        "comment_author": "fzlzjerry",
        "comment_body": "\u5df2\u7ecf\u66f4\u6539\u65b9\u6cd5",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1894793046",
    "pr_number": 5085,
    "pr_file": "src/libs/next-auth/sso-providers/wechat.ts",
    "created_at": "2024-12-22T05:46:58+00:00",
    "commented_code": null,
    "repo_full_name": "lobehub/lobe-chat",
    "discussion_comments": [
      {
        "comment_id": "1894793046",
        "repo_full_name": "lobehub/lobe-chat",
        "pr_number": 5085,
        "pr_file": "src/libs/next-auth/sso-providers/wechat.ts",
        "discussion_id": "1894793046",
        "commented_code": null,
        "comment_created_at": "2024-12-22T05:46:58+00:00",
        "comment_author": "arvinxx",
        "comment_body": "\u76f4\u63a5\u7528 process.env.xxx",
        "pr_file_module": null
      },
      {
        "comment_id": "1895135870",
        "repo_full_name": "lobehub/lobe-chat",
        "pr_number": 5085,
        "pr_file": "src/libs/next-auth/sso-providers/wechat.ts",
        "discussion_id": "1894793046",
        "commented_code": null,
        "comment_created_at": "2024-12-23T01:24:00+00:00",
        "comment_author": "xiangnanscu",
        "comment_body": "\u80fd\u5426\u8bf4\u4e00\u4e0b\u662f\u5177\u4f53\u54ea\u4e9bprocess.env\u53d8\u91cf\uff1f",
        "pr_file_module": null
      },
      {
        "comment_id": "1895224043",
        "repo_full_name": "lobehub/lobe-chat",
        "pr_number": 5085,
        "pr_file": "src/libs/next-auth/sso-providers/wechat.ts",
        "discussion_id": "1894793046",
        "commented_code": null,
        "comment_created_at": "2024-12-23T04:19:15+00:00",
        "comment_author": "arvinxx",
        "comment_body": "```\r\n   clientId: process.env.AUTH_WECHAT_ID,\r\n    clientSecret: process.env.AUTH_WECHAT_SECRET,\r\n```\r\n\u5c31\u662f\u4e0d\u9700\u8981\u524d\u9762\u7684 authEnv \u4e86\u3002\u65e7\u7684 authEnv \u662f\u4e3a\u4e86\u517c\u5bb9\u4ee5\u524d\u7684\u5199\u6cd5\u3002\u65b0\u7684 provider \u7528\u65b0\u7684\u65b9\u6848",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1782108677",
    "pr_number": 4168,
    "pr_file": "src/config/auth.ts",
    "created_at": "2024-10-01T04:54:39+00:00",
    "commented_code": null,
    "repo_full_name": "lobehub/lobe-chat",
    "discussion_comments": [
      {
        "comment_id": "1782108677",
        "repo_full_name": "lobehub/lobe-chat",
        "pr_number": 4168,
        "pr_file": "src/config/auth.ts",
        "discussion_id": "1782108677",
        "commented_code": null,
        "comment_created_at": "2024-10-01T04:54:39+00:00",
        "comment_author": "arvinxx",
        "comment_body": "I think we don't need this env any more. Just Environment Variable Inference ( #3701 ) is enough",
        "pr_file_module": null
      },
      {
        "comment_id": "1783798422",
        "repo_full_name": "lobehub/lobe-chat",
        "pr_number": 4168,
        "pr_file": "src/config/auth.ts",
        "discussion_id": "1782108677",
        "commented_code": null,
        "comment_created_at": "2024-10-02T03:26:51+00:00",
        "comment_author": "EINDEX",
        "comment_body": "I think those env vars are the same as those in the official guide.\r\n<img width=\"694\" alt=\"image\" src=\"https://github.com/user-attachments/assets/580a2072-b57d-4737-9d62-1ee534c2e925\">\r\n",
        "pr_file_module": null
      },
      {
        "comment_id": "1797617284",
        "repo_full_name": "lobehub/lobe-chat",
        "pr_number": 4168,
        "pr_file": "src/config/auth.ts",
        "discussion_id": "1782108677",
        "commented_code": null,
        "comment_created_at": "2024-10-12T06:45:00+00:00",
        "comment_author": "arvinxx",
        "comment_body": "I mean because of `Environment Variable Inference`, so we don't need to defined it in the `authEnv`, and we also don't need to write these, because it will be handled automately by next-auth\r\n\r\n```js\r\nclientId: process.env.AUTH_XXX_ID,\r\nclientSecret: process.env.AUTH_XXX_SECRET,\r\nissuer: process.env.AUTH_XXX_ISSUER,\r\n```\r\n\r\n",
        "pr_file_module": null
      },
      {
        "comment_id": "1797617524",
        "repo_full_name": "lobehub/lobe-chat",
        "pr_number": 4168,
        "pr_file": "src/config/auth.ts",
        "discussion_id": "1782108677",
        "commented_code": null,
        "comment_created_at": "2024-10-12T06:46:42+00:00",
        "comment_author": "EINDEX",
        "comment_body": "Oh, I got it.",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1807596306",
    "pr_number": 4168,
    "pr_file": "src/libs/next-auth/sso-providers/microsoft-entra-id.ts",
    "created_at": "2024-10-20T03:27:45+00:00",
    "commented_code": "+import MicrosoftEntraID from 'next-auth/providers/microsoft-entra-id';\n+\n+import { authEnv } from '@/config/auth';\n+\n+import { CommonProviderConfig } from './sso.config';\n+\n+const provider = {\n+  id: 'microsoft-entra-id',\n+  provider: MicrosoftEntraID({\n+    ...CommonProviderConfig,\n+    // Specify auth scope, at least include 'openid email'\n+    // all scopes in Azure AD ref: https://learn.microsoft.com/en-us/entra/identity-platform/scopes-oidc#openid-connect-scopes\n+    authorization: { params: { scope: 'openid email profile' } },\n+    clientId: process.env.AUTH_MICROSOFT_ENTRA_ID_ID,",
    "repo_full_name": "lobehub/lobe-chat",
    "discussion_comments": [
      {
        "comment_id": "1807596306",
        "repo_full_name": "lobehub/lobe-chat",
        "pr_number": 4168,
        "pr_file": "src/libs/next-auth/sso-providers/microsoft-entra-id.ts",
        "discussion_id": "1807596306",
        "commented_code": "@@ -0,0 +1,20 @@\n+import MicrosoftEntraID from 'next-auth/providers/microsoft-entra-id';\n+\n+import { authEnv } from '@/config/auth';\n+\n+import { CommonProviderConfig } from './sso.config';\n+\n+const provider = {\n+  id: 'microsoft-entra-id',\n+  provider: MicrosoftEntraID({\n+    ...CommonProviderConfig,\n+    // Specify auth scope, at least include 'openid email'\n+    // all scopes in Azure AD ref: https://learn.microsoft.com/en-us/entra/identity-platform/scopes-oidc#openid-connect-scopes\n+    authorization: { params: { scope: 'openid email profile' } },\n+    clientId: process.env.AUTH_MICROSOFT_ENTRA_ID_ID,",
        "comment_created_at": "2024-10-20T03:27:45+00:00",
        "comment_author": "arvinxx",
        "comment_body": "\u4e0d\u9700\u8981\u52a0 `process.env.XXX`\uff0c\u56e0\u4e3a next-auth \u4f1a\u81ea\u52a8\u8bfb\u8fd9\u4e2a\u503c",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1832259277",
    "pr_number": 4633,
    "pr_file": "src/app/(backend)/webapi/proxy/route.ts",
    "created_at": "2024-11-07T08:35:46+00:00",
    "commented_code": "const url = await req.text();\n \n   try {\n-    const res = await fetch(url, { agent: ssrfAgent(url) });\n+    // https://www.npmjs.com/package/request-filtering-agent\n+    const options: RequestFilteringAgentOptions = {\n+      allowIPAddressList: process.env.SSRF_ALLOW_IP_ADDRESS_LIST?.split(',') || [],",
    "repo_full_name": "lobehub/lobe-chat",
    "discussion_comments": [
      {
        "comment_id": "1832259277",
        "repo_full_name": "lobehub/lobe-chat",
        "pr_number": 4633,
        "pr_file": "src/app/(backend)/webapi/proxy/route.ts",
        "discussion_id": "1832259277",
        "commented_code": "@@ -9,7 +9,14 @@ export const POST = async (req: Request) => {\n   const url = await req.text();\n \n   try {\n-    const res = await fetch(url, { agent: ssrfAgent(url) });\n+    // https://www.npmjs.com/package/request-filtering-agent\n+    const options: RequestFilteringAgentOptions = {\n+      allowIPAddressList: process.env.SSRF_ALLOW_IP_ADDRESS_LIST?.split(',') || [],",
        "comment_created_at": "2024-11-07T08:35:46+00:00",
        "comment_author": "arvinxx",
        "comment_body": "env \u9700\u8981\u914d\u5728\u8fd9\u91cc https://github.com/lobehub/lobe-chat/blob/main/src/config/app.ts \u7136\u540e\u8bfb",
        "pr_file_module": null
      },
      {
        "comment_id": "1832835036",
        "repo_full_name": "lobehub/lobe-chat",
        "pr_number": 4633,
        "pr_file": "src/app/(backend)/webapi/proxy/route.ts",
        "discussion_id": "1832259277",
        "commented_code": "@@ -9,7 +9,14 @@ export const POST = async (req: Request) => {\n   const url = await req.text();\n \n   try {\n-    const res = await fetch(url, { agent: ssrfAgent(url) });\n+    // https://www.npmjs.com/package/request-filtering-agent\n+    const options: RequestFilteringAgentOptions = {\n+      allowIPAddressList: process.env.SSRF_ALLOW_IP_ADDRESS_LIST?.split(',') || [],",
        "comment_created_at": "2024-11-07T15:01:25+00:00",
        "comment_author": "coulsontl",
        "comment_body": "@arvinxx \u5df2\u66f4\u65b0\u6587\u6863\uff0c\u5e76\u628aenv\u914d\u7f6e\u5230\u4e86app.ts\u91cc\uff1b\u540c\u65f6\u4e3a\u4e86\u964d\u4f4e\u914d\u7f6e\u96be\u5ea6\uff0c\u628a\u73af\u5883\u53d8\u91cf\u7cbe\u7b80\u5230\u4e862\u4e2a\uff0c\u9ebb\u70e6\u91cd\u65b0review\u4e00\u4e0b",
        "pr_file_module": null
      }
    ]
  }
]