[
  {
    "discussion_id": "1969859964",
    "pr_number": 6386,
    "pr_file": "src/libs/next-auth/sso-providers/feishu.ts",
    "created_at": "2025-02-25T14:10:51+00:00",
    "commented_code": "+import { customFetch } from 'next-auth';\n+import type { OAuthConfig } from 'next-auth/providers';\n+\n+interface FeishuProfile {\n+  avatar_big: string;\n+  avatar_middle: string;\n+  avatar_thumb: string;\n+  avatar_url: string;\n+  en_name: string;\n+  name: string;\n+  open_id: string;\n+  tenant_key: string;\n+  union_id: string;\n+}\n+\n+interface FeishuProfileResponse {\n+  data: FeishuProfile;\n+}\n+\n+function Feishu(): OAuthConfig<FeishuProfileResponse> {\n+  return {\n+    authorization: {\n+      params: {\n+        scope: '',\n+      },\n+      url: 'https://accounts.feishu.cn/open-apis/authen/v1/authorize',\n+    },\n+    checks: ['state'],\n+    client: {\n+      token_endpoint_auth_method: 'client_secret_post',\n+    },\n+    [customFetch]: (url, options = {}) => {\n+      if (\n+        url === 'https://open.feishu.cn/open-apis/authen/v2/oauth/token' &&\n+        options.method === 'POST'\n+      ) {\n+        if (options?.headers) {\n+          options.headers = {\n+            ...options.headers,\n+            'content-type': 'application/json; charset=utf-8',\n+          };\n+        } else {\n+          options.headers = {\n+            'content-type': 'application/json; charset=utf-8',\n+          };\n+        }\n+\n+        if (options.body instanceof URLSearchParams) {\n+          options.body = JSON.stringify(Object.fromEntries(options.body));\n+        }\n+      }\n+\n+      return fetch(url, options);\n+    },\n+    id: 'feishu',\n+    name: 'Feishu',\n+    profile(profileResponse) {\n+      const profile = profileResponse.data;\n+\n+      return {\n+        id: profile.union_id,\n+        image: profile.avatar_url,\n+        name: profile.name,\n+        providerAccountId: profile.union_id,\n+      };\n+    },\n+    style: {\n+      logo: 'https://p1-hera.feishucdn.com/tos-cn-i-jbbdkfciu3/268ec674a56a4510889f7f5ca14f1ba1~tplv-jbbdkfciu3-image:0:0.image',\n+    },\n+    token: 'https://open.feishu.cn/open-apis/authen/v2/oauth/token',\n+    type: 'oauth',\n+    userinfo: 'https://open.feishu.cn/open-apis/authen/v1/user_info',\n+  };\n+}\n+\n+const provider = {\n+  id: 'feishu',\n+  provider: Feishu(),\n+};\n+\n+export default provider;",
    "repo_full_name": "lobehub/lobe-chat",
    "discussion_comments": [
      {
        "comment_id": "1969859964",
        "repo_full_name": "lobehub/lobe-chat",
        "pr_number": 6386,
        "pr_file": "src/libs/next-auth/sso-providers/feishu.ts",
        "discussion_id": "1969859964",
        "commented_code": "@@ -0,0 +1,81 @@\n+import { customFetch } from 'next-auth';\n+import type { OAuthConfig } from 'next-auth/providers';\n+\n+interface FeishuProfile {\n+  avatar_big: string;\n+  avatar_middle: string;\n+  avatar_thumb: string;\n+  avatar_url: string;\n+  en_name: string;\n+  name: string;\n+  open_id: string;\n+  tenant_key: string;\n+  union_id: string;\n+}\n+\n+interface FeishuProfileResponse {\n+  data: FeishuProfile;\n+}\n+\n+function Feishu(): OAuthConfig<FeishuProfileResponse> {\n+  return {\n+    authorization: {\n+      params: {\n+        scope: '',\n+      },\n+      url: 'https://accounts.feishu.cn/open-apis/authen/v1/authorize',\n+    },\n+    checks: ['state'],\n+    client: {\n+      token_endpoint_auth_method: 'client_secret_post',\n+    },\n+    [customFetch]: (url, options = {}) => {\n+      if (\n+        url === 'https://open.feishu.cn/open-apis/authen/v2/oauth/token' &&\n+        options.method === 'POST'\n+      ) {\n+        if (options?.headers) {\n+          options.headers = {\n+            ...options.headers,\n+            'content-type': 'application/json; charset=utf-8',\n+          };\n+        } else {\n+          options.headers = {\n+            'content-type': 'application/json; charset=utf-8',\n+          };\n+        }\n+\n+        if (options.body instanceof URLSearchParams) {\n+          options.body = JSON.stringify(Object.fromEntries(options.body));\n+        }\n+      }\n+\n+      return fetch(url, options);\n+    },\n+    id: 'feishu',\n+    name: 'Feishu',\n+    profile(profileResponse) {\n+      const profile = profileResponse.data;\n+\n+      return {\n+        id: profile.union_id,\n+        image: profile.avatar_url,\n+        name: profile.name,\n+        providerAccountId: profile.union_id,\n+      };\n+    },\n+    style: {\n+      logo: 'https://p1-hera.feishucdn.com/tos-cn-i-jbbdkfciu3/268ec674a56a4510889f7f5ca14f1ba1~tplv-jbbdkfciu3-image:0:0.image',\n+    },\n+    token: 'https://open.feishu.cn/open-apis/authen/v2/oauth/token',\n+    type: 'oauth',\n+    userinfo: 'https://open.feishu.cn/open-apis/authen/v1/user_info',\n+  };\n+}\n+\n+const provider = {\n+  id: 'feishu',\n+  provider: Feishu(),\n+};\n+\n+export default provider;",
        "comment_created_at": "2025-02-25T14:10:51+00:00",
        "comment_author": "cy948",
        "comment_body": "\u53c2\u7167 https://github.com/lobehub/lobe-chat/blob/main/src/libs/next-auth/sso-providers/logto.ts \u7684\u5b9e\u73b0\uff0c\u628a\u4ee3\u7801\u91cd\u6784\u4e00\u4e0b\uff0c\u5148\u5199\u57fa\u7840\u7684 Provider\uff0c\u6700\u540e\u5728 function \u5165\u53c2\u7684\u5730\u65b9\u901a\u8fc7\u73af\u5883\u53d8\u91cf\u4f20\u5165 app id, secret \u7b49\u3002 \u73af\u5883\u53d8\u91cf\u53ea\u9700\u8981 `process.env.AUTH_[provider id ]_ID`  \u8fd9\u4e2a\uff0c\u524d\u9762\u7684\u5c31\u4e0d\u9700\u8981\u52a0\u4e86\uff0c\u524d\u9762\u7684\u5199\u6cd5\u5728 2.0 \u4f1a\u5e9f\u5f03\u7684\u3002\r\nhttps://github.com/lobehub/lobe-chat/blob/69f85558b7ba6b50f3750286d1cc7f90e5445dc0/src/libs/next-auth/sso-providers/logto.ts#L38-L48",
        "pr_file_module": null
      },
      {
        "comment_id": "1970826196",
        "repo_full_name": "lobehub/lobe-chat",
        "pr_number": 6386,
        "pr_file": "src/libs/next-auth/sso-providers/feishu.ts",
        "discussion_id": "1969859964",
        "commented_code": "@@ -0,0 +1,81 @@\n+import { customFetch } from 'next-auth';\n+import type { OAuthConfig } from 'next-auth/providers';\n+\n+interface FeishuProfile {\n+  avatar_big: string;\n+  avatar_middle: string;\n+  avatar_thumb: string;\n+  avatar_url: string;\n+  en_name: string;\n+  name: string;\n+  open_id: string;\n+  tenant_key: string;\n+  union_id: string;\n+}\n+\n+interface FeishuProfileResponse {\n+  data: FeishuProfile;\n+}\n+\n+function Feishu(): OAuthConfig<FeishuProfileResponse> {\n+  return {\n+    authorization: {\n+      params: {\n+        scope: '',\n+      },\n+      url: 'https://accounts.feishu.cn/open-apis/authen/v1/authorize',\n+    },\n+    checks: ['state'],\n+    client: {\n+      token_endpoint_auth_method: 'client_secret_post',\n+    },\n+    [customFetch]: (url, options = {}) => {\n+      if (\n+        url === 'https://open.feishu.cn/open-apis/authen/v2/oauth/token' &&\n+        options.method === 'POST'\n+      ) {\n+        if (options?.headers) {\n+          options.headers = {\n+            ...options.headers,\n+            'content-type': 'application/json; charset=utf-8',\n+          };\n+        } else {\n+          options.headers = {\n+            'content-type': 'application/json; charset=utf-8',\n+          };\n+        }\n+\n+        if (options.body instanceof URLSearchParams) {\n+          options.body = JSON.stringify(Object.fromEntries(options.body));\n+        }\n+      }\n+\n+      return fetch(url, options);\n+    },\n+    id: 'feishu',\n+    name: 'Feishu',\n+    profile(profileResponse) {\n+      const profile = profileResponse.data;\n+\n+      return {\n+        id: profile.union_id,\n+        image: profile.avatar_url,\n+        name: profile.name,\n+        providerAccountId: profile.union_id,\n+      };\n+    },\n+    style: {\n+      logo: 'https://p1-hera.feishucdn.com/tos-cn-i-jbbdkfciu3/268ec674a56a4510889f7f5ca14f1ba1~tplv-jbbdkfciu3-image:0:0.image',\n+    },\n+    token: 'https://open.feishu.cn/open-apis/authen/v2/oauth/token',\n+    type: 'oauth',\n+    userinfo: 'https://open.feishu.cn/open-apis/authen/v1/user_info',\n+  };\n+}\n+\n+const provider = {\n+  id: 'feishu',\n+  provider: Feishu(),\n+};\n+\n+export default provider;",
        "comment_created_at": "2025-02-26T02:57:31+00:00",
        "comment_author": "sssession",
        "comment_body": "process.env.AUTH_[provider id ]_ID \u73af\u5883\u53d8\u91cf\u4f1a\u88ab auth.js \u81ea\u52a8\u8bfb\u53d6\u3002\u8fd8\u9700\u8981\u663e\u793a\u4f20\u5165\u5417\uff1f @cy948 ",
        "pr_file_module": null
      },
      {
        "comment_id": "1970910565",
        "repo_full_name": "lobehub/lobe-chat",
        "pr_number": 6386,
        "pr_file": "src/libs/next-auth/sso-providers/feishu.ts",
        "discussion_id": "1969859964",
        "commented_code": "@@ -0,0 +1,81 @@\n+import { customFetch } from 'next-auth';\n+import type { OAuthConfig } from 'next-auth/providers';\n+\n+interface FeishuProfile {\n+  avatar_big: string;\n+  avatar_middle: string;\n+  avatar_thumb: string;\n+  avatar_url: string;\n+  en_name: string;\n+  name: string;\n+  open_id: string;\n+  tenant_key: string;\n+  union_id: string;\n+}\n+\n+interface FeishuProfileResponse {\n+  data: FeishuProfile;\n+}\n+\n+function Feishu(): OAuthConfig<FeishuProfileResponse> {\n+  return {\n+    authorization: {\n+      params: {\n+        scope: '',\n+      },\n+      url: 'https://accounts.feishu.cn/open-apis/authen/v1/authorize',\n+    },\n+    checks: ['state'],\n+    client: {\n+      token_endpoint_auth_method: 'client_secret_post',\n+    },\n+    [customFetch]: (url, options = {}) => {\n+      if (\n+        url === 'https://open.feishu.cn/open-apis/authen/v2/oauth/token' &&\n+        options.method === 'POST'\n+      ) {\n+        if (options?.headers) {\n+          options.headers = {\n+            ...options.headers,\n+            'content-type': 'application/json; charset=utf-8',\n+          };\n+        } else {\n+          options.headers = {\n+            'content-type': 'application/json; charset=utf-8',\n+          };\n+        }\n+\n+        if (options.body instanceof URLSearchParams) {\n+          options.body = JSON.stringify(Object.fromEntries(options.body));\n+        }\n+      }\n+\n+      return fetch(url, options);\n+    },\n+    id: 'feishu',\n+    name: 'Feishu',\n+    profile(profileResponse) {\n+      const profile = profileResponse.data;\n+\n+      return {\n+        id: profile.union_id,\n+        image: profile.avatar_url,\n+        name: profile.name,\n+        providerAccountId: profile.union_id,\n+      };\n+    },\n+    style: {\n+      logo: 'https://p1-hera.feishucdn.com/tos-cn-i-jbbdkfciu3/268ec674a56a4510889f7f5ca14f1ba1~tplv-jbbdkfciu3-image:0:0.image',\n+    },\n+    token: 'https://open.feishu.cn/open-apis/authen/v2/oauth/token',\n+    type: 'oauth',\n+    userinfo: 'https://open.feishu.cn/open-apis/authen/v1/user_info',\n+  };\n+}\n+\n+const provider = {\n+  id: 'feishu',\n+  provider: Feishu(),\n+};\n+\n+export default provider;",
        "comment_created_at": "2025-02-26T05:02:00+00:00",
        "comment_author": "cy948",
        "comment_body": "\u628ascope\u548cprofile\u5904\u7406\u51fd\u6570\u663e\u5f0f\u58f0\u660e\u4e00\u4e0b",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1590565041",
    "pr_number": 2364,
    "pr_file": "src/store/user/slices/auth/action.ts",
    "created_at": "2024-05-06T05:50:17+00:00",
    "commented_code": "if (enableNextAuth) {\n       // TODO: \u9488\u5bf9\u5f00\u542f next-auth \u7684\u573a\u666f\uff0c\u9700\u8981\u5728\u8fd9\u91cc\u8c03\u7528\u767b\u5f55\u65b9\u6cd5\n       console.log(n('logout'));\n+      signOut();",
    "repo_full_name": "lobehub/lobe-chat",
    "discussion_comments": [
      {
        "comment_id": "1590565041",
        "repo_full_name": "lobehub/lobe-chat",
        "pr_number": 2364,
        "pr_file": "src/store/user/slices/auth/action.ts",
        "discussion_id": "1590565041",
        "commented_code": "@@ -52,6 +58,7 @@ export const createAuthSlice: StateCreator<\n     if (enableNextAuth) {\n       // TODO: \u9488\u5bf9\u5f00\u542f next-auth \u7684\u573a\u666f\uff0c\u9700\u8981\u5728\u8fd9\u91cc\u8c03\u7528\u767b\u5f55\u65b9\u6cd5\n       console.log(n('logout'));\n+      signOut();",
        "comment_created_at": "2024-05-06T05:50:17+00:00",
        "comment_author": "arvinxx",
        "comment_body": "next-auth/react \u7528\u52a8\u6001\u52a0\u8f7d\u5427\uff1f\r\n\r\nconst { signOut } = awat import(\"next-auth/react\")",
        "pr_file_module": null
      },
      {
        "comment_id": "1590572876",
        "repo_full_name": "lobehub/lobe-chat",
        "pr_number": 2364,
        "pr_file": "src/store/user/slices/auth/action.ts",
        "discussion_id": "1590565041",
        "commented_code": "@@ -52,6 +58,7 @@ export const createAuthSlice: StateCreator<\n     if (enableNextAuth) {\n       // TODO: \u9488\u5bf9\u5f00\u542f next-auth \u7684\u573a\u666f\uff0c\u9700\u8981\u5728\u8fd9\u91cc\u8c03\u7528\u767b\u5f55\u65b9\u6cd5\n       console.log(n('logout'));\n+      signOut();",
        "comment_created_at": "2024-05-06T06:05:12+00:00",
        "comment_author": "cy948",
        "comment_body": "\u5df2\u6539",
        "pr_file_module": null
      }
    ]
  }
]