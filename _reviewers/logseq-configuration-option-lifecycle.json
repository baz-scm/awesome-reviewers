[
  {
    "discussion_id": "1165320073",
    "pr_number": 9093,
    "pr_file": "src/main/frontend/components/container.cljs",
    "created_at": "2023-04-13T10:16:21+00:00",
    "commented_code": "(remove string/blank?))]\n                  (doseq [page pages]\n                    (let [page (util/safe-page-name-sanity-lc page)\n-                         [db-id block-type] (if (= page \"contents\")\n-                                              [\"contents\" :contents]\n+                         [db-id block-type] (case page",
    "repo_full_name": "logseq/logseq",
    "discussion_comments": [
      {
        "comment_id": "1165320073",
        "repo_full_name": "logseq/logseq",
        "pr_number": 9093,
        "pr_file": "src/main/frontend/components/container.cljs",
        "discussion_id": "1165320073",
        "commented_code": "@@ -583,8 +583,9 @@\n                                      (remove string/blank?))]\n                  (doseq [page pages]\n                    (let [page (util/safe-page-name-sanity-lc page)\n-                         [db-id block-type] (if (= page \"contents\")\n-                                              [\"contents\" :contents]\n+                         [db-id block-type] (case page",
        "comment_created_at": "2023-04-13T10:16:21+00:00",
        "comment_author": "andelf",
        "comment_body": "This is not the correct way to add `:page-graph` support.\r\n\r\nTo add a new config item:\r\n\r\n- add config key to config schema\r\n- add config key and documentation to config template\r\n- add optional default values to config.cjs\r\n- add setter and getter fn\r\n- use the setter & getter fn\r\n\r\nBTW, The newly introduced setting `:page-graph` is counterintuitive.\r\nThe current setting is `:default-home {:page \"Changelog\", :sidebar \"Contents\"}`. The keys reflect UI areas.\r\n\r\nCould you provide more information on why you want to add a `page-graph` setting?",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1181788665",
    "pr_number": 9287,
    "pr_file": "templates/config.edn",
    "created_at": "2023-05-01T18:36:37+00:00",
    "commented_code": "{:meta/version 1\n \n- ;; Currently, we support either \"Markdown\" or \"Org\".\n- ;; This can overwrite your global preference so that\n- ;; maybe your personal preferred format is Org but you'd\n- ;; need to use Markdown for some projects.\n- ;; :preferred-format \"\"\n-\n- ;; Preferred workflow style.\n- ;; Value is either \":now\" for NOW/LATER style,\n- ;; or \":todo\" for TODO/DOING style.\n+ ;; Set the preferred format.\n+ ;; Available options:\n+ ;; - \"Markdown\" (default)\n+ ;; - \"Org\"\n+ :preferred-format \"Markdown\"",
    "repo_full_name": "logseq/logseq",
    "discussion_comments": [
      {
        "comment_id": "1181788665",
        "repo_full_name": "logseq/logseq",
        "pr_number": 9287,
        "pr_file": "templates/config.edn",
        "discussion_id": "1181788665",
        "commented_code": "@@ -1,137 +1,167 @@\n {:meta/version 1\n \n- ;; Currently, we support either \"Markdown\" or \"Org\".\n- ;; This can overwrite your global preference so that\n- ;; maybe your personal preferred format is Org but you'd\n- ;; need to use Markdown for some projects.\n- ;; :preferred-format \"\"\n-\n- ;; Preferred workflow style.\n- ;; Value is either \":now\" for NOW/LATER style,\n- ;; or \":todo\" for TODO/DOING style.\n+ ;; Set the preferred format.\n+ ;; Available options:\n+ ;; - \"Markdown\" (default)\n+ ;; - \"Org\"\n+ :preferred-format \"Markdown\"",
        "comment_created_at": "2023-05-01T18:36:37+00:00",
        "comment_author": "Bad3r",
        "comment_body": "source:  \r\n\u00a0\r\n\r\n```clojure\r\n(defn get-preferred-format\r\n  ([]\r\n   (get-preferred-format (get-current-repo)))\r\n  ([repo-url]\r\n   (keyword\r\n     (or\r\n       (when-let [fmt (:preferred-format (get-config repo-url))]\r\n         (string/lower-case (name fmt)))\r\n\r\n       (get-in @state [:me :preferred_format] \"markdown\")))))\r\n```",
        "pr_file_module": null
      },
      {
        "comment_id": "1182878733",
        "repo_full_name": "logseq/logseq",
        "pr_number": 9287,
        "pr_file": "templates/config.edn",
        "discussion_id": "1181788665",
        "commented_code": "@@ -1,137 +1,167 @@\n {:meta/version 1\n \n- ;; Currently, we support either \"Markdown\" or \"Org\".\n- ;; This can overwrite your global preference so that\n- ;; maybe your personal preferred format is Org but you'd\n- ;; need to use Markdown for some projects.\n- ;; :preferred-format \"\"\n-\n- ;; Preferred workflow style.\n- ;; Value is either \":now\" for NOW/LATER style,\n- ;; or \":todo\" for TODO/DOING style.\n+ ;; Set the preferred format.\n+ ;; Available options:\n+ ;; - \"Markdown\" (default)\n+ ;; - \"Org\"\n+ :preferred-format \"Markdown\"",
        "comment_created_at": "2023-05-02T18:04:20+00:00",
        "comment_author": "logseq-cldwalker",
        "comment_body": "Would be good to remove these additions of default config values. We have a tech debt item to move all these out to `frontend.state`. Also, as @andelf pointed out, hardcoding default values would make global config unusable",
        "pr_file_module": null
      },
      {
        "comment_id": "1183112461",
        "repo_full_name": "logseq/logseq",
        "pr_number": 9287,
        "pr_file": "templates/config.edn",
        "discussion_id": "1181788665",
        "commented_code": "@@ -1,137 +1,167 @@\n {:meta/version 1\n \n- ;; Currently, we support either \"Markdown\" or \"Org\".\n- ;; This can overwrite your global preference so that\n- ;; maybe your personal preferred format is Org but you'd\n- ;; need to use Markdown for some projects.\n- ;; :preferred-format \"\"\n-\n- ;; Preferred workflow style.\n- ;; Value is either \":now\" for NOW/LATER style,\n- ;; or \":todo\" for TODO/DOING style.\n+ ;; Set the preferred format.\n+ ;; Available options:\n+ ;; - \"Markdown\" (default)\n+ ;; - \"Org\"\n+ :preferred-format \"Markdown\"",
        "comment_created_at": "2023-05-02T22:43:20+00:00",
        "comment_author": "Bad3r",
        "comment_body": "@logseq-cldwalker should all be commented out? my only concern is that when users modify options that are available via the settings UI it will create a duplicate entry at the bottom of the file. \r\n\r\nPossible options as I see it:\r\nA. comment out all options after setting the default value\r\nB. uncomment all options w/ default value\r\nC. uncomment-only options configurable via settings UI.\r\nD. mirror current version",
        "pr_file_module": null
      },
      {
        "comment_id": "1183179389",
        "repo_full_name": "logseq/logseq",
        "pr_number": 9287,
        "pr_file": "templates/config.edn",
        "discussion_id": "1181788665",
        "commented_code": "@@ -1,137 +1,167 @@\n {:meta/version 1\n \n- ;; Currently, we support either \"Markdown\" or \"Org\".\n- ;; This can overwrite your global preference so that\n- ;; maybe your personal preferred format is Org but you'd\n- ;; need to use Markdown for some projects.\n- ;; :preferred-format \"\"\n-\n- ;; Preferred workflow style.\n- ;; Value is either \":now\" for NOW/LATER style,\n- ;; or \":todo\" for TODO/DOING style.\n+ ;; Set the preferred format.\n+ ;; Available options:\n+ ;; - \"Markdown\" (default)\n+ ;; - \"Org\"\n+ :preferred-format \"Markdown\"",
        "comment_created_at": "2023-05-03T01:43:10+00:00",
        "comment_author": "Bad3r",
        "comment_body": "It's worth noting that once the user changes the setting from the UI a new line will be added at the bottom of the file. The format selection is available in the settings UI:  \r\n\u00a0\r\n\r\n![](https://user-images.githubusercontent.com/25513724/235818811-ebd68509-48cb-490c-b9dd-9b9efa16ad95.png)",
        "pr_file_module": null
      },
      {
        "comment_id": "1186396008",
        "repo_full_name": "logseq/logseq",
        "pr_number": 9287,
        "pr_file": "templates/config.edn",
        "discussion_id": "1181788665",
        "commented_code": "@@ -1,137 +1,167 @@\n {:meta/version 1\n \n- ;; Currently, we support either \"Markdown\" or \"Org\".\n- ;; This can overwrite your global preference so that\n- ;; maybe your personal preferred format is Org but you'd\n- ;; need to use Markdown for some projects.\n- ;; :preferred-format \"\"\n-\n- ;; Preferred workflow style.\n- ;; Value is either \":now\" for NOW/LATER style,\n- ;; or \":todo\" for TODO/DOING style.\n+ ;; Set the preferred format.\n+ ;; Available options:\n+ ;; - \"Markdown\" (default)\n+ ;; - \"Org\"\n+ :preferred-format \"Markdown\"",
        "comment_created_at": "2023-05-05T18:36:15+00:00",
        "comment_author": "logseq-cldwalker",
        "comment_body": "I can address in the followup commit. Breaking the basic usability of a feature is not as important as a small workflow enhancement",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1181789055",
    "pr_number": 9287,
    "pr_file": "templates/config.edn",
    "created_at": "2023-05-01T18:37:11+00:00",
    "commented_code": "{:meta/version 1\n \n- ;; Currently, we support either \"Markdown\" or \"Org\".\n- ;; This can overwrite your global preference so that\n- ;; maybe your personal preferred format is Org but you'd\n- ;; need to use Markdown for some projects.\n- ;; :preferred-format \"\"\n-\n- ;; Preferred workflow style.\n- ;; Value is either \":now\" for NOW/LATER style,\n- ;; or \":todo\" for TODO/DOING style.\n+ ;; Set the preferred format.\n+ ;; Available options:\n+ ;; - \"Markdown\" (default)\n+ ;; - \"Org\"\n+ :preferred-format \"Markdown\"\n+\n+ ;; Set the preferred workflow style.\n+ ;; Available options:\n+ ;; - \":now\" for NOW/LATER style (default)\n+ ;; - \":todo\" for TODO/DOING style\n  :preferred-workflow :now",
    "repo_full_name": "logseq/logseq",
    "discussion_comments": [
      {
        "comment_id": "1181789055",
        "repo_full_name": "logseq/logseq",
        "pr_number": 9287,
        "pr_file": "templates/config.edn",
        "discussion_id": "1181789055",
        "commented_code": "@@ -1,137 +1,167 @@\n {:meta/version 1\n \n- ;; Currently, we support either \"Markdown\" or \"Org\".\n- ;; This can overwrite your global preference so that\n- ;; maybe your personal preferred format is Org but you'd\n- ;; need to use Markdown for some projects.\n- ;; :preferred-format \"\"\n-\n- ;; Preferred workflow style.\n- ;; Value is either \":now\" for NOW/LATER style,\n- ;; or \":todo\" for TODO/DOING style.\n+ ;; Set the preferred format.\n+ ;; Available options:\n+ ;; - \"Markdown\" (default)\n+ ;; - \"Org\"\n+ :preferred-format \"Markdown\"\n+\n+ ;; Set the preferred workflow style.\n+ ;; Available options:\n+ ;; - \":now\" for NOW/LATER style (default)\n+ ;; - \":todo\" for TODO/DOING style\n  :preferred-workflow :now",
        "comment_created_at": "2023-05-01T18:37:11+00:00",
        "comment_author": "Bad3r",
        "comment_body": "souce:  \r\n```cljs\r\n(defn get-preferred-workflow\r\n  []\r\n  (keyword\r\n    (or\r\n      (when-let [workflow (:preferred-workflow (get-config))]\r\n        (let [workflow (name workflow)]\r\n          (if (util/safe-re-find #\"now|NOW\" workflow)\r\n            :now\r\n            :todo)))\r\n      (get-in @state [:me :preferred_workflow] :now))))\r\n```",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1181790166",
    "pr_number": 9287,
    "pr_file": "templates/config.edn",
    "created_at": "2023-05-01T18:38:46+00:00",
    "commented_code": "{:meta/version 1\n \n- ;; Currently, we support either \"Markdown\" or \"Org\".\n- ;; This can overwrite your global preference so that\n- ;; maybe your personal preferred format is Org but you'd\n- ;; need to use Markdown for some projects.\n- ;; :preferred-format \"\"\n-\n- ;; Preferred workflow style.\n- ;; Value is either \":now\" for NOW/LATER style,\n- ;; or \":todo\" for TODO/DOING style.\n+ ;; Set the preferred format.\n+ ;; Available options:\n+ ;; - \"Markdown\" (default)\n+ ;; - \"Org\"\n+ :preferred-format \"Markdown\"\n+\n+ ;; Set the preferred workflow style.\n+ ;; Available options:\n+ ;; - \":now\" for NOW/LATER style (default)\n+ ;; - \":todo\" for TODO/DOING style\n  :preferred-workflow :now\n \n- ;; The app will ignore those directories or files.\n- ;; E.g. :hidden [\"/archived\" \"/test.md\" \"../assets/archived\"]\n+ ;; Exclude directories/files.\n+ ;; Example usage: \n+ ;; :hidden [\"/archived\" \"/test.md\" \"../assets/archived\"]\n  :hidden []\n \n- ;; When creating the new journal page, the app will use your template if there is one.\n- ;; You only need to input your template name here.\n+ ;; Define the default journal page template.\n+ ;; Enter the template name between the quotes.\n  :default-templates\n  {:journals \"\"}\n \n- ;; Set a custom date format for journal page title\n- ;; Example:\n- ;; :journal/page-title-format \"EEE, do MMM yyyy\"\n+ ;; Set a custom date format for the journal page title.\n+ ;; Default value: \"MMM do, yyyy\"\n+ :journal/page-title-format \"MMM do, yyyy\"",
    "repo_full_name": "logseq/logseq",
    "discussion_comments": [
      {
        "comment_id": "1181790166",
        "repo_full_name": "logseq/logseq",
        "pr_number": 9287,
        "pr_file": "templates/config.edn",
        "discussion_id": "1181790166",
        "commented_code": "@@ -1,137 +1,167 @@\n {:meta/version 1\n \n- ;; Currently, we support either \"Markdown\" or \"Org\".\n- ;; This can overwrite your global preference so that\n- ;; maybe your personal preferred format is Org but you'd\n- ;; need to use Markdown for some projects.\n- ;; :preferred-format \"\"\n-\n- ;; Preferred workflow style.\n- ;; Value is either \":now\" for NOW/LATER style,\n- ;; or \":todo\" for TODO/DOING style.\n+ ;; Set the preferred format.\n+ ;; Available options:\n+ ;; - \"Markdown\" (default)\n+ ;; - \"Org\"\n+ :preferred-format \"Markdown\"\n+\n+ ;; Set the preferred workflow style.\n+ ;; Available options:\n+ ;; - \":now\" for NOW/LATER style (default)\n+ ;; - \":todo\" for TODO/DOING style\n  :preferred-workflow :now\n \n- ;; The app will ignore those directories or files.\n- ;; E.g. :hidden [\"/archived\" \"/test.md\" \"../assets/archived\"]\n+ ;; Exclude directories/files.\n+ ;; Example usage: \n+ ;; :hidden [\"/archived\" \"/test.md\" \"../assets/archived\"]\n  :hidden []\n \n- ;; When creating the new journal page, the app will use your template if there is one.\n- ;; You only need to input your template name here.\n+ ;; Define the default journal page template.\n+ ;; Enter the template name between the quotes.\n  :default-templates\n  {:journals \"\"}\n \n- ;; Set a custom date format for journal page title\n- ;; Example:\n- ;; :journal/page-title-format \"EEE, do MMM yyyy\"\n+ ;; Set a custom date format for the journal page title.\n+ ;; Default value: \"MMM do, yyyy\"\n+ :journal/page-title-format \"MMM do, yyyy\"",
        "comment_created_at": "2023-05-01T18:38:46+00:00",
        "comment_author": "Bad3r",
        "comment_body": "The code uses `MMM do, yyyy` as the default if none is specified. I do think that `EEE, do MMM yyyy` is better, and I think this option has been set like this for a long time.\r\n\r\nhttps://github.com/logseq/logseq/blob/a5e31128a6366df002488203406684f78d80c7e3/deps/graph-parser/src/logseq/graph_parser/config.cljs#L76-82\r\n\r\n@cnrpman, should the default value be updated to `EEE, do MMM yyyy`",
        "pr_file_module": null
      },
      {
        "comment_id": "1182119075",
        "repo_full_name": "logseq/logseq",
        "pr_number": 9287,
        "pr_file": "templates/config.edn",
        "discussion_id": "1181790166",
        "commented_code": "@@ -1,137 +1,167 @@\n {:meta/version 1\n \n- ;; Currently, we support either \"Markdown\" or \"Org\".\n- ;; This can overwrite your global preference so that\n- ;; maybe your personal preferred format is Org but you'd\n- ;; need to use Markdown for some projects.\n- ;; :preferred-format \"\"\n-\n- ;; Preferred workflow style.\n- ;; Value is either \":now\" for NOW/LATER style,\n- ;; or \":todo\" for TODO/DOING style.\n+ ;; Set the preferred format.\n+ ;; Available options:\n+ ;; - \"Markdown\" (default)\n+ ;; - \"Org\"\n+ :preferred-format \"Markdown\"\n+\n+ ;; Set the preferred workflow style.\n+ ;; Available options:\n+ ;; - \":now\" for NOW/LATER style (default)\n+ ;; - \":todo\" for TODO/DOING style\n  :preferred-workflow :now\n \n- ;; The app will ignore those directories or files.\n- ;; E.g. :hidden [\"/archived\" \"/test.md\" \"../assets/archived\"]\n+ ;; Exclude directories/files.\n+ ;; Example usage: \n+ ;; :hidden [\"/archived\" \"/test.md\" \"../assets/archived\"]\n  :hidden []\n \n- ;; When creating the new journal page, the app will use your template if there is one.\n- ;; You only need to input your template name here.\n+ ;; Define the default journal page template.\n+ ;; Enter the template name between the quotes.\n  :default-templates\n  {:journals \"\"}\n \n- ;; Set a custom date format for journal page title\n- ;; Example:\n- ;; :journal/page-title-format \"EEE, do MMM yyyy\"\n+ ;; Set a custom date format for the journal page title.\n+ ;; Default value: \"MMM do, yyyy\"\n+ :journal/page-title-format \"MMM do, yyyy\"",
        "comment_created_at": "2023-05-02T06:05:03+00:00",
        "comment_author": "andelf",
        "comment_body": "This deviates from the default behavior and is a personal preference.\r\nAt least, this should be marked as BREAKING CHANGE.",
        "pr_file_module": null
      },
      {
        "comment_id": "1182162874",
        "repo_full_name": "logseq/logseq",
        "pr_number": 9287,
        "pr_file": "templates/config.edn",
        "discussion_id": "1181790166",
        "commented_code": "@@ -1,137 +1,167 @@\n {:meta/version 1\n \n- ;; Currently, we support either \"Markdown\" or \"Org\".\n- ;; This can overwrite your global preference so that\n- ;; maybe your personal preferred format is Org but you'd\n- ;; need to use Markdown for some projects.\n- ;; :preferred-format \"\"\n-\n- ;; Preferred workflow style.\n- ;; Value is either \":now\" for NOW/LATER style,\n- ;; or \":todo\" for TODO/DOING style.\n+ ;; Set the preferred format.\n+ ;; Available options:\n+ ;; - \"Markdown\" (default)\n+ ;; - \"Org\"\n+ :preferred-format \"Markdown\"\n+\n+ ;; Set the preferred workflow style.\n+ ;; Available options:\n+ ;; - \":now\" for NOW/LATER style (default)\n+ ;; - \":todo\" for TODO/DOING style\n  :preferred-workflow :now\n \n- ;; The app will ignore those directories or files.\n- ;; E.g. :hidden [\"/archived\" \"/test.md\" \"../assets/archived\"]\n+ ;; Exclude directories/files.\n+ ;; Example usage: \n+ ;; :hidden [\"/archived\" \"/test.md\" \"../assets/archived\"]\n  :hidden []\n \n- ;; When creating the new journal page, the app will use your template if there is one.\n- ;; You only need to input your template name here.\n+ ;; Define the default journal page template.\n+ ;; Enter the template name between the quotes.\n  :default-templates\n  {:journals \"\"}\n \n- ;; Set a custom date format for journal page title\n- ;; Example:\n- ;; :journal/page-title-format \"EEE, do MMM yyyy\"\n+ ;; Set a custom date format for the journal page title.\n+ ;; Default value: \"MMM do, yyyy\"\n+ :journal/page-title-format \"MMM do, yyyy\"",
        "comment_created_at": "2023-05-02T07:01:16+00:00",
        "comment_author": "Bad3r",
        "comment_body": "@andelf which is the default behaviour?\u00a0  \r\nA. `MMM do, yyyy`  \r\n  \r\nB. `EEE, do MMM yyyy`  \r\n  \r\nAccording to [https://github.com/logseq/logseq/blob/master/deps/graph-parser/src/logseq/graph_parser/config.cljs#L76-82](https://github.com/logseq/logseq/blob/master/deps/graph-parser/src/logseq/graph_parser/config.cljs#L76-82)  \r\n```cljs  \r\n(defn get-date-formatter  \r\n\u00a0[config]  \r\n\u00a0(or  \r\n\u00a0 (:journal/page-title-format config)  \r\n\u00a0 ;; for compatibility  \r\n\u00a0 (:date-formatter config)  \r\n\u00a0 \"MMM do, yyyy\"))\r\n\r\n```\r\n  \r\n  \r\nthe default value is B. Which one should be used as the default?",
        "pr_file_module": null
      },
      {
        "comment_id": "1182168789",
        "repo_full_name": "logseq/logseq",
        "pr_number": 9287,
        "pr_file": "templates/config.edn",
        "discussion_id": "1181790166",
        "commented_code": "@@ -1,137 +1,167 @@\n {:meta/version 1\n \n- ;; Currently, we support either \"Markdown\" or \"Org\".\n- ;; This can overwrite your global preference so that\n- ;; maybe your personal preferred format is Org but you'd\n- ;; need to use Markdown for some projects.\n- ;; :preferred-format \"\"\n-\n- ;; Preferred workflow style.\n- ;; Value is either \":now\" for NOW/LATER style,\n- ;; or \":todo\" for TODO/DOING style.\n+ ;; Set the preferred format.\n+ ;; Available options:\n+ ;; - \"Markdown\" (default)\n+ ;; - \"Org\"\n+ :preferred-format \"Markdown\"\n+\n+ ;; Set the preferred workflow style.\n+ ;; Available options:\n+ ;; - \":now\" for NOW/LATER style (default)\n+ ;; - \":todo\" for TODO/DOING style\n  :preferred-workflow :now\n \n- ;; The app will ignore those directories or files.\n- ;; E.g. :hidden [\"/archived\" \"/test.md\" \"../assets/archived\"]\n+ ;; Exclude directories/files.\n+ ;; Example usage: \n+ ;; :hidden [\"/archived\" \"/test.md\" \"../assets/archived\"]\n  :hidden []\n \n- ;; When creating the new journal page, the app will use your template if there is one.\n- ;; You only need to input your template name here.\n+ ;; Define the default journal page template.\n+ ;; Enter the template name between the quotes.\n  :default-templates\n  {:journals \"\"}\n \n- ;; Set a custom date format for journal page title\n- ;; Example:\n- ;; :journal/page-title-format \"EEE, do MMM yyyy\"\n+ ;; Set a custom date format for the journal page title.\n+ ;; Default value: \"MMM do, yyyy\"\n+ :journal/page-title-format \"MMM do, yyyy\"",
        "comment_created_at": "2023-05-02T07:09:13+00:00",
        "comment_author": "Bad3r",
        "comment_body": "@andelf I appreciate that it's a matter of personal preference, and I'm just curious about which one you would recommend as the default value in the default config template.\r\n\r\nEdit:\r\n\r\n- It's worth noting that users may change the value from the settings UI.\r\n- btw I just added an example to the docstring.\r\n\r\n```cljs\r\n ;; Set a custom date format for the journal page title.\r\n ;; Example usage:\r\n ;; :journal/page-title-format \"EEE do, MMM yyyy\"\r\n ;; e.g., \"Tue 19th, Jan 2038\"\"\r\n ;; Default value: \"MMM do, yyyy\"\r\n ;; e.g., \"Jan 19th, 2038\"\r\n :journal/page-title-format \"MMM do, yyyy\"\r\n ```",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1028583379",
    "pr_number": 7394,
    "pr_file": "src/main/frontend/state.cljs",
    "created_at": "2022-11-21T22:46:05+00:00",
    "commented_code": "which are merged.\"\n   [& configs]\n   (apply merge-with\n-    (fn merge-config [current new]\n-      (if (and (map? current) (map? new))\n-        (merge current new)\n-        new))\n-    configs))\n+         (fn merge-config [current new]\n+           (if (and (map? current) (map? new))\n+             (merge current new)\n+             new))\n+         configs))\n \n (defn get-config\n   \"User config for the given repo or current repo if none given. All config fetching\n should be done through this fn in order to get global config and config defaults\"\n   ([]\n    (get-config (get-current-repo)))\n   ([repo-url]\n-   (merge-configs\n-    default-config\n-    (get-in @state [:config ::global-config])\n-    (get-in @state [:config repo-url]))))\n+   (try\n+     (merge-configs\n+      default-config\n+      (get-in @state [:config ::global-config])\n+      (get-in @state [:config repo-url]))\n+     (catch :default e\n+       (do\n+         (log/error \"Cannot parse config files\" e)\n+         (log/error \"Restore default config\")\n+         default-config)))))",
    "repo_full_name": "logseq/logseq",
    "discussion_comments": [
      {
        "comment_id": "1028583379",
        "repo_full_name": "logseq/logseq",
        "pr_number": 7394,
        "pr_file": "src/main/frontend/state.cljs",
        "discussion_id": "1028583379",
        "commented_code": "@@ -312,22 +313,28 @@\n   which are merged.\"\n   [& configs]\n   (apply merge-with\n-    (fn merge-config [current new]\n-      (if (and (map? current) (map? new))\n-        (merge current new)\n-        new))\n-    configs))\n+         (fn merge-config [current new]\n+           (if (and (map? current) (map? new))\n+             (merge current new)\n+             new))\n+         configs))\n \n (defn get-config\n   \"User config for the given repo or current repo if none given. All config fetching\n should be done through this fn in order to get global config and config defaults\"\n   ([]\n    (get-config (get-current-repo)))\n   ([repo-url]\n-   (merge-configs\n-    default-config\n-    (get-in @state [:config ::global-config])\n-    (get-in @state [:config repo-url]))))\n+   (try\n+     (merge-configs\n+      default-config\n+      (get-in @state [:config ::global-config])\n+      (get-in @state [:config repo-url]))\n+     (catch :default e\n+       (do\n+         (log/error \"Cannot parse config files\" e)\n+         (log/error \"Restore default config\")\n+         default-config)))))",
        "comment_created_at": "2022-11-21T22:46:05+00:00",
        "comment_author": "logseq-cldwalker",
        "comment_body": "If we only set default-config the user loses all of their graph config which would cause annoying, silent bugs e.g. certain properties aren't rendered correctly or their journals start saving in a different format",
        "pr_file_module": null
      },
      {
        "comment_id": "1033185586",
        "repo_full_name": "logseq/logseq",
        "pr_number": 7394,
        "pr_file": "src/main/frontend/state.cljs",
        "discussion_id": "1028583379",
        "commented_code": "@@ -312,22 +313,28 @@\n   which are merged.\"\n   [& configs]\n   (apply merge-with\n-    (fn merge-config [current new]\n-      (if (and (map? current) (map? new))\n-        (merge current new)\n-        new))\n-    configs))\n+         (fn merge-config [current new]\n+           (if (and (map? current) (map? new))\n+             (merge current new)\n+             new))\n+         configs))\n \n (defn get-config\n   \"User config for the given repo or current repo if none given. All config fetching\n should be done through this fn in order to get global config and config defaults\"\n   ([]\n    (get-config (get-current-repo)))\n   ([repo-url]\n-   (merge-configs\n-    default-config\n-    (get-in @state [:config ::global-config])\n-    (get-in @state [:config repo-url]))))\n+   (try\n+     (merge-configs\n+      default-config\n+      (get-in @state [:config ::global-config])\n+      (get-in @state [:config repo-url]))\n+     (catch :default e\n+       (do\n+         (log/error \"Cannot parse config files\" e)\n+         (log/error \"Restore default config\")\n+         default-config)))))",
        "comment_created_at": "2022-11-28T07:03:49+00:00",
        "comment_author": "tiensonqin",
        "comment_body": "Can we keep the valid config from the global one and the current graph's config as a temporal fix?",
        "pr_file_module": null
      },
      {
        "comment_id": "1034103479",
        "repo_full_name": "logseq/logseq",
        "pr_number": 7394,
        "pr_file": "src/main/frontend/state.cljs",
        "discussion_id": "1028583379",
        "commented_code": "@@ -312,22 +313,28 @@\n   which are merged.\"\n   [& configs]\n   (apply merge-with\n-    (fn merge-config [current new]\n-      (if (and (map? current) (map? new))\n-        (merge current new)\n-        new))\n-    configs))\n+         (fn merge-config [current new]\n+           (if (and (map? current) (map? new))\n+             (merge current new)\n+             new))\n+         configs))\n \n (defn get-config\n   \"User config for the given repo or current repo if none given. All config fetching\n should be done through this fn in order to get global config and config defaults\"\n   ([]\n    (get-config (get-current-repo)))\n   ([repo-url]\n-   (merge-configs\n-    default-config\n-    (get-in @state [:config ::global-config])\n-    (get-in @state [:config repo-url]))))\n+   (try\n+     (merge-configs\n+      default-config\n+      (get-in @state [:config ::global-config])\n+      (get-in @state [:config repo-url]))\n+     (catch :default e\n+       (do\n+         (log/error \"Cannot parse config files\" e)\n+         (log/error \"Restore default config\")\n+         default-config)))))",
        "comment_created_at": "2022-11-28T22:11:02+00:00",
        "comment_author": "logseq-cldwalker",
        "comment_body": "Unfortunately we don't have access to both valid configs here. Since global config doesn't have validation, it's probably the global config being invalid that causes the failure. We could add the current graph config as a temporal fix but it doesn't guarantee that there still isn't an issue and leads to another issue - a poor user notification experience. These catch's are occurring in a low level fn that can be called a number of times during render, which leads to notifying the user a number of times, at a time potentially much later than when they edited the invalid config. If we don't want illegal global config we should just validate and tell the user when they have entered it",
        "pr_file_module": null
      },
      {
        "comment_id": "1037440892",
        "repo_full_name": "logseq/logseq",
        "pr_number": 7394,
        "pr_file": "src/main/frontend/state.cljs",
        "discussion_id": "1028583379",
        "commented_code": "@@ -312,22 +313,28 @@\n   which are merged.\"\n   [& configs]\n   (apply merge-with\n-    (fn merge-config [current new]\n-      (if (and (map? current) (map? new))\n-        (merge current new)\n-        new))\n-    configs))\n+         (fn merge-config [current new]\n+           (if (and (map? current) (map? new))\n+             (merge current new)\n+             new))\n+         configs))\n \n (defn get-config\n   \"User config for the given repo or current repo if none given. All config fetching\n should be done through this fn in order to get global config and config defaults\"\n   ([]\n    (get-config (get-current-repo)))\n   ([repo-url]\n-   (merge-configs\n-    default-config\n-    (get-in @state [:config ::global-config])\n-    (get-in @state [:config repo-url]))))\n+   (try\n+     (merge-configs\n+      default-config\n+      (get-in @state [:config ::global-config])\n+      (get-in @state [:config repo-url]))\n+     (catch :default e\n+       (do\n+         (log/error \"Cannot parse config files\" e)\n+         (log/error \"Restore default config\")\n+         default-config)))))",
        "comment_created_at": "2022-12-01T18:28:39+00:00",
        "comment_author": "cnrpman",
        "comment_body": "What about backup the user's last valid config on exit?",
        "pr_file_module": null
      }
    ]
  }
]