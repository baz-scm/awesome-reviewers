[
  {
    "discussion_id": "1047793479",
    "pr_number": 7555,
    "pr_file": "src/main/frontend/extensions/code.cljs",
    "created_at": "2022-12-13T21:57:14+00:00",
    "commented_code": "[:div.extensions__code\n    (when-let [mode (:data-lang attr)]\n      (when-not (= mode \"calc\")\n-       [:div.extensions__code-lang\n-        (string/lower-case mode)]))\n+       [:div\n+        [:div.extensions__code-lang\n+         (if (contains? (shell-handler/get-code-block-commands) (string/lower-case mode))\n+           [:a {:title (str \"Run command \" mode)\n+                :on-click (fn [_e]\n+                            (let [editor-atom (:editor-atom state)]\n+                              (when-let [editor @editor-atom]\n+                                (state/pub-event! [:run/cli-command\n+                                                   (string/lower-case mode)\n+                                                   (.getValue editor)]))))}\n+            (if (= mode \"alda\")",
    "repo_full_name": "logseq/logseq",
    "discussion_comments": [
      {
        "comment_id": "1047793479",
        "repo_full_name": "logseq/logseq",
        "pr_number": 7555,
        "pr_file": "src/main/frontend/extensions/code.cljs",
        "discussion_id": "1047793479",
        "commented_code": "@@ -302,8 +304,20 @@\n   [:div.extensions__code\n    (when-let [mode (:data-lang attr)]\n      (when-not (= mode \"calc\")\n-       [:div.extensions__code-lang\n-        (string/lower-case mode)]))\n+       [:div\n+        [:div.extensions__code-lang\n+         (if (contains? (shell-handler/get-code-block-commands) (string/lower-case mode))\n+           [:a {:title (str \"Run command \" mode)\n+                :on-click (fn [_e]\n+                            (let [editor-atom (:editor-atom state)]\n+                              (when-let [editor @editor-atom]\n+                                (state/pub-event! [:run/cli-command\n+                                                   (string/lower-case mode)\n+                                                   (.getValue editor)]))))}\n+            (if (= mode \"alda\")",
        "comment_created_at": "2022-12-13T21:57:14+00:00",
        "comment_author": "logseq-cldwalker",
        "comment_body": "Is there any way we could make this available to plugins? By special casing for alda here, we encourage building an alda feature in logseq, instead of as a plugin",
        "pr_file_module": null
      },
      {
        "comment_id": "1048034023",
        "repo_full_name": "logseq/logseq",
        "pr_number": 7555,
        "pr_file": "src/main/frontend/extensions/code.cljs",
        "discussion_id": "1047793479",
        "commented_code": "@@ -302,8 +304,20 @@\n   [:div.extensions__code\n    (when-let [mode (:data-lang attr)]\n      (when-not (= mode \"calc\")\n-       [:div.extensions__code-lang\n-        (string/lower-case mode)]))\n+       [:div\n+        [:div.extensions__code-lang\n+         (if (contains? (shell-handler/get-code-block-commands) (string/lower-case mode))\n+           [:a {:title (str \"Run command \" mode)\n+                :on-click (fn [_e]\n+                            (let [editor-atom (:editor-atom state)]\n+                              (when-let [editor @editor-atom]\n+                                (state/pub-event! [:run/cli-command\n+                                                   (string/lower-case mode)\n+                                                   (.getValue editor)]))))}\n+            (if (= mode \"alda\")",
        "comment_created_at": "2022-12-14T05:36:34+00:00",
        "comment_author": "xyhp915",
        "comment_body": "The original idea was to open up the ability to execute native CLI to plugins with the allow/deny list to ensure security. However, it was found that the shell exec of the node APIs may still have some security risks, so it is not open to plugins for the time being. This feature may need more time to research and test.",
        "pr_file_module": null
      },
      {
        "comment_id": "1052012944",
        "repo_full_name": "logseq/logseq",
        "pr_number": 7555,
        "pr_file": "src/main/frontend/extensions/code.cljs",
        "discussion_id": "1047793479",
        "commented_code": "@@ -302,8 +304,20 @@\n   [:div.extensions__code\n    (when-let [mode (:data-lang attr)]\n      (when-not (= mode \"calc\")\n-       [:div.extensions__code-lang\n-        (string/lower-case mode)]))\n+       [:div\n+        [:div.extensions__code-lang\n+         (if (contains? (shell-handler/get-code-block-commands) (string/lower-case mode))\n+           [:a {:title (str \"Run command \" mode)\n+                :on-click (fn [_e]\n+                            (let [editor-atom (:editor-atom state)]\n+                              (when-let [editor @editor-atom]\n+                                (state/pub-event! [:run/cli-command\n+                                                   (string/lower-case mode)\n+                                                   (.getValue editor)]))))}\n+            (if (= mode \"alda\")",
        "comment_created_at": "2022-12-19T10:00:34+00:00",
        "comment_author": "tiensonqin",
        "comment_body": "The experimental `alda` support has been removed by [f5a1e13](https://github.com/logseq/logseq/pull/7555/commits/f5a1e13ed11a89ea9dddae5aef31c968d4976cfd).",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1047801215",
    "pr_number": 7555,
    "pr_file": "src/main/frontend/handler/shell.cljs",
    "created_at": "2022-12-13T22:07:20+00:00",
    "commented_code": ":success\n      false)))\n \n+(def dangerous-commands",
    "repo_full_name": "logseq/logseq",
    "discussion_comments": [
      {
        "comment_id": "1047801215",
        "repo_full_name": "logseq/logseq",
        "pr_number": 7555,
        "pr_file": "src/main/frontend/handler/shell.cljs",
        "discussion_id": "1047801215",
        "commented_code": "@@ -33,22 +36,36 @@\n      :success\n      false)))\n \n+(def dangerous-commands",
        "comment_created_at": "2022-12-13T22:07:20+00:00",
        "comment_author": "logseq-cldwalker",
        "comment_body": "I'm concerned this list doesn't protect enough. Have we considered something like the shellquote npm lib - https://auth0.com/blog/preventing-command-injection-attacks-in-node-js-apps/#Preventing-Command-Injection?",
        "pr_file_module": null
      }
    ]
  }
]