[
  {
    "discussion_id": "2102151834",
    "pr_number": 34768,
    "pr_file": "app/views/layouts/application.html.haml",
    "created_at": "2025-05-22T09:59:36+00:00",
    "commented_code": "= theme_style_tags current_theme\n     = vite_client_tag\n     = vite_react_refresh_tag\n-    = vite_polyfill_tag crossorigin: 'anonymous'\n+    = vite_polyfills_tag crossorigin: 'anonymous'",
    "repo_full_name": "mastodon/mastodon",
    "discussion_comments": [
      {
        "comment_id": "2102151834",
        "repo_full_name": "mastodon/mastodon",
        "pr_number": 34768,
        "pr_file": "app/views/layouts/application.html.haml",
        "discussion_id": "2102151834",
        "commented_code": "@@ -28,7 +28,7 @@\n     = theme_style_tags current_theme\n     = vite_client_tag\n     = vite_react_refresh_tag\n-    = vite_polyfill_tag crossorigin: 'anonymous'\n+    = vite_polyfills_tag crossorigin: 'anonymous'",
        "comment_created_at": "2025-05-22T09:59:36+00:00",
        "comment_author": "ChaosExAnima",
        "comment_body": "would it make sense to set `crossorigin` to default to anonymous? feels duplicative as it currently is",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1894655121",
    "pr_number": 29391,
    "pr_file": "dist/Caddyfile",
    "created_at": "2024-12-21T16:37:52+00:00",
    "commented_code": "+# This is a Caddyfile, i.e. a configuration file for Caddy.\n+# Caddy (https://caddyserver.com) is a widely used open source web server,\n+# which can replace Nginx as a reverse proxy in front of Mastodon.\n+# If you decide to use Caddy with this configuration file, remember to replace\n+# \"example.com\" with the URL of your Mastodon instance.\n+\n+example.com {\n+\troot * /home/mastodon/live/public\n+\n+\t@staticfiles file\n+\thandle @staticfiles {\n+\t\tfile_server\n+\t}\n+\n+\thandle /api/v1/streaming* {\n+\t\treverse_proxy localhost:4000\n+\t}\n+\n+\thandle * {\n+\t\treverse_proxy localhost:3000\n+\t}\n+\n+\tencode gzip",
    "repo_full_name": "mastodon/mastodon",
    "discussion_comments": [
      {
        "comment_id": "1894655121",
        "repo_full_name": "mastodon/mastodon",
        "pr_number": 29391,
        "pr_file": "dist/Caddyfile",
        "discussion_id": "1894655121",
        "commented_code": "@@ -0,0 +1,42 @@\n+# This is a Caddyfile, i.e. a configuration file for Caddy.\n+# Caddy (https://caddyserver.com) is a widely used open source web server,\n+# which can replace Nginx as a reverse proxy in front of Mastodon.\n+# If you decide to use Caddy with this configuration file, remember to replace\n+# \"example.com\" with the URL of your Mastodon instance.\n+\n+example.com {\n+\troot * /home/mastodon/live/public\n+\n+\t@staticfiles file\n+\thandle @staticfiles {\n+\t\tfile_server\n+\t}\n+\n+\thandle /api/v1/streaming* {\n+\t\treverse_proxy localhost:4000\n+\t}\n+\n+\thandle * {\n+\t\treverse_proxy localhost:3000\n+\t}\n+\n+\tencode gzip",
        "comment_created_at": "2024-12-21T16:37:52+00:00",
        "comment_author": "rriemann",
        "comment_body": "Lets do `encode zstd gzip`\r\n\r\nAccording to <https://caniuse.com/zstd>, 70% of internet users can use zstd encoding. :partying_face: ",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1894655333",
    "pr_number": 29391,
    "pr_file": "dist/Caddyfile",
    "created_at": "2024-12-21T16:39:51+00:00",
    "commented_code": "+# This is a Caddyfile, i.e. a configuration file for Caddy.\n+# Caddy (https://caddyserver.com) is a widely used open source web server,\n+# which can replace Nginx as a reverse proxy in front of Mastodon.\n+# If you decide to use Caddy with this configuration file, remember to replace\n+# \"example.com\" with the URL of your Mastodon instance.\n+\n+example.com {\n+\troot * /home/mastodon/live/public\n+\n+\t@staticfiles file\n+\thandle @staticfiles {\n+\t\tfile_server\n+\t}\n+\n+\thandle /api/v1/streaming* {",
    "repo_full_name": "mastodon/mastodon",
    "discussion_comments": [
      {
        "comment_id": "1894655333",
        "repo_full_name": "mastodon/mastodon",
        "pr_number": 29391,
        "pr_file": "dist/Caddyfile",
        "discussion_id": "1894655333",
        "commented_code": "@@ -0,0 +1,42 @@\n+# This is a Caddyfile, i.e. a configuration file for Caddy.\n+# Caddy (https://caddyserver.com) is a widely used open source web server,\n+# which can replace Nginx as a reverse proxy in front of Mastodon.\n+# If you decide to use Caddy with this configuration file, remember to replace\n+# \"example.com\" with the URL of your Mastodon instance.\n+\n+example.com {\n+\troot * /home/mastodon/live/public\n+\n+\t@staticfiles file\n+\thandle @staticfiles {\n+\t\tfile_server\n+\t}\n+\n+\thandle /api/v1/streaming* {",
        "comment_created_at": "2024-12-21T16:39:51+00:00",
        "comment_author": "rriemann",
        "comment_body": "I have more than one streaming container. Could we document in comments how to deal with this?\r\nTo <https://github.com/mastodon/mastodon/blob/877090518682b6c77ba9bdfa0231afd56daec44d/dist/nginx.conf#L10>, the equivalent would be:\r\n\r\n~~~\r\n        handle /api/v1/streaming* {\r\n                reverse_proxy localhost:4000 localhost:4001 {\r\n                        lb_policy least_conn\r\n                        health_uri /api/v1/streaming/health\r\n                }\r\n        }\r\n~~~",
        "pr_file_module": null
      }
    ]
  }
]