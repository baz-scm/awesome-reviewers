[
  {
    "discussion_id": "2065638741",
    "pr_number": 34568,
    "pr_file": "app/javascript/mastodon/hooks/useAccountId.ts",
    "created_at": "2025-04-29T06:53:52+00:00",
    "commented_code": "}\n   }, [dispatch, accountId, acct, isAccount]);\n \n-  return accountId;\n+  if (accountId) {\n+    return accountId;\n+  }\n+\n+  return undefined;",
    "repo_full_name": "mastodon/mastodon",
    "discussion_comments": [
      {
        "comment_id": "2065638741",
        "repo_full_name": "mastodon/mastodon",
        "pr_number": 34568,
        "pr_file": "app/javascript/mastodon/hooks/useAccountId.ts",
        "discussion_id": "2065638741",
        "commented_code": "@@ -33,5 +32,9 @@ export function useAccountId() {\n     }\n   }, [dispatch, accountId, acct, isAccount]);\n \n-  return accountId;\n+  if (accountId) {\n+    return accountId;\n+  }\n+\n+  return undefined;",
        "comment_created_at": "2025-04-29T06:53:52+00:00",
        "comment_author": "ClearlyClaire",
        "comment_body": "Maybe the following might be a little easier to read?\r\n```suggestion\r\n  return accountId ?? undefined;\r\n```",
        "pr_file_module": null
      },
      {
        "comment_id": "2065654319",
        "repo_full_name": "mastodon/mastodon",
        "pr_number": 34568,
        "pr_file": "app/javascript/mastodon/hooks/useAccountId.ts",
        "discussion_id": "2065638741",
        "commented_code": "@@ -33,5 +32,9 @@ export function useAccountId() {\n     }\n   }, [dispatch, accountId, acct, isAccount]);\n \n-  return accountId;\n+  if (accountId) {\n+    return accountId;\n+  }\n+\n+  return undefined;",
        "comment_created_at": "2025-04-29T07:00:15+00:00",
        "comment_author": "ClearlyClaire",
        "comment_body": "But overall, the previous version had an actual issue where it could return a string, `undefined` or `null` but the types were overridden so Typescript was considering only `string` and `undefined`. I think in some places (probably non-Typescript only) we rely on the difference between `undefined` and `null`, as `undefined` means \u201cwe haven't fetched it yet\u201d and `null` means \u201cit does not exist\u201d.\r\n\r\nIf I'm wrong and we never make the distinction, we probably should never store `null` and instead delete from the map, simplifying the type and having `string | undefined` everywhere.",
        "pr_file_module": null
      },
      {
        "comment_id": "2065659701",
        "repo_full_name": "mastodon/mastodon",
        "pr_number": 34568,
        "pr_file": "app/javascript/mastodon/hooks/useAccountId.ts",
        "discussion_id": "2065638741",
        "commented_code": "@@ -33,5 +32,9 @@ export function useAccountId() {\n     }\n   }, [dispatch, accountId, acct, isAccount]);\n \n-  return accountId;\n+  if (accountId) {\n+    return accountId;\n+  }\n+\n+  return undefined;",
        "comment_created_at": "2025-04-29T07:04:43+00:00",
        "comment_author": "ClearlyClaire",
        "comment_body": "We indeed do make a distinction in at least `app/javascript/mastodon/features/account_timeline/index.jsx`, with `https://mastodon.social/@bogus@example.com` displaying a 404, but `app/javascript/mastodon/features/account_featured/index.tsx`, not making that distinction, displays an infinite spinner: `https://mastodon.social/@bogus@example.com/featured`",
        "pr_file_module": null
      },
      {
        "comment_id": "2065995057",
        "repo_full_name": "mastodon/mastodon",
        "pr_number": 34568,
        "pr_file": "app/javascript/mastodon/hooks/useAccountId.ts",
        "discussion_id": "2065638741",
        "commented_code": "@@ -33,5 +32,9 @@ export function useAccountId() {\n     }\n   }, [dispatch, accountId, acct, isAccount]);\n \n-  return accountId;\n+  if (accountId) {\n+    return accountId;\n+  }\n+\n+  return undefined;",
        "comment_created_at": "2025-04-29T10:14:46+00:00",
        "comment_author": "Gargron",
        "comment_body": "Thanks, I think I made it better!",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1807336242",
    "pr_number": 32593,
    "pr_file": "app/javascript/mastodon/models/account.ts",
    "created_at": "2024-10-19T13:44:58+00:00",
    "commented_code": "note_plain: string | null;\n   hidden: boolean;\n   moved: string | null;\n+  avatar_description: string | null;\n+  header_description: string | null;",
    "repo_full_name": "mastodon/mastodon",
    "discussion_comments": [
      {
        "comment_id": "1807336242",
        "repo_full_name": "mastodon/mastodon",
        "pr_number": 32593,
        "pr_file": "app/javascript/mastodon/models/account.ts",
        "discussion_id": "1807336242",
        "commented_code": "@@ -56,6 +56,8 @@ export interface AccountShape\n   note_plain: string | null;\n   hidden: boolean;\n   moved: string | null;\n+  avatar_description: string | null;\n+  header_description: string | null;",
        "comment_created_at": "2024-10-19T13:44:58+00:00",
        "comment_author": "ThisIsMissEm",
        "comment_body": "Then you'd not need string | null as the type \u2014 an empty string is as food as null in this case: there is no description to show.",
        "pr_file_module": null
      }
    ]
  }
]