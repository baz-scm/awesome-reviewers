[
  {
    "discussion_id": "2161833448",
    "pr_number": 12294,
    "pr_file": "compute/etc/sql_exporter/autovacuum_stats.libsonnet",
    "created_at": "2025-06-23T14:55:27+00:00",
    "commented_code": "+{\n+  metric_name: 'pg_autovacuum_stats',\n+  type: 'gauge',\n+  help: 'Autovacuum statistics for all tables across databases',\n+  key_labels: [\n+    'database_name',\n+  ],\n+  value_label: 'metric',\n+  values: [\n+    'oldest_mxid',\n+    'oldest_frozen_xid',\n+  ],",
    "repo_full_name": "neondatabase/neon",
    "discussion_comments": [
      {
        "comment_id": "2161833448",
        "repo_full_name": "neondatabase/neon",
        "pr_number": 12294,
        "pr_file": "compute/etc/sql_exporter/autovacuum_stats.libsonnet",
        "discussion_id": "2161833448",
        "commented_code": "@@ -0,0 +1,14 @@\n+{\n+  metric_name: 'pg_autovacuum_stats',\n+  type: 'gauge',\n+  help: 'Autovacuum statistics for all tables across databases',\n+  key_labels: [\n+    'database_name',\n+  ],\n+  value_label: 'metric',\n+  values: [\n+    'oldest_mxid',\n+    'oldest_frozen_xid',\n+  ],",
        "comment_created_at": "2025-06-23T14:55:27+00:00",
        "comment_author": "ololobus",
        "comment_body": "I think it's not considered a best-practice, in the docs it's formulated like\r\n\r\n> As a rule of thumb, either the sum() or the avg() over all dimensions of a given metric should be meaningful (though not necessarily useful). If it is not meaningful, split the data up into multiple metrics.\r\n\r\nhttps://prometheus.io/docs/practices/naming/ (see other suggestions there)\r\n\r\nI suggest you split it into two separate metrics with a clear meaning",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2140793798",
    "pr_number": 12197,
    "pr_file": "compute/etc/sql_exporter/autovacuum_stats.libsonnet",
    "created_at": "2025-06-11T18:10:55+00:00",
    "commented_code": "+{\n+  metric_name: 'pg_autovacuum_stats',\n+  type: 'gauge',",
    "repo_full_name": "neondatabase/neon",
    "discussion_comments": [
      {
        "comment_id": "2140793798",
        "repo_full_name": "neondatabase/neon",
        "pr_number": 12197,
        "pr_file": "compute/etc/sql_exporter/autovacuum_stats.libsonnet",
        "discussion_id": "2140793798",
        "commented_code": "@@ -0,0 +1,13 @@\n+{\n+  metric_name: 'pg_autovacuum_stats',\n+  type: 'gauge',",
        "comment_created_at": "2025-06-11T18:10:55+00:00",
        "comment_author": "myrrc",
        "comment_body": "I thing `counter` is better since \"number of autovacuum runs\" is non-decreasing",
        "pr_file_module": null
      },
      {
        "comment_id": "2140813170",
        "repo_full_name": "neondatabase/neon",
        "pr_number": 12197,
        "pr_file": "compute/etc/sql_exporter/autovacuum_stats.libsonnet",
        "discussion_id": "2140793798",
        "commented_code": "@@ -0,0 +1,13 @@\n+{\n+  metric_name: 'pg_autovacuum_stats',\n+  type: 'gauge',",
        "comment_created_at": "2025-06-11T18:22:27+00:00",
        "comment_author": "MMeent",
        "comment_body": "If a table is dropped, its count is presumably removed from the total, too.",
        "pr_file_module": null
      }
    ]
  }
]