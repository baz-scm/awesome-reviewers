[
  {
    "discussion_id": "1036671058",
    "pr_number": 10623,
    "pr_file": "sample/01-cats-app/src/cats/cats.service.spec.ts",
    "created_at": "2022-12-01T04:08:02+00:00",
    "commented_code": "+import { Test } from '@nestjs/testing';\n+import { CatsService } from './cats.service';\n+import { Cat } from './interfaces/cat.interface';\n+\n+describe('CatsService', () => {\n+  let catsService: CatsService;\n+\n+  beforeEach(async () => {\n+    const moduleRef = await Test.createTestingModule({\n+      providers: [CatsService],\n+    }).compile();\n+\n+    catsService = moduleRef.get<CatsService>(CatsService);\n+  });\n+\n+  describe('findAll', () => {\n+    it('should return an array of cats', async () => {\n+      const result = [\n+        {\n+          name: 'Frajola',\n+          age: 2,\n+          breed: 'Stray',\n+        },\n+      ];\n+      jest.spyOn(catsService, 'findAll').mockImplementation(() => result);",
    "repo_full_name": "nestjs/nest",
    "discussion_comments": [
      {
        "comment_id": "1036671058",
        "repo_full_name": "nestjs/nest",
        "pr_number": 10623,
        "pr_file": "sample/01-cats-app/src/cats/cats.service.spec.ts",
        "discussion_id": "1036671058",
        "commented_code": "@@ -0,0 +1,46 @@\n+import { Test } from '@nestjs/testing';\n+import { CatsService } from './cats.service';\n+import { Cat } from './interfaces/cat.interface';\n+\n+describe('CatsService', () => {\n+  let catsService: CatsService;\n+\n+  beforeEach(async () => {\n+    const moduleRef = await Test.createTestingModule({\n+      providers: [CatsService],\n+    }).compile();\n+\n+    catsService = moduleRef.get<CatsService>(CatsService);\n+  });\n+\n+  describe('findAll', () => {\n+    it('should return an array of cats', async () => {\n+      const result = [\n+        {\n+          name: 'Frajola',\n+          age: 2,\n+          breed: 'Stray',\n+        },\n+      ];\n+      jest.spyOn(catsService, 'findAll').mockImplementation(() => result);",
        "comment_created_at": "2022-12-01T04:08:02+00:00",
        "comment_author": "micalevisk",
        "comment_body": "```suggestion\r\n```\r\n\r\nif we're testing `CatsService#findAll`, we shouldn't mock its implementation, otherwise we end up testing nothing.\r\n\r\nInstead, you somehow should do `catService.cats = result`. I guess it's fine do write it like this:\r\n\r\n```ts\r\n// @ts-ignore\r\ncatService.cats = result\r\n```\r\n",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1030747625",
    "pr_number": 10390,
    "pr_file": "packages/core/test/middleware/middleware-module.spec.ts",
    "created_at": "2022-11-23T18:03:10+00:00",
    "commented_code": "expect(createMiddlewareFactoryStub.calledOnce).to.be.true;\n     });\n   });\n+  describe('getPaths', () => {",
    "repo_full_name": "nestjs/nest",
    "discussion_comments": [
      {
        "comment_id": "1030747625",
        "repo_full_name": "nestjs/nest",
        "pr_number": 10390,
        "pr_file": "packages/core/test/middleware/middleware-module.spec.ts",
        "discussion_id": "1030747625",
        "commented_code": "@@ -196,4 +198,85 @@ describe('MiddlewareModule', () => {\n       expect(createMiddlewareFactoryStub.calledOnce).to.be.true;\n     });\n   });\n+  describe('getPaths', () => {",
        "comment_created_at": "2022-11-23T18:03:10+00:00",
        "comment_author": "thiagomini",
        "comment_body": "I appreciate that you are trying to add tests for this behavior Cody, but the short answer here is: We shouldn't test **private** functions. Instead, our integration tests / unit tests executed by the **public** methods are meant to guarantee this part of the code too.\r\n\r\n**Now a longer answer:**\r\n\r\nGood tests are meant not only to guarantee our code behaves as we expect but also to facilitate the refactoring of classes, functions, and modules. Because of that, if we end up testing a **private** function, it means we are testing a specific **implementation detail**. Imagine that we want to change the way we get paths for the `MiddlewareModule`, completely removing this private function and relying on another class. This would cause this test to fail. In summary, we should test **behaviors** in a \"black-box\" perspective:\r\n\r\n1. Given a scenario (condition)\r\n2. When something happens (a function is called)\r\n3. We expect a specific output (either a return value or a side-effect, for instance, a new record in the database)\r\n\r\nIn this case, I imagine you needed to test this code because it's not simple! This is a reasonable thought. However, when that occurs for a **private** method, it indicates we have an [Iceberg class anti-pattern](https://deviq.com/antipatterns/iceberg-class). In short, it means we have too many responsibilities for a private function in a way that is hard to test its behavior via the public interface (in this case, the `MiddlewareModule` public method called `register`). \r\n\r\nSo, you might ask, what should we do? Well, I see 2 alternatives here:\r\n\r\n1. Ensure the behavior you are trying to test here is actually covered by integration tests\r\n2. Create a separate class that is responsible for retrieving the `paths`. That way, you can have tests for its public interface **and** inject it as a dependency for the `MiddlewareModule`. A name suggestion for this class could be `RouteInfoPathExtractor`.\r\n\r\nFinally, if you want to know more about tests, I highly recommend reading [Fundamentals of Automated Testing](https://trilon.io/blog/fundamentals-of-automated-testing-unit-tests-basic-concepts), a blog post from a colleague here at Trilon. You can also check out my own post called [Advanced Testing Strategies with Mocks in NestJS](https://trilon.io/blog/advanced-testing-strategies-with-mocks-in-nestjs).",
        "pr_file_module": null
      },
      {
        "comment_id": "1030994767",
        "repo_full_name": "nestjs/nest",
        "pr_number": 10390,
        "pr_file": "packages/core/test/middleware/middleware-module.spec.ts",
        "discussion_id": "1030747625",
        "commented_code": "@@ -196,4 +198,85 @@ describe('MiddlewareModule', () => {\n       expect(createMiddlewareFactoryStub.calledOnce).to.be.true;\n     });\n   });\n+  describe('getPaths', () => {",
        "comment_created_at": "2022-11-24T02:06:53+00:00",
        "comment_author": "CodyTseng",
        "comment_body": "Thank you so much for taking the time to give me such detailed advice! I think I will learn a lot from your advice. And I will find time to read the blogs you recommend.\r\n\r\nFinally, I might choose the second solution. Because I think it will be complicated to cover all situation by integration tests 😁",
        "pr_file_module": null
      },
      {
        "comment_id": "1031453457",
        "repo_full_name": "nestjs/nest",
        "pr_number": 10390,
        "pr_file": "packages/core/test/middleware/middleware-module.spec.ts",
        "discussion_id": "1030747625",
        "commented_code": "@@ -196,4 +198,85 @@ describe('MiddlewareModule', () => {\n       expect(createMiddlewareFactoryStub.calledOnce).to.be.true;\n     });\n   });\n+  describe('getPaths', () => {",
        "comment_created_at": "2022-11-24T12:24:59+00:00",
        "comment_author": "thiagomini",
        "comment_body": "You are welcome, Cody. Glad to know I could help!",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "729397177",
    "pr_number": 8044,
    "pr_file": "sample/07-sequelize/src/users/users.controller.spec.ts",
    "created_at": "2021-10-14T22:51:26+00:00",
    "commented_code": "+import { Test, TestingModule } from '@nestjs/testing';\n+import { CreateUserDto } from './dto/create-user.dto';\n+import { UsersController } from './users.controller';\n+import { UsersService } from './users.service';\n+\n+const createUserDto: CreateUserDto = {\n+  firstName: 'firstName #1',\n+  lastName: 'lastName #1',\n+};\n+\n+describe('UsersController', () => {\n+  let usersController: UsersController;\n+  let usersService: UsersService;\n+\n+  beforeEach(async () => {\n+    const app: TestingModule = await Test.createTestingModule({\n+      controllers: [UsersController],\n+      providers: [\n+        UsersService,\n+        {\n+          provide: UsersService,\n+          useValue: {\n+            create: jest\n+              .fn()\n+              .mockImplementation((user: CreateUserDto) =>\n+                Promise.resolve({ id: 'a id', ...user }),\n+              ),\n+            findAll: jest.fn().mockResolvedValue([\n+              {\n+                firstName: 'firstName #1',\n+                lastName: 'lastName #1',\n+              },\n+              {\n+                firstName: 'firstName #2',\n+                lastName: 'lastName #2',\n+              },\n+            ]),\n+            findOne: jest.fn().mockImplementation((id: string) =>\n+              Promise.resolve({\n+                firstName: 'firstName #1',\n+                lastName: 'lastName #1',\n+                id,\n+              }),\n+            ),\n+            remove: jest.fn(),\n+          },\n+        },\n+      ],\n+    }).compile();\n+\n+    usersController = app.get<UsersController>(UsersController);\n+    usersService = app.get<UsersService>(UsersService);\n+  });\n+\n+  it('should be defined', () => {\n+    expect(usersController).toBeDefined();\n+  });\n+\n+  describe('create()', () => {\n+    it('should create an user', () => {\n+      usersController.create(createUserDto);\n+      expect(usersService.create).toHaveBeenCalled();\n+      expect(usersService.create).toHaveBeenCalledWith(createUserDto);\n+      expect(usersController.create(createUserDto)).resolves.toEqual({\n+        id: 'a id',\n+        ...createUserDto,\n+      });",
    "repo_full_name": "nestjs/nest",
    "discussion_comments": [
      {
        "comment_id": "729397177",
        "repo_full_name": "nestjs/nest",
        "pr_number": 8044,
        "pr_file": "sample/07-sequelize/src/users/users.controller.spec.ts",
        "discussion_id": "729397177",
        "commented_code": "@@ -0,0 +1,96 @@\n+import { Test, TestingModule } from '@nestjs/testing';\n+import { CreateUserDto } from './dto/create-user.dto';\n+import { UsersController } from './users.controller';\n+import { UsersService } from './users.service';\n+\n+const createUserDto: CreateUserDto = {\n+  firstName: 'firstName #1',\n+  lastName: 'lastName #1',\n+};\n+\n+describe('UsersController', () => {\n+  let usersController: UsersController;\n+  let usersService: UsersService;\n+\n+  beforeEach(async () => {\n+    const app: TestingModule = await Test.createTestingModule({\n+      controllers: [UsersController],\n+      providers: [\n+        UsersService,\n+        {\n+          provide: UsersService,\n+          useValue: {\n+            create: jest\n+              .fn()\n+              .mockImplementation((user: CreateUserDto) =>\n+                Promise.resolve({ id: 'a id', ...user }),\n+              ),\n+            findAll: jest.fn().mockResolvedValue([\n+              {\n+                firstName: 'firstName #1',\n+                lastName: 'lastName #1',\n+              },\n+              {\n+                firstName: 'firstName #2',\n+                lastName: 'lastName #2',\n+              },\n+            ]),\n+            findOne: jest.fn().mockImplementation((id: string) =>\n+              Promise.resolve({\n+                firstName: 'firstName #1',\n+                lastName: 'lastName #1',\n+                id,\n+              }),\n+            ),\n+            remove: jest.fn(),\n+          },\n+        },\n+      ],\n+    }).compile();\n+\n+    usersController = app.get<UsersController>(UsersController);\n+    usersService = app.get<UsersService>(UsersService);\n+  });\n+\n+  it('should be defined', () => {\n+    expect(usersController).toBeDefined();\n+  });\n+\n+  describe('create()', () => {\n+    it('should create an user', () => {\n+      usersController.create(createUserDto);\n+      expect(usersService.create).toHaveBeenCalled();\n+      expect(usersService.create).toHaveBeenCalledWith(createUserDto);\n+      expect(usersController.create(createUserDto)).resolves.toEqual({\n+        id: 'a id',\n+        ...createUserDto,\n+      });",
        "comment_created_at": "2021-10-14T22:51:26+00:00",
        "comment_author": "jmcdo29",
        "comment_body": "```suggestion\r\n      expect(usersController.create(createUserDto)).resolves.toEqual({\r\n        id: 'a id',\r\n        ...createUserDto,\r\n      });\r\n      expect(usersService.create).toHaveBeenCalled();\r\n      expect(usersService.create).toHaveBeenCalledWith(createUserDto);\r\n```\r\nNo need to call `usersController.create` twice. ",
        "pr_file_module": null
      },
      {
        "comment_id": "729633815",
        "repo_full_name": "nestjs/nest",
        "pr_number": 8044,
        "pr_file": "sample/07-sequelize/src/users/users.controller.spec.ts",
        "discussion_id": "729397177",
        "commented_code": "@@ -0,0 +1,96 @@\n+import { Test, TestingModule } from '@nestjs/testing';\n+import { CreateUserDto } from './dto/create-user.dto';\n+import { UsersController } from './users.controller';\n+import { UsersService } from './users.service';\n+\n+const createUserDto: CreateUserDto = {\n+  firstName: 'firstName #1',\n+  lastName: 'lastName #1',\n+};\n+\n+describe('UsersController', () => {\n+  let usersController: UsersController;\n+  let usersService: UsersService;\n+\n+  beforeEach(async () => {\n+    const app: TestingModule = await Test.createTestingModule({\n+      controllers: [UsersController],\n+      providers: [\n+        UsersService,\n+        {\n+          provide: UsersService,\n+          useValue: {\n+            create: jest\n+              .fn()\n+              .mockImplementation((user: CreateUserDto) =>\n+                Promise.resolve({ id: 'a id', ...user }),\n+              ),\n+            findAll: jest.fn().mockResolvedValue([\n+              {\n+                firstName: 'firstName #1',\n+                lastName: 'lastName #1',\n+              },\n+              {\n+                firstName: 'firstName #2',\n+                lastName: 'lastName #2',\n+              },\n+            ]),\n+            findOne: jest.fn().mockImplementation((id: string) =>\n+              Promise.resolve({\n+                firstName: 'firstName #1',\n+                lastName: 'lastName #1',\n+                id,\n+              }),\n+            ),\n+            remove: jest.fn(),\n+          },\n+        },\n+      ],\n+    }).compile();\n+\n+    usersController = app.get<UsersController>(UsersController);\n+    usersService = app.get<UsersService>(UsersService);\n+  });\n+\n+  it('should be defined', () => {\n+    expect(usersController).toBeDefined();\n+  });\n+\n+  describe('create()', () => {\n+    it('should create an user', () => {\n+      usersController.create(createUserDto);\n+      expect(usersService.create).toHaveBeenCalled();\n+      expect(usersService.create).toHaveBeenCalledWith(createUserDto);\n+      expect(usersController.create(createUserDto)).resolves.toEqual({\n+        id: 'a id',\n+        ...createUserDto,\n+      });",
        "comment_created_at": "2021-10-15T08:41:14+00:00",
        "comment_author": "Tony133",
        "comment_body": "Done! 👍",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "723406321",
    "pr_number": 8036,
    "pr_file": "sample/06-mongoose/src/cats/cats.controller.spec.ts",
    "created_at": "2021-10-06T15:38:08+00:00",
    "commented_code": "+import { Test, TestingModule } from '@nestjs/testing';\n+import { CatsController } from './cats.controller';\n+import { CreateCatDto } from './dto/create-cat.dto';\n+import { CatsService } from './cats.service';\n+\n+describe('Cats Controller', () => {\n+  let controller: CatsController;\n+  let service: CatsService;\n+  const createCatDto: CreateCatDto = {\n+    name: 'Cat #1',\n+    breed: 'Breed #1',\n+    age: 4,\n+  };\n+\n+  const mockCat = {\n+    name: 'Cat #1',\n+    breed: 'Breed #1',\n+    age: 4,\n+    _id: 'a id',\n+  };\n+\n+  beforeEach(async () => {\n+    const module: TestingModule = await Test.createTestingModule({\n+      controllers: [CatsController],\n+      providers: [\n+        {\n+          provide: CatsService,\n+          useValue: {\n+            findAll: jest.fn().mockResolvedValue([\n+              {\n+                name: 'Cat #1',\n+                breed: 'Bread #1',\n+                age: 4,\n+              },\n+              {\n+                name: 'Cat #2',\n+                breed: 'Breed #2',\n+                age: 3,\n+              },\n+              {\n+                name: 'Cat #3',\n+                breed: 'Breed #3',\n+                age: 2,\n+              },\n+            ]),\n+            create: jest.fn().mockResolvedValue(createCatDto),\n+          },\n+        },\n+      ],\n+    }).compile();\n+\n+    controller = module.get<CatsController>(CatsController);\n+    service = module.get<CatsService>(CatsService);\n+  });\n+\n+  describe('create()', () => {\n+    it('should create a new cat', async () => {\n+      const createSpy = jest\n+        .spyOn(service, 'create')\n+        .mockResolvedValueOnce(mockCat);\n+\n+      await controller.create(createCatDto);\n+      expect(createSpy).toHaveBeenCalledWith(createCatDto);\n+    });\n+  });\n+\n+  describe('findAll()', () => {\n+    it('should get an array of cats', async () => {\n+      await controller.findAll();\n+      expect(service.findAll).toHaveBeenCalled();\n+      expect(controller.findAll()).resolves.toEqual([\n+        {\n+          name: 'Cat #1',\n+          breed: 'Bread #1',\n+          age: 4,\n+        },\n+        {\n+          name: 'Cat #2',\n+          breed: 'Breed #2',\n+          age: 3,\n+        },\n+        {\n+          name: 'Cat #3',\n+          breed: 'Breed #3',\n+          age: 2,\n+        },\n+      ]);",
    "repo_full_name": "nestjs/nest",
    "discussion_comments": [
      {
        "comment_id": "723406321",
        "repo_full_name": "nestjs/nest",
        "pr_number": 8036,
        "pr_file": "sample/06-mongoose/src/cats/cats.controller.spec.ts",
        "discussion_id": "723406321",
        "commented_code": "@@ -0,0 +1,90 @@\n+import { Test, TestingModule } from '@nestjs/testing';\n+import { CatsController } from './cats.controller';\n+import { CreateCatDto } from './dto/create-cat.dto';\n+import { CatsService } from './cats.service';\n+\n+describe('Cats Controller', () => {\n+  let controller: CatsController;\n+  let service: CatsService;\n+  const createCatDto: CreateCatDto = {\n+    name: 'Cat #1',\n+    breed: 'Breed #1',\n+    age: 4,\n+  };\n+\n+  const mockCat = {\n+    name: 'Cat #1',\n+    breed: 'Breed #1',\n+    age: 4,\n+    _id: 'a id',\n+  };\n+\n+  beforeEach(async () => {\n+    const module: TestingModule = await Test.createTestingModule({\n+      controllers: [CatsController],\n+      providers: [\n+        {\n+          provide: CatsService,\n+          useValue: {\n+            findAll: jest.fn().mockResolvedValue([\n+              {\n+                name: 'Cat #1',\n+                breed: 'Bread #1',\n+                age: 4,\n+              },\n+              {\n+                name: 'Cat #2',\n+                breed: 'Breed #2',\n+                age: 3,\n+              },\n+              {\n+                name: 'Cat #3',\n+                breed: 'Breed #3',\n+                age: 2,\n+              },\n+            ]),\n+            create: jest.fn().mockResolvedValue(createCatDto),\n+          },\n+        },\n+      ],\n+    }).compile();\n+\n+    controller = module.get<CatsController>(CatsController);\n+    service = module.get<CatsService>(CatsService);\n+  });\n+\n+  describe('create()', () => {\n+    it('should create a new cat', async () => {\n+      const createSpy = jest\n+        .spyOn(service, 'create')\n+        .mockResolvedValueOnce(mockCat);\n+\n+      await controller.create(createCatDto);\n+      expect(createSpy).toHaveBeenCalledWith(createCatDto);\n+    });\n+  });\n+\n+  describe('findAll()', () => {\n+    it('should get an array of cats', async () => {\n+      await controller.findAll();\n+      expect(service.findAll).toHaveBeenCalled();\n+      expect(controller.findAll()).resolves.toEqual([\n+        {\n+          name: 'Cat #1',\n+          breed: 'Bread #1',\n+          age: 4,\n+        },\n+        {\n+          name: 'Cat #2',\n+          breed: 'Breed #2',\n+          age: 3,\n+        },\n+        {\n+          name: 'Cat #3',\n+          breed: 'Breed #3',\n+          age: 2,\n+        },\n+      ]);",
        "comment_created_at": "2021-10-06T15:38:08+00:00",
        "comment_author": "jmcdo29",
        "comment_body": "There's no need to call `controller.findAll()` twice in the test. Just call it in the assertion and then do the jest check after it\r\n```suggestion\r\n      expect(controller.findAll()).resolves.toEqual([\r\n        {\r\n          name: 'Cat #1',\r\n          breed: 'Bread #1',\r\n          age: 4,\r\n        },\r\n        {\r\n          name: 'Cat #2',\r\n          breed: 'Breed #2',\r\n          age: 3,\r\n        },\r\n        {\r\n          name: 'Cat #3',\r\n          breed: 'Breed #3',\r\n          age: 2,\r\n        },\r\n      ]);\r\n      expect(service.findAll).toHaveBeenCalled();\r\n```",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "702448282",
    "pr_number": 8032,
    "pr_file": "sample/05-sql-typeorm/src/users/users.service.spec.ts",
    "created_at": "2021-09-05T16:36:23+00:00",
    "commented_code": "+import { Test, TestingModule } from '@nestjs/testing';\n+import { getRepositoryToken } from '@nestjs/typeorm';\n+import { User } from './user.entity';\n+import { UsersService } from './users.service';\n+import { Repository } from 'typeorm';\n+\n+const userArray = [\n+  {\n+    firstName: 'firstName #1',\n+    lastName: 'lastName #1',\n+  },\n+  {\n+    firstName: 'firstName #2',\n+    lastName: 'lastName #2',\n+  },\n+];\n+\n+const oneUser = {\n+  firstName: 'firstName #1',\n+  lastName: 'lastName #1',\n+};\n+\n+describe('UserService', () => {\n+  let service: UsersService;\n+  let repository: Repository<User>;\n+\n+  beforeEach(async () => {\n+    const module: TestingModule = await Test.createTestingModule({\n+      providers: [\n+        UsersService,\n+        {\n+          provide: getRepositoryToken(User),\n+          useValue: {\n+            find: jest.fn().mockResolvedValue(userArray),\n+            findOne: jest.fn().mockResolvedValue(oneUser),\n+            save: jest.fn(),\n+            remove: jest.fn(),\n+            delete: jest.fn(),\n+          },\n+        },\n+      ],\n+    }).compile();\n+\n+    service = module.get<UsersService>(UsersService);\n+    repository = module.get<Repository<User>>(getRepositoryToken(User));\n+  });\n+\n+  it('should be defined', () => {\n+    expect(service).toBeDefined();\n+  });\n+\n+  describe('create()', () => {\n+    it('should successfully insert a user', () => {\n+      const user = {\n+        firstName: 'firstName #1',\n+        lastName: 'lastName #1',\n+      };\n+      expect(user).toEqual(user);\n+    });\n+  });\n+\n+  describe('findAll()', () => {\n+    it('should return an array of users', async () => {\n+      const users = await service.findAll();\n+      expect(users).toEqual(userArray);\n+    });\n+  });\n+\n+  describe('findOne()', () => {\n+    it('should get a single user', () => {\n+      const repoSpy = jest.spyOn(repository, 'findOne');\n+      expect(service.findOne('a id')).resolves.toEqual(oneUser);\n+      expect(repoSpy).toBeCalledWith('a id');\n+    });\n+  });\n+\n+  describe('remove()', () => {\n+    it('should remove a user', async () => {\n+      const removeUserSpy = jest.spyOn(service, 'remove');\n+      service.remove('anyid');\n+      expect(removeUserSpy).toHaveBeenCalledWith('anyid');",
    "repo_full_name": "nestjs/nest",
    "discussion_comments": [
      {
        "comment_id": "702448282",
        "repo_full_name": "nestjs/nest",
        "pr_number": 8032,
        "pr_file": "sample/05-sql-typeorm/src/users/users.service.spec.ts",
        "discussion_id": "702448282",
        "commented_code": "@@ -0,0 +1,84 @@\n+import { Test, TestingModule } from '@nestjs/testing';\n+import { getRepositoryToken } from '@nestjs/typeorm';\n+import { User } from './user.entity';\n+import { UsersService } from './users.service';\n+import { Repository } from 'typeorm';\n+\n+const userArray = [\n+  {\n+    firstName: 'firstName #1',\n+    lastName: 'lastName #1',\n+  },\n+  {\n+    firstName: 'firstName #2',\n+    lastName: 'lastName #2',\n+  },\n+];\n+\n+const oneUser = {\n+  firstName: 'firstName #1',\n+  lastName: 'lastName #1',\n+};\n+\n+describe('UserService', () => {\n+  let service: UsersService;\n+  let repository: Repository<User>;\n+\n+  beforeEach(async () => {\n+    const module: TestingModule = await Test.createTestingModule({\n+      providers: [\n+        UsersService,\n+        {\n+          provide: getRepositoryToken(User),\n+          useValue: {\n+            find: jest.fn().mockResolvedValue(userArray),\n+            findOne: jest.fn().mockResolvedValue(oneUser),\n+            save: jest.fn(),\n+            remove: jest.fn(),\n+            delete: jest.fn(),\n+          },\n+        },\n+      ],\n+    }).compile();\n+\n+    service = module.get<UsersService>(UsersService);\n+    repository = module.get<Repository<User>>(getRepositoryToken(User));\n+  });\n+\n+  it('should be defined', () => {\n+    expect(service).toBeDefined();\n+  });\n+\n+  describe('create()', () => {\n+    it('should successfully insert a user', () => {\n+      const user = {\n+        firstName: 'firstName #1',\n+        lastName: 'lastName #1',\n+      };\n+      expect(user).toEqual(user);\n+    });\n+  });\n+\n+  describe('findAll()', () => {\n+    it('should return an array of users', async () => {\n+      const users = await service.findAll();\n+      expect(users).toEqual(userArray);\n+    });\n+  });\n+\n+  describe('findOne()', () => {\n+    it('should get a single user', () => {\n+      const repoSpy = jest.spyOn(repository, 'findOne');\n+      expect(service.findOne('a id')).resolves.toEqual(oneUser);\n+      expect(repoSpy).toBeCalledWith('a id');\n+    });\n+  });\n+\n+  describe('remove()', () => {\n+    it('should remove a user', async () => {\n+      const removeUserSpy = jest.spyOn(service, 'remove');\n+      service.remove('anyid');\n+      expect(removeUserSpy).toHaveBeenCalledWith('anyid');",
        "comment_created_at": "2021-09-05T16:36:23+00:00",
        "comment_author": "jmcdo29",
        "comment_body": "This isn't an actual test of anything. You mock the value you want to call and assert the test just called the service method. This should instead mock the repository method used in `service.remove`",
        "pr_file_module": null
      },
      {
        "comment_id": "702463384",
        "repo_full_name": "nestjs/nest",
        "pr_number": 8032,
        "pr_file": "sample/05-sql-typeorm/src/users/users.service.spec.ts",
        "discussion_id": "702448282",
        "commented_code": "@@ -0,0 +1,84 @@\n+import { Test, TestingModule } from '@nestjs/testing';\n+import { getRepositoryToken } from '@nestjs/typeorm';\n+import { User } from './user.entity';\n+import { UsersService } from './users.service';\n+import { Repository } from 'typeorm';\n+\n+const userArray = [\n+  {\n+    firstName: 'firstName #1',\n+    lastName: 'lastName #1',\n+  },\n+  {\n+    firstName: 'firstName #2',\n+    lastName: 'lastName #2',\n+  },\n+];\n+\n+const oneUser = {\n+  firstName: 'firstName #1',\n+  lastName: 'lastName #1',\n+};\n+\n+describe('UserService', () => {\n+  let service: UsersService;\n+  let repository: Repository<User>;\n+\n+  beforeEach(async () => {\n+    const module: TestingModule = await Test.createTestingModule({\n+      providers: [\n+        UsersService,\n+        {\n+          provide: getRepositoryToken(User),\n+          useValue: {\n+            find: jest.fn().mockResolvedValue(userArray),\n+            findOne: jest.fn().mockResolvedValue(oneUser),\n+            save: jest.fn(),\n+            remove: jest.fn(),\n+            delete: jest.fn(),\n+          },\n+        },\n+      ],\n+    }).compile();\n+\n+    service = module.get<UsersService>(UsersService);\n+    repository = module.get<Repository<User>>(getRepositoryToken(User));\n+  });\n+\n+  it('should be defined', () => {\n+    expect(service).toBeDefined();\n+  });\n+\n+  describe('create()', () => {\n+    it('should successfully insert a user', () => {\n+      const user = {\n+        firstName: 'firstName #1',\n+        lastName: 'lastName #1',\n+      };\n+      expect(user).toEqual(user);\n+    });\n+  });\n+\n+  describe('findAll()', () => {\n+    it('should return an array of users', async () => {\n+      const users = await service.findAll();\n+      expect(users).toEqual(userArray);\n+    });\n+  });\n+\n+  describe('findOne()', () => {\n+    it('should get a single user', () => {\n+      const repoSpy = jest.spyOn(repository, 'findOne');\n+      expect(service.findOne('a id')).resolves.toEqual(oneUser);\n+      expect(repoSpy).toBeCalledWith('a id');\n+    });\n+  });\n+\n+  describe('remove()', () => {\n+    it('should remove a user', async () => {\n+      const removeUserSpy = jest.spyOn(service, 'remove');\n+      service.remove('anyid');\n+      expect(removeUserSpy).toHaveBeenCalledWith('anyid');",
        "comment_created_at": "2021-09-05T18:57:30+00:00",
        "comment_author": "Tony133",
        "comment_body": "true, you must have lost it, sorry\r\nit had to be something like this:\r\n```\r\n      const removeUserSpy = jest.spyOn(repository, 'remove');\r\n      service.remove('anyid');\r\n      expect(removeUserSpy).toHaveBeenCalledWith('anyid');\r\n```\r\n",
        "pr_file_module": null
      },
      {
        "comment_id": "702463803",
        "repo_full_name": "nestjs/nest",
        "pr_number": 8032,
        "pr_file": "sample/05-sql-typeorm/src/users/users.service.spec.ts",
        "discussion_id": "702448282",
        "commented_code": "@@ -0,0 +1,84 @@\n+import { Test, TestingModule } from '@nestjs/testing';\n+import { getRepositoryToken } from '@nestjs/typeorm';\n+import { User } from './user.entity';\n+import { UsersService } from './users.service';\n+import { Repository } from 'typeorm';\n+\n+const userArray = [\n+  {\n+    firstName: 'firstName #1',\n+    lastName: 'lastName #1',\n+  },\n+  {\n+    firstName: 'firstName #2',\n+    lastName: 'lastName #2',\n+  },\n+];\n+\n+const oneUser = {\n+  firstName: 'firstName #1',\n+  lastName: 'lastName #1',\n+};\n+\n+describe('UserService', () => {\n+  let service: UsersService;\n+  let repository: Repository<User>;\n+\n+  beforeEach(async () => {\n+    const module: TestingModule = await Test.createTestingModule({\n+      providers: [\n+        UsersService,\n+        {\n+          provide: getRepositoryToken(User),\n+          useValue: {\n+            find: jest.fn().mockResolvedValue(userArray),\n+            findOne: jest.fn().mockResolvedValue(oneUser),\n+            save: jest.fn(),\n+            remove: jest.fn(),\n+            delete: jest.fn(),\n+          },\n+        },\n+      ],\n+    }).compile();\n+\n+    service = module.get<UsersService>(UsersService);\n+    repository = module.get<Repository<User>>(getRepositoryToken(User));\n+  });\n+\n+  it('should be defined', () => {\n+    expect(service).toBeDefined();\n+  });\n+\n+  describe('create()', () => {\n+    it('should successfully insert a user', () => {\n+      const user = {\n+        firstName: 'firstName #1',\n+        lastName: 'lastName #1',\n+      };\n+      expect(user).toEqual(user);\n+    });\n+  });\n+\n+  describe('findAll()', () => {\n+    it('should return an array of users', async () => {\n+      const users = await service.findAll();\n+      expect(users).toEqual(userArray);\n+    });\n+  });\n+\n+  describe('findOne()', () => {\n+    it('should get a single user', () => {\n+      const repoSpy = jest.spyOn(repository, 'findOne');\n+      expect(service.findOne('a id')).resolves.toEqual(oneUser);\n+      expect(repoSpy).toBeCalledWith('a id');\n+    });\n+  });\n+\n+  describe('remove()', () => {\n+    it('should remove a user', async () => {\n+      const removeUserSpy = jest.spyOn(service, 'remove');\n+      service.remove('anyid');\n+      expect(removeUserSpy).toHaveBeenCalledWith('anyid');",
        "comment_created_at": "2021-09-05T19:01:58+00:00",
        "comment_author": "Tony133",
        "comment_body": "no, maybe it's not good yet\r\n",
        "pr_file_module": null
      },
      {
        "comment_id": "702466563",
        "repo_full_name": "nestjs/nest",
        "pr_number": 8032,
        "pr_file": "sample/05-sql-typeorm/src/users/users.service.spec.ts",
        "discussion_id": "702448282",
        "commented_code": "@@ -0,0 +1,84 @@\n+import { Test, TestingModule } from '@nestjs/testing';\n+import { getRepositoryToken } from '@nestjs/typeorm';\n+import { User } from './user.entity';\n+import { UsersService } from './users.service';\n+import { Repository } from 'typeorm';\n+\n+const userArray = [\n+  {\n+    firstName: 'firstName #1',\n+    lastName: 'lastName #1',\n+  },\n+  {\n+    firstName: 'firstName #2',\n+    lastName: 'lastName #2',\n+  },\n+];\n+\n+const oneUser = {\n+  firstName: 'firstName #1',\n+  lastName: 'lastName #1',\n+};\n+\n+describe('UserService', () => {\n+  let service: UsersService;\n+  let repository: Repository<User>;\n+\n+  beforeEach(async () => {\n+    const module: TestingModule = await Test.createTestingModule({\n+      providers: [\n+        UsersService,\n+        {\n+          provide: getRepositoryToken(User),\n+          useValue: {\n+            find: jest.fn().mockResolvedValue(userArray),\n+            findOne: jest.fn().mockResolvedValue(oneUser),\n+            save: jest.fn(),\n+            remove: jest.fn(),\n+            delete: jest.fn(),\n+          },\n+        },\n+      ],\n+    }).compile();\n+\n+    service = module.get<UsersService>(UsersService);\n+    repository = module.get<Repository<User>>(getRepositoryToken(User));\n+  });\n+\n+  it('should be defined', () => {\n+    expect(service).toBeDefined();\n+  });\n+\n+  describe('create()', () => {\n+    it('should successfully insert a user', () => {\n+      const user = {\n+        firstName: 'firstName #1',\n+        lastName: 'lastName #1',\n+      };\n+      expect(user).toEqual(user);\n+    });\n+  });\n+\n+  describe('findAll()', () => {\n+    it('should return an array of users', async () => {\n+      const users = await service.findAll();\n+      expect(users).toEqual(userArray);\n+    });\n+  });\n+\n+  describe('findOne()', () => {\n+    it('should get a single user', () => {\n+      const repoSpy = jest.spyOn(repository, 'findOne');\n+      expect(service.findOne('a id')).resolves.toEqual(oneUser);\n+      expect(repoSpy).toBeCalledWith('a id');\n+    });\n+  });\n+\n+  describe('remove()', () => {\n+    it('should remove a user', async () => {\n+      const removeUserSpy = jest.spyOn(service, 'remove');\n+      service.remove('anyid');\n+      expect(removeUserSpy).toHaveBeenCalledWith('anyid');",
        "comment_created_at": "2021-09-05T19:27:52+00:00",
        "comment_author": "Tony133",
        "comment_body": "thank you very much for helping 🙌\r\n",
        "pr_file_module": null
      }
    ]
  }
]