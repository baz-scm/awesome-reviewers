[
  {
    "discussion_id": "1839606427",
    "pr_number": 5819,
    "pr_file": "app/client/platforms/google.ts",
    "created_at": "2024-11-13T07:00:45+00:00",
    "commented_code": "console.log(\"[Proxy Endpoint] \", baseUrl, path);\n \n     let chatPath = [baseUrl, path].join(\"/\");\n+    if (!chatPath.includes(\"gemini-pro\")) {",
    "repo_full_name": "ChatGPTNextWeb/NextChat",
    "discussion_comments": [
      {
        "comment_id": "1839606427",
        "repo_full_name": "ChatGPTNextWeb/NextChat",
        "pr_number": 5819,
        "pr_file": "app/client/platforms/google.ts",
        "discussion_id": "1839606427",
        "commented_code": "@@ -51,15 +51,18 @@ export class GeminiProApi implements LLMApi {\n     console.log(\"[Proxy Endpoint] \", baseUrl, path);\n \n     let chatPath = [baseUrl, path].join(\"/\");\n+    if (!chatPath.includes(\"gemini-pro\")) {",
        "comment_created_at": "2024-11-13T07:00:45+00:00",
        "comment_author": "lloydzhou",
        "comment_body": "\u5e94\u8be5\u4e0d\u80fd\u8fd9\u4e48\u5224\u65ad\u5427\uff0c\u8fd9\u91cc\u9700\u8981\u6309\u7167\u662f\u5426\u8d70stream\u6a21\u5f0f\u8fdb\u884c\u5224\u65ad\uff0c\u800c\u4e0d\u662f\u6309\u6a21\u578b\u540d\u79f0\u8fdb\u884c\u5224\u65ad",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1758386640",
    "pr_number": 5416,
    "pr_file": "app/client/platforms/openai.ts",
    "created_at": "2024-09-13T08:04:44+00:00",
    "commented_code": "const content = visionModel\n           ? await preProcessImageContent(v.content)\n           : getMessageTextContent(v);\n-        messages.push({ role: v.role, content });\n+        if(!(isO1 && v.role === \"system\"))\n+          messages.push({ role: v.role, content });",
    "repo_full_name": "ChatGPTNextWeb/NextChat",
    "discussion_comments": [
      {
        "comment_id": "1758386640",
        "repo_full_name": "ChatGPTNextWeb/NextChat",
        "pr_number": 5416,
        "pr_file": "app/client/platforms/openai.ts",
        "discussion_id": "1758386640",
        "commented_code": "@@ -181,17 +182,19 @@ export class ChatGPTApi implements LLMApi {\n         const content = visionModel\n           ? await preProcessImageContent(v.content)\n           : getMessageTextContent(v);\n-        messages.push({ role: v.role, content });\n+        if(!(isO1 && v.role === \"system\"))\n+          messages.push({ role: v.role, content });",
        "comment_created_at": "2024-09-13T08:04:44+00:00",
        "comment_author": "Dogtiti",
        "comment_body": "\u8fd9\u91cc\u611f\u89c9\u5904\u7406\u7684\u4e0d\u592a\u5408\u7406\uff0c\u4e3a\u4ec0\u4e48\u8fc7\u6ee4system message",
        "pr_file_module": null
      },
      {
        "comment_id": "1758387516",
        "repo_full_name": "ChatGPTNextWeb/NextChat",
        "pr_number": 5416,
        "pr_file": "app/client/platforms/openai.ts",
        "discussion_id": "1758386640",
        "commented_code": "@@ -181,17 +182,19 @@ export class ChatGPTApi implements LLMApi {\n         const content = visionModel\n           ? await preProcessImageContent(v.content)\n           : getMessageTextContent(v);\n-        messages.push({ role: v.role, content });\n+        if(!(isO1 && v.role === \"system\"))\n+          messages.push({ role: v.role, content });",
        "comment_created_at": "2024-09-13T08:05:18+00:00",
        "comment_author": "skymkmk",
        "comment_body": "\u56e0\u4e3a o1 \u76ee\u524d\u4e0d\u652f\u6301 system role",
        "pr_file_module": null
      },
      {
        "comment_id": "1758393315",
        "repo_full_name": "ChatGPTNextWeb/NextChat",
        "pr_number": 5416,
        "pr_file": "app/client/platforms/openai.ts",
        "discussion_id": "1758386640",
        "commented_code": "@@ -181,17 +182,19 @@ export class ChatGPTApi implements LLMApi {\n         const content = visionModel\n           ? await preProcessImageContent(v.content)\n           : getMessageTextContent(v);\n-        messages.push({ role: v.role, content });\n+        if(!(isO1 && v.role === \"system\"))\n+          messages.push({ role: v.role, content });",
        "comment_created_at": "2024-09-13T08:08:56+00:00",
        "comment_author": "Dogtiti",
        "comment_body": "\u5982\u679c\u8f6c\u6362\u4e3a user message:   role=user \u5462\uff1f",
        "pr_file_module": null
      },
      {
        "comment_id": "1758399735",
        "repo_full_name": "ChatGPTNextWeb/NextChat",
        "pr_number": 5416,
        "pr_file": "app/client/platforms/openai.ts",
        "discussion_id": "1758386640",
        "commented_code": "@@ -181,17 +182,19 @@ export class ChatGPTApi implements LLMApi {\n         const content = visionModel\n           ? await preProcessImageContent(v.content)\n           : getMessageTextContent(v);\n-        messages.push({ role: v.role, content });\n+        if(!(isO1 && v.role === \"system\"))\n+          messages.push({ role: v.role, content });",
        "comment_created_at": "2024-09-13T08:12:21+00:00",
        "comment_author": "skymkmk",
        "comment_body": "\u4e2a\u4eba\u611f\u89c9\u6ca1\u5fc5\u8981\r\n\r\n1. O1 \u5f88\u8d35\uff0c\u6bcf\u6b21\u90fd\u9644\u52a0 system \u7684\u8bdd\u662f\u5426\u4f1a\u5bfc\u81f4\u82b1\u8d39\u66f4\u9ad8\uff1f\r\n2. system role \u672a\u6765\u51e0\u5468\u5e94\u8be5\u662f\u4f1a\u88ab OpenAI \u652f\u6301\u7684\uff0c\u4e0d\u5982\u5c4a\u65f6\u53bb\u6389\u8fc7\u6ee4\uff1f\r\n\r\n\u8bf7\u544a\u77e5\u4f60\u7684\u60f3\u6cd5\uff0c\u6211\u73b0\u5728\u4e5f\u6709\u4e9b\u7ea0\u7ed3\u8fd9\u4e2a\u95ee\u9898\uff1b\u53e6\u5916\u6211 push \u4e86\u4e00\u4e2a\u4fee\u6539\u8d85\u65f6\u7684 commit\uff0c\u4f60\u770b\u770b\u662f\u5426\u65f6\u95f4\u7ed9\u7684\u8fc7\u957f\u6216\u6709\u6ca1\u6709\u5fc5\u8981\u4e3a\u4e86 O1 \u5ef6\u957f\u9608\u503c\uff1f",
        "pr_file_module": null
      },
      {
        "comment_id": "1758406890",
        "repo_full_name": "ChatGPTNextWeb/NextChat",
        "pr_number": 5416,
        "pr_file": "app/client/platforms/openai.ts",
        "discussion_id": "1758386640",
        "commented_code": "@@ -181,17 +182,19 @@ export class ChatGPTApi implements LLMApi {\n         const content = visionModel\n           ? await preProcessImageContent(v.content)\n           : getMessageTextContent(v);\n-        messages.push({ role: v.role, content });\n+        if(!(isO1 && v.role === \"system\"))\n+          messages.push({ role: v.role, content });",
        "comment_created_at": "2024-09-13T08:17:06+00:00",
        "comment_author": "Dogtiti",
        "comment_body": "1.\u5982\u679c\u662f\u8003\u8651\u5230\u672a\u6765\u4e0d\u4e45\u53ef\u80fd\u88ab\u652f\u6301\uff0c\u90a3\u4e48\u53ef\u4ee5\u6682\u65f6\u8fd9\u6837\u8fc7\u6ee4\u6389\uff0c\u56de\u5934\u5f00\u653e\u56de\u6765\u5373\u53ef\r\n2.\u8d85\u65f6\u7684\u95ee\u9898\u53ef\u4ee5\u4fdd\u6301\u539f\u6837,\u57fa\u4e8e1\u7684\u8003\u91cf\u672a\u6765\u901f\u5ea6\u53ef\u80fd\u4e5f\u4f1a\u63d0\u5347",
        "pr_file_module": null
      },
      {
        "comment_id": "1758414340",
        "repo_full_name": "ChatGPTNextWeb/NextChat",
        "pr_number": 5416,
        "pr_file": "app/client/platforms/openai.ts",
        "discussion_id": "1758386640",
        "commented_code": "@@ -181,17 +182,19 @@ export class ChatGPTApi implements LLMApi {\n         const content = visionModel\n           ? await preProcessImageContent(v.content)\n           : getMessageTextContent(v);\n-        messages.push({ role: v.role, content });\n+        if(!(isO1 && v.role === \"system\"))\n+          messages.push({ role: v.role, content });",
        "comment_created_at": "2024-09-13T08:21:31+00:00",
        "comment_author": "skymkmk",
        "comment_body": "\u90a3\u4f60\u770b\u8fd9\u6837\u5982\u4f55\uff1a\r\n\r\n1. system \u4fdd\u6301\u539f\u6837\u8fc7\u6ee4\r\n2. \u8d85\u65f6\u7684\u8bdd\uff0cOpenAI \u4e13\u95e8\u63d0\u5230\u4e86\u4f1a\u8ba9\u6a21\u578b\u201c\u601d\u8003\u4e00\u6bb5\u65f6\u95f4\u201d\u4ece\u800c\u63d0\u9ad8\u63a8\u7406\u80fd\u529b\uff0c\u8fd9\u6ce8\u5b9a\u4e86 reasoning \u6a21\u578b\u65f6\u957f\u4f1a\u6bd4 completion \u6a21\u578b\u957f\uff0c\u4f46\u662f\u5ef6\u957f\u5230\u4e09\u500d\u786e\u5b9e\u6709\u4e9b\u8fc7\u5206\uff0c\u6211\u5c06\u5176\u9608\u503c\u8c03\u5230\u4e0e Dall-E \u76f8\u540c\u5982\u4f55\uff1f",
        "pr_file_module": null
      },
      {
        "comment_id": "1758417325",
        "repo_full_name": "ChatGPTNextWeb/NextChat",
        "pr_number": 5416,
        "pr_file": "app/client/platforms/openai.ts",
        "discussion_id": "1758386640",
        "commented_code": "@@ -181,17 +182,19 @@ export class ChatGPTApi implements LLMApi {\n         const content = visionModel\n           ? await preProcessImageContent(v.content)\n           : getMessageTextContent(v);\n-        messages.push({ role: v.role, content });\n+        if(!(isO1 && v.role === \"system\"))\n+          messages.push({ role: v.role, content });",
        "comment_created_at": "2024-09-13T08:23:19+00:00",
        "comment_author": "Dogtiti",
        "comment_body": "\u53ef\u4ee5~",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1666744758",
    "pr_number": 4930,
    "pr_file": "app/api/auth.ts",
    "created_at": "2024-07-05T12:23:54+00:00",
    "commented_code": "break;\n       case ModelProvider.GPT:\n       default:\n-        if (serverConfig.isAzure) {\n+        if (req.nextUrl.pathname.includes(\"azure/deployments\")) {",
    "repo_full_name": "ChatGPTNextWeb/NextChat",
    "discussion_comments": [
      {
        "comment_id": "1666744758",
        "repo_full_name": "ChatGPTNextWeb/NextChat",
        "pr_number": 4930,
        "pr_file": "app/api/auth.ts",
        "discussion_id": "1666744758",
        "commented_code": "@@ -75,7 +75,7 @@ export function auth(req: NextRequest, modelProvider: ModelProvider) {\n         break;\n       case ModelProvider.GPT:\n       default:\n-        if (serverConfig.isAzure) {\n+        if (req.nextUrl.pathname.includes(\"azure/deployments\")) {",
        "comment_created_at": "2024-07-05T12:23:54+00:00",
        "comment_author": "lloydzhou",
        "comment_body": "\u8fd9\u4e2a\u5730\u65b9\u662f\u670d\u52a1\u7aef\u6267\u884c\u7684\u4ee3\u7801\uff0c\u6309\u5b9e\u9645\u8bf7\u6c42\u5224\u65ad\u5f53\u524d\u662fazure\u8fd8\u662fopenai\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u6309serverConfig.isAzure\u5224\u65ad\r\n\u4e4b\u524d\u7684\u903b\u8f91\uff0cazure\u548copenai\u4e0d\u80fd\u5e76\u5b58\u3002\u4f1a\u51b2\u7a81\uff01",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1666748649",
    "pr_number": 4930,
    "pr_file": "app/api/common.ts",
    "created_at": "2024-07-05T12:27:48+00:00",
    "commented_code": "10 * 60 * 1000,\n   );\n \n-  if (serverConfig.isAzure) {\n-    if (!serverConfig.azureApiVersion) {\n-      return NextResponse.json({\n-        error: true,\n-        message: `missing AZURE_API_VERSION in server env vars`,\n-      });\n-    }\n-    path = makeAzurePath(path, serverConfig.azureApiVersion);\n+  if (isAzure) {\n+    const azureApiVersion = req?.nextUrl?.searchParams?.get(\"api-version\");\n+    baseUrl = baseUrl.split(\"/deployments\").shift() as string;\n+    path = `${req.nextUrl.pathname.replaceAll(\n+      \"/api/azure/\",\n+      \"\",\n+    )}?api-version=${azureApiVersion}`;",
    "repo_full_name": "ChatGPTNextWeb/NextChat",
    "discussion_comments": [
      {
        "comment_id": "1666748649",
        "repo_full_name": "ChatGPTNextWeb/NextChat",
        "pr_number": 4930,
        "pr_file": "app/api/common.ts",
        "discussion_id": "1666748649",
        "commented_code": "@@ -56,14 +57,13 @@ export async function requestOpenai(req: NextRequest) {\n     10 * 60 * 1000,\n   );\n \n-  if (serverConfig.isAzure) {\n-    if (!serverConfig.azureApiVersion) {\n-      return NextResponse.json({\n-        error: true,\n-        message: `missing AZURE_API_VERSION in server env vars`,\n-      });\n-    }\n-    path = makeAzurePath(path, serverConfig.azureApiVersion);\n+  if (isAzure) {\n+    const azureApiVersion = req?.nextUrl?.searchParams?.get(\"api-version\");\n+    baseUrl = baseUrl.split(\"/deployments\").shift() as string;\n+    path = `${req.nextUrl.pathname.replaceAll(\n+      \"/api/azure/\",\n+      \"\",\n+    )}?api-version=${azureApiVersion}`;",
        "comment_created_at": "2024-07-05T12:27:48+00:00",
        "comment_author": "lloydzhou",
        "comment_body": "\u91cd\u65b0\u7ec4\u5408Azure\u8bf7\u6c42\r\n1. \u524d\u9762\u4eceazureUrl\u83b7\u53d6\u7684baseUrl\u6709\u5305\u542bresource-name\r\n2. pathname\u4e2d\u6709\u5305\u542bdeployment-name\r\n3. \u518d\u52a0\u4e0aapi-version\u7ec4\u5408\u5373\u53ef\r\n",
        "pr_file_module": null
      }
    ]
  }
]