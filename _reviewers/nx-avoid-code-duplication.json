[
  {
    "discussion_id": "2451009372",
    "pr_number": 33178,
    "pr_file": "packages/docker/src/release/version-utils.ts",
    "created_at": "2025-10-22T08:53:59+00:00",
    "commented_code": "import type { ProjectGraphProjectNode } from '@nx/devkit';\n import type { FinalConfigForProject } from 'nx/src/command-line/release/utils/release-graph';\n import { interpolateVersionPattern } from './version-pattern-utils';\n+import type { VersionDataEntry } from 'packages/nx/src/command-line/release/utils/shared';",
    "repo_full_name": "nrwl/nx",
    "discussion_comments": [
      {
        "comment_id": "2451009372",
        "repo_full_name": "nrwl/nx",
        "pr_number": 33178,
        "pr_file": "packages/docker/src/release/version-utils.ts",
        "discussion_id": "2451009372",
        "commented_code": "@@ -5,6 +5,7 @@ import { prompt } from 'enquirer';\n import type { ProjectGraphProjectNode } from '@nx/devkit';\n import type { FinalConfigForProject } from 'nx/src/command-line/release/utils/release-graph';\n import { interpolateVersionPattern } from './version-pattern-utils';\n+import type { VersionDataEntry } from 'packages/nx/src/command-line/release/utils/shared';",
        "comment_created_at": "2025-10-22T08:53:59+00:00",
        "comment_author": "Coly010",
        "comment_body": "This import is incorrect, we shouldn't be referencing it via `packages/nx`",
        "pr_file_module": null
      },
      {
        "comment_id": "2451013794",
        "repo_full_name": "nrwl/nx",
        "pr_number": 33178,
        "pr_file": "packages/docker/src/release/version-utils.ts",
        "discussion_id": "2451009372",
        "commented_code": "@@ -5,6 +5,7 @@ import { prompt } from 'enquirer';\n import type { ProjectGraphProjectNode } from '@nx/devkit';\n import type { FinalConfigForProject } from 'nx/src/command-line/release/utils/release-graph';\n import { interpolateVersionPattern } from './version-pattern-utils';\n+import type { VersionDataEntry } from 'packages/nx/src/command-line/release/utils/shared';",
        "comment_created_at": "2025-10-22T08:54:55+00:00",
        "comment_author": "Coly010",
        "comment_body": "Actually, let's remove this import altogether in line with the next comment",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2414234524",
    "pr_number": 33005,
    "pr_file": "packages/nx/src/daemon/server/server.ts",
    "created_at": "2025-10-08T15:20:33+00:00",
    "commented_code": ");\n   } else if (payload.type === 'REGISTER_FILE_WATCHER') {\n     registeredFileWatcherSockets.push({ socket, config: payload.config });\n+  } else if (payload.type === REGISTER_PROJECT_GRAPH_LISTENER) {",
    "repo_full_name": "nrwl/nx",
    "discussion_comments": [
      {
        "comment_id": "2414234524",
        "repo_full_name": "nrwl/nx",
        "pr_number": 33005,
        "pr_file": "packages/nx/src/daemon/server/server.ts",
        "discussion_id": "2414234524",
        "commented_code": "@@ -244,6 +251,8 @@ async function handleMessage(socket, data: string) {\n     );\n   } else if (payload.type === 'REGISTER_FILE_WATCHER') {\n     registeredFileWatcherSockets.push({ socket, config: payload.config });\n+  } else if (payload.type === REGISTER_PROJECT_GRAPH_LISTENER) {",
        "comment_created_at": "2025-10-08T15:20:33+00:00",
        "comment_author": "AgentEnder",
        "comment_body": "Lets add these messages to message-types, gives a bit more type safety but is admittedly a bit more cruft",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2189374444",
    "pr_number": 31756,
    "pr_file": "packages/nx/src/command-line/release/utils/git.ts",
    "created_at": "2025-07-07T08:38:14+00:00",
    "commented_code": "const SEMVER_REGEX =\n   /^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$/g;\n \n+/**\n+ * Check if a semver string is for a stable release (i.e. no prerelease or build metadata)\n+ * @param semver - The semver string to check\n+ * @returns True if the semver string is stable, false otherwise\n+ */\n+export function isStableSemver(semver: string): boolean {",
    "repo_full_name": "nrwl/nx",
    "discussion_comments": [
      {
        "comment_id": "2189374444",
        "repo_full_name": "nrwl/nx",
        "pr_number": 31756,
        "pr_file": "packages/nx/src/command-line/release/utils/git.ts",
        "discussion_id": "2189374444",
        "commented_code": "@@ -44,11 +49,65 @@ function escapeRegExp(string) {\n const SEMVER_REGEX =\n   /^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$/g;\n \n+/**\n+ * Check if a semver string is for a stable release (i.e. no prerelease or build metadata)\n+ * @param semver - The semver string to check\n+ * @returns True if the semver string is stable, false otherwise\n+ */\n+export function isStableSemver(semver: string): boolean {",
        "comment_created_at": "2025-07-07T08:38:14+00:00",
        "comment_author": "JamesHenry",
        "comment_body": "There is already a `isPrerelease` utility in `packages/nx/src/command-line/release/utils/shared.ts`, let's not duplicate the logic",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2175658294",
    "pr_number": 31759,
    "pr_file": "packages/js/src/utils/typescript/ts-solution-setup.ts",
    "created_at": "2025-06-30T18:30:56+00:00",
    "commented_code": "}\n \n export function getProjectSourceRoot(\n-  tree: Tree,\n-  projectSourceRoot: string | undefined,\n-  projectRoot: string\n-): string | undefined {\n+  project: ProjectConfiguration,\n+  tree?: Tree\n+): string {\n+  tree ??= new FsTree(workspaceRoot, false);",
    "repo_full_name": "nrwl/nx",
    "discussion_comments": [
      {
        "comment_id": "2175658294",
        "repo_full_name": "nrwl/nx",
        "pr_number": 31759,
        "pr_file": "packages/js/src/utils/typescript/ts-solution-setup.ts",
        "discussion_id": "2175658294",
        "commented_code": "@@ -290,14 +291,15 @@ export function getProjectType(\n }\n \n export function getProjectSourceRoot(\n-  tree: Tree,\n-  projectSourceRoot: string | undefined,\n-  projectRoot: string\n-): string | undefined {\n+  project: ProjectConfiguration,\n+  tree?: Tree\n+): string {\n+  tree ??= new FsTree(workspaceRoot, false);",
        "comment_created_at": "2025-06-30T18:30:56+00:00",
        "comment_author": "FrozenPandaz",
        "comment_body": "Not really a fan of creating a FsTree just for this. Is this `tree` even needed? I think we can use 2 different `exists` functions here rather than creating a tree?",
        "pr_file_module": null
      },
      {
        "comment_id": "2189452748",
        "repo_full_name": "nrwl/nx",
        "pr_number": 31759,
        "pr_file": "packages/js/src/utils/typescript/ts-solution-setup.ts",
        "discussion_id": "2175658294",
        "commented_code": "@@ -290,14 +291,15 @@ export function getProjectType(\n }\n \n export function getProjectSourceRoot(\n-  tree: Tree,\n-  projectSourceRoot: string | undefined,\n-  projectRoot: string\n-): string | undefined {\n+  project: ProjectConfiguration,\n+  tree?: Tree\n+): string {\n+  tree ??= new FsTree(workspaceRoot, false);",
        "comment_created_at": "2025-07-07T09:12:06+00:00",
        "comment_author": "leosvelperez",
        "comment_body": "The `tree` argument is needed when generators consume this function because some changes might be on the virtual tree and have not yet been committed to the file system. In that case, it's better to just forward the `tree` rather than requiring generators to provide a function that uses the `tree` to check if a file exists.\r\n\r\nWhen a tree is not provided, we don't \"need\" it. In that case, it's being created and used as an abstraction over the file system. I'll change that so the function internally defines the two different `exists` functions.",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2144621752",
    "pr_number": 31550,
    "pr_file": "packages/nx/src/tasks-runner/pseudo-terminal.ts",
    "created_at": "2025-06-13T09:37:03+00:00",
    "commented_code": "import { PseudoIPCServer } from './pseudo-ipc';\n import { RunningTask } from './running-tasks/running-task';\n import { codeToSignal } from '../utils/exit-codes';\n+import { NormalizedRunCommandsOptions } from '../executors/run-commands/run-commands.impl';",
    "repo_full_name": "nrwl/nx",
    "discussion_comments": [
      {
        "comment_id": "2144621752",
        "repo_full_name": "nrwl/nx",
        "pr_number": 31550,
        "pr_file": "packages/nx/src/tasks-runner/pseudo-terminal.ts",
        "discussion_id": "2144621752",
        "commented_code": "@@ -5,6 +5,7 @@ import { ChildProcess, IS_WASM, RustPseudoTerminal } from '../native';\n import { PseudoIPCServer } from './pseudo-ipc';\n import { RunningTask } from './running-tasks/running-task';\n import { codeToSignal } from '../utils/exit-codes';\n+import { NormalizedRunCommandsOptions } from '../executors/run-commands/run-commands.impl';",
        "comment_created_at": "2025-06-13T09:37:03+00:00",
        "comment_author": "leosvelperez",
        "comment_body": "This introduces a circular dep. `run-commands.impl` already imports from this file. We can either extract the type to a shared file or duplicate it here.",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2145043116",
    "pr_number": 31550,
    "pr_file": "packages/nx/src/tasks-runner/pseudo-terminal.ts",
    "created_at": "2025-06-13T12:59:32+00:00",
    "commented_code": "export class PseudoTtyProcess implements RunningTask {\n   isAlive = true;\n+  private initChildProcessesPromise: Promise<any>;",
    "repo_full_name": "nrwl/nx",
    "discussion_comments": [
      {
        "comment_id": "2145043116",
        "repo_full_name": "nrwl/nx",
        "pr_number": 31550,
        "pr_file": "packages/nx/src/tasks-runner/pseudo-terminal.ts",
        "discussion_id": "2145043116",
        "commented_code": "@@ -143,6 +151,7 @@ export class PseudoTerminal {\n \n export class PseudoTtyProcess implements RunningTask {\n   isAlive = true;\n+  private initChildProcessesPromise: Promise<any>;",
        "comment_created_at": "2025-06-13T12:59:32+00:00",
        "comment_author": "leosvelperez",
        "comment_body": "Sorry, I missed this in the previous review: this `Promise` shouldn't be needed. We're storing it but not awaiting or using it. We can set up the listeners right away.",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2154667728",
    "pr_number": 31626,
    "pr_file": "graph/migrate/src/lib/state/automatic/selectors.ts",
    "created_at": "2025-06-18T13:50:20+00:00",
    "commented_code": "/* eslint-enable @nx/enforce-module-boundaries */\n import type { AutomaticMigrationState } from './types';\n \n-// this is where the ui should start off on\n-// we assume completed migrations in the past are reviewed\n export function findFirstIncompleteMigration(\n   migrations: MigrationDetailsWithId[],\n   nxConsoleMetadata: MigrationsJsonMetadata\n ) {\n   return (\n-    migrations.find(\n-      (migration) =>\n-        nxConsoleMetadata.completedMigrations?.[migration.id]?.type !==\n-          'successful' &&\n-        nxConsoleMetadata.completedMigrations?.[migration.id]?.type !==\n-          'skipped'\n-    ) ?? migrations[0]\n+    migrations.find((migration) => {\n+      const type = nxConsoleMetadata.completedMigrations?.[migration.id]?.type;\n+      return type !== 'successful' && type !== 'skipped';\n+    }) ?? migrations[0]\n   );\n }\n \n export function currentMigrationHasSucceeded(ctx: AutomaticMigrationState) {\n   if (!ctx.currentMigration) {\n     return false;\n   }\n-  const completedMigration =\n-    ctx.nxConsoleMetadata?.completedMigrations?.[ctx.currentMigration.id];\n-  return completedMigration?.type === 'successful';\n+  return isMigrationSuccessful(ctx, ctx.currentMigration.id);\n }\n \n export function currentMigrationHasChanges(ctx: AutomaticMigrationState) {\n   if (!ctx.currentMigration) {\n     return false;\n   }\n-  const completedMigration =\n-    ctx.nxConsoleMetadata?.completedMigrations?.[ctx.currentMigration.id];\n+  const completed =\n+    ctx.nxConsoleMetadata?.completedMigrations?.[ctx.currentMigration?.id];\n   return (\n-    completedMigration?.type === 'successful' &&\n-    completedMigration.changedFiles.length > 0\n+    completed?.type === 'successful' &&\n+    (completed.changedFiles?.length ?? 0) > 0\n+  );\n+}\n+\n+export function isMigrationSuccessful(\n+  ctx: AutomaticMigrationState,\n+  migrationId: string\n+) {\n+  return (\n+    ctx.nxConsoleMetadata?.completedMigrations?.[migrationId]?.type ===\n+    'successful'\n+  );\n+}\n+\n+export function isMigrationFailed(",
    "repo_full_name": "nrwl/nx",
    "discussion_comments": [
      {
        "comment_id": "2154667728",
        "repo_full_name": "nrwl/nx",
        "pr_number": 31626,
        "pr_file": "graph/migrate/src/lib/state/automatic/selectors.ts",
        "discussion_id": "2154667728",
        "commented_code": "@@ -4,58 +4,102 @@ import { MigrationDetailsWithId } from 'nx/src/config/misc-interfaces';\n /* eslint-enable @nx/enforce-module-boundaries */\n import type { AutomaticMigrationState } from './types';\n \n-// this is where the ui should start off on\n-// we assume completed migrations in the past are reviewed\n export function findFirstIncompleteMigration(\n   migrations: MigrationDetailsWithId[],\n   nxConsoleMetadata: MigrationsJsonMetadata\n ) {\n   return (\n-    migrations.find(\n-      (migration) =>\n-        nxConsoleMetadata.completedMigrations?.[migration.id]?.type !==\n-          'successful' &&\n-        nxConsoleMetadata.completedMigrations?.[migration.id]?.type !==\n-          'skipped'\n-    ) ?? migrations[0]\n+    migrations.find((migration) => {\n+      const type = nxConsoleMetadata.completedMigrations?.[migration.id]?.type;\n+      return type !== 'successful' && type !== 'skipped';\n+    }) ?? migrations[0]\n   );\n }\n \n export function currentMigrationHasSucceeded(ctx: AutomaticMigrationState) {\n   if (!ctx.currentMigration) {\n     return false;\n   }\n-  const completedMigration =\n-    ctx.nxConsoleMetadata?.completedMigrations?.[ctx.currentMigration.id];\n-  return completedMigration?.type === 'successful';\n+  return isMigrationSuccessful(ctx, ctx.currentMigration.id);\n }\n \n export function currentMigrationHasChanges(ctx: AutomaticMigrationState) {\n   if (!ctx.currentMigration) {\n     return false;\n   }\n-  const completedMigration =\n-    ctx.nxConsoleMetadata?.completedMigrations?.[ctx.currentMigration.id];\n+  const completed =\n+    ctx.nxConsoleMetadata?.completedMigrations?.[ctx.currentMigration?.id];\n   return (\n-    completedMigration?.type === 'successful' &&\n-    completedMigration.changedFiles.length > 0\n+    completed?.type === 'successful' &&\n+    (completed.changedFiles?.length ?? 0) > 0\n+  );\n+}\n+\n+export function isMigrationSuccessful(\n+  ctx: AutomaticMigrationState,\n+  migrationId: string\n+) {\n+  return (\n+    ctx.nxConsoleMetadata?.completedMigrations?.[migrationId]?.type ===\n+    'successful'\n+  );\n+}\n+\n+export function isMigrationFailed(",
        "comment_created_at": "2025-06-18T13:50:20+00:00",
        "comment_author": "jaysoo",
        "comment_body": "Instead of having one selector for each type, I'd just use `getMigrationType` and then in the component you can select the type and do the `===` comparison there. Otherwise we'd have to add more and more of these selectors if we add more types.",
        "pr_file_module": null
      }
    ]
  }
]