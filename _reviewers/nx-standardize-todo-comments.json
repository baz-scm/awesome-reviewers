[
  {
    "discussion_id": "2168950302",
    "pr_number": 31718,
    "pr_file": "packages/rollup/src/plugins/with-nx/with-nx.ts",
    "created_at": "2025-06-26T12:28:37+00:00",
    "commented_code": "}),\n       image(),\n       json(),\n-      // Needed to generate type definitions, even if we're using babel or swc.\n-      require('rollup-plugin-typescript2')({\n-        check: !options.skipTypeCheck,\n-        tsconfig: tsConfigPath,\n-        tsconfigOverride: {\n-          compilerOptions: createTsCompilerOptions(\n-            projectRoot,\n-            tsConfig,\n-            options,\n-            dependencies\n-          ),\n-        },\n-      }),\n+      // TypeScript compilation and declaration generation\n+      // TODO(Colum): Change default value of useLegacyTypescriptPlugin to false for Nx 23",
    "repo_full_name": "nrwl/nx",
    "discussion_comments": [
      {
        "comment_id": "2168950302",
        "repo_full_name": "nrwl/nx",
        "pr_number": 31718,
        "pr_file": "packages/rollup/src/plugins/with-nx/with-nx.ts",
        "discussion_id": "2168950302",
        "commented_code": "@@ -216,19 +227,32 @@ export function withNx(\n       }),\n       image(),\n       json(),\n-      // Needed to generate type definitions, even if we're using babel or swc.\n-      require('rollup-plugin-typescript2')({\n-        check: !options.skipTypeCheck,\n-        tsconfig: tsConfigPath,\n-        tsconfigOverride: {\n-          compilerOptions: createTsCompilerOptions(\n-            projectRoot,\n-            tsConfig,\n-            options,\n-            dependencies\n-          ),\n-        },\n-      }),\n+      // TypeScript compilation and declaration generation\n+      // TODO(Colum): Change default value of useLegacyTypescriptPlugin to false for Nx 23",
        "comment_created_at": "2025-06-26T12:28:37+00:00",
        "comment_author": "jaysoo",
        "comment_body": "I think we can be more aggressive. Change it in v22, and then remove in v23. The plugin is unmaintained and unofficial.\r\n\r\nCan we also use `TODO(v22)` and `TODO(v23)` so it's easier to find all of the TODOs?",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2123619454",
    "pr_number": 31424,
    "pr_file": "packages/rspack/src/generators/application/application.ts",
    "created_at": "2025-06-03T12:07:02+00:00",
    "commented_code": "-import { ensurePackage, formatFiles, runTasksInSerial, Tree } from '@nx/devkit';\n+import {\n+  ensurePackage,\n+  formatFiles,\n+  logger,\n+  readNxJson,\n+  runTasksInSerial,\n+  Tree,\n+  updateNxJson,\n+} from '@nx/devkit';\n import { version as nxVersion } from 'nx/package.json';\n import configurationGenerator from '../configuration/configuration';\n import rspackInitGenerator from '../init/init';\n import { normalizeOptions } from './lib/normalize-options';\n-import { ApplicationGeneratorSchema } from './schema';\n+import { ApplicationGeneratorSchema, NormalizedSchema } from './schema';\n+\n+/**\n+ * Updates the exclude field for any @nx/rspack/plugin registrations in nx.json\n+ */\n+function updateRspackPluginExclusion(tree: Tree, options: NormalizedSchema) {\n+  const nxJson = readNxJson(tree);\n+  if (!nxJson.plugins?.length) {\n+    return;\n+  }\n+\n+  let updated = false;\n+\n+  // Loop through all plugins to find @nx/rspack/plugin registrations\n+  for (let i = 0; i < nxJson.plugins.length; i++) {\n+    const plugin = nxJson.plugins[i];\n+    const isRspackPlugin =\n+      typeof plugin === 'string'\n+        ? plugin === '@nx/rspack/plugin'\n+        : plugin.plugin === '@nx/rspack/plugin';\n+\n+    if (!isRspackPlugin) {\n+      continue;\n+    }\n+\n+    if (typeof plugin === 'string') {\n+      // Convert string notation to object notation with exclude field\n+      nxJson.plugins[i] = {\n+        plugin: '@nx/rspack/plugin',\n+        exclude: [`${options.appProjectRoot}/**`],\n+      };\n+      updated = true;\n+    } else {\n+      // Object notation\n+      if (!plugin.exclude) {\n+        // Add exclude field if it doesn't exist\n+        plugin.exclude = [`${options.appProjectRoot}/**`];\n+        updated = true;\n+      } else if (Array.isArray(plugin.exclude)) {\n+        // Add to existing exclude field if it's an array\n+        plugin.exclude.push(`${options.appProjectRoot}/**`);\n+        updated = true;\n+      }\n+    }\n+  }\n+\n+  if (updated) {\n+    updateNxJson(tree, nxJson);\n+  }\n+}\n \n export default async function (\n   tree: Tree,\n   _options: ApplicationGeneratorSchema\n ) {\n+  // Add deprecation warning with alternatives based on framework\n+  const framework = _options.framework || 'react'; // Default is react\n+\n+  logger.warn(\n+    `The @nx/rspack:application generator is deprecated and will be removed in Nx 22. ` +",
    "repo_full_name": "nrwl/nx",
    "discussion_comments": [
      {
        "comment_id": "2123619454",
        "repo_full_name": "nrwl/nx",
        "pr_number": 31424,
        "pr_file": "packages/rspack/src/generators/application/application.ts",
        "discussion_id": "2123619454",
        "commented_code": "@@ -1,14 +1,81 @@\n-import { ensurePackage, formatFiles, runTasksInSerial, Tree } from '@nx/devkit';\n+import {\n+  ensurePackage,\n+  formatFiles,\n+  logger,\n+  readNxJson,\n+  runTasksInSerial,\n+  Tree,\n+  updateNxJson,\n+} from '@nx/devkit';\n import { version as nxVersion } from 'nx/package.json';\n import configurationGenerator from '../configuration/configuration';\n import rspackInitGenerator from '../init/init';\n import { normalizeOptions } from './lib/normalize-options';\n-import { ApplicationGeneratorSchema } from './schema';\n+import { ApplicationGeneratorSchema, NormalizedSchema } from './schema';\n+\n+/**\n+ * Updates the exclude field for any @nx/rspack/plugin registrations in nx.json\n+ */\n+function updateRspackPluginExclusion(tree: Tree, options: NormalizedSchema) {\n+  const nxJson = readNxJson(tree);\n+  if (!nxJson.plugins?.length) {\n+    return;\n+  }\n+\n+  let updated = false;\n+\n+  // Loop through all plugins to find @nx/rspack/plugin registrations\n+  for (let i = 0; i < nxJson.plugins.length; i++) {\n+    const plugin = nxJson.plugins[i];\n+    const isRspackPlugin =\n+      typeof plugin === 'string'\n+        ? plugin === '@nx/rspack/plugin'\n+        : plugin.plugin === '@nx/rspack/plugin';\n+\n+    if (!isRspackPlugin) {\n+      continue;\n+    }\n+\n+    if (typeof plugin === 'string') {\n+      // Convert string notation to object notation with exclude field\n+      nxJson.plugins[i] = {\n+        plugin: '@nx/rspack/plugin',\n+        exclude: [`${options.appProjectRoot}/**`],\n+      };\n+      updated = true;\n+    } else {\n+      // Object notation\n+      if (!plugin.exclude) {\n+        // Add exclude field if it doesn't exist\n+        plugin.exclude = [`${options.appProjectRoot}/**`];\n+        updated = true;\n+      } else if (Array.isArray(plugin.exclude)) {\n+        // Add to existing exclude field if it's an array\n+        plugin.exclude.push(`${options.appProjectRoot}/**`);\n+        updated = true;\n+      }\n+    }\n+  }\n+\n+  if (updated) {\n+    updateNxJson(tree, nxJson);\n+  }\n+}\n \n export default async function (\n   tree: Tree,\n   _options: ApplicationGeneratorSchema\n ) {\n+  // Add deprecation warning with alternatives based on framework\n+  const framework = _options.framework || 'react'; // Default is react\n+\n+  logger.warn(\n+    `The @nx/rspack:application generator is deprecated and will be removed in Nx 22. ` +",
        "comment_created_at": "2025-06-03T12:07:02+00:00",
        "comment_author": "jaysoo",
        "comment_body": "Add a `TODO(v22)` so we can find it later",
        "pr_file_module": null
      },
      {
        "comment_id": "2123637974",
        "repo_full_name": "nrwl/nx",
        "pr_number": 31424,
        "pr_file": "packages/rspack/src/generators/application/application.ts",
        "discussion_id": "2123619454",
        "commented_code": "@@ -1,14 +1,81 @@\n-import { ensurePackage, formatFiles, runTasksInSerial, Tree } from '@nx/devkit';\n+import {\n+  ensurePackage,\n+  formatFiles,\n+  logger,\n+  readNxJson,\n+  runTasksInSerial,\n+  Tree,\n+  updateNxJson,\n+} from '@nx/devkit';\n import { version as nxVersion } from 'nx/package.json';\n import configurationGenerator from '../configuration/configuration';\n import rspackInitGenerator from '../init/init';\n import { normalizeOptions } from './lib/normalize-options';\n-import { ApplicationGeneratorSchema } from './schema';\n+import { ApplicationGeneratorSchema, NormalizedSchema } from './schema';\n+\n+/**\n+ * Updates the exclude field for any @nx/rspack/plugin registrations in nx.json\n+ */\n+function updateRspackPluginExclusion(tree: Tree, options: NormalizedSchema) {\n+  const nxJson = readNxJson(tree);\n+  if (!nxJson.plugins?.length) {\n+    return;\n+  }\n+\n+  let updated = false;\n+\n+  // Loop through all plugins to find @nx/rspack/plugin registrations\n+  for (let i = 0; i < nxJson.plugins.length; i++) {\n+    const plugin = nxJson.plugins[i];\n+    const isRspackPlugin =\n+      typeof plugin === 'string'\n+        ? plugin === '@nx/rspack/plugin'\n+        : plugin.plugin === '@nx/rspack/plugin';\n+\n+    if (!isRspackPlugin) {\n+      continue;\n+    }\n+\n+    if (typeof plugin === 'string') {\n+      // Convert string notation to object notation with exclude field\n+      nxJson.plugins[i] = {\n+        plugin: '@nx/rspack/plugin',\n+        exclude: [`${options.appProjectRoot}/**`],\n+      };\n+      updated = true;\n+    } else {\n+      // Object notation\n+      if (!plugin.exclude) {\n+        // Add exclude field if it doesn't exist\n+        plugin.exclude = [`${options.appProjectRoot}/**`];\n+        updated = true;\n+      } else if (Array.isArray(plugin.exclude)) {\n+        // Add to existing exclude field if it's an array\n+        plugin.exclude.push(`${options.appProjectRoot}/**`);\n+        updated = true;\n+      }\n+    }\n+  }\n+\n+  if (updated) {\n+    updateNxJson(tree, nxJson);\n+  }\n+}\n \n export default async function (\n   tree: Tree,\n   _options: ApplicationGeneratorSchema\n ) {\n+  // Add deprecation warning with alternatives based on framework\n+  const framework = _options.framework || 'react'; // Default is react\n+\n+  logger.warn(\n+    `The @nx/rspack:application generator is deprecated and will be removed in Nx 22. ` +",
        "comment_created_at": "2025-06-03T12:16:20+00:00",
        "comment_author": "Coly010",
        "comment_body": "@claude can you add a `// TODO(v22) - remove this generator` to ensure it does not get missed in the next major",
        "pr_file_module": null
      }
    ]
  }
]