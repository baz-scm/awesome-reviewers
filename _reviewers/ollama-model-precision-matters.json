[
  {
    "discussion_id": "1697785918",
    "pr_number": 5872,
    "pr_file": "scripts/install.sh",
    "created_at": "2024-07-31T01:40:52+00:00",
    "commented_code": "case $2 in\n                 nvidia) available lspci && lspci -d '10de:' | grep -q 'NVIDIA' || return 1 ;;\n                 amdgpu) available lspci && lspci -d '1002:' | grep -q 'AMD' || return 1 ;;\n+                ascend) available lspci && lspci -d '19e5:' | grep -q 'HUAWEI' || return 1 ;;\n             esac ;;\n         lshw)\n             case $2 in\n                 nvidia) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[10DE\\]' || return 1 ;;\n                 amdgpu) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[1002\\]' || return 1 ;;\n+                ascend) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[19E5\\]' || return 1 ;;\n             esac ;;\n         nvidia-smi) available nvidia-smi || return 1 ;;\n+        npu-smi) available npu-smi || return 1 ;;\n     esac\n }\n \n+if check_gpu npu-smi; then\n+    status \"ASCEND GPU installed.\"\n+    exit 0\n+fi\n+\n if check_gpu nvidia-smi; then\n     status \"NVIDIA GPU installed.\"\n     exit 0\n fi\n \n-if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu; then\n+if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu ; check_gpu lspci ascend && ! check_gpu lshw ascend then",
    "repo_full_name": "ollama/ollama",
    "discussion_comments": [
      {
        "comment_id": "1697785918",
        "repo_full_name": "ollama/ollama",
        "pr_number": 5872,
        "pr_file": "scripts/install.sh",
        "discussion_id": "1697785918",
        "commented_code": "@@ -156,24 +156,32 @@ check_gpu() {\n             case $2 in\n                 nvidia) available lspci && lspci -d '10de:' | grep -q 'NVIDIA' || return 1 ;;\n                 amdgpu) available lspci && lspci -d '1002:' | grep -q 'AMD' || return 1 ;;\n+                ascend) available lspci && lspci -d '19e5:' | grep -q 'HUAWEI' || return 1 ;;\n             esac ;;\n         lshw)\n             case $2 in\n                 nvidia) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[10DE\\]' || return 1 ;;\n                 amdgpu) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[1002\\]' || return 1 ;;\n+                ascend) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[19E5\\]' || return 1 ;;\n             esac ;;\n         nvidia-smi) available nvidia-smi || return 1 ;;\n+        npu-smi) available npu-smi || return 1 ;;\n     esac\n }\n \n+if check_gpu npu-smi; then\n+    status \"ASCEND GPU installed.\"\n+    exit 0\n+fi\n+\n if check_gpu nvidia-smi; then\n     status \"NVIDIA GPU installed.\"\n     exit 0\n fi\n \n-if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu; then\n+if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu ; check_gpu lspci ascend && ! check_gpu lshw ascend then",
        "comment_created_at": "2024-07-31T01:40:52+00:00",
        "comment_author": "wangshuai09",
        "comment_body": "Incorrect use of `;`",
        "pr_file_module": null
      },
      {
        "comment_id": "1704974205",
        "repo_full_name": "ollama/ollama",
        "pr_number": 5872,
        "pr_file": "scripts/install.sh",
        "discussion_id": "1697785918",
        "commented_code": "@@ -156,24 +156,32 @@ check_gpu() {\n             case $2 in\n                 nvidia) available lspci && lspci -d '10de:' | grep -q 'NVIDIA' || return 1 ;;\n                 amdgpu) available lspci && lspci -d '1002:' | grep -q 'AMD' || return 1 ;;\n+                ascend) available lspci && lspci -d '19e5:' | grep -q 'HUAWEI' || return 1 ;;\n             esac ;;\n         lshw)\n             case $2 in\n                 nvidia) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[10DE\\]' || return 1 ;;\n                 amdgpu) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[1002\\]' || return 1 ;;\n+                ascend) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[19E5\\]' || return 1 ;;\n             esac ;;\n         nvidia-smi) available nvidia-smi || return 1 ;;\n+        npu-smi) available npu-smi || return 1 ;;\n     esac\n }\n \n+if check_gpu npu-smi; then\n+    status \"ASCEND GPU installed.\"\n+    exit 0\n+fi\n+\n if check_gpu nvidia-smi; then\n     status \"NVIDIA GPU installed.\"\n     exit 0\n fi\n \n-if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu; then\n+if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu ; check_gpu lspci ascend && ! check_gpu lshw ascend then",
        "comment_created_at": "2024-08-06T06:24:46+00:00",
        "comment_author": "zhongTao99",
        "comment_body": "fixed",
        "pr_file_module": null
      },
      {
        "comment_id": "1839616290",
        "repo_full_name": "ollama/ollama",
        "pr_number": 5872,
        "pr_file": "scripts/install.sh",
        "discussion_id": "1697785918",
        "commented_code": "@@ -156,24 +156,32 @@ check_gpu() {\n             case $2 in\n                 nvidia) available lspci && lspci -d '10de:' | grep -q 'NVIDIA' || return 1 ;;\n                 amdgpu) available lspci && lspci -d '1002:' | grep -q 'AMD' || return 1 ;;\n+                ascend) available lspci && lspci -d '19e5:' | grep -q 'HUAWEI' || return 1 ;;\n             esac ;;\n         lshw)\n             case $2 in\n                 nvidia) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[10DE\\]' || return 1 ;;\n                 amdgpu) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[1002\\]' || return 1 ;;\n+                ascend) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[19E5\\]' || return 1 ;;\n             esac ;;\n         nvidia-smi) available nvidia-smi || return 1 ;;\n+        npu-smi) available npu-smi || return 1 ;;\n     esac\n }\n \n+if check_gpu npu-smi; then\n+    status \"ASCEND GPU installed.\"\n+    exit 0\n+fi\n+\n if check_gpu nvidia-smi; then\n     status \"NVIDIA GPU installed.\"\n     exit 0\n fi\n \n-if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu; then\n+if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu ; check_gpu lspci ascend && ! check_gpu lshw ascend then",
        "comment_created_at": "2024-11-13T07:07:14+00:00",
        "comment_author": "donkey566788",
        "comment_body": "@wangshuai09  \r\nHello, could you please advise how I should deploy ollama inference on an aarch64 system architecture using Ascend 910B? Could you also provide an installation example? \r\n您好，是否直接下载最新ollma 版本编译安装即可。。",
        "pr_file_module": null
      },
      {
        "comment_id": "1841386100",
        "repo_full_name": "ollama/ollama",
        "pr_number": 5872,
        "pr_file": "scripts/install.sh",
        "discussion_id": "1697785918",
        "commented_code": "@@ -156,24 +156,32 @@ check_gpu() {\n             case $2 in\n                 nvidia) available lspci && lspci -d '10de:' | grep -q 'NVIDIA' || return 1 ;;\n                 amdgpu) available lspci && lspci -d '1002:' | grep -q 'AMD' || return 1 ;;\n+                ascend) available lspci && lspci -d '19e5:' | grep -q 'HUAWEI' || return 1 ;;\n             esac ;;\n         lshw)\n             case $2 in\n                 nvidia) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[10DE\\]' || return 1 ;;\n                 amdgpu) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[1002\\]' || return 1 ;;\n+                ascend) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[19E5\\]' || return 1 ;;\n             esac ;;\n         nvidia-smi) available nvidia-smi || return 1 ;;\n+        npu-smi) available npu-smi || return 1 ;;\n     esac\n }\n \n+if check_gpu npu-smi; then\n+    status \"ASCEND GPU installed.\"\n+    exit 0\n+fi\n+\n if check_gpu nvidia-smi; then\n     status \"NVIDIA GPU installed.\"\n     exit 0\n fi\n \n-if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu; then\n+if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu ; check_gpu lspci ascend && ! check_gpu lshw ascend then",
        "comment_created_at": "2024-11-14T01:06:58+00:00",
        "comment_author": "hipudding",
        "comment_body": "Yes, download the pr and compile it according to the official guidance.",
        "pr_file_module": null
      },
      {
        "comment_id": "1841442779",
        "repo_full_name": "ollama/ollama",
        "pr_number": 5872,
        "pr_file": "scripts/install.sh",
        "discussion_id": "1697785918",
        "commented_code": "@@ -156,24 +156,32 @@ check_gpu() {\n             case $2 in\n                 nvidia) available lspci && lspci -d '10de:' | grep -q 'NVIDIA' || return 1 ;;\n                 amdgpu) available lspci && lspci -d '1002:' | grep -q 'AMD' || return 1 ;;\n+                ascend) available lspci && lspci -d '19e5:' | grep -q 'HUAWEI' || return 1 ;;\n             esac ;;\n         lshw)\n             case $2 in\n                 nvidia) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[10DE\\]' || return 1 ;;\n                 amdgpu) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[1002\\]' || return 1 ;;\n+                ascend) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[19E5\\]' || return 1 ;;\n             esac ;;\n         nvidia-smi) available nvidia-smi || return 1 ;;\n+        npu-smi) available npu-smi || return 1 ;;\n     esac\n }\n \n+if check_gpu npu-smi; then\n+    status \"ASCEND GPU installed.\"\n+    exit 0\n+fi\n+\n if check_gpu nvidia-smi; then\n     status \"NVIDIA GPU installed.\"\n     exit 0\n fi\n \n-if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu; then\n+if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu ; check_gpu lspci ascend && ! check_gpu lshw ascend then",
        "comment_created_at": "2024-11-14T01:54:50+00:00",
        "comment_author": "donkey566788",
        "comment_body": "@hipudding  感谢回复， 还有一些细节期待您的支持\r\n\r\n官方版本需求\r\ngo version 1.22 or higher\r\ngcc version 11.4.0 or higher\r\n\r\n我使用以下 方法编译安装\r\ngit clone https://github.com/zhongTao99/ollama.git\r\ncd ollama//llm/generate\r\nollama/llm/generate# bash gen_linux.sh\r\n\r\n由于项目环境不可升级gcc 版本，且gcc版本 为7.x ，编译失败， 请问有什么解决方案吗",
        "pr_file_module": null
      },
      {
        "comment_id": "1841444009",
        "repo_full_name": "ollama/ollama",
        "pr_number": 5872,
        "pr_file": "scripts/install.sh",
        "discussion_id": "1697785918",
        "commented_code": "@@ -156,24 +156,32 @@ check_gpu() {\n             case $2 in\n                 nvidia) available lspci && lspci -d '10de:' | grep -q 'NVIDIA' || return 1 ;;\n                 amdgpu) available lspci && lspci -d '1002:' | grep -q 'AMD' || return 1 ;;\n+                ascend) available lspci && lspci -d '19e5:' | grep -q 'HUAWEI' || return 1 ;;\n             esac ;;\n         lshw)\n             case $2 in\n                 nvidia) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[10DE\\]' || return 1 ;;\n                 amdgpu) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[1002\\]' || return 1 ;;\n+                ascend) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[19E5\\]' || return 1 ;;\n             esac ;;\n         nvidia-smi) available nvidia-smi || return 1 ;;\n+        npu-smi) available npu-smi || return 1 ;;\n     esac\n }\n \n+if check_gpu npu-smi; then\n+    status \"ASCEND GPU installed.\"\n+    exit 0\n+fi\n+\n if check_gpu nvidia-smi; then\n     status \"NVIDIA GPU installed.\"\n     exit 0\n fi\n \n-if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu; then\n+if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu ; check_gpu lspci ascend && ! check_gpu lshw ascend then",
        "comment_created_at": "2024-11-14T01:56:16+00:00",
        "comment_author": "hipudding",
        "comment_body": "go generate ./...\r\ngo build .\r\n\r\nBut for the gcc version, there shouldn't be any good solution. If it doesn't work, just compile a higher version of gcc.",
        "pr_file_module": null
      },
      {
        "comment_id": "1843140901",
        "repo_full_name": "ollama/ollama",
        "pr_number": 5872,
        "pr_file": "scripts/install.sh",
        "discussion_id": "1697785918",
        "commented_code": "@@ -156,24 +156,32 @@ check_gpu() {\n             case $2 in\n                 nvidia) available lspci && lspci -d '10de:' | grep -q 'NVIDIA' || return 1 ;;\n                 amdgpu) available lspci && lspci -d '1002:' | grep -q 'AMD' || return 1 ;;\n+                ascend) available lspci && lspci -d '19e5:' | grep -q 'HUAWEI' || return 1 ;;\n             esac ;;\n         lshw)\n             case $2 in\n                 nvidia) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[10DE\\]' || return 1 ;;\n                 amdgpu) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[1002\\]' || return 1 ;;\n+                ascend) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[19E5\\]' || return 1 ;;\n             esac ;;\n         nvidia-smi) available nvidia-smi || return 1 ;;\n+        npu-smi) available npu-smi || return 1 ;;\n     esac\n }\n \n+if check_gpu npu-smi; then\n+    status \"ASCEND GPU installed.\"\n+    exit 0\n+fi\n+\n if check_gpu nvidia-smi; then\n     status \"NVIDIA GPU installed.\"\n     exit 0\n fi\n \n-if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu; then\n+if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu ; check_gpu lspci ascend && ! check_gpu lshw ascend then",
        "comment_created_at": "2024-11-15T03:24:41+00:00",
        "comment_author": "donkey566788",
        "comment_body": "@hipudding 已经升级 go 1.22.9 和 gcc 版本 11.4\r\n编译这个pr 仍然编译不过去， 请教下还有什么解决办法吗\r\n\r\n![6da078357cb98e61a6d99b4d53b50367](https://github.com/user-attachments/assets/e1a49977-4b3f-4736-8c9f-330183a49f64)\r\n![453d123639c8af8c7efa878715d229db](https://github.com/user-attachments/assets/c2f87e76-49c2-4a24-b73f-68dcec65a451)\r\n",
        "pr_file_module": null
      },
      {
        "comment_id": "1843233311",
        "repo_full_name": "ollama/ollama",
        "pr_number": 5872,
        "pr_file": "scripts/install.sh",
        "discussion_id": "1697785918",
        "commented_code": "@@ -156,24 +156,32 @@ check_gpu() {\n             case $2 in\n                 nvidia) available lspci && lspci -d '10de:' | grep -q 'NVIDIA' || return 1 ;;\n                 amdgpu) available lspci && lspci -d '1002:' | grep -q 'AMD' || return 1 ;;\n+                ascend) available lspci && lspci -d '19e5:' | grep -q 'HUAWEI' || return 1 ;;\n             esac ;;\n         lshw)\n             case $2 in\n                 nvidia) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[10DE\\]' || return 1 ;;\n                 amdgpu) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[1002\\]' || return 1 ;;\n+                ascend) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[19E5\\]' || return 1 ;;\n             esac ;;\n         nvidia-smi) available nvidia-smi || return 1 ;;\n+        npu-smi) available npu-smi || return 1 ;;\n     esac\n }\n \n+if check_gpu npu-smi; then\n+    status \"ASCEND GPU installed.\"\n+    exit 0\n+fi\n+\n if check_gpu nvidia-smi; then\n     status \"NVIDIA GPU installed.\"\n     exit 0\n fi\n \n-if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu; then\n+if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu ; check_gpu lspci ascend && ! check_gpu lshw ascend then",
        "comment_created_at": "2024-11-15T06:10:25+00:00",
        "comment_author": "hipudding",
        "comment_body": "Check whether the gcc detected in cmake is version 11.4, or you can manually specify the gcc path. It seems that the gcc version is wrong.",
        "pr_file_module": null
      },
      {
        "comment_id": "1843326453",
        "repo_full_name": "ollama/ollama",
        "pr_number": 5872,
        "pr_file": "scripts/install.sh",
        "discussion_id": "1697785918",
        "commented_code": "@@ -156,24 +156,32 @@ check_gpu() {\n             case $2 in\n                 nvidia) available lspci && lspci -d '10de:' | grep -q 'NVIDIA' || return 1 ;;\n                 amdgpu) available lspci && lspci -d '1002:' | grep -q 'AMD' || return 1 ;;\n+                ascend) available lspci && lspci -d '19e5:' | grep -q 'HUAWEI' || return 1 ;;\n             esac ;;\n         lshw)\n             case $2 in\n                 nvidia) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[10DE\\]' || return 1 ;;\n                 amdgpu) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[1002\\]' || return 1 ;;\n+                ascend) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[19E5\\]' || return 1 ;;\n             esac ;;\n         nvidia-smi) available nvidia-smi || return 1 ;;\n+        npu-smi) available npu-smi || return 1 ;;\n     esac\n }\n \n+if check_gpu npu-smi; then\n+    status \"ASCEND GPU installed.\"\n+    exit 0\n+fi\n+\n if check_gpu nvidia-smi; then\n     status \"NVIDIA GPU installed.\"\n     exit 0\n fi\n \n-if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu; then\n+if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu ; check_gpu lspci ascend && ! check_gpu lshw ascend then",
        "comment_created_at": "2024-11-15T07:56:39+00:00",
        "comment_author": "Wind-Ring",
        "comment_body": "@hipudding 大佬您好，目前go generate ./...这一步看上去已经完成，执行go build .后无返回，不知道是否安装成功。后续要从测试环境迁移部署到某运营商的gcc版本低(7.3.0)，无法升级系统包的封闭环境，请问如何打包集成这个应用。\r\n如果您能留下私下联系的邮箱就最好了，感谢！\r\n![1](https://github.com/user-attachments/assets/97cc2aba-78a6-4a9a-a59f-f6f789bfbdf1)\r\n![2](https://github.com/user-attachments/assets/0ad48c5a-8dcd-47c3-9646-461acf8072f3)\r\n",
        "pr_file_module": null
      },
      {
        "comment_id": "1845801828",
        "repo_full_name": "ollama/ollama",
        "pr_number": 5872,
        "pr_file": "scripts/install.sh",
        "discussion_id": "1697785918",
        "commented_code": "@@ -156,24 +156,32 @@ check_gpu() {\n             case $2 in\n                 nvidia) available lspci && lspci -d '10de:' | grep -q 'NVIDIA' || return 1 ;;\n                 amdgpu) available lspci && lspci -d '1002:' | grep -q 'AMD' || return 1 ;;\n+                ascend) available lspci && lspci -d '19e5:' | grep -q 'HUAWEI' || return 1 ;;\n             esac ;;\n         lshw)\n             case $2 in\n                 nvidia) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[10DE\\]' || return 1 ;;\n                 amdgpu) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[1002\\]' || return 1 ;;\n+                ascend) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[19E5\\]' || return 1 ;;\n             esac ;;\n         nvidia-smi) available nvidia-smi || return 1 ;;\n+        npu-smi) available npu-smi || return 1 ;;\n     esac\n }\n \n+if check_gpu npu-smi; then\n+    status \"ASCEND GPU installed.\"\n+    exit 0\n+fi\n+\n if check_gpu nvidia-smi; then\n     status \"NVIDIA GPU installed.\"\n     exit 0\n fi\n \n-if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu; then\n+if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu ; check_gpu lspci ascend && ! check_gpu lshw ascend then",
        "comment_created_at": "2024-11-18T03:18:46+00:00",
        "comment_author": "MeiK2333",
        "comment_body": "@Wind-Ring @donkey566788 \r\n[ollama.zip](https://github.com/user-attachments/files/17794164/ollama.zip)\r\n\r\n这里是我编译打包的 ollama 二进制文件，如果 gcc 版本过低的话，需要把 libstdc++.so 那个文件加入 LD_LIBRARY_PATH 中\r\n\r\n还有就是这个文件是基于当前 pr 的代码编译的，没有合入最新的 ollama 和 llama.cpp 的代码",
        "pr_file_module": null
      },
      {
        "comment_id": "1845805950",
        "repo_full_name": "ollama/ollama",
        "pr_number": 5872,
        "pr_file": "scripts/install.sh",
        "discussion_id": "1697785918",
        "commented_code": "@@ -156,24 +156,32 @@ check_gpu() {\n             case $2 in\n                 nvidia) available lspci && lspci -d '10de:' | grep -q 'NVIDIA' || return 1 ;;\n                 amdgpu) available lspci && lspci -d '1002:' | grep -q 'AMD' || return 1 ;;\n+                ascend) available lspci && lspci -d '19e5:' | grep -q 'HUAWEI' || return 1 ;;\n             esac ;;\n         lshw)\n             case $2 in\n                 nvidia) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[10DE\\]' || return 1 ;;\n                 amdgpu) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[1002\\]' || return 1 ;;\n+                ascend) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[19E5\\]' || return 1 ;;\n             esac ;;\n         nvidia-smi) available nvidia-smi || return 1 ;;\n+        npu-smi) available npu-smi || return 1 ;;\n     esac\n }\n \n+if check_gpu npu-smi; then\n+    status \"ASCEND GPU installed.\"\n+    exit 0\n+fi\n+\n if check_gpu nvidia-smi; then\n     status \"NVIDIA GPU installed.\"\n     exit 0\n fi\n \n-if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu; then\n+if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu ; check_gpu lspci ascend && ! check_gpu lshw ascend then",
        "comment_created_at": "2024-11-18T03:27:45+00:00",
        "comment_author": "Wind-Ring",
        "comment_body": "@MeiK2333 \r\n非常感谢！",
        "pr_file_module": null
      },
      {
        "comment_id": "1860488489",
        "repo_full_name": "ollama/ollama",
        "pr_number": 5872,
        "pr_file": "scripts/install.sh",
        "discussion_id": "1697785918",
        "commented_code": "@@ -156,24 +156,32 @@ check_gpu() {\n             case $2 in\n                 nvidia) available lspci && lspci -d '10de:' | grep -q 'NVIDIA' || return 1 ;;\n                 amdgpu) available lspci && lspci -d '1002:' | grep -q 'AMD' || return 1 ;;\n+                ascend) available lspci && lspci -d '19e5:' | grep -q 'HUAWEI' || return 1 ;;\n             esac ;;\n         lshw)\n             case $2 in\n                 nvidia) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[10DE\\]' || return 1 ;;\n                 amdgpu) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[1002\\]' || return 1 ;;\n+                ascend) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[19E5\\]' || return 1 ;;\n             esac ;;\n         nvidia-smi) available nvidia-smi || return 1 ;;\n+        npu-smi) available npu-smi || return 1 ;;\n     esac\n }\n \n+if check_gpu npu-smi; then\n+    status \"ASCEND GPU installed.\"\n+    exit 0\n+fi\n+\n if check_gpu nvidia-smi; then\n     status \"NVIDIA GPU installed.\"\n     exit 0\n fi\n \n-if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu; then\n+if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu ; check_gpu lspci ascend && ! check_gpu lshw ascend then",
        "comment_created_at": "2024-11-27T11:23:44+00:00",
        "comment_author": "121209",
        "comment_body": "> [ollama.zip](https://github.com/user-attachments/files/17794164/ollama.zip)\r\n> \r\n> 这里是我编译打包的 ollama 二进制文件，如果 gcc 版本过低的话，需要把 libstdc++.so 那个文件加入 LD_LIBRARY_PATH 中\r\n> \r\n> 还有就是这个文件是基于当前 pr 的代码编译的，没有合入最新的 ollama 和 llama.cpp 的代码\r\n\r\n我是新手，能问下这个包上传服务器后该如何安装吗",
        "pr_file_module": null
      },
      {
        "comment_id": "1861393560",
        "repo_full_name": "ollama/ollama",
        "pr_number": 5872,
        "pr_file": "scripts/install.sh",
        "discussion_id": "1697785918",
        "commented_code": "@@ -156,24 +156,32 @@ check_gpu() {\n             case $2 in\n                 nvidia) available lspci && lspci -d '10de:' | grep -q 'NVIDIA' || return 1 ;;\n                 amdgpu) available lspci && lspci -d '1002:' | grep -q 'AMD' || return 1 ;;\n+                ascend) available lspci && lspci -d '19e5:' | grep -q 'HUAWEI' || return 1 ;;\n             esac ;;\n         lshw)\n             case $2 in\n                 nvidia) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[10DE\\]' || return 1 ;;\n                 amdgpu) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[1002\\]' || return 1 ;;\n+                ascend) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[19E5\\]' || return 1 ;;\n             esac ;;\n         nvidia-smi) available nvidia-smi || return 1 ;;\n+        npu-smi) available npu-smi || return 1 ;;\n     esac\n }\n \n+if check_gpu npu-smi; then\n+    status \"ASCEND GPU installed.\"\n+    exit 0\n+fi\n+\n if check_gpu nvidia-smi; then\n     status \"NVIDIA GPU installed.\"\n     exit 0\n fi\n \n-if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu; then\n+if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu ; check_gpu lspci ascend && ! check_gpu lshw ascend then",
        "comment_created_at": "2024-11-28T01:14:53+00:00",
        "comment_author": "hipudding",
        "comment_body": "@121209 ./ollama serve",
        "pr_file_module": null
      },
      {
        "comment_id": "1861426468",
        "repo_full_name": "ollama/ollama",
        "pr_number": 5872,
        "pr_file": "scripts/install.sh",
        "discussion_id": "1697785918",
        "commented_code": "@@ -156,24 +156,32 @@ check_gpu() {\n             case $2 in\n                 nvidia) available lspci && lspci -d '10de:' | grep -q 'NVIDIA' || return 1 ;;\n                 amdgpu) available lspci && lspci -d '1002:' | grep -q 'AMD' || return 1 ;;\n+                ascend) available lspci && lspci -d '19e5:' | grep -q 'HUAWEI' || return 1 ;;\n             esac ;;\n         lshw)\n             case $2 in\n                 nvidia) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[10DE\\]' || return 1 ;;\n                 amdgpu) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[1002\\]' || return 1 ;;\n+                ascend) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[19E5\\]' || return 1 ;;\n             esac ;;\n         nvidia-smi) available nvidia-smi || return 1 ;;\n+        npu-smi) available npu-smi || return 1 ;;\n     esac\n }\n \n+if check_gpu npu-smi; then\n+    status \"ASCEND GPU installed.\"\n+    exit 0\n+fi\n+\n if check_gpu nvidia-smi; then\n     status \"NVIDIA GPU installed.\"\n     exit 0\n fi\n \n-if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu; then\n+if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu ; check_gpu lspci ascend && ! check_gpu lshw ascend then",
        "comment_created_at": "2024-11-28T02:19:07+00:00",
        "comment_author": "121209",
        "comment_body": "> @121209 ./ollama serve\r\n大佬，您好。我在910B3上将打包好的二进制文件解压后，./ollama serve启动服务，但是打屏信息卡住了，也没有输出结果。这该咋办呢？\r\n![Snipaste_2024-11-28_10-16-51](https://github.com/user-attachments/assets/fb8b9abe-0896-47cf-9e1c-7b4e3ec8dbb6)\r\n\r\n\r\n",
        "pr_file_module": null
      },
      {
        "comment_id": "1861446172",
        "repo_full_name": "ollama/ollama",
        "pr_number": 5872,
        "pr_file": "scripts/install.sh",
        "discussion_id": "1697785918",
        "commented_code": "@@ -156,24 +156,32 @@ check_gpu() {\n             case $2 in\n                 nvidia) available lspci && lspci -d '10de:' | grep -q 'NVIDIA' || return 1 ;;\n                 amdgpu) available lspci && lspci -d '1002:' | grep -q 'AMD' || return 1 ;;\n+                ascend) available lspci && lspci -d '19e5:' | grep -q 'HUAWEI' || return 1 ;;\n             esac ;;\n         lshw)\n             case $2 in\n                 nvidia) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[10DE\\]' || return 1 ;;\n                 amdgpu) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[1002\\]' || return 1 ;;\n+                ascend) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[19E5\\]' || return 1 ;;\n             esac ;;\n         nvidia-smi) available nvidia-smi || return 1 ;;\n+        npu-smi) available npu-smi || return 1 ;;\n     esac\n }\n \n+if check_gpu npu-smi; then\n+    status \"ASCEND GPU installed.\"\n+    exit 0\n+fi\n+\n if check_gpu nvidia-smi; then\n     status \"NVIDIA GPU installed.\"\n     exit 0\n fi\n \n-if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu; then\n+if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu ; check_gpu lspci ascend && ! check_gpu lshw ascend then",
        "comment_created_at": "2024-11-28T02:55:09+00:00",
        "comment_author": "121209",
        "comment_body": "> go generate ./... go build .\r\n> \r\n> But for the gcc version, there shouldn't be any good solution. If it doesn't work, just compile a higher version of gcc.\r\n\r\n大佬，我利用conda安装了go1.22.6和gcc11.4版本，然后使用如下方式编译\r\ngit clone https://github.com/zhongTao99/ollama.git\r\ncd ollama//llm/generate\r\nollama/llm/generate# bash gen_linux.sh；\r\nbash运行报错后接着运行：\r\ngo generate ./...\r\ngo build .\r\n其中，go generate ./报错：\r\n![image](https://github.com/user-attachments/assets/5ccfbaa5-e922-4c72-a17c-948b8bd5d366)\r\ngo bulid .没有报错但是启动ollama serve后，\r\n![image](https://github.com/user-attachments/assets/011ad01e-ff84-43bd-ba94-c7ca68ddc342)\r\n这种情况该怎么处理呢？能和您直接在welink中取得联系吗？",
        "pr_file_module": null
      },
      {
        "comment_id": "1861560951",
        "repo_full_name": "ollama/ollama",
        "pr_number": 5872,
        "pr_file": "scripts/install.sh",
        "discussion_id": "1697785918",
        "commented_code": "@@ -156,24 +156,32 @@ check_gpu() {\n             case $2 in\n                 nvidia) available lspci && lspci -d '10de:' | grep -q 'NVIDIA' || return 1 ;;\n                 amdgpu) available lspci && lspci -d '1002:' | grep -q 'AMD' || return 1 ;;\n+                ascend) available lspci && lspci -d '19e5:' | grep -q 'HUAWEI' || return 1 ;;\n             esac ;;\n         lshw)\n             case $2 in\n                 nvidia) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[10DE\\]' || return 1 ;;\n                 amdgpu) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[1002\\]' || return 1 ;;\n+                ascend) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[19E5\\]' || return 1 ;;\n             esac ;;\n         nvidia-smi) available nvidia-smi || return 1 ;;\n+        npu-smi) available npu-smi || return 1 ;;\n     esac\n }\n \n+if check_gpu npu-smi; then\n+    status \"ASCEND GPU installed.\"\n+    exit 0\n+fi\n+\n if check_gpu nvidia-smi; then\n     status \"NVIDIA GPU installed.\"\n     exit 0\n fi\n \n-if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu; then\n+if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu ; check_gpu lspci ascend && ! check_gpu lshw ascend then",
        "comment_created_at": "2024-11-28T06:15:57+00:00",
        "comment_author": "hipudding",
        "comment_body": "> > @121209 ./ollama serve\r\n> > 大佬，您好。我在910B3上将打包好的二进制文件解压后，./ollama serve启动服务，但是打屏信息卡住了，也没有输出结果。这该咋办呢？\r\n> > ![Snipaste_2024-11-28_10-16-51](https://private-user-images.githubusercontent.com/74487984/390616774-fb8b9abe-0896-47cf-9e1c-7b4e3ec8dbb6.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzI3NzQ3OTIsIm5iZiI6MTczMjc3NDQ5MiwicGF0aCI6Ii83NDQ4Nzk4NC8zOTA2MTY3NzQtZmI4YjlhYmUtMDg5Ni00N2NmLTllMWMtN2I0ZTNlYzhkYmI2LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDExMjglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQxMTI4VDA2MTQ1MlomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTdmNzg5YjBmYjE2YzdlNDBlYWZlMTE5ZGE4YTVkOTI5YjIwMTg3MGUyODc1Y2QxMWI5NWQzZjc2OTk2Y2Q3ZDkmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.L0UNMsjPKKyVPi7AxoaHbupKbz8P-Is4gGLPsp5-MVo)\r\n\r\nIt seems ollama server has already started. You can just run ollama client, for example: ./ollama run qwen2.5",
        "pr_file_module": null
      },
      {
        "comment_id": "1861584628",
        "repo_full_name": "ollama/ollama",
        "pr_number": 5872,
        "pr_file": "scripts/install.sh",
        "discussion_id": "1697785918",
        "commented_code": "@@ -156,24 +156,32 @@ check_gpu() {\n             case $2 in\n                 nvidia) available lspci && lspci -d '10de:' | grep -q 'NVIDIA' || return 1 ;;\n                 amdgpu) available lspci && lspci -d '1002:' | grep -q 'AMD' || return 1 ;;\n+                ascend) available lspci && lspci -d '19e5:' | grep -q 'HUAWEI' || return 1 ;;\n             esac ;;\n         lshw)\n             case $2 in\n                 nvidia) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[10DE\\]' || return 1 ;;\n                 amdgpu) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[1002\\]' || return 1 ;;\n+                ascend) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[19E5\\]' || return 1 ;;\n             esac ;;\n         nvidia-smi) available nvidia-smi || return 1 ;;\n+        npu-smi) available npu-smi || return 1 ;;\n     esac\n }\n \n+if check_gpu npu-smi; then\n+    status \"ASCEND GPU installed.\"\n+    exit 0\n+fi\n+\n if check_gpu nvidia-smi; then\n     status \"NVIDIA GPU installed.\"\n     exit 0\n fi\n \n-if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu; then\n+if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu ; check_gpu lspci ascend && ! check_gpu lshw ascend then",
        "comment_created_at": "2024-11-28T06:35:30+00:00",
        "comment_author": "Wind-Ring",
        "comment_body": "@hipudding @MeiK2333 @zhongTao99 大佬们好，我用自己编译的以及MeiK2333大佬给出的ollama，启动服务后发现无法监测出本设备npu而是直接加载cpu，且跑模型时确实没有使用到npu，请问是什么原因呢\r\n![31CEC4C6-CF88-465f-8BD5-0C23A7E289C3](https://github.com/user-attachments/assets/fd7823ee-8a81-4d4c-8f98-2668c9c07d9e)\r\n",
        "pr_file_module": null
      },
      {
        "comment_id": "1861638681",
        "repo_full_name": "ollama/ollama",
        "pr_number": 5872,
        "pr_file": "scripts/install.sh",
        "discussion_id": "1697785918",
        "commented_code": "@@ -156,24 +156,32 @@ check_gpu() {\n             case $2 in\n                 nvidia) available lspci && lspci -d '10de:' | grep -q 'NVIDIA' || return 1 ;;\n                 amdgpu) available lspci && lspci -d '1002:' | grep -q 'AMD' || return 1 ;;\n+                ascend) available lspci && lspci -d '19e5:' | grep -q 'HUAWEI' || return 1 ;;\n             esac ;;\n         lshw)\n             case $2 in\n                 nvidia) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[10DE\\]' || return 1 ;;\n                 amdgpu) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[1002\\]' || return 1 ;;\n+                ascend) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[19E5\\]' || return 1 ;;\n             esac ;;\n         nvidia-smi) available nvidia-smi || return 1 ;;\n+        npu-smi) available npu-smi || return 1 ;;\n     esac\n }\n \n+if check_gpu npu-smi; then\n+    status \"ASCEND GPU installed.\"\n+    exit 0\n+fi\n+\n if check_gpu nvidia-smi; then\n     status \"NVIDIA GPU installed.\"\n     exit 0\n fi\n \n-if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu; then\n+if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu ; check_gpu lspci ascend && ! check_gpu lshw ascend then",
        "comment_created_at": "2024-11-28T07:30:38+00:00",
        "comment_author": "hipudding",
        "comment_body": "> @hipudding @MeiK2333 @zhongTao99 大佬们好，我用自己编译的以及MeiK2333大佬给出的ollama，启动服务后发现无法监测出本设备npu而是直接加载cpu，且跑模型时确实没有使用到npu，请问是什么原因呢 ![31CEC4C6-CF88-465f-8BD5-0C23A7E289C3](https://private-user-images.githubusercontent.com/52388501/390667212-fd7823ee-8a81-4d4c-8f98-2668c9c07d9e.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzI3NzkxNjQsIm5iZiI6MTczMjc3ODg2NCwicGF0aCI6Ii81MjM4ODUwMS8zOTA2NjcyMTItZmQ3ODIzZWUtOGE4MS00ZDRjLThmOTgtMjY2OGM5YzA3ZDllLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDExMjglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQxMTI4VDA3Mjc0NFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWJkY2QwNWMzYjVmNjY0ZjcxZmU2MTJjMjUzZWMzMDFmNWM3MzU2ZTAzY2U1ZWM3OTc2NmMzOWEzMzFkYjY0MTYmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.pDy0zBsSMf8lOK5g-A10zrVT4V3JmuiSCNafo4OS8rc)\r\n\r\nThere are two possibilities: 1. CANN compilation was not used during compilation; 2. Ascend NPU was not detected during startup.\r\n\r\nYou can check like this: after starting ollama, go to the /tmp/ollama****/ directory to check whether the Ascend version of the ollama server has been generated; or check whether the user who started ollama has permission to access the NPU.",
        "pr_file_module": null
      },
      {
        "comment_id": "1861700827",
        "repo_full_name": "ollama/ollama",
        "pr_number": 5872,
        "pr_file": "scripts/install.sh",
        "discussion_id": "1697785918",
        "commented_code": "@@ -156,24 +156,32 @@ check_gpu() {\n             case $2 in\n                 nvidia) available lspci && lspci -d '10de:' | grep -q 'NVIDIA' || return 1 ;;\n                 amdgpu) available lspci && lspci -d '1002:' | grep -q 'AMD' || return 1 ;;\n+                ascend) available lspci && lspci -d '19e5:' | grep -q 'HUAWEI' || return 1 ;;\n             esac ;;\n         lshw)\n             case $2 in\n                 nvidia) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[10DE\\]' || return 1 ;;\n                 amdgpu) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[1002\\]' || return 1 ;;\n+                ascend) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[19E5\\]' || return 1 ;;\n             esac ;;\n         nvidia-smi) available nvidia-smi || return 1 ;;\n+        npu-smi) available npu-smi || return 1 ;;\n     esac\n }\n \n+if check_gpu npu-smi; then\n+    status \"ASCEND GPU installed.\"\n+    exit 0\n+fi\n+\n if check_gpu nvidia-smi; then\n     status \"NVIDIA GPU installed.\"\n     exit 0\n fi\n \n-if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu; then\n+if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu ; check_gpu lspci ascend && ! check_gpu lshw ascend then",
        "comment_created_at": "2024-11-28T08:13:42+00:00",
        "comment_author": "121209",
        "comment_body": "> > > @121209 ./ollama serve\r\n> > > 大佬，您好。我在910B3上将打包好的二进制文件解压后，./ollama serve启动服务，但是打屏信息卡住了，也没有输出结果。这该咋办呢？\r\n> > > ![Snipaste_2024-11-28_10-16-51](https://private-user-images.githubusercontent.com/74487984/390616774-fb8b9abe-0896-47cf-9e1c-7b4e3ec8dbb6.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzI3NzQ3OTIsIm5iZiI6MTczMjc3NDQ5MiwicGF0aCI6Ii83NDQ4Nzk4NC8zOTA2MTY3NzQtZmI4YjlhYmUtMDg5Ni00N2NmLTllMWMtN2I0ZTNlYzhkYmI2LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDExMjglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQxMTI4VDA2MTQ1MlomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTdmNzg5YjBmYjE2YzdlNDBlYWZlMTE5ZGE4YTVkOTI5YjIwMTg3MGUyODc1Y2QxMWI5NWQzZjc2OTk2Y2Q3ZDkmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.L0UNMsjPKKyVPi7AxoaHbupKbz8P-Is4gGLPsp5-MVo)\r\n> \r\n> It seems ollama server has already started. You can just run ollama client, for example: ./ollama run qwen2.5\r\n\r\n@hipudding 大佬，直接运行显示服务没拉起来。您有能直接使用该服务的有效方法吗？\r\n![Snipaste_2024-11-28_16-06-21](https://github.com/user-attachments/assets/d43c109a-a36b-4f9e-92cf-49a120b0e1c5)\r\n",
        "pr_file_module": null
      },
      {
        "comment_id": "1861703129",
        "repo_full_name": "ollama/ollama",
        "pr_number": 5872,
        "pr_file": "scripts/install.sh",
        "discussion_id": "1697785918",
        "commented_code": "@@ -156,24 +156,32 @@ check_gpu() {\n             case $2 in\n                 nvidia) available lspci && lspci -d '10de:' | grep -q 'NVIDIA' || return 1 ;;\n                 amdgpu) available lspci && lspci -d '1002:' | grep -q 'AMD' || return 1 ;;\n+                ascend) available lspci && lspci -d '19e5:' | grep -q 'HUAWEI' || return 1 ;;\n             esac ;;\n         lshw)\n             case $2 in\n                 nvidia) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[10DE\\]' || return 1 ;;\n                 amdgpu) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[1002\\]' || return 1 ;;\n+                ascend) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[19E5\\]' || return 1 ;;\n             esac ;;\n         nvidia-smi) available nvidia-smi || return 1 ;;\n+        npu-smi) available npu-smi || return 1 ;;\n     esac\n }\n \n+if check_gpu npu-smi; then\n+    status \"ASCEND GPU installed.\"\n+    exit 0\n+fi\n+\n if check_gpu nvidia-smi; then\n     status \"NVIDIA GPU installed.\"\n     exit 0\n fi\n \n-if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu; then\n+if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu ; check_gpu lspci ascend && ! check_gpu lshw ascend then",
        "comment_created_at": "2024-11-28T08:14:36+00:00",
        "comment_author": "Wind-Ring",
        "comment_body": "@hipudding \r\n大佬你好，我刚刚检查并export了cann环境变量后启动ollama，结果依旧是没有监测出npu。\r\n\r\n![AEFD4FB7-73B8-45b3-949D-DCB0FF253275](https://github.com/user-attachments/assets/eb25b725-829b-48d5-99cf-a788c53be8ee)\r\n\r\n目前的ollama是在无npu以及驱动的测试环境编译好，然后上传到封闭环境且无root权限现网设备上的。ollama要使用npu是否需要从一开始编译就要加入npu相关参数呢？如若需要，如何结合cann驱动编译ollama？",
        "pr_file_module": null
      },
      {
        "comment_id": "1863027631",
        "repo_full_name": "ollama/ollama",
        "pr_number": 5872,
        "pr_file": "scripts/install.sh",
        "discussion_id": "1697785918",
        "commented_code": "@@ -156,24 +156,32 @@ check_gpu() {\n             case $2 in\n                 nvidia) available lspci && lspci -d '10de:' | grep -q 'NVIDIA' || return 1 ;;\n                 amdgpu) available lspci && lspci -d '1002:' | grep -q 'AMD' || return 1 ;;\n+                ascend) available lspci && lspci -d '19e5:' | grep -q 'HUAWEI' || return 1 ;;\n             esac ;;\n         lshw)\n             case $2 in\n                 nvidia) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[10DE\\]' || return 1 ;;\n                 amdgpu) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[1002\\]' || return 1 ;;\n+                ascend) available lshw && $SUDO lshw -c display -numeric -disable network | grep -q 'vendor: .* \\[19E5\\]' || return 1 ;;\n             esac ;;\n         nvidia-smi) available nvidia-smi || return 1 ;;\n+        npu-smi) available npu-smi || return 1 ;;\n     esac\n }\n \n+if check_gpu npu-smi; then\n+    status \"ASCEND GPU installed.\"\n+    exit 0\n+fi\n+\n if check_gpu nvidia-smi; then\n     status \"NVIDIA GPU installed.\"\n     exit 0\n fi\n \n-if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu; then\n+if ! check_gpu lspci nvidia && ! check_gpu lshw nvidia && ! check_gpu lspci amdgpu && ! check_gpu lshw amdgpu ; check_gpu lspci ascend && ! check_gpu lshw ascend then",
        "comment_created_at": "2024-11-29T06:44:26+00:00",
        "comment_author": "hipudding",
        "comment_body": "> > > > @121209 ./ollama serve\r\n> > > > 大佬，您好。我在910B3上将打包好的二进制文件解压后，./ollama serve启动服务，但是打屏信息卡住了，也没有输出结果。这该咋办呢？\r\n> > > > ![Snipaste_2024-11-28_10-16-51](https://private-user-images.githubusercontent.com/74487984/390616774-fb8b9abe-0896-47cf-9e1c-7b4e3ec8dbb6.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzI3NzQ3OTIsIm5iZiI6MTczMjc3NDQ5MiwicGF0aCI6Ii83NDQ4Nzk4NC8zOTA2MTY3NzQtZmI4YjlhYmUtMDg5Ni00N2NmLTllMWMtN2I0ZTNlYzhkYmI2LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDExMjglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQxMTI4VDA2MTQ1MlomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTdmNzg5YjBmYjE2YzdlNDBlYWZlMTE5ZGE4YTVkOTI5YjIwMTg3MGUyODc1Y2QxMWI5NWQzZjc2OTk2Y2Q3ZDkmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.L0UNMsjPKKyVPi7AxoaHbupKbz8P-Is4gGLPsp5-MVo)\r\n> > \r\n> > \r\n> > It seems ollama server has already started. You can just run ollama client, for example: ./ollama run qwen2.5\r\n> \r\n> @hipudding 大佬，直接运行显示服务没拉起来。您有能直接使用该服务的有效方法吗？ ![Snipaste_2024-11-28_16-06-21](https://private-user-images.githubusercontent.com/74487984/390694396-d43c109a-a36b-4f9e-92cf-49a120b0e1c5.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzI4NDQwMDIsIm5iZiI6MTczMjg0MzcwMiwicGF0aCI6Ii83NDQ4Nzk4NC8zOTA2OTQzOTYtZDQzYzEwOWEtYTM2Yi00ZjllLTkyY2YtNDlhMTIwYjBlMWM1LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDExMjklMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQxMTI5VDAxMjgyMlomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWUzYzQyYjZjOGJiOWJjM2QyODQ2ZTE0MDk0Y2MxMjZiY2UyM2UyODBiMjY5ZGZkMzE5ZjVmMWU0MGJlNjhiNmUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.67HeB1JIwFh0sTz-FKcUqoI2ufMNyoHjhDJKUp49Fyw)\r\n\r\nDo not terminate ollama server, keep ollama server running, and open another terminal run ollama cli.",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1697791177",
    "pr_number": 5872,
    "pr_file": "scripts/install.sh",
    "created_at": "2024-07-31T01:49:19+00:00",
    "commented_code": "done\n fi\n \n+install_ascend_driver_yum() {\n+    status 'Installing ASCNED driver...'\n+    $SUDO $PACKAGE_MANAGER -y install gcc gcc-c++ make cmake unzip zlib-devel libffi-devel openssl-devel pciutils net-tools sqlite-devel lapack-devel gcc-gfortran python3-devel\n+    $SUDO groupadd -g HwHiAiUser\n+    $SUDO useradd -g HwHiAiUser -d /home/HwHiAiUser -m HwHiAiUser -s /bin/bash\n+    $SUDO usermod -aG HwHiAiUser $USER\n+\n+    # driver version, mabey get from it\n+    # npu-smi info\n+    # +------------------------------------------------------------------------------------------------+\n+    # | npu-smi 24.1.rc1.b060            Version: 24.1.rc1.b060                                        |\n+    wget \"https://ascend-repo.obs.cn-east-2.myhuaweicloud.com/Ascend HDK/Ascend HDK 24.1.RC1/Ascend-hdk-$1-npu-driver_24.1.rc1_linux-$ARCH.run\"\n+    $SUDO sh Ascend-hdk-$1-npu-driver_24.1.rc1_linux-$ARCH.run --full --install-for-all\n+    rm -rf ./Ascend-hdk-$1-npu-driver_24.1.rc1_linux-$ARCH.run\n+\n+    wget \"https://ascend-repo.obs.cn-east-2.myhuaweicloud.com/Ascend HDK/Ascend HDK 24.1.RC1/Ascend-hdk-$1-npu-firmware_7.1.0.6.220.run\"\n+    sudo sh Ascend-hdk-$1-npu-firmware_7.1.0.6.220.run --full\n+    rm -rf ./Ascend-hdk-$1-npu-firmware_7.1.0.6.220.run",
    "repo_full_name": "ollama/ollama",
    "discussion_comments": [
      {
        "comment_id": "1697791177",
        "repo_full_name": "ollama/ollama",
        "pr_number": 5872,
        "pr_file": "scripts/install.sh",
        "discussion_id": "1697791177",
        "commented_code": "@@ -322,5 +330,82 @@ if command -v nvidia-persistenced > /dev/null 2>&1; then\n     done\n fi\n \n+install_ascend_driver_yum() {\n+    status 'Installing ASCNED driver...'\n+    $SUDO $PACKAGE_MANAGER -y install gcc gcc-c++ make cmake unzip zlib-devel libffi-devel openssl-devel pciutils net-tools sqlite-devel lapack-devel gcc-gfortran python3-devel\n+    $SUDO groupadd -g HwHiAiUser\n+    $SUDO useradd -g HwHiAiUser -d /home/HwHiAiUser -m HwHiAiUser -s /bin/bash\n+    $SUDO usermod -aG HwHiAiUser $USER\n+\n+    # driver version, mabey get from it\n+    # npu-smi info\n+    # +------------------------------------------------------------------------------------------------+\n+    # | npu-smi 24.1.rc1.b060            Version: 24.1.rc1.b060                                        |\n+    wget \"https://ascend-repo.obs.cn-east-2.myhuaweicloud.com/Ascend HDK/Ascend HDK 24.1.RC1/Ascend-hdk-$1-npu-driver_24.1.rc1_linux-$ARCH.run\"\n+    $SUDO sh Ascend-hdk-$1-npu-driver_24.1.rc1_linux-$ARCH.run --full --install-for-all\n+    rm -rf ./Ascend-hdk-$1-npu-driver_24.1.rc1_linux-$ARCH.run\n+\n+    wget \"https://ascend-repo.obs.cn-east-2.myhuaweicloud.com/Ascend HDK/Ascend HDK 24.1.RC1/Ascend-hdk-$1-npu-firmware_7.1.0.6.220.run\"\n+    sudo sh Ascend-hdk-$1-npu-firmware_7.1.0.6.220.run --full\n+    rm -rf ./Ascend-hdk-$1-npu-firmware_7.1.0.6.220.run",
        "comment_created_at": "2024-07-31T01:49:19+00:00",
        "comment_author": "wangshuai09",
        "comment_body": "Replace `24.1.RC1` and `7.1.0.6.220` with `ASCEND_DRIVER_VERSION` and `ASCEND_FIRMWARE_VERSION`.",
        "pr_file_module": null
      },
      {
        "comment_id": "1704974281",
        "repo_full_name": "ollama/ollama",
        "pr_number": 5872,
        "pr_file": "scripts/install.sh",
        "discussion_id": "1697791177",
        "commented_code": "@@ -322,5 +330,82 @@ if command -v nvidia-persistenced > /dev/null 2>&1; then\n     done\n fi\n \n+install_ascend_driver_yum() {\n+    status 'Installing ASCNED driver...'\n+    $SUDO $PACKAGE_MANAGER -y install gcc gcc-c++ make cmake unzip zlib-devel libffi-devel openssl-devel pciutils net-tools sqlite-devel lapack-devel gcc-gfortran python3-devel\n+    $SUDO groupadd -g HwHiAiUser\n+    $SUDO useradd -g HwHiAiUser -d /home/HwHiAiUser -m HwHiAiUser -s /bin/bash\n+    $SUDO usermod -aG HwHiAiUser $USER\n+\n+    # driver version, mabey get from it\n+    # npu-smi info\n+    # +------------------------------------------------------------------------------------------------+\n+    # | npu-smi 24.1.rc1.b060            Version: 24.1.rc1.b060                                        |\n+    wget \"https://ascend-repo.obs.cn-east-2.myhuaweicloud.com/Ascend HDK/Ascend HDK 24.1.RC1/Ascend-hdk-$1-npu-driver_24.1.rc1_linux-$ARCH.run\"\n+    $SUDO sh Ascend-hdk-$1-npu-driver_24.1.rc1_linux-$ARCH.run --full --install-for-all\n+    rm -rf ./Ascend-hdk-$1-npu-driver_24.1.rc1_linux-$ARCH.run\n+\n+    wget \"https://ascend-repo.obs.cn-east-2.myhuaweicloud.com/Ascend HDK/Ascend HDK 24.1.RC1/Ascend-hdk-$1-npu-firmware_7.1.0.6.220.run\"\n+    sudo sh Ascend-hdk-$1-npu-firmware_7.1.0.6.220.run --full\n+    rm -rf ./Ascend-hdk-$1-npu-firmware_7.1.0.6.220.run",
        "comment_created_at": "2024-08-06T06:24:52+00:00",
        "comment_author": "zhongTao99",
        "comment_body": "fxied",
        "pr_file_module": null
      },
      {
        "comment_id": "1947411391",
        "repo_full_name": "ollama/ollama",
        "pr_number": 5872,
        "pr_file": "scripts/install.sh",
        "discussion_id": "1697791177",
        "commented_code": "@@ -322,5 +330,82 @@ if command -v nvidia-persistenced > /dev/null 2>&1; then\n     done\n fi\n \n+install_ascend_driver_yum() {\n+    status 'Installing ASCNED driver...'\n+    $SUDO $PACKAGE_MANAGER -y install gcc gcc-c++ make cmake unzip zlib-devel libffi-devel openssl-devel pciutils net-tools sqlite-devel lapack-devel gcc-gfortran python3-devel\n+    $SUDO groupadd -g HwHiAiUser\n+    $SUDO useradd -g HwHiAiUser -d /home/HwHiAiUser -m HwHiAiUser -s /bin/bash\n+    $SUDO usermod -aG HwHiAiUser $USER\n+\n+    # driver version, mabey get from it\n+    # npu-smi info\n+    # +------------------------------------------------------------------------------------------------+\n+    # | npu-smi 24.1.rc1.b060            Version: 24.1.rc1.b060                                        |\n+    wget \"https://ascend-repo.obs.cn-east-2.myhuaweicloud.com/Ascend HDK/Ascend HDK 24.1.RC1/Ascend-hdk-$1-npu-driver_24.1.rc1_linux-$ARCH.run\"\n+    $SUDO sh Ascend-hdk-$1-npu-driver_24.1.rc1_linux-$ARCH.run --full --install-for-all\n+    rm -rf ./Ascend-hdk-$1-npu-driver_24.1.rc1_linux-$ARCH.run\n+\n+    wget \"https://ascend-repo.obs.cn-east-2.myhuaweicloud.com/Ascend HDK/Ascend HDK 24.1.RC1/Ascend-hdk-$1-npu-firmware_7.1.0.6.220.run\"\n+    sudo sh Ascend-hdk-$1-npu-firmware_7.1.0.6.220.run --full\n+    rm -rf ./Ascend-hdk-$1-npu-firmware_7.1.0.6.220.run",
        "comment_created_at": "2025-02-08T02:38:29+00:00",
        "comment_author": "zhangzhi0902",
        "comment_body": "@zhongTao99 @hipudding \r\n大佬好，我按照这样的方式编译：\r\n硬件环境：\r\n    ubuntu22.04 aarch64\r\n    atlas 800 (Model 9000) -> ascend 910Bpro * 8\r\n1、git clone https://github.com/zhongTao99/ollama.git\r\n2、cd ollama\r\n3、export CUSTOM_CPU_FLAGS=cann\r\n4、make --no-print-directory -f make/Makefile.cann\r\n5、make\r\n6、go clean -cache\r\n7、go build -v .\r\n8、./ollama serve\r\n然后可以检测到npu卡\r\n```\r\n[GIN-debug] HEAD   /api/version              --> github.com/ollama/ollama/server.(*Server).GenerateRoutes.func2 (5 handlers)\r\ntime=2025-02-08T10:37:20.671+08:00 level=INFO source=routes.go:1310 msg=\"Listening on 127.0.0.1:11434 (version 0.0.0)\"\r\ntime=2025-02-08T10:37:20.671+08:00 level=INFO source=routes.go:1339 msg=\"Dynamic LLM libraries\" runners=\"[cpu cann]\"\r\ntime=2025-02-08T10:37:20.672+08:00 level=INFO source=gpu.go:231 msg=\"looking for compatible GPUs\"\r\ntime=2025-02-08T10:37:21.721+08:00 level=INFO source=gpu.go:414 msg=\"[%!d(string=0)] Name:Ascend910P: FreeMemory:30664511488, TotalMemory: 47497707520\"\r\ntime=2025-02-08T10:37:22.194+08:00 level=INFO source=gpu.go:414 msg=\"[%!d(string=1)] Name:Ascend910P: FreeMemory:62613598208, TotalMemory: 97210580992\"\r\ntime=2025-02-08T10:37:22.696+08:00 level=INFO source=gpu.go:414 msg=\"[%!d(string=2)] Name:Ascend910P: FreeMemory:93374935040, TotalMemory: 146923454464\"\r\ntime=2025-02-08T10:37:23.217+08:00 level=INFO source=gpu.go:414 msg=\"[%!d(string=3)] Name:Ascend910P: FreeMemory:125907451904, TotalMemory: 196532715520\"\r\ntime=2025-02-08T10:37:23.671+08:00 level=INFO source=gpu.go:414 msg=\"[%!d(string=4)] Name:Ascend910P: FreeMemory:156503126016, TotalMemory: 244030414848\"\r\ntime=2025-02-08T10:37:24.144+08:00 level=INFO source=gpu.go:414 msg=\"[%!d(string=5)] Name:Ascend910P: FreeMemory:187712458752, TotalMemory: 293743292416\"\r\ntime=2025-02-08T10:37:24.673+08:00 level=INFO source=gpu.go:414 msg=\"[%!d(string=6)] Name:Ascend910P: FreeMemory:220164345856, TotalMemory: 343456169984\"\r\ntime=2025-02-08T10:37:25.184+08:00 level=INFO source=gpu.go:414 msg=\"[%!d(string=7)] Name:Ascend910P: FreeMemory:249405378560, TotalMemory: 393065435136\"\r\ntime=2025-02-08T10:37:25.185+08:00 level=INFO source=types.go:131 msg=\"inference compute\" id=0 library=ascend variant=\"\" compute=\"\" driver=0.0 name=Ascend910P total=\"44.2 GiB\" available=\"28.6 GiB\"\r\ntime=2025-02-08T10:37:25.185+08:00 level=INFO source=types.go:131 msg=\"inference compute\" id=1 library=ascend variant=\"\" compute=\"\" driver=0.0 name=Ascend910P total=\"90.5 GiB\" available=\"58.3 GiB\"\r\ntime=2025-02-08T10:37:25.185+08:00 level=INFO source=types.go:131 msg=\"inference compute\" id=2 library=ascend variant=\"\" compute=\"\" driver=0.0 name=Ascend910P total=\"136.8 GiB\" available=\"87.0 GiB\"\r\ntime=2025-02-08T10:37:25.185+08:00 level=INFO source=types.go:131 msg=\"inference compute\" id=3 library=ascend variant=\"\" compute=\"\" driver=0.0 name=Ascend910P total=\"183.0 GiB\" available=\"117.3 GiB\"\r\ntime=2025-02-08T10:37:25.186+08:00 level=INFO source=types.go:131 msg=\"inference compute\" id=4 library=ascend variant=\"\" compute=\"\" driver=0.0 name=Ascend910P total=\"227.3 GiB\" available=\"145.8 GiB\"\r\ntime=2025-02-08T10:37:25.186+08:00 level=INFO source=types.go:131 msg=\"inference compute\" id=5 library=ascend variant=\"\" compute=\"\" driver=0.0 name=Ascend910P total=\"273.6 GiB\" available=\"174.8 GiB\"\r\ntime=2025-02-08T10:37:25.186+08:00 level=INFO source=types.go:131 msg=\"inference compute\" id=6 library=ascend variant=\"\" compute=\"\" driver=0.0 name=Ascend910P total=\"319.9 GiB\" available=\"205.0 GiB\"\r\ntime=2025-02-08T10:37:25.186+08:00 level=INFO source=types.go:131 msg=\"inference compute\" id=7 library=ascend variant=\"\" compute=\"\" driver=0.0 name=Ascend910P total=\"366.1 GiB\" available=\"232.3 GiB\"\r\n```\r\n但是执行./ollama run qwen2.5-7b-instruct-f16:latest后没有加载到NPU上\r\n```\r\nllm_load_print_meta: EOG token        = 151643 '<|endoftext|>'\r\nllm_load_print_meta: EOG token        = 151645 '<|im_end|>'\r\nllm_load_print_meta: EOG token        = 151662 '<|fim_pad|>'\r\nllm_load_print_meta: EOG token        = 151663 '<|repo_name|>'\r\nllm_load_print_meta: EOG token        = 151664 '<|file_sep|>'\r\nllm_load_print_meta: max token length = 256\r\nllm_load_tensors:   CPU_Mapped model buffer size = 14526.27 MiB\r\nllama_new_context_with_model: n_seq_max     = 4\r\nllama_new_context_with_model: n_ctx         = 8192\r\nllama_new_context_with_model: n_ctx_per_seq = 2048\r\nllama_new_context_with_model: n_batch       = 2048\r\nllama_new_context_with_model: n_ubatch      = 512\r\nllama_new_context_with_model: flash_attn    = 0\r\nllama_new_context_with_model: freq_base     = 1000000.0\r\nllama_new_context_with_model: freq_scale    = 1\r\nllama_new_context_with_model: n_ctx_per_seq (2048) < n_ctx_train (32768) -- the full capacity of the model will not be utilized\r\nllama_kv_cache_init:        CPU KV buffer size =   448.00 MiB\r\nllama_new_context_with_model: KV self size  =  448.00 MiB, K (f16):  224.00 MiB, V (f16):  224.00 MiB\r\nllama_new_context_with_model:        CPU  output buffer size =     2.38 MiB\r\nllama_new_context_with_model:        CPU compute buffer size =   492.01 MiB\r\nllama_new_context_with_model: graph nodes  = 986\r\nllama_new_context_with_model: graph splits = 1\r\ntime=2025-02-08T10:40:32.222+08:00 level=INFO source=server.go:594 msg=\"llama runner started in 1.01 seconds\"\r\n[GIN] 2025/02/08 - 10:40:32 | 200 |   9.37067435s |       127.0.0.1 | POST     \"/api/generate\"\r\n```\r\n该怎样解决？我尝试在llama.cpp上使用llama-cli测试过这个模型，可以加载在npu上，但是推理速度极慢，约0.45tokens/s, 这是什么情况？",
        "pr_file_module": null
      },
      {
        "comment_id": "1957332098",
        "repo_full_name": "ollama/ollama",
        "pr_number": 5872,
        "pr_file": "scripts/install.sh",
        "discussion_id": "1697791177",
        "commented_code": "@@ -322,5 +330,82 @@ if command -v nvidia-persistenced > /dev/null 2>&1; then\n     done\n fi\n \n+install_ascend_driver_yum() {\n+    status 'Installing ASCNED driver...'\n+    $SUDO $PACKAGE_MANAGER -y install gcc gcc-c++ make cmake unzip zlib-devel libffi-devel openssl-devel pciutils net-tools sqlite-devel lapack-devel gcc-gfortran python3-devel\n+    $SUDO groupadd -g HwHiAiUser\n+    $SUDO useradd -g HwHiAiUser -d /home/HwHiAiUser -m HwHiAiUser -s /bin/bash\n+    $SUDO usermod -aG HwHiAiUser $USER\n+\n+    # driver version, mabey get from it\n+    # npu-smi info\n+    # +------------------------------------------------------------------------------------------------+\n+    # | npu-smi 24.1.rc1.b060            Version: 24.1.rc1.b060                                        |\n+    wget \"https://ascend-repo.obs.cn-east-2.myhuaweicloud.com/Ascend HDK/Ascend HDK 24.1.RC1/Ascend-hdk-$1-npu-driver_24.1.rc1_linux-$ARCH.run\"\n+    $SUDO sh Ascend-hdk-$1-npu-driver_24.1.rc1_linux-$ARCH.run --full --install-for-all\n+    rm -rf ./Ascend-hdk-$1-npu-driver_24.1.rc1_linux-$ARCH.run\n+\n+    wget \"https://ascend-repo.obs.cn-east-2.myhuaweicloud.com/Ascend HDK/Ascend HDK 24.1.RC1/Ascend-hdk-$1-npu-firmware_7.1.0.6.220.run\"\n+    sudo sh Ascend-hdk-$1-npu-firmware_7.1.0.6.220.run --full\n+    rm -rf ./Ascend-hdk-$1-npu-firmware_7.1.0.6.220.run",
        "comment_created_at": "2025-02-16T13:52:42+00:00",
        "comment_author": "windy629",
        "comment_body": "我也碰到这个问题，ollama编译都成功了，但是执行./ollama run deepseek-r1:1.5b 的时候，没有用到gpu，只用到cpu，导致好慢。下面是我的编译后的ollama运行启动信息，显示识别到Ascend310P显卡\r\n\r\n\r\ntime=2025-02-16T21:45:10.990+08:00 level=INFO source=routes.go:1310 msg=\"Listening on 127.0.0.1:11434 (version 0.0.0)\"\r\ntime=2025-02-16T21:45:10.990+08:00 level=INFO source=routes.go:1339 msg=\"Dynamic LLM libraries\" runners=\"[cpu cann]\"\r\ntime=2025-02-16T21:45:10.990+08:00 level=INFO source=gpu.go:231 msg=\"looking for compatible GPUs\"\r\ntime=2025-02-16T21:45:11.957+08:00 level=INFO source=gpu.go:414 msg=\"[%!d(string=0)] Name:Ascend310P: FreeMemory:90251976704, TotalMemory: 92727123968\"\r\ntime=2025-02-16T21:45:12.400+08:00 level=INFO source=gpu.go:414 msg=\"[%!d(string=1)] Name:Ascend310P: FreeMemory:180501692416, TotalMemory: 185454239744\"\r\ntime=2025-02-16T21:45:12.537+08:00 level=INFO source=types.go:131 msg=\"inference compute\" id=0 library=ascend variant=\"\" compute=\"\" driver=0.0 name=Ascend310P total=\"86.4 GiB\" available=\"84.1 GiB\"\r\ntime=2025-02-16T21:45:12.537+08:00 level=INFO source=types.go:131 msg=\"inference compute\" id=1 library=ascend variant=\"\" compute=\"\" driver=0.0 name=Ascend310P total=\"172.7 GiB\" available=\"168.1 GiB\"\r\n",
        "pr_file_module": null
      },
      {
        "comment_id": "1961289584",
        "repo_full_name": "ollama/ollama",
        "pr_number": 5872,
        "pr_file": "scripts/install.sh",
        "discussion_id": "1697791177",
        "commented_code": "@@ -322,5 +330,82 @@ if command -v nvidia-persistenced > /dev/null 2>&1; then\n     done\n fi\n \n+install_ascend_driver_yum() {\n+    status 'Installing ASCNED driver...'\n+    $SUDO $PACKAGE_MANAGER -y install gcc gcc-c++ make cmake unzip zlib-devel libffi-devel openssl-devel pciutils net-tools sqlite-devel lapack-devel gcc-gfortran python3-devel\n+    $SUDO groupadd -g HwHiAiUser\n+    $SUDO useradd -g HwHiAiUser -d /home/HwHiAiUser -m HwHiAiUser -s /bin/bash\n+    $SUDO usermod -aG HwHiAiUser $USER\n+\n+    # driver version, mabey get from it\n+    # npu-smi info\n+    # +------------------------------------------------------------------------------------------------+\n+    # | npu-smi 24.1.rc1.b060            Version: 24.1.rc1.b060                                        |\n+    wget \"https://ascend-repo.obs.cn-east-2.myhuaweicloud.com/Ascend HDK/Ascend HDK 24.1.RC1/Ascend-hdk-$1-npu-driver_24.1.rc1_linux-$ARCH.run\"\n+    $SUDO sh Ascend-hdk-$1-npu-driver_24.1.rc1_linux-$ARCH.run --full --install-for-all\n+    rm -rf ./Ascend-hdk-$1-npu-driver_24.1.rc1_linux-$ARCH.run\n+\n+    wget \"https://ascend-repo.obs.cn-east-2.myhuaweicloud.com/Ascend HDK/Ascend HDK 24.1.RC1/Ascend-hdk-$1-npu-firmware_7.1.0.6.220.run\"\n+    sudo sh Ascend-hdk-$1-npu-firmware_7.1.0.6.220.run --full\n+    rm -rf ./Ascend-hdk-$1-npu-firmware_7.1.0.6.220.run",
        "comment_created_at": "2025-02-19T09:26:12+00:00",
        "comment_author": "windy629",
        "comment_body": "@zhongTao99  有什么办法解决这个问题啊",
        "pr_file_module": null
      },
      {
        "comment_id": "1962774520",
        "repo_full_name": "ollama/ollama",
        "pr_number": 5872,
        "pr_file": "scripts/install.sh",
        "discussion_id": "1697791177",
        "commented_code": "@@ -322,5 +330,82 @@ if command -v nvidia-persistenced > /dev/null 2>&1; then\n     done\n fi\n \n+install_ascend_driver_yum() {\n+    status 'Installing ASCNED driver...'\n+    $SUDO $PACKAGE_MANAGER -y install gcc gcc-c++ make cmake unzip zlib-devel libffi-devel openssl-devel pciutils net-tools sqlite-devel lapack-devel gcc-gfortran python3-devel\n+    $SUDO groupadd -g HwHiAiUser\n+    $SUDO useradd -g HwHiAiUser -d /home/HwHiAiUser -m HwHiAiUser -s /bin/bash\n+    $SUDO usermod -aG HwHiAiUser $USER\n+\n+    # driver version, mabey get from it\n+    # npu-smi info\n+    # +------------------------------------------------------------------------------------------------+\n+    # | npu-smi 24.1.rc1.b060            Version: 24.1.rc1.b060                                        |\n+    wget \"https://ascend-repo.obs.cn-east-2.myhuaweicloud.com/Ascend HDK/Ascend HDK 24.1.RC1/Ascend-hdk-$1-npu-driver_24.1.rc1_linux-$ARCH.run\"\n+    $SUDO sh Ascend-hdk-$1-npu-driver_24.1.rc1_linux-$ARCH.run --full --install-for-all\n+    rm -rf ./Ascend-hdk-$1-npu-driver_24.1.rc1_linux-$ARCH.run\n+\n+    wget \"https://ascend-repo.obs.cn-east-2.myhuaweicloud.com/Ascend HDK/Ascend HDK 24.1.RC1/Ascend-hdk-$1-npu-firmware_7.1.0.6.220.run\"\n+    sudo sh Ascend-hdk-$1-npu-firmware_7.1.0.6.220.run --full\n+    rm -rf ./Ascend-hdk-$1-npu-firmware_7.1.0.6.220.run",
        "comment_created_at": "2025-02-20T02:39:00+00:00",
        "comment_author": "hipudding",
        "comment_body": "Use fp16 instead.",
        "pr_file_module": null
      },
      {
        "comment_id": "1976438630",
        "repo_full_name": "ollama/ollama",
        "pr_number": 5872,
        "pr_file": "scripts/install.sh",
        "discussion_id": "1697791177",
        "commented_code": "@@ -322,5 +330,82 @@ if command -v nvidia-persistenced > /dev/null 2>&1; then\n     done\n fi\n \n+install_ascend_driver_yum() {\n+    status 'Installing ASCNED driver...'\n+    $SUDO $PACKAGE_MANAGER -y install gcc gcc-c++ make cmake unzip zlib-devel libffi-devel openssl-devel pciutils net-tools sqlite-devel lapack-devel gcc-gfortran python3-devel\n+    $SUDO groupadd -g HwHiAiUser\n+    $SUDO useradd -g HwHiAiUser -d /home/HwHiAiUser -m HwHiAiUser -s /bin/bash\n+    $SUDO usermod -aG HwHiAiUser $USER\n+\n+    # driver version, mabey get from it\n+    # npu-smi info\n+    # +------------------------------------------------------------------------------------------------+\n+    # | npu-smi 24.1.rc1.b060            Version: 24.1.rc1.b060                                        |\n+    wget \"https://ascend-repo.obs.cn-east-2.myhuaweicloud.com/Ascend HDK/Ascend HDK 24.1.RC1/Ascend-hdk-$1-npu-driver_24.1.rc1_linux-$ARCH.run\"\n+    $SUDO sh Ascend-hdk-$1-npu-driver_24.1.rc1_linux-$ARCH.run --full --install-for-all\n+    rm -rf ./Ascend-hdk-$1-npu-driver_24.1.rc1_linux-$ARCH.run\n+\n+    wget \"https://ascend-repo.obs.cn-east-2.myhuaweicloud.com/Ascend HDK/Ascend HDK 24.1.RC1/Ascend-hdk-$1-npu-firmware_7.1.0.6.220.run\"\n+    sudo sh Ascend-hdk-$1-npu-firmware_7.1.0.6.220.run --full\n+    rm -rf ./Ascend-hdk-$1-npu-firmware_7.1.0.6.220.run",
        "comment_created_at": "2025-03-01T15:34:06+00:00",
        "comment_author": "windy629",
        "comment_body": "你指的是使用fp16的模型？\r\n",
        "pr_file_module": null
      },
      {
        "comment_id": "1976776927",
        "repo_full_name": "ollama/ollama",
        "pr_number": 5872,
        "pr_file": "scripts/install.sh",
        "discussion_id": "1697791177",
        "commented_code": "@@ -322,5 +330,82 @@ if command -v nvidia-persistenced > /dev/null 2>&1; then\n     done\n fi\n \n+install_ascend_driver_yum() {\n+    status 'Installing ASCNED driver...'\n+    $SUDO $PACKAGE_MANAGER -y install gcc gcc-c++ make cmake unzip zlib-devel libffi-devel openssl-devel pciutils net-tools sqlite-devel lapack-devel gcc-gfortran python3-devel\n+    $SUDO groupadd -g HwHiAiUser\n+    $SUDO useradd -g HwHiAiUser -d /home/HwHiAiUser -m HwHiAiUser -s /bin/bash\n+    $SUDO usermod -aG HwHiAiUser $USER\n+\n+    # driver version, mabey get from it\n+    # npu-smi info\n+    # +------------------------------------------------------------------------------------------------+\n+    # | npu-smi 24.1.rc1.b060            Version: 24.1.rc1.b060                                        |\n+    wget \"https://ascend-repo.obs.cn-east-2.myhuaweicloud.com/Ascend HDK/Ascend HDK 24.1.RC1/Ascend-hdk-$1-npu-driver_24.1.rc1_linux-$ARCH.run\"\n+    $SUDO sh Ascend-hdk-$1-npu-driver_24.1.rc1_linux-$ARCH.run --full --install-for-all\n+    rm -rf ./Ascend-hdk-$1-npu-driver_24.1.rc1_linux-$ARCH.run\n+\n+    wget \"https://ascend-repo.obs.cn-east-2.myhuaweicloud.com/Ascend HDK/Ascend HDK 24.1.RC1/Ascend-hdk-$1-npu-firmware_7.1.0.6.220.run\"\n+    sudo sh Ascend-hdk-$1-npu-firmware_7.1.0.6.220.run --full\n+    rm -rf ./Ascend-hdk-$1-npu-firmware_7.1.0.6.220.run",
        "comment_created_at": "2025-03-03T01:23:23+00:00",
        "comment_author": "hipudding",
        "comment_body": "Yes.",
        "pr_file_module": null
      }
    ]
  }
]