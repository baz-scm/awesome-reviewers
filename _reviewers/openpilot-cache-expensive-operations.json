[
  {
    "discussion_id": "786366799",
    "pr_number": 23561,
    "pr_file": "selfdrive/boardd/boardd.cc",
    "created_at": "2022-01-18T01:59:42+00:00",
    "commented_code": "send_peripheral_state(pm, peripheral_panda);\n     ignition = send_panda_states(pm, pandas, spoofing_started);\n \n-    // TODO: make this check fast, currently takes 16ms\n     // check if we have new pandas and are offroad\n-    if (!ignition && (pandas.size() != Panda::list().size())) {\n+    if (!ignition && (pandas.size() != USBDeviceList(usb_ctx).size())) {",
    "repo_full_name": "commaai/openpilot",
    "discussion_comments": [
      {
        "comment_id": "786366799",
        "repo_full_name": "commaai/openpilot",
        "pr_number": 23561,
        "pr_file": "selfdrive/boardd/boardd.cc",
        "discussion_id": "786366799",
        "commented_code": "@@ -426,9 +427,8 @@ void panda_state_thread(PubMaster *pm, std::vector<Panda *> pandas, bool spoofin\n     send_peripheral_state(pm, peripheral_panda);\n     ignition = send_panda_states(pm, pandas, spoofing_started);\n \n-    // TODO: make this check fast, currently takes 16ms\n     // check if we have new pandas and are offroad\n-    if (!ignition && (pandas.size() != Panda::list().size())) {\n+    if (!ignition && (pandas.size() != USBDeviceList(usb_ctx).size())) {",
        "comment_created_at": "2022-01-18T01:59:42+00:00",
        "comment_author": "deanlee",
        "comment_body": "USBDeviceList(usb_ctx).size() takes less than 0.5ms",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1703941898",
    "pr_number": 33183,
    "pr_file": "selfdrive/ui/qt/onroad/annotated_camera.cc",
    "created_at": "2024-08-05T11:02:06+00:00",
    "commented_code": "dm_img = loadPixmap(\"../assets/img_driver_face.png\", {img_size + 5, img_size + 5});\n }\n \n+// Checks if \"Always-On Driver Monitoring\" toggle is enabled in settings\n+bool AnnotatedCameraWidget::isDMAlwaysOn() const {\n+  Params params;\n+  return params.getBool(\"AlwaysOnDM\");\n+}\n+",
    "repo_full_name": "commaai/openpilot",
    "discussion_comments": [
      {
        "comment_id": "1703941898",
        "repo_full_name": "commaai/openpilot",
        "pr_number": 33183,
        "pr_file": "selfdrive/ui/qt/onroad/annotated_camera.cc",
        "discussion_id": "1703941898",
        "commented_code": "@@ -23,6 +24,12 @@ AnnotatedCameraWidget::AnnotatedCameraWidget(VisionStreamType type, QWidget* par\n   dm_img = loadPixmap(\"../assets/img_driver_face.png\", {img_size + 5, img_size + 5});\n }\n \n+// Checks if \"Always-On Driver Monitoring\" toggle is enabled in settings\n+bool AnnotatedCameraWidget::isDMAlwaysOn() const {\n+  Params params;\n+  return params.getBool(\"AlwaysOnDM\");\n+}\n+",
        "comment_created_at": "2024-08-05T11:02:06+00:00",
        "comment_author": "deanlee",
        "comment_body": "`params.get()` is expensive. Move parameter reading to `void AnnotatedCameraWidget::showEvent(QShowEvent *event)` to update it once when the widget becomes visible, instead of repeating it on every update.",
        "pr_file_module": null
      },
      {
        "comment_id": "1704527213",
        "repo_full_name": "commaai/openpilot",
        "pr_number": 33183,
        "pr_file": "selfdrive/ui/qt/onroad/annotated_camera.cc",
        "discussion_id": "1703941898",
        "commented_code": "@@ -23,6 +24,12 @@ AnnotatedCameraWidget::AnnotatedCameraWidget(VisionStreamType type, QWidget* par\n   dm_img = loadPixmap(\"../assets/img_driver_face.png\", {img_size + 5, img_size + 5});\n }\n \n+// Checks if \"Always-On Driver Monitoring\" toggle is enabled in settings\n+bool AnnotatedCameraWidget::isDMAlwaysOn() const {\n+  Params params;\n+  return params.getBool(\"AlwaysOnDM\");\n+}\n+",
        "comment_created_at": "2024-08-05T19:08:48+00:00",
        "comment_author": "ugtthis",
        "comment_body": "I went with FrogAi's solution. Thanks for pointing this out in the first place",
        "pr_file_module": null
      }
    ]
  }
]