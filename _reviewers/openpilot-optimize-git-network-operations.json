[
  {
    "discussion_id": "1859279754",
    "pr_number": 34112,
    "pr_file": "tools/op.sh",
    "created_at": "2024-11-26T22:00:41+00:00",
    "commented_code": "op_run_command exec tools/sim/launch_openpilot.sh\n }\n \n+function op_switch() {\n+  op_before_cmd\n+\n+  if [ -z \"$1\" ]; then\n+    echo \"specify a branch\"\n+    exit 1\n+  fi\n+\n+  git fetch origin $1",
    "repo_full_name": "commaai/openpilot",
    "discussion_comments": [
      {
        "comment_id": "1859279754",
        "repo_full_name": "commaai/openpilot",
        "pr_number": 34112,
        "pr_file": "tools/op.sh",
        "discussion_id": "1859279754",
        "commented_code": "@@ -312,6 +312,23 @@ function op_sim() {\n   op_run_command exec tools/sim/launch_openpilot.sh\n }\n \n+function op_switch() {\n+  op_before_cmd\n+\n+  if [ -z \"$1\" ]; then\n+    echo \"specify a branch\"\n+    exit 1\n+  fi\n+\n+  git fetch origin $1",
        "comment_created_at": "2024-11-26T22:00:41+00:00",
        "comment_author": "maxime-desroches",
        "comment_body": "```suggestion\r\n  git fetch origin $1:$1\r\n```",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1692054128",
    "pr_number": 33072,
    "pr_file": "tools/setup.sh",
    "created_at": "2024-07-25T20:06:20+00:00",
    "commented_code": "#!/usr/bin/env bash\n \n+RED='\\033[0;31m'\n+GREEN='\\033[0;32m'\n+UNDERLINE='\\033[4m'\n+BOLD='\\033[1m'\n+NC='\\033[0m'\n+\n set -e\n \n-if [ ! -f launch_openpilot.sh ]; then\n-  if [ ! -d openpilot ]; then\n-    git clone --single-branch --recurse-submodules https://github.com/commaai/openpilot.git\n-  fi\n-  cd openpilot\n+if [ -z \"$OPENPILOT_ROOT\" ]; then\n+  # default to current directory for installation\n+  OPENPILOT_ROOT=\"$(pwd)/openpilot\"\n fi\n \n-if [[ \"$OSTYPE\" == \"darwin\"* ]]; then\n-  tools/mac_setup.sh\n-else\n-  tools/ubuntu_setup.sh\n-fi\n+function check_dir() {\n+  echo \"Checking for installation directory...\"\n+  if [ -d \"$OPENPILOT_ROOT\" ]; then\n+    echo -e \" \u21b3 [${RED}\u2717${NC}] can't install openpilot in $OPENPILOT_ROOT !\"\n+    return 1\n+  fi\n \n-git lfs pull\n+  echo -e \" \u21b3 [${GREEN}\u2714${NC}] Successfully chosen $OPENPILOT_ROOT as installation directory\n\"\n+}\n+\n+function check_git() {\n+  echo \"Checking for git...\"\n+  if ! command -v \"git\" > /dev/null 2>&1; then\n+    echo -e \" \u21b3 [${RED}\u2717${NC}] git not found on your system, can't continue!\"\n+    return 1\n+  else\n+    echo -e \" \u21b3 [${GREEN}\u2714${NC}] git found.\n\"\n+  fi\n+}\n+\n+function git_clone() {\n+  echo \"Cloning openpilot...\"\n+  if $(git clone --depth=1 https://github.com/commaai/openpilot.git \"$OPENPILOT_ROOT\"); then",
    "repo_full_name": "commaai/openpilot",
    "discussion_comments": [
      {
        "comment_id": "1692054128",
        "repo_full_name": "commaai/openpilot",
        "pr_number": 33072,
        "pr_file": "tools/setup.sh",
        "discussion_id": "1692054128",
        "commented_code": "@@ -1,32 +1,58 @@\n #!/usr/bin/env bash\n \n+RED='\\033[0;31m'\n+GREEN='\\033[0;32m'\n+UNDERLINE='\\033[4m'\n+BOLD='\\033[1m'\n+NC='\\033[0m'\n+\n set -e\n \n-if [ ! -f launch_openpilot.sh ]; then\n-  if [ ! -d openpilot ]; then\n-    git clone --single-branch --recurse-submodules https://github.com/commaai/openpilot.git\n-  fi\n-  cd openpilot\n+if [ -z \"$OPENPILOT_ROOT\" ]; then\n+  # default to current directory for installation\n+  OPENPILOT_ROOT=\"$(pwd)/openpilot\"\n fi\n \n-if [[ \"$OSTYPE\" == \"darwin\"* ]]; then\n-  tools/mac_setup.sh\n-else\n-  tools/ubuntu_setup.sh\n-fi\n+function check_dir() {\n+  echo \"Checking for installation directory...\"\n+  if [ -d \"$OPENPILOT_ROOT\" ]; then\n+    echo -e \" \u21b3 [${RED}\u2717${NC}] can't install openpilot in $OPENPILOT_ROOT !\"\n+    return 1\n+  fi\n \n-git lfs pull\n+  echo -e \" \u21b3 [${GREEN}\u2714${NC}] Successfully chosen $OPENPILOT_ROOT as installation directory\\n\"\n+}\n+\n+function check_git() {\n+  echo \"Checking for git...\"\n+  if ! command -v \"git\" > /dev/null 2>&1; then\n+    echo -e \" \u21b3 [${RED}\u2717${NC}] git not found on your system, can't continue!\"\n+    return 1\n+  else\n+    echo -e \" \u21b3 [${GREEN}\u2714${NC}] git found.\\n\"\n+  fi\n+}\n+\n+function git_clone() {\n+  echo \"Cloning openpilot...\"\n+  if $(git clone --depth=1 https://github.com/commaai/openpilot.git \"$OPENPILOT_ROOT\"); then",
        "comment_created_at": "2024-07-25T20:06:20+00:00",
        "comment_author": "andiradulescu",
        "comment_body": "since the cloning is in `--depth 1` (shallow) and implicitly `--single-branch` it should be trivial to:\r\n- add your own remote (fork) and unshallow - might work by explaining something like [this](https://stackoverflow.com/a/17714718/639708) and `git fetch --unshallow`\r\n- if I say \"N\" to \"macOS support\" it should continue to git submodules and lfs (works fine when saying \"Y\")\r\n\r\nmaybe do a `op unshallow` and/or `op set-fork ...`, not really sure, still thinking about this",
        "pr_file_module": null
      },
      {
        "comment_id": "1692114281",
        "repo_full_name": "commaai/openpilot",
        "pr_number": 33072,
        "pr_file": "tools/setup.sh",
        "discussion_id": "1692054128",
        "commented_code": "@@ -1,32 +1,58 @@\n #!/usr/bin/env bash\n \n+RED='\\033[0;31m'\n+GREEN='\\033[0;32m'\n+UNDERLINE='\\033[4m'\n+BOLD='\\033[1m'\n+NC='\\033[0m'\n+\n set -e\n \n-if [ ! -f launch_openpilot.sh ]; then\n-  if [ ! -d openpilot ]; then\n-    git clone --single-branch --recurse-submodules https://github.com/commaai/openpilot.git\n-  fi\n-  cd openpilot\n+if [ -z \"$OPENPILOT_ROOT\" ]; then\n+  # default to current directory for installation\n+  OPENPILOT_ROOT=\"$(pwd)/openpilot\"\n fi\n \n-if [[ \"$OSTYPE\" == \"darwin\"* ]]; then\n-  tools/mac_setup.sh\n-else\n-  tools/ubuntu_setup.sh\n-fi\n+function check_dir() {\n+  echo \"Checking for installation directory...\"\n+  if [ -d \"$OPENPILOT_ROOT\" ]; then\n+    echo -e \" \u21b3 [${RED}\u2717${NC}] can't install openpilot in $OPENPILOT_ROOT !\"\n+    return 1\n+  fi\n \n-git lfs pull\n+  echo -e \" \u21b3 [${GREEN}\u2714${NC}] Successfully chosen $OPENPILOT_ROOT as installation directory\\n\"\n+}\n+\n+function check_git() {\n+  echo \"Checking for git...\"\n+  if ! command -v \"git\" > /dev/null 2>&1; then\n+    echo -e \" \u21b3 [${RED}\u2717${NC}] git not found on your system, can't continue!\"\n+    return 1\n+  else\n+    echo -e \" \u21b3 [${GREEN}\u2714${NC}] git found.\\n\"\n+  fi\n+}\n+\n+function git_clone() {\n+  echo \"Cloning openpilot...\"\n+  if $(git clone --depth=1 https://github.com/commaai/openpilot.git \"$OPENPILOT_ROOT\"); then",
        "comment_created_at": "2024-07-25T20:57:42+00:00",
        "comment_author": "maxime-desroches",
        "comment_body": "depth 1 was mostly for testing speed. If you think that those commands should be added to op, feel free to open a pr or discuss it on the discord, but general I don't think we should add git command to op unless it is very related to an openpilot task. The fork one might be good, but I don't think we should include the unshallow one, that is way to git specific",
        "pr_file_module": null
      }
    ]
  }
]