[
  {
    "discussion_id": "1957251094",
    "pr_number": 34591,
    "pr_file": "system/athena/athenad.py",
    "created_at": "2025-02-16T06:24:34+00:00",
    "commented_code": "# While not sending data, onroad, we can expect to time out in 7 + (7 * 2) = 21s\n         #                         offroad, we can expect to time out in 30 + (10 * 3) = 60s\n         # FIXME: TCP_USER_TIMEOUT is effectively 2x for some reason (32s), so it's mostly unused\n-        sock.setsockopt(socket.IPPROTO_TCP, socket.TCP_USER_TIMEOUT, 16000 if onroad else 0)\n-        sock.setsockopt(socket.IPPROTO_TCP, socket.TCP_KEEPIDLE, 7 if onroad else 30)\n+        if sys.platform == 'linux':\n+          sock.setsockopt(socket.IPPROTO_TCP, socket.TCP_USER_TIMEOUT, 16000 if onroad else 0)\n+        if sys.platform == 'darwin':\n+          sock.setsockopt(socket.IPPROTO_TCP, socket.TCP_KEEPALIVE, 7 if onroad else 30)\n+        else:\n+          sock.setsockopt(socket.IPPROTO_TCP, socket.TCP_KEEPIDLE, 7 if onroad else 30)",
    "repo_full_name": "commaai/openpilot",
    "discussion_comments": [
      {
        "comment_id": "1957251094",
        "repo_full_name": "commaai/openpilot",
        "pr_number": 34591,
        "pr_file": "system/athena/athenad.py",
        "discussion_id": "1957251094",
        "commented_code": "@@ -765,8 +765,12 @@ def ws_manage(ws: WebSocket, end_event: threading.Event) -> None:\n         # While not sending data, onroad, we can expect to time out in 7 + (7 * 2) = 21s\n         #                         offroad, we can expect to time out in 30 + (10 * 3) = 60s\n         # FIXME: TCP_USER_TIMEOUT is effectively 2x for some reason (32s), so it's mostly unused\n-        sock.setsockopt(socket.IPPROTO_TCP, socket.TCP_USER_TIMEOUT, 16000 if onroad else 0)\n-        sock.setsockopt(socket.IPPROTO_TCP, socket.TCP_KEEPIDLE, 7 if onroad else 30)\n+        if sys.platform == 'linux':\n+          sock.setsockopt(socket.IPPROTO_TCP, socket.TCP_USER_TIMEOUT, 16000 if onroad else 0)\n+        if sys.platform == 'darwin':\n+          sock.setsockopt(socket.IPPROTO_TCP, socket.TCP_KEEPALIVE, 7 if onroad else 30)\n+        else:\n+          sock.setsockopt(socket.IPPROTO_TCP, socket.TCP_KEEPIDLE, 7 if onroad else 30)",
        "comment_created_at": "2025-02-16T06:24:34+00:00",
        "comment_author": "maxime-desroches",
        "comment_body": "```suggestion\r\n        if sys.platform == 'linux':\r\n          sock.setsockopt(socket.IPPROTO_TCP, socket.TCP_USER_TIMEOUT, 16000 if onroad else 0)\r\n          sock.setsockopt(socket.IPPROTO_TCP, socket.TCP_KEEPIDLE, 7 if onroad else 30)\r\n        elif sys.platform == 'darwin':\r\n          sock.setsockopt(socket.IPPROTO_TCP, socket.TCP_KEEPALIVE, 7 if onroad else 30)\r\n          \r\n```",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1950726046",
    "pr_number": 34567,
    "pr_file": "system/athena/athenad.py",
    "created_at": "2025-02-11T12:07:11+00:00",
    "commented_code": "onroad_prev = onroad\n \n       if sock is not None:",
    "repo_full_name": "commaai/openpilot",
    "discussion_comments": [
      {
        "comment_id": "1950726046",
        "repo_full_name": "commaai/openpilot",
        "pr_number": 34567,
        "pr_file": "system/athena/athenad.py",
        "discussion_id": "1950726046",
        "commented_code": "@@ -762,13 +762,25 @@ def ws_manage(ws: WebSocket, end_event: threading.Event) -> None:\n       onroad_prev = onroad\n \n       if sock is not None:",
        "comment_created_at": "2025-02-11T12:07:11+00:00",
        "comment_author": "incognitojam",
        "comment_body": "Does it work if you check the platform instead?\r\n```\r\nif sys.platform != \"win32\" and sys.platform != \"darwin\":\r\n```\r\nThat's how it's setup where the types themselves are defined https://github.com/python/typeshed/pull/10530/files#diff-8d751cc8017e3c1cde34b01bdd3e44d5ba963d53a47c6262972d206200d4913fL178",
        "pr_file_module": null
      }
    ]
  }
]