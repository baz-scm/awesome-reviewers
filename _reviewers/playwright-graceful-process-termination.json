[
  {
    "discussion_id": "2081957937",
    "pr_number": 35910,
    "pr_file": "utils/build/build.js",
    "created_at": "2025-05-09T15:41:23+00:00",
    "commented_code": "}\n }\n process.on('exit', cleanup);\n-process.on('SIGINT', cleanup);\n+process.on('SIGINT', () => {\n+  cleanup();",
    "repo_full_name": "microsoft/playwright",
    "discussion_comments": [
      {
        "comment_id": "2081957937",
        "repo_full_name": "microsoft/playwright",
        "pr_number": 35910,
        "pr_file": "utils/build/build.js",
        "discussion_id": "2081957937",
        "commented_code": "@@ -560,6 +560,9 @@ function cleanup() {\n   }\n }\n process.on('exit', cleanup);\n-process.on('SIGINT', cleanup);\n+process.on('SIGINT', () => {\n+  cleanup();",
        "comment_created_at": "2025-05-09T15:41:23+00:00",
        "comment_author": "yury-s",
        "comment_body": "I believe this will still flood terminal with the following:\r\n```\r\n...\r\nError: 'npx vite --port 44225' exited with code null, signal SIGINT\r\n    at ChildProcess.<anonymous> (/Users/yurys/playwright/utils/build/build.js:145:18)\r\n    at ChildProcess.emit (node:events:518:28)\r\n    at maybeClose (node:internal/child_process:1104:16)\r\n    at ChildProcess._handle.onexit (node:internal/child_process:304:5)\r\nError: 'npm run watch -- --sourcemap' exited with code null, signal SIGINT\r\n    at ChildProcess.<anonymous> (/Users/yurys/playwright/utils/build/build.js:145:18)\r\n    at ChildProcess.emit (node:events:518:28)\r\n    at maybeClose (node:internal/child_process:1104:16)\r\n    at ChildProcess._handle.onexit (node:internal/child_process:304:5)\r\nError: 'npx vite build --watch --minify=false --sourcemap=inline' exited with code null, signal SIGINT\r\n    at ChildProcess.<anonymous> (/Users/yurys/playwright/utils/build/build.js:145:18)\r\n    at ChildProcess.emit (node:events:518:28)\r\n    at maybeClose (node:internal/child_process:1104:16)\r\n    at ChildProcess._handle.onexit (node:internal/child_process:304:5)\r\nError: 'npx tsc -w -p \"/Users/yurys/playwright/packages/html-reporter\"' exited with code null, signal SIGINT\r\n    at ChildProcess.<anonymous> (/Users/yurys/playwright/utils/build/build.js:145:18)\r\n    at ChildProcess.emit (node:events:518:28)\r\n    at maybeClose (node:internal/child_process:1104:16)\r\n    at ChildProcess._handle.onexit (node:internal/child_process:304:5)\r\nError: 'npx vite build --watch --minify=false --sourcemap=inline' exited with code null, signal SIGINT\r\n    at ChildProcess.<anonymous> (/Users/yurys/playwright/utils/build/build.js:145:18)\r\n    at ChildProcess.emit (node:events:518:28)\r\n    at maybeClose (node:internal/child_process:1104:16)\r\n    at ChildProcess._handle.onexit (node:internal/child_process:304:5)\r\nError: 'npx tsc -w -p \"/Users/yurys/playwright/packages/recorder\"' exited with code null, signal SIGINT\r\n    at ChildProcess.<anonymous> (/Users/yurys/playwright/utils/build/build.js:145:18)\r\n    at ChildProcess.emit (node:events:518:28)\r\n    at maybeClose (node:internal/child_process:1104:16)\r\n    at ChildProcess._handle.onexit (node:internal/child_process:304:5)\r\n...\r\n```\r\n",
        "pr_file_module": null
      },
      {
        "comment_id": "2081958731",
        "repo_full_name": "microsoft/playwright",
        "pr_number": 35910,
        "pr_file": "utils/build/build.js",
        "discussion_id": "2081957937",
        "commented_code": "@@ -560,6 +560,9 @@ function cleanup() {\n   }\n }\n process.on('exit', cleanup);\n-process.on('SIGINT', cleanup);\n+process.on('SIGINT', () => {\n+  cleanup();",
        "comment_created_at": "2025-05-09T15:41:52+00:00",
        "comment_author": "yury-s",
        "comment_body": "We can address it separately though as handling sigint is more important.",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2081539132",
    "pr_number": 35905,
    "pr_file": "utils/build/build.js",
    "created_at": "2025-05-09T12:10:47+00:00",
    "commented_code": "},\n       cwd: step.cwd,\n     });\n-    process.on('exit', () => child.kill());\n+\n+    if (ProgramStep.activeChildren.length === 0) {",
    "repo_full_name": "microsoft/playwright",
    "discussion_comments": [
      {
        "comment_id": "2081539132",
        "repo_full_name": "microsoft/playwright",
        "pr_number": 35905,
        "pr_file": "utils/build/build.js",
        "discussion_id": "2081539132",
        "commented_code": "@@ -130,7 +133,16 @@ class ProgramStep extends Step {\n       },\n       cwd: step.cwd,\n     });\n-    process.on('exit', () => child.kill());\n+\n+    if (ProgramStep.activeChildren.length === 0) {",
        "comment_created_at": "2025-05-09T12:10:47+00:00",
        "comment_author": "dgozman",
        "comment_body": "While this works, I think it's nicer to have a generic list of disposables to run at exit, sigint, etc. We can probably include esbuild contexts there, and calls `context.dispose()` to ensure esbuild native process is stopped.",
        "pr_file_module": null
      }
    ]
  }
]