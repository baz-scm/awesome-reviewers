[
  {
    "discussion_id": "2089566628",
    "pr_number": 35859,
    "pr_file": "packages/trace-viewer/src/ui/uiModeView.tsx",
    "created_at": "2025-05-14T19:08:23+00:00",
    "commented_code": "testModel={testModel}\n           runTests={() => runTests('bounce-if-busy', visibleTestIds)} />\n         <Toolbar noMinHeight={true}>\n-          {!isRunningTest && !progress && <div className='section-title'>Tests</div>}\n-          {!isRunningTest && progress && <div data-testid='status-line' className='status-line'>\n-            <div>{progress.passed}/{progress.total} passed ({(progress.passed / progress.total) * 100 | 0}%)</div>\n-          </div>}\n-          {isRunningTest && progress && <div data-testid='status-line' className='status-line'>\n-            <div>Running {progress.passed}/{runningState.testIds.size} passed ({(progress.passed / runningState.testIds.size) * 100 | 0}%)</div>\n-          </div>}\n+          {!progress ? (<StatusLine",
    "repo_full_name": "microsoft/playwright",
    "discussion_comments": [
      {
        "comment_id": "2089566628",
        "repo_full_name": "microsoft/playwright",
        "pr_number": 35859,
        "pr_file": "packages/trace-viewer/src/ui/uiModeView.tsx",
        "discussion_id": "2089566628",
        "commented_code": "@@ -460,13 +461,20 @@ export const UIModeView: React.FC<{}> = ({\n           testModel={testModel}\n           runTests={() => runTests('bounce-if-busy', visibleTestIds)} />\n         <Toolbar noMinHeight={true}>\n-          {!isRunningTest && !progress && <div className='section-title'>Tests</div>}\n-          {!isRunningTest && progress && <div data-testid='status-line' className='status-line'>\n-            <div>{progress.passed}/{progress.total} passed ({(progress.passed / progress.total) * 100 | 0}%)</div>\n-          </div>}\n-          {isRunningTest && progress && <div data-testid='status-line' className='status-line'>\n-            <div>Running {progress.passed}/{runningState.testIds.size} passed ({(progress.passed / runningState.testIds.size) * 100 | 0}%)</div>\n-          </div>}\n+          {!progress ? (<StatusLine",
        "comment_created_at": "2025-05-14T19:08:23+00:00",
        "comment_author": "agg23",
        "comment_body": "Put this as a single `<StatusLine>` reference with nullish coalescence and ternaries where that isn't acceptable?",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2006355047",
    "pr_number": 35292,
    "pr_file": "packages/trace-viewer/src/ui/uiModeTraceView.tsx",
    "created_at": "2025-03-20T19:56:10+00:00",
    "commented_code": "};\n   }, [outputDir, item, setModel, counter, setCounter, pathSeparator]);\n \n+  const annotations = item.testCase ? [...item.testCase.annotations, ...item.testCase.results.flatMap(r => r.annotations)] : [];",
    "repo_full_name": "microsoft/playwright",
    "discussion_comments": [
      {
        "comment_id": "2006355047",
        "repo_full_name": "microsoft/playwright",
        "pr_number": 35292,
        "pr_file": "packages/trace-viewer/src/ui/uiModeTraceView.tsx",
        "discussion_id": "2006355047",
        "commented_code": "@@ -86,6 +86,8 @@ export const TraceView: React.FC<{\n     };\n   }, [outputDir, item, setModel, counter, setCounter, pathSeparator]);\n \n+  const annotations = item.testCase ? [...item.testCase.annotations, ...item.testCase.results.flatMap(r => r.annotations)] : [];",
        "comment_created_at": "2025-03-20T19:56:10+00:00",
        "comment_author": "dgozman",
        "comment_body": "This one should use `item.testCase?.results[0]`, similar to the line 48.",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2018850436",
    "pr_number": 35292,
    "pr_file": "packages/html-reporter/src/testCaseView.tsx",
    "created_at": "2025-03-28T15:04:14+00:00",
    "commented_code": "}, [test]);\n \n   const visibleAnnotations = React.useMemo(() => {\n-    return test?.annotations?.filter(annotation => !annotation.type.startsWith('_')) || [];\n-  }, [test?.annotations]);\n+    if (!test)\n+      return [];\n+    const annotations = [...test.annotations];\n+    if (test.results[selectedResultIndex])\n+      annotations.push(...test.results[selectedResultIndex].annotations);",
    "repo_full_name": "microsoft/playwright",
    "discussion_comments": [
      {
        "comment_id": "2018850436",
        "repo_full_name": "microsoft/playwright",
        "pr_number": 35292,
        "pr_file": "packages/html-reporter/src/testCaseView.tsx",
        "discussion_id": "2018850436",
        "commented_code": "@@ -46,8 +46,13 @@ export const TestCaseView: React.FC<{\n   }, [test]);\n \n   const visibleAnnotations = React.useMemo(() => {\n-    return test?.annotations?.filter(annotation => !annotation.type.startsWith('_')) || [];\n-  }, [test?.annotations]);\n+    if (!test)\n+      return [];\n+    const annotations = [...test.annotations];\n+    if (test.results[selectedResultIndex])\n+      annotations.push(...test.results[selectedResultIndex].annotations);",
        "comment_created_at": "2025-03-28T15:04:14+00:00",
        "comment_author": "cpAdm",
        "comment_body": "@Skn0tt This will crash the reporter if I open up an older report that has no `annotations`, not sure if this is a realistic scenario?\r\n```suggestion\r\n      annotations.push(...test.results[selectedResultIndex]?.annotations ?? []);\r\n``` \r\n![image](https://github.com/user-attachments/assets/53370e35-36c6-4eb1-a3e8-51bf7f8306c2)\r\n",
        "pr_file_module": null
      },
      {
        "comment_id": "2020544818",
        "repo_full_name": "microsoft/playwright",
        "pr_number": 35292,
        "pr_file": "packages/html-reporter/src/testCaseView.tsx",
        "discussion_id": "2018850436",
        "commented_code": "@@ -46,8 +46,13 @@ export const TestCaseView: React.FC<{\n   }, [test]);\n \n   const visibleAnnotations = React.useMemo(() => {\n-    return test?.annotations?.filter(annotation => !annotation.type.startsWith('_')) || [];\n-  }, [test?.annotations]);\n+    if (!test)\n+      return [];\n+    const annotations = [...test.annotations];\n+    if (test.results[selectedResultIndex])\n+      annotations.push(...test.results[selectedResultIndex].annotations);",
        "comment_created_at": "2025-03-31T07:45:03+00:00",
        "comment_author": "Skn0tt",
        "comment_body": "The old report will contain an old version of the javascript, so there's no need for cross-version considerations here.",
        "pr_file_module": null
      }
    ]
  }
]