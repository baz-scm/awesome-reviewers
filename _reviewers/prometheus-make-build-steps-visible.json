[
  {
    "discussion_id": "1899126845",
    "pr_number": 15712,
    "pr_file": "Makefile.common",
    "created_at": "2024-12-29T12:58:53+00:00",
    "commented_code": ".PHONY: common-build\n common-build: promu\n \t@echo \">> building binaries\"\n-\t$(PROMU) build --prefix $(PREFIX) $(PROMU_BINARIES)\n+\t@$(PROMU) build --prefix $(PREFIX) $(PROMU_BINARIES) && \\\n+\t\tif [ \"$(GOHOSTOS)\" = \"darwin\" ] && command -v codesign > /dev/null 2>&1; then \\\n+\t\t\tcodesign --sign - --force --preserve-metadata=entitlements,requirements,flags,runtime $(PREFIX) >/dev/null 2>&1; \\\n+\t\tfi",
    "repo_full_name": "prometheus/prometheus",
    "discussion_comments": [
      {
        "comment_id": "1899126845",
        "repo_full_name": "prometheus/prometheus",
        "pr_number": 15712,
        "pr_file": "Makefile.common",
        "discussion_id": "1899126845",
        "commented_code": "@@ -201,7 +201,10 @@ common-unused:\n .PHONY: common-build\n common-build: promu\n \t@echo \">> building binaries\"\n-\t$(PROMU) build --prefix $(PREFIX) $(PROMU_BINARIES)\n+\t@$(PROMU) build --prefix $(PREFIX) $(PROMU_BINARIES) && \\\n+\t\tif [ \"$(GOHOSTOS)\" = \"darwin\" ] && command -v codesign > /dev/null 2>&1; then \\\n+\t\t\tcodesign --sign - --force --preserve-metadata=entitlements,requirements,flags,runtime $(PREFIX) >/dev/null 2>&1; \\\n+\t\tfi",
        "comment_created_at": "2024-12-29T12:58:53+00:00",
        "comment_author": "aknuds1",
        "comment_body": "Perhaps a nit, but I don't see the need to suppress Make's echoing of the `promu` command, and the `codesign` invocation might as well be its own command, right?\r\n```suggestion\r\n\t$(PROMU) build --prefix $(PREFIX) $(PROMU_BINARIES)\r\n\t@if [ \"$(GOHOSTOS)\" = \"darwin\" ] && command -v codesign > /dev/null 2>&1; then \\\r\n\t\tcodesign --sign - --force --preserve-metadata=entitlements,requirements,flags,runtime $(PREFIX) >/dev/null 2>&1; \\\r\n\tfi\r\n```",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1998343680",
    "pr_number": 15712,
    "pr_file": "Makefile.common",
    "created_at": "2025-03-17T09:46:13+00:00",
    "commented_code": "common-build: promu\n \t@echo \">> building binaries\"\n \t$(PROMU) build --prefix $(PREFIX) $(PROMU_BINARIES)\n+\t@if [ \"$(GOHOSTOS)\" = \"darwin\" ] && command -v codesign > /dev/null 2>&1; then \\\n+\t\tcodesign --sign - --force --preserve-metadata=entitlements,requirements,flags,runtime $(PREFIX) >/dev/null 2>&1; \\",
    "repo_full_name": "prometheus/prometheus",
    "discussion_comments": [
      {
        "comment_id": "1998343680",
        "repo_full_name": "prometheus/prometheus",
        "pr_number": 15712,
        "pr_file": "Makefile.common",
        "discussion_id": "1998343680",
        "commented_code": "@@ -202,6 +202,9 @@ common-unused:\n common-build: promu\n \t@echo \">> building binaries\"\n \t$(PROMU) build --prefix $(PREFIX) $(PROMU_BINARIES)\n+\t@if [ \"$(GOHOSTOS)\" = \"darwin\" ] && command -v codesign > /dev/null 2>&1; then \\\n+\t\tcodesign --sign - --force --preserve-metadata=entitlements,requirements,flags,runtime $(PREFIX) >/dev/null 2>&1; \\",
        "comment_created_at": "2025-03-17T09:46:13+00:00",
        "comment_author": "aknuds1",
        "comment_body": "Could you just add the following `echo`, so the user can see that code signing happens? When running `make common-build`, I was wondering whether the signing was actually executing :)\r\n```suggestion\r\n\t\techo \"Signing binaries...\"\r\n\t\tcodesign --sign - --force --preserve-metadata=entitlements,requirements,flags,runtime $(PREFIX) >/dev/null 2>&1; \\\r\n```",
        "pr_file_module": null
      }
    ]
  }
]