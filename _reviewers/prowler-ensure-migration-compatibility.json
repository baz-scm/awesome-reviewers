[
  {
    "discussion_id": "2142134811",
    "pr_number": 7848,
    "pr_file": "api/src/backend/api/migrations/0031_lighthouseconfig.py",
    "created_at": "2025-06-12T09:12:16+00:00",
    "commented_code": null,
    "repo_full_name": "prowler-cloud/prowler",
    "discussion_comments": [
      {
        "comment_id": "2142134811",
        "repo_full_name": "prowler-cloud/prowler",
        "pr_number": 7848,
        "pr_file": "api/src/backend/api/migrations/0031_lighthouseconfig.py",
        "discussion_id": "2142134811",
        "commented_code": null,
        "comment_created_at": "2025-06-12T09:12:16+00:00",
        "comment_author": "vicferpoy",
        "comment_body": "You didn't update the migration file after changes in `models.py`.",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1916274137",
    "pr_number": 6460,
    "pr_file": "api/src/backend/api/models.py",
    "created_at": "2025-01-15T10:00:54+00:00",
    "commented_code": "id = models.UUIDField(primary_key=True, default=uuid7, editable=False)\n     inserted_at = models.DateTimeField(auto_now_add=True, editable=False)\n     updated_at = models.DateTimeField(auto_now=True, editable=False)\n+    first_seen_at = models.DateTimeField(editable=False)",
    "repo_full_name": "prowler-cloud/prowler",
    "discussion_comments": [
      {
        "comment_id": "1916274137",
        "repo_full_name": "prowler-cloud/prowler",
        "pr_number": 6460,
        "pr_file": "api/src/backend/api/models.py",
        "discussion_id": "1916274137",
        "commented_code": "@@ -615,6 +615,7 @@ class DeltaChoices(models.TextChoices):\n     id = models.UUIDField(primary_key=True, default=uuid7, editable=False)\n     inserted_at = models.DateTimeField(auto_now_add=True, editable=False)\n     updated_at = models.DateTimeField(auto_now=True, editable=False)\n+    first_seen_at = models.DateTimeField(editable=False)",
        "comment_created_at": "2025-01-15T10:00:54+00:00",
        "comment_author": "vicferpoy",
        "comment_body": "What happens when we perform this migration on an already existing database with findings? What value do the older findings take? I believe we are missing, at least, `null=True` here and in the migration.",
        "pr_file_module": null
      },
      {
        "comment_id": "1916274689",
        "repo_full_name": "prowler-cloud/prowler",
        "pr_number": 6460,
        "pr_file": "api/src/backend/api/models.py",
        "discussion_id": "1916274137",
        "commented_code": "@@ -615,6 +615,7 @@ class DeltaChoices(models.TextChoices):\n     id = models.UUIDField(primary_key=True, default=uuid7, editable=False)\n     inserted_at = models.DateTimeField(auto_now_add=True, editable=False)\n     updated_at = models.DateTimeField(auto_now=True, editable=False)\n+    first_seen_at = models.DateTimeField(editable=False)",
        "comment_created_at": "2025-01-15T10:01:17+00:00",
        "comment_author": "vicferpoy",
        "comment_body": "> Sorry, this comment was meant to be added with the last review but I missed it somehow.",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2066044861",
    "pr_number": 7563,
    "pr_file": "api/src/backend/api/migrations/0017_m365_provider.py",
    "created_at": "2025-04-29T10:50:54+00:00",
    "commented_code": "+# Generated by Django 5.1.7 on 2025-04-16 08:47\n+\n+from django.db import migrations\n+\n+import api.db_utils\n+\n+\n+class Migration(migrations.Migration):\n+    dependencies = [\n+        (\"api\", \"0016_finding_compliance_resource_details_and_more\"),\n+    ]\n+\n+    operations = [\n+        migrations.AlterField(\n+            model_name=\"provider\",\n+            name=\"provider\",\n+            field=api.db_utils.ProviderEnumField(\n+                choices=[\n+                    (\"aws\", \"AWS\"),\n+                    (\"azure\", \"Azure\"),\n+                    (\"gcp\", \"GCP\"),\n+                    (\"kubernetes\", \"Kubernetes\"),\n+                    (\"m365\", \"M365\"),\n+                ],\n+                default=\"aws\",\n+            ),\n+        ),\n+        migrations.RunSQL(\n+            \"ALTER TYPE provider ADD VALUE IF NOT EXISTS 'm365';\",\n+        ),",
    "repo_full_name": "prowler-cloud/prowler",
    "discussion_comments": [
      {
        "comment_id": "2066044861",
        "repo_full_name": "prowler-cloud/prowler",
        "pr_number": 7563,
        "pr_file": "api/src/backend/api/migrations/0017_m365_provider.py",
        "discussion_id": "2066044861",
        "commented_code": "@@ -0,0 +1,31 @@\n+# Generated by Django 5.1.7 on 2025-04-16 08:47\n+\n+from django.db import migrations\n+\n+import api.db_utils\n+\n+\n+class Migration(migrations.Migration):\n+    dependencies = [\n+        (\"api\", \"0016_finding_compliance_resource_details_and_more\"),\n+    ]\n+\n+    operations = [\n+        migrations.AlterField(\n+            model_name=\"provider\",\n+            name=\"provider\",\n+            field=api.db_utils.ProviderEnumField(\n+                choices=[\n+                    (\"aws\", \"AWS\"),\n+                    (\"azure\", \"Azure\"),\n+                    (\"gcp\", \"GCP\"),\n+                    (\"kubernetes\", \"Kubernetes\"),\n+                    (\"m365\", \"M365\"),\n+                ],\n+                default=\"aws\",\n+            ),\n+        ),\n+        migrations.RunSQL(\n+            \"ALTER TYPE provider ADD VALUE IF NOT EXISTS 'm365';\",\n+        ),",
        "comment_created_at": "2025-04-29T10:50:54+00:00",
        "comment_author": "vicferpoy",
        "comment_body": "Every time we add new `RunSQL` or `RunPython` migrations, we need to define the reverse operation and test it.",
        "pr_file_module": null
      },
      {
        "comment_id": "2066096650",
        "repo_full_name": "prowler-cloud/prowler",
        "pr_number": 7563,
        "pr_file": "api/src/backend/api/migrations/0017_m365_provider.py",
        "discussion_id": "2066044861",
        "commented_code": "@@ -0,0 +1,31 @@\n+# Generated by Django 5.1.7 on 2025-04-16 08:47\n+\n+from django.db import migrations\n+\n+import api.db_utils\n+\n+\n+class Migration(migrations.Migration):\n+    dependencies = [\n+        (\"api\", \"0016_finding_compliance_resource_details_and_more\"),\n+    ]\n+\n+    operations = [\n+        migrations.AlterField(\n+            model_name=\"provider\",\n+            name=\"provider\",\n+            field=api.db_utils.ProviderEnumField(\n+                choices=[\n+                    (\"aws\", \"AWS\"),\n+                    (\"azure\", \"Azure\"),\n+                    (\"gcp\", \"GCP\"),\n+                    (\"kubernetes\", \"Kubernetes\"),\n+                    (\"m365\", \"M365\"),\n+                ],\n+                default=\"aws\",\n+            ),\n+        ),\n+        migrations.RunSQL(\n+            \"ALTER TYPE provider ADD VALUE IF NOT EXISTS 'm365';\",\n+        ),",
        "comment_created_at": "2025-04-29T11:13:00+00:00",
        "comment_author": "AdriiiPRodri",
        "comment_body": "Since enum can't have a reverse operation to return the old value I add this:\r\n\r\nreverse_sql=migrations.RunSQL.noop,",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1913110759",
    "pr_number": 6460,
    "pr_file": "api/src/backend/api/migrations/0006_findings_first_seen.py",
    "created_at": "2025-01-13T12:26:03+00:00",
    "commented_code": "+from django.db import migrations, models\n+\n+\n+def populate_first_seen(apps, schema_editor):",
    "repo_full_name": "prowler-cloud/prowler",
    "discussion_comments": [
      {
        "comment_id": "1913110759",
        "repo_full_name": "prowler-cloud/prowler",
        "pr_number": 6460,
        "pr_file": "api/src/backend/api/migrations/0006_findings_first_seen.py",
        "discussion_id": "1913110759",
        "commented_code": "@@ -0,0 +1,58 @@\n+from django.db import migrations, models\n+\n+\n+def populate_first_seen(apps, schema_editor):",
        "comment_created_at": "2025-01-13T12:26:03+00:00",
        "comment_author": "jfagoagas",
        "comment_body": "Do we want to backfill all previous findings? This blocks the app startup while updating all the findings.",
        "pr_file_module": null
      }
    ]
  }
]