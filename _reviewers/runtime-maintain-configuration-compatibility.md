---
title: Maintain configuration compatibility
description: When modifying configuration systems, prioritize backward compatibility
  unless there's an explicit breaking change planned. If a breaking change is necessary,
  implement compatibility handlers for older configurations and clearly communicate
  the transition plan.
repository: dotnet/runtime
label: Configurations
language: Txt
comments_count: 2
repository_stars: 16578
---

When modifying configuration systems, prioritize backward compatibility unless there's an explicit breaking change planned. If a breaking change is necessary, implement compatibility handlers for older configurations and clearly communicate the transition plan.

For example, when modifying configuration enums or data structures:

```csharp
// When adding new configuration values, append them rather than reordering
// to maintain compatibility with serialized configurations
enum ConfigValues 
{
    // Existing values - don't change these ids
    Value1 = 1,
    Value2 = 2,
    
    // New values - add at the end
    NewValue = 3
}

// For major changes, implement version detection and compatibility handling
public ProcessConfig(ConfigData data) 
{
    if (data.Version < CurrentVersion) {
        // Handle older format compatibility
        return ProcessLegacyConfig(data);
    }
    
    // Process current format
}
```

This approach ensures tools and systems can continue to process configurations from previous versions, maintaining reliability across version updates. As seen in the discussions, breaking configuration compatibility (like removing enum definitions) can break tools that need to process older versions, requiring changes to be reverted or additional compatibility code to be written.


[
  {
    "discussion_id": "2150539307",
    "pr_number": 116310,
    "pr_file": "src/coreclr/gc/CMakeLists.txt",
    "created_at": "2025-06-16T17:51:21+00:00",
    "commented_code": "gceesvr.cpp\n  gceewks.cpp\n  gcload.cpp\n  gcbridge.cpp",
    "repo_full_name": "dotnet/runtime",
    "discussion_comments": [
      {
        "comment_id": "2150539307",
        "repo_full_name": "dotnet/runtime",
        "pr_number": 116310,
        "pr_file": "src/coreclr/gc/CMakeLists.txt",
        "discussion_id": "2150539307",
        "commented_code": "@@ -22,6 +22,7 @@ set(GC_SOURCES\n   gceesvr.cpp\n   gceewks.cpp\n   gcload.cpp\n+  gcbridge.cpp",
        "comment_created_at": "2025-06-16T17:51:21+00:00",
        "comment_author": "AaronRobinsonMSFT",
        "comment_body": "We should only include these files when appropriate. The alternative is to ifdef the code itself, but I prefer to just not include them in the build.",
        "pr_file_module": null
      },
      {
        "comment_id": "2156620162",
        "repo_full_name": "dotnet/runtime",
        "pr_number": 116310,
        "pr_file": "src/coreclr/gc/CMakeLists.txt",
        "discussion_id": "2150539307",
        "commented_code": "@@ -22,6 +22,7 @@ set(GC_SOURCES\n   gceesvr.cpp\n   gceewks.cpp\n   gcload.cpp\n+  gcbridge.cpp",
        "comment_created_at": "2025-06-19T09:57:20+00:00",
        "comment_author": "BrzVlad",
        "comment_body": "I ended up ifdef-ing the code out because my understanding is that it is not possible to add files to the build conditionally based on the Debug/Release configuration.",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2110670849",
    "pr_number": 115983,
    "pr_file": "src/coreclr/tools/Common/JitInterface/ThunkGenerator/InstructionSetDesc.txt",
    "created_at": "2025-05-28T01:31:37+00:00",
    "commented_code": "; Definition of X86 instruction sets\ndefinearch         ,X86   ,32Bit                ,X64, X64\n\ninstructionset     ,X86   ,X86Base              ,        ,22 ,X86Base               ,base\ninstructionset     ,X86   ,Sse                  ,        ,1  ,SSE                   ,sse\ninstructionset     ,X86   ,Sse2                 ,        ,2  ,SSE2                  ,sse2\ninstructionset     ,X86   ,Sse3                 ,        ,3  ,SSE3                  ,sse3\ninstructionset     ,X86   ,Ssse3                ,        ,4  ,SSSE3                 ,ssse3\ninstructionset     ,X86   ,Sse41                ,        ,5  ,SSE41                 ,sse4.1\ninstructionset     ,X86   ,Sse42                ,        ,6  ,SSE42                 ,sse4.2\ninstructionset     ,X86   ,Avx                  ,        ,7  ,AVX                   ,avx\ninstructionset     ,X86   ,Avx2                 ,        ,8  ,AVX2                  ,avx2\ninstructionset     ,X86   ,Aes                  ,        ,9  ,AES                   ,aes\ninstructionset     ,X86   ,Bmi1                 ,        ,10 ,BMI1                  ,bmi\ninstructionset     ,X86   ,Bmi2                 ,        ,11 ,BMI2                  ,bmi2\ninstructionset     ,X86   ,Fma                  ,        ,12 ,FMA                   ,fma\ninstructionset     ,X86   ,Lzcnt                ,        ,13 ,LZCNT                 ,lzcnt\ninstructionset     ,X86   ,Pclmulqdq            ,        ,14 ,PCLMULQDQ             ,pclmul\ninstructionset     ,X86   ,Pclmulqdq_V256       ,        ,49 ,PCLMULQDQ_V256        ,vpclmul\ninstructionset     ,X86   ,Pclmulqdq_V512       ,        ,50 ,PCLMULQDQ_V512        ,vpclmul_v512\ninstructionset     ,X86   ,Popcnt               ,        ,15 ,POPCNT                ,popcnt\ninstructionset     ,X86   ,                     ,        ,   ,Vector128             ,\ninstructionset     ,X86   ,                     ,        ,   ,Vector256             ,\ninstructionset     ,X86   ,                     ,        ,   ,Vector512             ,\ninstructionset     ,X86   ,AvxVnni              ,        ,25 ,AVXVNNI               ,avxvnni\ninstructionset     ,X86   ,Movbe                ,        ,27 ,MOVBE                 ,movbe\ninstructionset     ,X86   ,X86Serialize         ,        ,28 ,X86Serialize          ,serialize\ninstructionset     ,X86   ,EVEX                 ,        ,47 ,EVEX                  ,evex\ninstructionset     ,X86   ,Avx512F              ,        ,29 ,AVX512F               ,avx512f\ninstructionset     ,X86   ,Avx512F_VL           ,        ,30 ,AVX512F_VL            ,avx512f_vl\ninstructionset     ,X86   ,Avx512BW             ,        ,31 ,AVX512BW              ,avx512bw\ninstructionset     ,X86   ,Avx512BW_VL          ,        ,32 ,AVX512BW_VL           ,avx512bw_vl\ninstructionset     ,X86   ,Avx512CD             ,        ,33 ,AVX512CD              ,avx512cd\ninstructionset     ,X86   ,Avx512CD_VL          ,        ,34 ,AVX512CD_VL           ,avx512cd_vl\ninstructionset     ,X86   ,Avx512DQ             ,        ,35 ,AVX512DQ              ,avx512dq\ninstructionset     ,X86   ,Avx512DQ_VL          ,        ,36 ,AVX512DQ_VL           ,avx512dq_vl\ninstructionset     ,X86   ,Avx512Vbmi           ,        ,37 ,AVX512VBMI            ,avx512vbmi\ninstructionset     ,X86   ,Avx512Vbmi_VL        ,        ,38 ,AVX512VBMI_VL         ,avx512vbmi_vl\ninstructionset     ,X86   ,Avx10v1              ,        ,44 ,AVX10v1               ,avx10v1\ninstructionset     ,X86   ,Avx10v1_V512         ,        ,46 ,AVX10v1_V512          ,avx10v1_v512\ninstructionset     ,X86   ,VectorT128           ,        ,39 ,VectorT128            ,vectort128\ninstructionset     ,X86   ,VectorT256           ,        ,40 ,VectorT256            ,vectort256\ninstructionset     ,X86   ,VectorT512           ,        ,41 ,VectorT512            ,vectort512\ninstructionset     ,X86   ,Apx                  ,        ,48 ,APX                   ,apx\ninstructionset     ,X86   ,Avx10v2              ,        ,51 ,AVX10v2               ,avx10v2\ninstructionset     ,X86   ,Avx10v2_V512         ,        ,52 ,AVX10v2_V512          ,avx10v2_v512\ninstructionset     ,X86   ,Gfni                 ,        ,53 ,GFNI                  ,gfni\ninstructionset     ,X86   ,Gfni_V256            ,        ,54 ,GFNI_V256             ,gfni_v256\ninstructionset     ,X86   ,Gfni_V512            ,        ,55 ,GFNI_V512             ,gfni_v512\ninstructionset     ,X86   ,X86Base              ,           ,22 ,X86Base               ,base",
    "repo_full_name": "dotnet/runtime",
    "discussion_comments": [
      {
        "comment_id": "2110670849",
        "repo_full_name": "dotnet/runtime",
        "pr_number": 115983,
        "pr_file": "src/coreclr/tools/Common/JitInterface/ThunkGenerator/InstructionSetDesc.txt",
        "discussion_id": "2110670849",
        "commented_code": "@@ -27,56 +27,53 @@\n ; Definition of X86 instruction sets\n definearch         ,X86   ,32Bit                ,X64, X64\n \n-instructionset     ,X86   ,X86Base              ,        ,22 ,X86Base               ,base\n-instructionset     ,X86   ,Sse                  ,        ,1  ,SSE                   ,sse\n-instructionset     ,X86   ,Sse2                 ,        ,2  ,SSE2                  ,sse2\n-instructionset     ,X86   ,Sse3                 ,        ,3  ,SSE3                  ,sse3\n-instructionset     ,X86   ,Ssse3                ,        ,4  ,SSSE3                 ,ssse3\n-instructionset     ,X86   ,Sse41                ,        ,5  ,SSE41                 ,sse4.1\n-instructionset     ,X86   ,Sse42                ,        ,6  ,SSE42                 ,sse4.2\n-instructionset     ,X86   ,Avx                  ,        ,7  ,AVX                   ,avx\n-instructionset     ,X86   ,Avx2                 ,        ,8  ,AVX2                  ,avx2\n-instructionset     ,X86   ,Aes                  ,        ,9  ,AES                   ,aes\n-instructionset     ,X86   ,Bmi1                 ,        ,10 ,BMI1                  ,bmi\n-instructionset     ,X86   ,Bmi2                 ,        ,11 ,BMI2                  ,bmi2\n-instructionset     ,X86   ,Fma                  ,        ,12 ,FMA                   ,fma\n-instructionset     ,X86   ,Lzcnt                ,        ,13 ,LZCNT                 ,lzcnt\n-instructionset     ,X86   ,Pclmulqdq            ,        ,14 ,PCLMULQDQ             ,pclmul\n-instructionset     ,X86   ,Pclmulqdq_V256       ,        ,49 ,PCLMULQDQ_V256        ,vpclmul\n-instructionset     ,X86   ,Pclmulqdq_V512       ,        ,50 ,PCLMULQDQ_V512        ,vpclmul_v512\n-instructionset     ,X86   ,Popcnt               ,        ,15 ,POPCNT                ,popcnt\n-instructionset     ,X86   ,                     ,        ,   ,Vector128             ,\n-instructionset     ,X86   ,                     ,        ,   ,Vector256             ,\n-instructionset     ,X86   ,                     ,        ,   ,Vector512             ,\n-instructionset     ,X86   ,AvxVnni              ,        ,25 ,AVXVNNI               ,avxvnni\n-instructionset     ,X86   ,Movbe                ,        ,27 ,MOVBE                 ,movbe\n-instructionset     ,X86   ,X86Serialize         ,        ,28 ,X86Serialize          ,serialize\n-instructionset     ,X86   ,EVEX                 ,        ,47 ,EVEX                  ,evex\n-instructionset     ,X86   ,Avx512F              ,        ,29 ,AVX512F               ,avx512f\n-instructionset     ,X86   ,Avx512F_VL           ,        ,30 ,AVX512F_VL            ,avx512f_vl\n-instructionset     ,X86   ,Avx512BW             ,        ,31 ,AVX512BW              ,avx512bw\n-instructionset     ,X86   ,Avx512BW_VL          ,        ,32 ,AVX512BW_VL           ,avx512bw_vl\n-instructionset     ,X86   ,Avx512CD             ,        ,33 ,AVX512CD              ,avx512cd\n-instructionset     ,X86   ,Avx512CD_VL          ,        ,34 ,AVX512CD_VL           ,avx512cd_vl\n-instructionset     ,X86   ,Avx512DQ             ,        ,35 ,AVX512DQ              ,avx512dq\n-instructionset     ,X86   ,Avx512DQ_VL          ,        ,36 ,AVX512DQ_VL           ,avx512dq_vl\n-instructionset     ,X86   ,Avx512Vbmi           ,        ,37 ,AVX512VBMI            ,avx512vbmi\n-instructionset     ,X86   ,Avx512Vbmi_VL        ,        ,38 ,AVX512VBMI_VL         ,avx512vbmi_vl\n-instructionset     ,X86   ,Avx10v1              ,        ,44 ,AVX10v1               ,avx10v1\n-instructionset     ,X86   ,Avx10v1_V512         ,        ,46 ,AVX10v1_V512          ,avx10v1_v512\n-instructionset     ,X86   ,VectorT128           ,        ,39 ,VectorT128            ,vectort128\n-instructionset     ,X86   ,VectorT256           ,        ,40 ,VectorT256            ,vectort256\n-instructionset     ,X86   ,VectorT512           ,        ,41 ,VectorT512            ,vectort512\n-instructionset     ,X86   ,Apx                  ,        ,48 ,APX                   ,apx\n-instructionset     ,X86   ,Avx10v2              ,        ,51 ,AVX10v2               ,avx10v2\n-instructionset     ,X86   ,Avx10v2_V512         ,        ,52 ,AVX10v2_V512          ,avx10v2_v512\n-instructionset     ,X86   ,Gfni                 ,        ,53 ,GFNI                  ,gfni\n-instructionset     ,X86   ,Gfni_V256            ,        ,54 ,GFNI_V256             ,gfni_v256\n-instructionset     ,X86   ,Gfni_V512            ,        ,55 ,GFNI_V512             ,gfni_v512\n+instructionset     ,X86   ,X86Base              ,           ,22 ,X86Base               ,base",
        "comment_created_at": "2025-05-28T01:31:37+00:00",
        "comment_author": "tannergooding",
        "comment_body": "@jkotas are we planning any other R2R breaking changes this release? If so, it would be nice to go ahead and clean up (potentially just in a follow up PR) some of the R2R values; otherwise, I can log a tracking issue for it.\r\n\r\nThe two big things are that we have some unused gaps now that could be filled in and I don't see why we need to use unique IDs across X86 and Arm64 (that is `X86Base` and `ArmBase` can't currently both be R2R ID 1).\r\n\r\nFor the latter point, the general intent of the R2R flags is to track when user code has some `if (Isa.IsSupported) { }` check that isn't taken, because we have to assume it may cause different behavior. However, on x64 some `AdvSimd.IsSupported` check can never be true, so it can't ever cause a difference in behavior and so we shouldn't need to track it at all and so the x64 vs Arm64 R2R IDs should be able to overlap, with them differentiated by a general \"target architecture\" flag instead. \r\n\r\nI believe we should be able to do much like we do in NAOT where we simply track 1 bit per ISA on the relevant architecture. In other words, I expect we could essentially simplify this to almost the same as https://github.com/dotnet/runtime/pull/115983/files#diff-37e89a49ea22a08b2d0502ca3b1716e2dd1bd68cafd3eeb3cd45f5a4406601d3R219, which would also let us avoid needing to track \"specifiable\" or not and needing unique bit entries for cases like `gfni_v512` (which is tracked as `gfni + avx512` for NAOT). We should just need to track the baseline ISA in addition to what NAOT tracks, since that can be disabled for testing user fallbacks.",
        "pr_file_module": null
      },
      {
        "comment_id": "2110883757",
        "repo_full_name": "dotnet/runtime",
        "pr_number": 115983,
        "pr_file": "src/coreclr/tools/Common/JitInterface/ThunkGenerator/InstructionSetDesc.txt",
        "discussion_id": "2110670849",
        "commented_code": "@@ -27,56 +27,53 @@\n ; Definition of X86 instruction sets\n definearch         ,X86   ,32Bit                ,X64, X64\n \n-instructionset     ,X86   ,X86Base              ,        ,22 ,X86Base               ,base\n-instructionset     ,X86   ,Sse                  ,        ,1  ,SSE                   ,sse\n-instructionset     ,X86   ,Sse2                 ,        ,2  ,SSE2                  ,sse2\n-instructionset     ,X86   ,Sse3                 ,        ,3  ,SSE3                  ,sse3\n-instructionset     ,X86   ,Ssse3                ,        ,4  ,SSSE3                 ,ssse3\n-instructionset     ,X86   ,Sse41                ,        ,5  ,SSE41                 ,sse4.1\n-instructionset     ,X86   ,Sse42                ,        ,6  ,SSE42                 ,sse4.2\n-instructionset     ,X86   ,Avx                  ,        ,7  ,AVX                   ,avx\n-instructionset     ,X86   ,Avx2                 ,        ,8  ,AVX2                  ,avx2\n-instructionset     ,X86   ,Aes                  ,        ,9  ,AES                   ,aes\n-instructionset     ,X86   ,Bmi1                 ,        ,10 ,BMI1                  ,bmi\n-instructionset     ,X86   ,Bmi2                 ,        ,11 ,BMI2                  ,bmi2\n-instructionset     ,X86   ,Fma                  ,        ,12 ,FMA                   ,fma\n-instructionset     ,X86   ,Lzcnt                ,        ,13 ,LZCNT                 ,lzcnt\n-instructionset     ,X86   ,Pclmulqdq            ,        ,14 ,PCLMULQDQ             ,pclmul\n-instructionset     ,X86   ,Pclmulqdq_V256       ,        ,49 ,PCLMULQDQ_V256        ,vpclmul\n-instructionset     ,X86   ,Pclmulqdq_V512       ,        ,50 ,PCLMULQDQ_V512        ,vpclmul_v512\n-instructionset     ,X86   ,Popcnt               ,        ,15 ,POPCNT                ,popcnt\n-instructionset     ,X86   ,                     ,        ,   ,Vector128             ,\n-instructionset     ,X86   ,                     ,        ,   ,Vector256             ,\n-instructionset     ,X86   ,                     ,        ,   ,Vector512             ,\n-instructionset     ,X86   ,AvxVnni              ,        ,25 ,AVXVNNI               ,avxvnni\n-instructionset     ,X86   ,Movbe                ,        ,27 ,MOVBE                 ,movbe\n-instructionset     ,X86   ,X86Serialize         ,        ,28 ,X86Serialize          ,serialize\n-instructionset     ,X86   ,EVEX                 ,        ,47 ,EVEX                  ,evex\n-instructionset     ,X86   ,Avx512F              ,        ,29 ,AVX512F               ,avx512f\n-instructionset     ,X86   ,Avx512F_VL           ,        ,30 ,AVX512F_VL            ,avx512f_vl\n-instructionset     ,X86   ,Avx512BW             ,        ,31 ,AVX512BW              ,avx512bw\n-instructionset     ,X86   ,Avx512BW_VL          ,        ,32 ,AVX512BW_VL           ,avx512bw_vl\n-instructionset     ,X86   ,Avx512CD             ,        ,33 ,AVX512CD              ,avx512cd\n-instructionset     ,X86   ,Avx512CD_VL          ,        ,34 ,AVX512CD_VL           ,avx512cd_vl\n-instructionset     ,X86   ,Avx512DQ             ,        ,35 ,AVX512DQ              ,avx512dq\n-instructionset     ,X86   ,Avx512DQ_VL          ,        ,36 ,AVX512DQ_VL           ,avx512dq_vl\n-instructionset     ,X86   ,Avx512Vbmi           ,        ,37 ,AVX512VBMI            ,avx512vbmi\n-instructionset     ,X86   ,Avx512Vbmi_VL        ,        ,38 ,AVX512VBMI_VL         ,avx512vbmi_vl\n-instructionset     ,X86   ,Avx10v1              ,        ,44 ,AVX10v1               ,avx10v1\n-instructionset     ,X86   ,Avx10v1_V512         ,        ,46 ,AVX10v1_V512          ,avx10v1_v512\n-instructionset     ,X86   ,VectorT128           ,        ,39 ,VectorT128            ,vectort128\n-instructionset     ,X86   ,VectorT256           ,        ,40 ,VectorT256            ,vectort256\n-instructionset     ,X86   ,VectorT512           ,        ,41 ,VectorT512            ,vectort512\n-instructionset     ,X86   ,Apx                  ,        ,48 ,APX                   ,apx\n-instructionset     ,X86   ,Avx10v2              ,        ,51 ,AVX10v2               ,avx10v2\n-instructionset     ,X86   ,Avx10v2_V512         ,        ,52 ,AVX10v2_V512          ,avx10v2_v512\n-instructionset     ,X86   ,Gfni                 ,        ,53 ,GFNI                  ,gfni\n-instructionset     ,X86   ,Gfni_V256            ,        ,54 ,GFNI_V256             ,gfni_v256\n-instructionset     ,X86   ,Gfni_V512            ,        ,55 ,GFNI_V512             ,gfni_v512\n+instructionset     ,X86   ,X86Base              ,           ,22 ,X86Base               ,base",
        "comment_created_at": "2025-05-28T04:35:38+00:00",
        "comment_author": "jkotas",
        "comment_body": "> The two big things are that we have some unused gaps now that could be filled in and I don't see why we need to use unique IDs across X86 and Arm64 (that is X86Base and ArmBase can't currently both be R2R ID 1).\r\n\r\nThis would make r2rdump more complicated. Right now, r2rdump just does Enum.ToString() to dump the instruction set. \r\n\r\nAlso, r2rdump is designed to be able to dump older versions of r2r images. Removing the definitions of the existing enum members breaks that. These removals should be reverted.",
        "pr_file_module": null
      },
      {
        "comment_id": "2110885193",
        "repo_full_name": "dotnet/runtime",
        "pr_number": 115983,
        "pr_file": "src/coreclr/tools/Common/JitInterface/ThunkGenerator/InstructionSetDesc.txt",
        "discussion_id": "2110670849",
        "commented_code": "@@ -27,56 +27,53 @@\n ; Definition of X86 instruction sets\n definearch         ,X86   ,32Bit                ,X64, X64\n \n-instructionset     ,X86   ,X86Base              ,        ,22 ,X86Base               ,base\n-instructionset     ,X86   ,Sse                  ,        ,1  ,SSE                   ,sse\n-instructionset     ,X86   ,Sse2                 ,        ,2  ,SSE2                  ,sse2\n-instructionset     ,X86   ,Sse3                 ,        ,3  ,SSE3                  ,sse3\n-instructionset     ,X86   ,Ssse3                ,        ,4  ,SSSE3                 ,ssse3\n-instructionset     ,X86   ,Sse41                ,        ,5  ,SSE41                 ,sse4.1\n-instructionset     ,X86   ,Sse42                ,        ,6  ,SSE42                 ,sse4.2\n-instructionset     ,X86   ,Avx                  ,        ,7  ,AVX                   ,avx\n-instructionset     ,X86   ,Avx2                 ,        ,8  ,AVX2                  ,avx2\n-instructionset     ,X86   ,Aes                  ,        ,9  ,AES                   ,aes\n-instructionset     ,X86   ,Bmi1                 ,        ,10 ,BMI1                  ,bmi\n-instructionset     ,X86   ,Bmi2                 ,        ,11 ,BMI2                  ,bmi2\n-instructionset     ,X86   ,Fma                  ,        ,12 ,FMA                   ,fma\n-instructionset     ,X86   ,Lzcnt                ,        ,13 ,LZCNT                 ,lzcnt\n-instructionset     ,X86   ,Pclmulqdq            ,        ,14 ,PCLMULQDQ             ,pclmul\n-instructionset     ,X86   ,Pclmulqdq_V256       ,        ,49 ,PCLMULQDQ_V256        ,vpclmul\n-instructionset     ,X86   ,Pclmulqdq_V512       ,        ,50 ,PCLMULQDQ_V512        ,vpclmul_v512\n-instructionset     ,X86   ,Popcnt               ,        ,15 ,POPCNT                ,popcnt\n-instructionset     ,X86   ,                     ,        ,   ,Vector128             ,\n-instructionset     ,X86   ,                     ,        ,   ,Vector256             ,\n-instructionset     ,X86   ,                     ,        ,   ,Vector512             ,\n-instructionset     ,X86   ,AvxVnni              ,        ,25 ,AVXVNNI               ,avxvnni\n-instructionset     ,X86   ,Movbe                ,        ,27 ,MOVBE                 ,movbe\n-instructionset     ,X86   ,X86Serialize         ,        ,28 ,X86Serialize          ,serialize\n-instructionset     ,X86   ,EVEX                 ,        ,47 ,EVEX                  ,evex\n-instructionset     ,X86   ,Avx512F              ,        ,29 ,AVX512F               ,avx512f\n-instructionset     ,X86   ,Avx512F_VL           ,        ,30 ,AVX512F_VL            ,avx512f_vl\n-instructionset     ,X86   ,Avx512BW             ,        ,31 ,AVX512BW              ,avx512bw\n-instructionset     ,X86   ,Avx512BW_VL          ,        ,32 ,AVX512BW_VL           ,avx512bw_vl\n-instructionset     ,X86   ,Avx512CD             ,        ,33 ,AVX512CD              ,avx512cd\n-instructionset     ,X86   ,Avx512CD_VL          ,        ,34 ,AVX512CD_VL           ,avx512cd_vl\n-instructionset     ,X86   ,Avx512DQ             ,        ,35 ,AVX512DQ              ,avx512dq\n-instructionset     ,X86   ,Avx512DQ_VL          ,        ,36 ,AVX512DQ_VL           ,avx512dq_vl\n-instructionset     ,X86   ,Avx512Vbmi           ,        ,37 ,AVX512VBMI            ,avx512vbmi\n-instructionset     ,X86   ,Avx512Vbmi_VL        ,        ,38 ,AVX512VBMI_VL         ,avx512vbmi_vl\n-instructionset     ,X86   ,Avx10v1              ,        ,44 ,AVX10v1               ,avx10v1\n-instructionset     ,X86   ,Avx10v1_V512         ,        ,46 ,AVX10v1_V512          ,avx10v1_v512\n-instructionset     ,X86   ,VectorT128           ,        ,39 ,VectorT128            ,vectort128\n-instructionset     ,X86   ,VectorT256           ,        ,40 ,VectorT256            ,vectort256\n-instructionset     ,X86   ,VectorT512           ,        ,41 ,VectorT512            ,vectort512\n-instructionset     ,X86   ,Apx                  ,        ,48 ,APX                   ,apx\n-instructionset     ,X86   ,Avx10v2              ,        ,51 ,AVX10v2               ,avx10v2\n-instructionset     ,X86   ,Avx10v2_V512         ,        ,52 ,AVX10v2_V512          ,avx10v2_v512\n-instructionset     ,X86   ,Gfni                 ,        ,53 ,GFNI                  ,gfni\n-instructionset     ,X86   ,Gfni_V256            ,        ,54 ,GFNI_V256             ,gfni_v256\n-instructionset     ,X86   ,Gfni_V512            ,        ,55 ,GFNI_V512             ,gfni_v512\n+instructionset     ,X86   ,X86Base              ,           ,22 ,X86Base               ,base",
        "comment_created_at": "2025-05-28T04:37:29+00:00",
        "comment_author": "jkotas",
        "comment_body": "> we should be able to do much like we do in NAOT\r\n\r\nNAOT does not have the versioning problem like R2R. There is no mixing and matching of versions, etc.",
        "pr_file_module": null
      },
      {
        "comment_id": "2112243957",
        "repo_full_name": "dotnet/runtime",
        "pr_number": 115983,
        "pr_file": "src/coreclr/tools/Common/JitInterface/ThunkGenerator/InstructionSetDesc.txt",
        "discussion_id": "2110670849",
        "commented_code": "@@ -27,56 +27,53 @@\n ; Definition of X86 instruction sets\n definearch         ,X86   ,32Bit                ,X64, X64\n \n-instructionset     ,X86   ,X86Base              ,        ,22 ,X86Base               ,base\n-instructionset     ,X86   ,Sse                  ,        ,1  ,SSE                   ,sse\n-instructionset     ,X86   ,Sse2                 ,        ,2  ,SSE2                  ,sse2\n-instructionset     ,X86   ,Sse3                 ,        ,3  ,SSE3                  ,sse3\n-instructionset     ,X86   ,Ssse3                ,        ,4  ,SSSE3                 ,ssse3\n-instructionset     ,X86   ,Sse41                ,        ,5  ,SSE41                 ,sse4.1\n-instructionset     ,X86   ,Sse42                ,        ,6  ,SSE42                 ,sse4.2\n-instructionset     ,X86   ,Avx                  ,        ,7  ,AVX                   ,avx\n-instructionset     ,X86   ,Avx2                 ,        ,8  ,AVX2                  ,avx2\n-instructionset     ,X86   ,Aes                  ,        ,9  ,AES                   ,aes\n-instructionset     ,X86   ,Bmi1                 ,        ,10 ,BMI1                  ,bmi\n-instructionset     ,X86   ,Bmi2                 ,        ,11 ,BMI2                  ,bmi2\n-instructionset     ,X86   ,Fma                  ,        ,12 ,FMA                   ,fma\n-instructionset     ,X86   ,Lzcnt                ,        ,13 ,LZCNT                 ,lzcnt\n-instructionset     ,X86   ,Pclmulqdq            ,        ,14 ,PCLMULQDQ             ,pclmul\n-instructionset     ,X86   ,Pclmulqdq_V256       ,        ,49 ,PCLMULQDQ_V256        ,vpclmul\n-instructionset     ,X86   ,Pclmulqdq_V512       ,        ,50 ,PCLMULQDQ_V512        ,vpclmul_v512\n-instructionset     ,X86   ,Popcnt               ,        ,15 ,POPCNT                ,popcnt\n-instructionset     ,X86   ,                     ,        ,   ,Vector128             ,\n-instructionset     ,X86   ,                     ,        ,   ,Vector256             ,\n-instructionset     ,X86   ,                     ,        ,   ,Vector512             ,\n-instructionset     ,X86   ,AvxVnni              ,        ,25 ,AVXVNNI               ,avxvnni\n-instructionset     ,X86   ,Movbe                ,        ,27 ,MOVBE                 ,movbe\n-instructionset     ,X86   ,X86Serialize         ,        ,28 ,X86Serialize          ,serialize\n-instructionset     ,X86   ,EVEX                 ,        ,47 ,EVEX                  ,evex\n-instructionset     ,X86   ,Avx512F              ,        ,29 ,AVX512F               ,avx512f\n-instructionset     ,X86   ,Avx512F_VL           ,        ,30 ,AVX512F_VL            ,avx512f_vl\n-instructionset     ,X86   ,Avx512BW             ,        ,31 ,AVX512BW              ,avx512bw\n-instructionset     ,X86   ,Avx512BW_VL          ,        ,32 ,AVX512BW_VL           ,avx512bw_vl\n-instructionset     ,X86   ,Avx512CD             ,        ,33 ,AVX512CD              ,avx512cd\n-instructionset     ,X86   ,Avx512CD_VL          ,        ,34 ,AVX512CD_VL           ,avx512cd_vl\n-instructionset     ,X86   ,Avx512DQ             ,        ,35 ,AVX512DQ              ,avx512dq\n-instructionset     ,X86   ,Avx512DQ_VL          ,        ,36 ,AVX512DQ_VL           ,avx512dq_vl\n-instructionset     ,X86   ,Avx512Vbmi           ,        ,37 ,AVX512VBMI            ,avx512vbmi\n-instructionset     ,X86   ,Avx512Vbmi_VL        ,        ,38 ,AVX512VBMI_VL         ,avx512vbmi_vl\n-instructionset     ,X86   ,Avx10v1              ,        ,44 ,AVX10v1               ,avx10v1\n-instructionset     ,X86   ,Avx10v1_V512         ,        ,46 ,AVX10v1_V512          ,avx10v1_v512\n-instructionset     ,X86   ,VectorT128           ,        ,39 ,VectorT128            ,vectort128\n-instructionset     ,X86   ,VectorT256           ,        ,40 ,VectorT256            ,vectort256\n-instructionset     ,X86   ,VectorT512           ,        ,41 ,VectorT512            ,vectort512\n-instructionset     ,X86   ,Apx                  ,        ,48 ,APX                   ,apx\n-instructionset     ,X86   ,Avx10v2              ,        ,51 ,AVX10v2               ,avx10v2\n-instructionset     ,X86   ,Avx10v2_V512         ,        ,52 ,AVX10v2_V512          ,avx10v2_v512\n-instructionset     ,X86   ,Gfni                 ,        ,53 ,GFNI                  ,gfni\n-instructionset     ,X86   ,Gfni_V256            ,        ,54 ,GFNI_V256             ,gfni_v256\n-instructionset     ,X86   ,Gfni_V512            ,        ,55 ,GFNI_V512             ,gfni_v512\n+instructionset     ,X86   ,X86Base              ,           ,22 ,X86Base               ,base",
        "comment_created_at": "2025-05-28T15:53:37+00:00",
        "comment_author": "tannergooding",
        "comment_body": "I'll revert for now. However, ...\r\n\r\n> This would make r2rdump more complicated. Right now, r2rdump just does Enum.ToString() to dump the instruction set.\r\n\r\nI think it would be better to make it slightly more complex by taking this break long term and adding a compat handler to r2rdump to handle older image versions.\r\n\r\nRight now we're using 60 bits for R2R, when we should only need 34 total. If we split it by platform then it's 11 for Arm64 and 23 for x64. Just given the pending work around SVE and AVX, we will likely go over 64-bits in the next release and need to take a break anyways.\r\n\r\nI think the way NAOT has this setup is more flexible and was done because it came online later and was able to handle some of the scenarios that R2R didn't have the foresight to consider.\r\n\r\n> NAOT does not have the versioning problem like R2R. There is no mixing and matching of versions, etc.\r\n\r\nRight, but I think it's also something we can handle for R2R to make things overall cleaner moving forward. Not something we have to do now, but I expect we'll be forced to deal with it in the .NET 11 timeframe\r\n\r\n",
        "pr_file_module": null
      },
      {
        "comment_id": "2112346761",
        "repo_full_name": "dotnet/runtime",
        "pr_number": 115983,
        "pr_file": "src/coreclr/tools/Common/JitInterface/ThunkGenerator/InstructionSetDesc.txt",
        "discussion_id": "2110670849",
        "commented_code": "@@ -27,56 +27,53 @@\n ; Definition of X86 instruction sets\n definearch         ,X86   ,32Bit                ,X64, X64\n \n-instructionset     ,X86   ,X86Base              ,        ,22 ,X86Base               ,base\n-instructionset     ,X86   ,Sse                  ,        ,1  ,SSE                   ,sse\n-instructionset     ,X86   ,Sse2                 ,        ,2  ,SSE2                  ,sse2\n-instructionset     ,X86   ,Sse3                 ,        ,3  ,SSE3                  ,sse3\n-instructionset     ,X86   ,Ssse3                ,        ,4  ,SSSE3                 ,ssse3\n-instructionset     ,X86   ,Sse41                ,        ,5  ,SSE41                 ,sse4.1\n-instructionset     ,X86   ,Sse42                ,        ,6  ,SSE42                 ,sse4.2\n-instructionset     ,X86   ,Avx                  ,        ,7  ,AVX                   ,avx\n-instructionset     ,X86   ,Avx2                 ,        ,8  ,AVX2                  ,avx2\n-instructionset     ,X86   ,Aes                  ,        ,9  ,AES                   ,aes\n-instructionset     ,X86   ,Bmi1                 ,        ,10 ,BMI1                  ,bmi\n-instructionset     ,X86   ,Bmi2                 ,        ,11 ,BMI2                  ,bmi2\n-instructionset     ,X86   ,Fma                  ,        ,12 ,FMA                   ,fma\n-instructionset     ,X86   ,Lzcnt                ,        ,13 ,LZCNT                 ,lzcnt\n-instructionset     ,X86   ,Pclmulqdq            ,        ,14 ,PCLMULQDQ             ,pclmul\n-instructionset     ,X86   ,Pclmulqdq_V256       ,        ,49 ,PCLMULQDQ_V256        ,vpclmul\n-instructionset     ,X86   ,Pclmulqdq_V512       ,        ,50 ,PCLMULQDQ_V512        ,vpclmul_v512\n-instructionset     ,X86   ,Popcnt               ,        ,15 ,POPCNT                ,popcnt\n-instructionset     ,X86   ,                     ,        ,   ,Vector128             ,\n-instructionset     ,X86   ,                     ,        ,   ,Vector256             ,\n-instructionset     ,X86   ,                     ,        ,   ,Vector512             ,\n-instructionset     ,X86   ,AvxVnni              ,        ,25 ,AVXVNNI               ,avxvnni\n-instructionset     ,X86   ,Movbe                ,        ,27 ,MOVBE                 ,movbe\n-instructionset     ,X86   ,X86Serialize         ,        ,28 ,X86Serialize          ,serialize\n-instructionset     ,X86   ,EVEX                 ,        ,47 ,EVEX                  ,evex\n-instructionset     ,X86   ,Avx512F              ,        ,29 ,AVX512F               ,avx512f\n-instructionset     ,X86   ,Avx512F_VL           ,        ,30 ,AVX512F_VL            ,avx512f_vl\n-instructionset     ,X86   ,Avx512BW             ,        ,31 ,AVX512BW              ,avx512bw\n-instructionset     ,X86   ,Avx512BW_VL          ,        ,32 ,AVX512BW_VL           ,avx512bw_vl\n-instructionset     ,X86   ,Avx512CD             ,        ,33 ,AVX512CD              ,avx512cd\n-instructionset     ,X86   ,Avx512CD_VL          ,        ,34 ,AVX512CD_VL           ,avx512cd_vl\n-instructionset     ,X86   ,Avx512DQ             ,        ,35 ,AVX512DQ              ,avx512dq\n-instructionset     ,X86   ,Avx512DQ_VL          ,        ,36 ,AVX512DQ_VL           ,avx512dq_vl\n-instructionset     ,X86   ,Avx512Vbmi           ,        ,37 ,AVX512VBMI            ,avx512vbmi\n-instructionset     ,X86   ,Avx512Vbmi_VL        ,        ,38 ,AVX512VBMI_VL         ,avx512vbmi_vl\n-instructionset     ,X86   ,Avx10v1              ,        ,44 ,AVX10v1               ,avx10v1\n-instructionset     ,X86   ,Avx10v1_V512         ,        ,46 ,AVX10v1_V512          ,avx10v1_v512\n-instructionset     ,X86   ,VectorT128           ,        ,39 ,VectorT128            ,vectort128\n-instructionset     ,X86   ,VectorT256           ,        ,40 ,VectorT256            ,vectort256\n-instructionset     ,X86   ,VectorT512           ,        ,41 ,VectorT512            ,vectort512\n-instructionset     ,X86   ,Apx                  ,        ,48 ,APX                   ,apx\n-instructionset     ,X86   ,Avx10v2              ,        ,51 ,AVX10v2               ,avx10v2\n-instructionset     ,X86   ,Avx10v2_V512         ,        ,52 ,AVX10v2_V512          ,avx10v2_v512\n-instructionset     ,X86   ,Gfni                 ,        ,53 ,GFNI                  ,gfni\n-instructionset     ,X86   ,Gfni_V256            ,        ,54 ,GFNI_V256             ,gfni_v256\n-instructionset     ,X86   ,Gfni_V512            ,        ,55 ,GFNI_V512             ,gfni_v512\n+instructionset     ,X86   ,X86Base              ,           ,22 ,X86Base               ,base",
        "comment_created_at": "2025-05-28T16:49:44+00:00",
        "comment_author": "tannergooding",
        "comment_body": "Reverted to preserve the compat for .NET 10",
        "pr_file_module": null
      },
      {
        "comment_id": "2114496732",
        "repo_full_name": "dotnet/runtime",
        "pr_number": 115983,
        "pr_file": "src/coreclr/tools/Common/JitInterface/ThunkGenerator/InstructionSetDesc.txt",
        "discussion_id": "2110670849",
        "commented_code": "@@ -27,56 +27,53 @@\n ; Definition of X86 instruction sets\n definearch         ,X86   ,32Bit                ,X64, X64\n \n-instructionset     ,X86   ,X86Base              ,        ,22 ,X86Base               ,base\n-instructionset     ,X86   ,Sse                  ,        ,1  ,SSE                   ,sse\n-instructionset     ,X86   ,Sse2                 ,        ,2  ,SSE2                  ,sse2\n-instructionset     ,X86   ,Sse3                 ,        ,3  ,SSE3                  ,sse3\n-instructionset     ,X86   ,Ssse3                ,        ,4  ,SSSE3                 ,ssse3\n-instructionset     ,X86   ,Sse41                ,        ,5  ,SSE41                 ,sse4.1\n-instructionset     ,X86   ,Sse42                ,        ,6  ,SSE42                 ,sse4.2\n-instructionset     ,X86   ,Avx                  ,        ,7  ,AVX                   ,avx\n-instructionset     ,X86   ,Avx2                 ,        ,8  ,AVX2                  ,avx2\n-instructionset     ,X86   ,Aes                  ,        ,9  ,AES                   ,aes\n-instructionset     ,X86   ,Bmi1                 ,        ,10 ,BMI1                  ,bmi\n-instructionset     ,X86   ,Bmi2                 ,        ,11 ,BMI2                  ,bmi2\n-instructionset     ,X86   ,Fma                  ,        ,12 ,FMA                   ,fma\n-instructionset     ,X86   ,Lzcnt                ,        ,13 ,LZCNT                 ,lzcnt\n-instructionset     ,X86   ,Pclmulqdq            ,        ,14 ,PCLMULQDQ             ,pclmul\n-instructionset     ,X86   ,Pclmulqdq_V256       ,        ,49 ,PCLMULQDQ_V256        ,vpclmul\n-instructionset     ,X86   ,Pclmulqdq_V512       ,        ,50 ,PCLMULQDQ_V512        ,vpclmul_v512\n-instructionset     ,X86   ,Popcnt               ,        ,15 ,POPCNT                ,popcnt\n-instructionset     ,X86   ,                     ,        ,   ,Vector128             ,\n-instructionset     ,X86   ,                     ,        ,   ,Vector256             ,\n-instructionset     ,X86   ,                     ,        ,   ,Vector512             ,\n-instructionset     ,X86   ,AvxVnni              ,        ,25 ,AVXVNNI               ,avxvnni\n-instructionset     ,X86   ,Movbe                ,        ,27 ,MOVBE                 ,movbe\n-instructionset     ,X86   ,X86Serialize         ,        ,28 ,X86Serialize          ,serialize\n-instructionset     ,X86   ,EVEX                 ,        ,47 ,EVEX                  ,evex\n-instructionset     ,X86   ,Avx512F              ,        ,29 ,AVX512F               ,avx512f\n-instructionset     ,X86   ,Avx512F_VL           ,        ,30 ,AVX512F_VL            ,avx512f_vl\n-instructionset     ,X86   ,Avx512BW             ,        ,31 ,AVX512BW              ,avx512bw\n-instructionset     ,X86   ,Avx512BW_VL          ,        ,32 ,AVX512BW_VL           ,avx512bw_vl\n-instructionset     ,X86   ,Avx512CD             ,        ,33 ,AVX512CD              ,avx512cd\n-instructionset     ,X86   ,Avx512CD_VL          ,        ,34 ,AVX512CD_VL           ,avx512cd_vl\n-instructionset     ,X86   ,Avx512DQ             ,        ,35 ,AVX512DQ              ,avx512dq\n-instructionset     ,X86   ,Avx512DQ_VL          ,        ,36 ,AVX512DQ_VL           ,avx512dq_vl\n-instructionset     ,X86   ,Avx512Vbmi           ,        ,37 ,AVX512VBMI            ,avx512vbmi\n-instructionset     ,X86   ,Avx512Vbmi_VL        ,        ,38 ,AVX512VBMI_VL         ,avx512vbmi_vl\n-instructionset     ,X86   ,Avx10v1              ,        ,44 ,AVX10v1               ,avx10v1\n-instructionset     ,X86   ,Avx10v1_V512         ,        ,46 ,AVX10v1_V512          ,avx10v1_v512\n-instructionset     ,X86   ,VectorT128           ,        ,39 ,VectorT128            ,vectort128\n-instructionset     ,X86   ,VectorT256           ,        ,40 ,VectorT256            ,vectort256\n-instructionset     ,X86   ,VectorT512           ,        ,41 ,VectorT512            ,vectort512\n-instructionset     ,X86   ,Apx                  ,        ,48 ,APX                   ,apx\n-instructionset     ,X86   ,Avx10v2              ,        ,51 ,AVX10v2               ,avx10v2\n-instructionset     ,X86   ,Avx10v2_V512         ,        ,52 ,AVX10v2_V512          ,avx10v2_v512\n-instructionset     ,X86   ,Gfni                 ,        ,53 ,GFNI                  ,gfni\n-instructionset     ,X86   ,Gfni_V256            ,        ,54 ,GFNI_V256             ,gfni_v256\n-instructionset     ,X86   ,Gfni_V512            ,        ,55 ,GFNI_V512             ,gfni_v512\n+instructionset     ,X86   ,X86Base              ,           ,22 ,X86Base               ,base",
        "comment_created_at": "2025-05-29T18:12:01+00:00",
        "comment_author": "jkotas",
        "comment_body": "> Right now we're using 60 bits for R2R, when we should only need 34 total. If we split it by platform then it's 11 for Arm64 and 23 for x64. Just given the pending work around SVE and AVX, we will likely go over 64-bits in the next release and need to take a break anyways.\r\n\r\nReadyToRunInstructionSet enum is not used to form a bit mask. Going above 64 should work just fine.",
        "pr_file_module": null
      }
    ]
  }
]
