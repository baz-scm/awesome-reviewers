[
  {
    "discussion_id": "2466987030",
    "pr_number": 1071,
    "pr_file": "src/strands/multiagent/base.py",
    "created_at": "2025-10-27T20:26:51+00:00",
    "commented_code": "metrics = _parse_metrics(data.get(\"accumulated_metrics\", {}))\n \n         multiagent_result = cls(\n-            status=Status(data.get(\"status\", Status.PENDING.value)),\n+            status=Status(data.get(\"status\")),",
    "repo_full_name": "strands-agents/sdk-python",
    "discussion_comments": [
      {
        "comment_id": "2466987030",
        "repo_full_name": "strands-agents/sdk-python",
        "pr_number": 1071,
        "pr_file": "src/strands/multiagent/base.py",
        "discussion_id": "2466987030",
        "commented_code": "@@ -137,7 +137,7 @@ def from_dict(cls, data: dict[str, Any]) -> \"MultiAgentResult\":\n         metrics = _parse_metrics(data.get(\"accumulated_metrics\", {}))\n \n         multiagent_result = cls(\n-            status=Status(data.get(\"status\", Status.PENDING.value)),\n+            status=Status(data.get(\"status\")),",
        "comment_created_at": "2025-10-27T20:26:51+00:00",
        "comment_author": "pgrayy",
        "comment_body": "Nit: We should switch to `data[\"status\"]` so that we get a `KeyError` if not provided. Otherwise, we will end up with a `None` value not supported error when trying to initialize `Status`.",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2421677431",
    "pr_number": 997,
    "pr_file": "src/strands/telemetry/tracer.py",
    "created_at": "2025-10-10T18:42:57+00:00",
    "commented_code": "for key, value in attributes.items():\n             span.set_attribute(key, value)\n \n+    def _add_optional_usage_and_metrics_attributes(\n+        self, attributes: Dict[str, AttributeValue], usage: Usage, metrics: Metrics\n+    ) -> None:\n+        \"\"\"Add optional usage and metrics attributes if they have values.\n+\n+        Args:\n+            attributes: Dictionary to add attributes to\n+            usage: Token usage information from the model call\n+            metrics: Metrics from the model call\n+        \"\"\"\n+        if usage.get(\"cacheReadInputTokens\", 0) > 0:",
    "repo_full_name": "strands-agents/sdk-python",
    "discussion_comments": [
      {
        "comment_id": "2421677431",
        "repo_full_name": "strands-agents/sdk-python",
        "pr_number": 997,
        "pr_file": "src/strands/telemetry/tracer.py",
        "discussion_id": "2421677431",
        "commented_code": "@@ -153,6 +153,28 @@ def _set_attributes(self, span: Span, attributes: Dict[str, AttributeValue]) ->\n         for key, value in attributes.items():\n             span.set_attribute(key, value)\n \n+    def _add_optional_usage_and_metrics_attributes(\n+        self, attributes: Dict[str, AttributeValue], usage: Usage, metrics: Metrics\n+    ) -> None:\n+        \"\"\"Add optional usage and metrics attributes if they have values.\n+\n+        Args:\n+            attributes: Dictionary to add attributes to\n+            usage: Token usage information from the model call\n+            metrics: Metrics from the model call\n+        \"\"\"\n+        if usage.get(\"cacheReadInputTokens\", 0) > 0:",
        "comment_created_at": "2025-10-10T18:42:57+00:00",
        "comment_author": "Unshure",
        "comment_body": "Why is this `> 0`? Shouldnt we just check if it exists or not? \r\n```suggestion\r\n        if usage.get(\"cacheReadInputTokens\", None) != None:\r\n```",
        "pr_file_module": null
      },
      {
        "comment_id": "2422042656",
        "repo_full_name": "strands-agents/sdk-python",
        "pr_number": 997,
        "pr_file": "src/strands/telemetry/tracer.py",
        "discussion_id": "2421677431",
        "commented_code": "@@ -153,6 +153,28 @@ def _set_attributes(self, span: Span, attributes: Dict[str, AttributeValue]) ->\n         for key, value in attributes.items():\n             span.set_attribute(key, value)\n \n+    def _add_optional_usage_and_metrics_attributes(\n+        self, attributes: Dict[str, AttributeValue], usage: Usage, metrics: Metrics\n+    ) -> None:\n+        \"\"\"Add optional usage and metrics attributes if they have values.\n+\n+        Args:\n+            attributes: Dictionary to add attributes to\n+            usage: Token usage information from the model call\n+            metrics: Metrics from the model call\n+        \"\"\"\n+        if usage.get(\"cacheReadInputTokens\", 0) > 0:",
        "comment_created_at": "2025-10-10T20:40:01+00:00",
        "comment_author": "poshinchen",
        "comment_body": "I'll use ` if \"cacheReadInputTokens\" in usage`.",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2445979282",
    "pr_number": 900,
    "pr_file": "src/strands/session/session_manager.py",
    "created_at": "2025-10-20T19:58:56+00:00",
    "commented_code": "for an agent, and should be persisted in the session.\n     \"\"\"\n \n+    def __init__(self, session_type: SessionType = SessionType.AGENT) -> None:\n+        \"\"\"Initialize SessionManager with session type.\n+\n+        Args:\n+            session_type: Type of session (AGENT or MULTI_AGENT)\n+        \"\"\"\n+        self.session_type: SessionType = session_type\n+        self._lock = threading.RLock()\n+\n     def register_hooks(self, registry: HookRegistry, **kwargs: Any) -> None:\n         \"\"\"Register hooks for persisting the agent to the session.\"\"\"\n-        # After the normal Agent initialization behavior, call the session initialize function to restore the agent\n-        registry.add_callback(AgentInitializedEvent, lambda event: self.initialize(event.agent))\n+        if self.session_type == SessionType.AGENT:",
    "repo_full_name": "strands-agents/sdk-python",
    "discussion_comments": [
      {
        "comment_id": "2445979282",
        "repo_full_name": "strands-agents/sdk-python",
        "pr_number": 900,
        "pr_file": "src/strands/session/session_manager.py",
        "discussion_id": "2445979282",
        "commented_code": "@@ -20,19 +31,36 @@ class SessionManager(HookProvider, ABC):\n     for an agent, and should be persisted in the session.\n     \"\"\"\n \n+    def __init__(self, session_type: SessionType = SessionType.AGENT) -> None:\n+        \"\"\"Initialize SessionManager with session type.\n+\n+        Args:\n+            session_type: Type of session (AGENT or MULTI_AGENT)\n+        \"\"\"\n+        self.session_type: SessionType = session_type\n+        self._lock = threading.RLock()\n+\n     def register_hooks(self, registry: HookRegistry, **kwargs: Any) -> None:\n         \"\"\"Register hooks for persisting the agent to the session.\"\"\"\n-        # After the normal Agent initialization behavior, call the session initialize function to restore the agent\n-        registry.add_callback(AgentInitializedEvent, lambda event: self.initialize(event.agent))\n+        if self.session_type == SessionType.AGENT:",
        "comment_created_at": "2025-10-20T19:58:56+00:00",
        "comment_author": "pgrayy",
        "comment_body": "Since customers can derive their own session managers and consequently override the init, it seems like you have to add the following:\r\n```Python\r\nif not hasattr(self, \"session_type\"):\r\n    self.session_type = SessionType.AGENT\r\n```",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2534824565",
    "pr_number": 1187,
    "pr_file": "src/strands/event_loop/streaming.py",
    "created_at": "2025-11-17T16:49:56+00:00",
    "commented_code": "Returns:\n         The extracted usage metrics and latency.\n     \"\"\"\n-    usage = Usage(**event[\"usage\"])\n-    metrics = Metrics(**event[\"metrics\"])\n+    # MetadataEvent has total=False, making all fields optional, but Usage and Metrics types\n+    # have Required fields. Provide defaults to handle cases where custom models don't\n+    # provide usage/metrics (e.g., when latency info is unavailable).\n+    usage = Usage(**{\"inputTokens\": 0, \"outputTokens\": 0, \"totalTokens\": 0, **event.get(\"usage\", {})})",
    "repo_full_name": "strands-agents/sdk-python",
    "discussion_comments": [
      {
        "comment_id": "2534824565",
        "repo_full_name": "strands-agents/sdk-python",
        "pr_number": 1187,
        "pr_file": "src/strands/event_loop/streaming.py",
        "discussion_id": "2534824565",
        "commented_code": "@@ -350,8 +350,11 @@ def extract_usage_metrics(event: MetadataEvent, time_to_first_byte_ms: int | Non\n     Returns:\n         The extracted usage metrics and latency.\n     \"\"\"\n-    usage = Usage(**event[\"usage\"])\n-    metrics = Metrics(**event[\"metrics\"])\n+    # MetadataEvent has total=False, making all fields optional, but Usage and Metrics types\n+    # have Required fields. Provide defaults to handle cases where custom models don't\n+    # provide usage/metrics (e.g., when latency info is unavailable).\n+    usage = Usage(**{\"inputTokens\": 0, \"outputTokens\": 0, \"totalTokens\": 0, **event.get(\"usage\", {})})",
        "comment_created_at": "2025-11-17T16:49:56+00:00",
        "comment_author": "zastrowm",
        "comment_body": "And this doesn't throw if there are duplicates?  (I presume not given that the UTs would fail in that case - at least I hope so)",
        "pr_file_module": null
      },
      {
        "comment_id": "2534839200",
        "repo_full_name": "strands-agents/sdk-python",
        "pr_number": 1187,
        "pr_file": "src/strands/event_loop/streaming.py",
        "discussion_id": "2534824565",
        "commented_code": "@@ -350,8 +350,11 @@ def extract_usage_metrics(event: MetadataEvent, time_to_first_byte_ms: int | Non\n     Returns:\n         The extracted usage metrics and latency.\n     \"\"\"\n-    usage = Usage(**event[\"usage\"])\n-    metrics = Metrics(**event[\"metrics\"])\n+    # MetadataEvent has total=False, making all fields optional, but Usage and Metrics types\n+    # have Required fields. Provide defaults to handle cases where custom models don't\n+    # provide usage/metrics (e.g., when latency info is unavailable).\n+    usage = Usage(**{\"inputTokens\": 0, \"outputTokens\": 0, \"totalTokens\": 0, **event.get(\"usage\", {})})",
        "comment_created_at": "2025-11-17T16:54:07+00:00",
        "comment_author": "dbschmigelski",
        "comment_body": "It would if we did\r\n\r\n`Usage(**{\"inputTokens\": 0, \"outputTokens\": 0, \"totalTokens\": 0}, **event.get(\"usage\", {}))`\r\n\r\nbut because its all in the single bracket it should override",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2180107547",
    "pr_number": 302,
    "pr_file": "src/strands/session/agent_session_manager.py",
    "created_at": "2025-07-02T13:44:45+00:00",
    "commented_code": "+\"\"\"File-based implementation of session manager.\"\"\"\n+\n+import logging\n+from typing import TYPE_CHECKING, Any, Optional\n+\n+from ..agent.state import AgentState\n+from ..handlers.callback_handler import CompositeCallbackHandler\n+from ..types.content import Message\n+from .exceptions import SessionException\n+from .file_session_dao import FileSessionDAO\n+from .session_dao import SessionDAO\n+from .session_manager import SessionManager\n+from .session_models import Session, SessionAgent, SessionMessage, SessionType\n+\n+logger = logging.getLogger(__name__)\n+\n+if TYPE_CHECKING:\n+    from ..agent.agent import Agent\n+\n+\n+class AgentSessionManager(SessionManager):\n+    \"\"\"Session manager for a single Agent.\n+\n+    This implementation stores sessions as JSON files in a specified directory.\n+    Each session is stored in a separate file named by its session_id.\n+    \"\"\"\n+\n+    def __init__(\n+        self,\n+        session_id: str,\n+        session_dao: Optional[SessionDAO] = None,\n+    ):\n+        \"\"\"Initialize the FileSessionManager.\"\"\"\n+        self.session_dao = session_dao or FileSessionDAO()\n+        self.session_id = session_id\n+\n+    def append_message_to_agent_session(self, agent: \"Agent\", message: Message) -> None:\n+        \"\"\"Append a message to the agent's session.\n+\n+        Args:\n+            agent: The agent whose session to update\n+            message: The message to append\n+        \"\"\"\n+        if agent.id is None:",
    "repo_full_name": "strands-agents/sdk-python",
    "discussion_comments": [
      {
        "comment_id": "2180107547",
        "repo_full_name": "strands-agents/sdk-python",
        "pr_number": 302,
        "pr_file": "src/strands/session/agent_session_manager.py",
        "discussion_id": "2180107547",
        "commented_code": "@@ -0,0 +1,117 @@\n+\"\"\"File-based implementation of session manager.\"\"\"\n+\n+import logging\n+from typing import TYPE_CHECKING, Any, Optional\n+\n+from ..agent.state import AgentState\n+from ..handlers.callback_handler import CompositeCallbackHandler\n+from ..types.content import Message\n+from .exceptions import SessionException\n+from .file_session_dao import FileSessionDAO\n+from .session_dao import SessionDAO\n+from .session_manager import SessionManager\n+from .session_models import Session, SessionAgent, SessionMessage, SessionType\n+\n+logger = logging.getLogger(__name__)\n+\n+if TYPE_CHECKING:\n+    from ..agent.agent import Agent\n+\n+\n+class AgentSessionManager(SessionManager):\n+    \"\"\"Session manager for a single Agent.\n+\n+    This implementation stores sessions as JSON files in a specified directory.\n+    Each session is stored in a separate file named by its session_id.\n+    \"\"\"\n+\n+    def __init__(\n+        self,\n+        session_id: str,\n+        session_dao: Optional[SessionDAO] = None,\n+    ):\n+        \"\"\"Initialize the FileSessionManager.\"\"\"\n+        self.session_dao = session_dao or FileSessionDAO()\n+        self.session_id = session_id\n+\n+    def append_message_to_agent_session(self, agent: \"Agent\", message: Message) -> None:\n+        \"\"\"Append a message to the agent's session.\n+\n+        Args:\n+            agent: The agent whose session to update\n+            message: The message to append\n+        \"\"\"\n+        if agent.id is None:",
        "comment_created_at": "2025-07-02T13:44:45+00:00",
        "comment_author": "zastrowm",
        "comment_body": "I wonder if we should just default a value (like \"default\")\r\n\r\nMy concern is that someone just trying to persist a single agent now needs to add both the session_manager and set an id.  So someone persisting a personal agent now has more steps?\r\n\r\nNot a blocker though",
        "pr_file_module": null
      },
      {
        "comment_id": "2180937960",
        "repo_full_name": "strands-agents/sdk-python",
        "pr_number": 302,
        "pr_file": "src/strands/session/agent_session_manager.py",
        "discussion_id": "2180107547",
        "commented_code": "@@ -0,0 +1,117 @@\n+\"\"\"File-based implementation of session manager.\"\"\"\n+\n+import logging\n+from typing import TYPE_CHECKING, Any, Optional\n+\n+from ..agent.state import AgentState\n+from ..handlers.callback_handler import CompositeCallbackHandler\n+from ..types.content import Message\n+from .exceptions import SessionException\n+from .file_session_dao import FileSessionDAO\n+from .session_dao import SessionDAO\n+from .session_manager import SessionManager\n+from .session_models import Session, SessionAgent, SessionMessage, SessionType\n+\n+logger = logging.getLogger(__name__)\n+\n+if TYPE_CHECKING:\n+    from ..agent.agent import Agent\n+\n+\n+class AgentSessionManager(SessionManager):\n+    \"\"\"Session manager for a single Agent.\n+\n+    This implementation stores sessions as JSON files in a specified directory.\n+    Each session is stored in a separate file named by its session_id.\n+    \"\"\"\n+\n+    def __init__(\n+        self,\n+        session_id: str,\n+        session_dao: Optional[SessionDAO] = None,\n+    ):\n+        \"\"\"Initialize the FileSessionManager.\"\"\"\n+        self.session_dao = session_dao or FileSessionDAO()\n+        self.session_id = session_id\n+\n+    def append_message_to_agent_session(self, agent: \"Agent\", message: Message) -> None:\n+        \"\"\"Append a message to the agent's session.\n+\n+        Args:\n+            agent: The agent whose session to update\n+            message: The message to append\n+        \"\"\"\n+        if agent.id is None:",
        "comment_created_at": "2025-07-02T20:43:47+00:00",
        "comment_author": "Unshure",
        "comment_body": "I guess this would work by checking if there is only one agent in the session, that agent is given a generated id. Then when it is re-initialized, the id will be set? I like that",
        "pr_file_module": null
      },
      {
        "comment_id": "2181087088",
        "repo_full_name": "strands-agents/sdk-python",
        "pr_number": 302,
        "pr_file": "src/strands/session/agent_session_manager.py",
        "discussion_id": "2180107547",
        "commented_code": "@@ -0,0 +1,117 @@\n+\"\"\"File-based implementation of session manager.\"\"\"\n+\n+import logging\n+from typing import TYPE_CHECKING, Any, Optional\n+\n+from ..agent.state import AgentState\n+from ..handlers.callback_handler import CompositeCallbackHandler\n+from ..types.content import Message\n+from .exceptions import SessionException\n+from .file_session_dao import FileSessionDAO\n+from .session_dao import SessionDAO\n+from .session_manager import SessionManager\n+from .session_models import Session, SessionAgent, SessionMessage, SessionType\n+\n+logger = logging.getLogger(__name__)\n+\n+if TYPE_CHECKING:\n+    from ..agent.agent import Agent\n+\n+\n+class AgentSessionManager(SessionManager):\n+    \"\"\"Session manager for a single Agent.\n+\n+    This implementation stores sessions as JSON files in a specified directory.\n+    Each session is stored in a separate file named by its session_id.\n+    \"\"\"\n+\n+    def __init__(\n+        self,\n+        session_id: str,\n+        session_dao: Optional[SessionDAO] = None,\n+    ):\n+        \"\"\"Initialize the FileSessionManager.\"\"\"\n+        self.session_dao = session_dao or FileSessionDAO()\n+        self.session_id = session_id\n+\n+    def append_message_to_agent_session(self, agent: \"Agent\", message: Message) -> None:\n+        \"\"\"Append a message to the agent's session.\n+\n+        Args:\n+            agent: The agent whose session to update\n+            message: The message to append\n+        \"\"\"\n+        if agent.id is None:",
        "comment_created_at": "2025-07-02T22:28:16+00:00",
        "comment_author": "zastrowm",
        "comment_body": "\ud83d\udc4d \r\n\r\noh, that's better than what I was thinking, because I didn't handle the edge case of \"you have multiple sessions on file but the agent has no id set\"",
        "pr_file_module": null
      }
    ]
  }
]