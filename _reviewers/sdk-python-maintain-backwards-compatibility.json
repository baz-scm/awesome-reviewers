[
  {
    "discussion_id": "2466829858",
    "pr_number": 582,
    "pr_file": "src/strands/models/litellm.py",
    "created_at": "2025-10-27T19:25:25+00:00",
    "commented_code": "return chunks, data_type\n \n+    @override\n+    @classmethod\n+    def format_request_tool_message(cls, tool_result: ToolResult) -> dict[str, Any]:\n+        \"\"\"Format a LiteLLM compatible tool message.\n+\n+        Args:\n+            tool_result: Tool result collected from a tool execution.\n+\n+        Returns:\n+            LiteLLM compatible tool message with plain string content.\n+        \"\"\"\n+        contents = cast(\n+            list[ContentBlock],\n+            [\n+                {\"text\": json.dumps(content[\"json\"])} if \"json\" in content else content\n+                for content in tool_result[\"content\"]\n+            ],\n+        )\n+\n+        # Extract plain text content for LiteLLM/OpenRouter compatibility\n+        content_text = \"\"\n+        if contents:\n+            if \"text\" in contents[0]:\n+                content_text = contents[0][\"text\"]\n+            elif \"json\" in contents[0]:\n+                content_text = json.dumps(contents[0][\"json\"])\n+\n+        return {\n+            \"role\": \"tool\",\n+            \"tool_call_id\": tool_result[\"toolUseId\"],\n+            \"content\": content_text,  # Plain string instead of content blocks\n+        }",
    "repo_full_name": "strands-agents/sdk-python",
    "discussion_comments": [
      {
        "comment_id": "2466829858",
        "repo_full_name": "strands-agents/sdk-python",
        "pr_number": 582,
        "pr_file": "src/strands/models/litellm.py",
        "discussion_id": "2466829858",
        "commented_code": "@@ -131,6 +131,93 @@ def _stream_switch_content(self, data_type: str, prev_data_type: str | None) ->\n \n         return chunks, data_type\n \n+    @override\n+    @classmethod\n+    def format_request_tool_message(cls, tool_result: ToolResult) -> dict[str, Any]:\n+        \"\"\"Format a LiteLLM compatible tool message.\n+\n+        Args:\n+            tool_result: Tool result collected from a tool execution.\n+\n+        Returns:\n+            LiteLLM compatible tool message with plain string content.\n+        \"\"\"\n+        contents = cast(\n+            list[ContentBlock],\n+            [\n+                {\"text\": json.dumps(content[\"json\"])} if \"json\" in content else content\n+                for content in tool_result[\"content\"]\n+            ],\n+        )\n+\n+        # Extract plain text content for LiteLLM/OpenRouter compatibility\n+        content_text = \"\"\n+        if contents:\n+            if \"text\" in contents[0]:\n+                content_text = contents[0][\"text\"]\n+            elif \"json\" in contents[0]:\n+                content_text = json.dumps(contents[0][\"json\"])\n+\n+        return {\n+            \"role\": \"tool\",\n+            \"tool_call_id\": tool_result[\"toolUseId\"],\n+            \"content\": content_text,  # Plain string instead of content blocks\n+        }",
        "comment_created_at": "2025-10-27T19:25:25+00:00",
        "comment_author": "Unshure",
        "comment_body": "Wont this change the message format for all litellm tool messages, even the ones where the original format worked? Worried that this is going to break existing supported use cases",
        "pr_file_module": null
      },
      {
        "comment_id": "2469645434",
        "repo_full_name": "strands-agents/sdk-python",
        "pr_number": 582,
        "pr_file": "src/strands/models/litellm.py",
        "discussion_id": "2466829858",
        "commented_code": "@@ -131,6 +131,93 @@ def _stream_switch_content(self, data_type: str, prev_data_type: str | None) ->\n \n         return chunks, data_type\n \n+    @override\n+    @classmethod\n+    def format_request_tool_message(cls, tool_result: ToolResult) -> dict[str, Any]:\n+        \"\"\"Format a LiteLLM compatible tool message.\n+\n+        Args:\n+            tool_result: Tool result collected from a tool execution.\n+\n+        Returns:\n+            LiteLLM compatible tool message with plain string content.\n+        \"\"\"\n+        contents = cast(\n+            list[ContentBlock],\n+            [\n+                {\"text\": json.dumps(content[\"json\"])} if \"json\" in content else content\n+                for content in tool_result[\"content\"]\n+            ],\n+        )\n+\n+        # Extract plain text content for LiteLLM/OpenRouter compatibility\n+        content_text = \"\"\n+        if contents:\n+            if \"text\" in contents[0]:\n+                content_text = contents[0][\"text\"]\n+            elif \"json\" in contents[0]:\n+                content_text = json.dumps(contents[0][\"json\"])\n+\n+        return {\n+            \"role\": \"tool\",\n+            \"tool_call_id\": tool_result[\"toolUseId\"],\n+            \"content\": content_text,  # Plain string instead of content blocks\n+        }",
        "comment_created_at": "2025-10-28T13:46:40+00:00",
        "comment_author": "dbschmigelski",
        "comment_body": "^ Exactly, it seems we need some conditioning logic, which will be challenging when it comes to proxy servers where the model isn't known.\n\nAlso, like @Unshure said this is definitely breaking. [ToolResult](https://github.com/strands-agents/sdk-python/blob/49e432deafa77b62459735834db300c4dea154cf/src/strands/types/tools.py#L99) returns `content: list[ToolResultContent]`. In the OpenAIModel we process all. In the proposed change we are simply dropping all content after the first item in the list (`if \"text\" in contents[0]`)",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2482472054",
    "pr_number": 1119,
    "pr_file": "src/strands/hooks/registry.py",
    "created_at": "2025-10-31T19:28:29+00:00",
    "commented_code": "\"\"\"\n         hook.register_hooks(self)\n \n-    def invoke_callbacks(self, event: TInvokeEvent) -> tuple[TInvokeEvent, list[Interrupt]]:\n+    async def invoke_callbacks(self, event: TInvokeEvent) -> tuple[TInvokeEvent, list[Interrupt]]:",
    "repo_full_name": "strands-agents/sdk-python",
    "discussion_comments": [
      {
        "comment_id": "2482472054",
        "repo_full_name": "strands-agents/sdk-python",
        "pr_number": 1119,
        "pr_file": "src/strands/hooks/registry.py",
        "discussion_id": "2482472054",
        "commented_code": "@@ -189,7 +208,7 @@ def register_hooks(self, registry: HookRegistry):\n         \"\"\"\n         hook.register_hooks(self)\n \n-    def invoke_callbacks(self, event: TInvokeEvent) -> tuple[TInvokeEvent, list[Interrupt]]:\n+    async def invoke_callbacks(self, event: TInvokeEvent) -> tuple[TInvokeEvent, list[Interrupt]]:",
        "comment_created_at": "2025-10-31T19:28:29+00:00",
        "comment_author": "pgrayy",
        "comment_body": "I know this is presented as a public method but unless I am mistaken, `invoke_callbacks` should only be operated internally on behalf of customers. I don't think they have a reason to call `invoke_callbacks` directly themselves. Based on that assumption, I went ahead and made this async.",
        "pr_file_module": null
      },
      {
        "comment_id": "2483033905",
        "repo_full_name": "strands-agents/sdk-python",
        "pr_number": 1119,
        "pr_file": "src/strands/hooks/registry.py",
        "discussion_id": "2482472054",
        "commented_code": "@@ -189,7 +208,7 @@ def register_hooks(self, registry: HookRegistry):\n         \"\"\"\n         hook.register_hooks(self)\n \n-    def invoke_callbacks(self, event: TInvokeEvent) -> tuple[TInvokeEvent, list[Interrupt]]:\n+    async def invoke_callbacks(self, event: TInvokeEvent) -> tuple[TInvokeEvent, list[Interrupt]]:",
        "comment_created_at": "2025-11-01T01:28:17+00:00",
        "comment_author": "zastrowm",
        "comment_body": "> I know this is presented as a public method but unless I am mistaken, invoke_callbacks should only be operated internally on behalf of customers. \n\nIt's designed so that anyone can emit them.  My gut says that nobody is, but it is technically public.  For that reason I might instead lean towards adding invoke_callbacks_async and deprecating this one",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2478966460",
    "pr_number": 1112,
    "pr_file": "src/strands/models/bedrock.py",
    "created_at": "2025-10-30T17:36:06+00:00",
    "commented_code": "system_prompt: Optional[str] = None,\n         *,\n         tool_choice: ToolChoice | None = None,\n+        system_prompt_content: Optional[list[SystemContentBlock]] = None,",
    "repo_full_name": "strands-agents/sdk-python",
    "discussion_comments": [
      {
        "comment_id": "2478966460",
        "repo_full_name": "strands-agents/sdk-python",
        "pr_number": 1112,
        "pr_file": "src/strands/models/bedrock.py",
        "discussion_id": "2478966460",
        "commented_code": "@@ -590,6 +598,7 @@ async def stream(\n         system_prompt: Optional[str] = None,\n         *,\n         tool_choice: ToolChoice | None = None,\n+        system_prompt_content: Optional[list[SystemContentBlock]] = None,",
        "comment_created_at": "2025-10-30T17:36:06+00:00",
        "comment_author": "pgrayy",
        "comment_body": "It looks like we now ignore `system_prompt`. Technically speaking, `stream` is a public method that customers could call directly. This change will break those customers. Are we concerned about this? Should we use `system_prompt` to construct a single item `system_prompt_content` list if `system_prompt_content` is None?",
        "pr_file_module": null
      },
      {
        "comment_id": "2478996535",
        "repo_full_name": "strands-agents/sdk-python",
        "pr_number": 1112,
        "pr_file": "src/strands/models/bedrock.py",
        "discussion_id": "2478966460",
        "commented_code": "@@ -590,6 +598,7 @@ async def stream(\n         system_prompt: Optional[str] = None,\n         *,\n         tool_choice: ToolChoice | None = None,\n+        system_prompt_content: Optional[list[SystemContentBlock]] = None,",
        "comment_created_at": "2025-10-30T17:47:36+00:00",
        "comment_author": "dbschmigelski",
        "comment_body": "Oh you're saying if system_prompt is present but system_prompt_content is not, yeah customers could, I think this is one where the caller is from the Agent. But it takes very little to be defensive here, so sounds like a good change",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2467081582",
    "pr_number": 1071,
    "pr_file": "src/strands/session/session_repository.py",
    "created_at": "2025-10-27T21:01:49+00:00",
    "commented_code": "self, session_id: str, agent_id: str, limit: Optional[int] = None, offset: int = 0, **kwargs: Any\n     ) -> list[SessionMessage]:\n         \"\"\"List Messages from an Agent with pagination.\"\"\"\n+\n+    @abstractmethod",
    "repo_full_name": "strands-agents/sdk-python",
    "discussion_comments": [
      {
        "comment_id": "2467081582",
        "repo_full_name": "strands-agents/sdk-python",
        "pr_number": 1071,
        "pr_file": "src/strands/session/session_repository.py",
        "discussion_id": "2467081582",
        "commented_code": "@@ -49,3 +52,15 @@ def list_messages(\n         self, session_id: str, agent_id: str, limit: Optional[int] = None, offset: int = 0, **kwargs: Any\n     ) -> list[SessionMessage]:\n         \"\"\"List Messages from an Agent with pagination.\"\"\"\n+\n+    @abstractmethod",
        "comment_created_at": "2025-10-27T21:01:49+00:00",
        "comment_author": "pgrayy",
        "comment_body": "Using `@abstractmethod` will immediately break anyone who derives a custom `SessionRepository` even if they don't use multi-agents. We should instead use the `NotImplementedError` approach.",
        "pr_file_module": null
      },
      {
        "comment_id": "2467130455",
        "repo_full_name": "strands-agents/sdk-python",
        "pr_number": 1071,
        "pr_file": "src/strands/session/session_repository.py",
        "discussion_id": "2467081582",
        "commented_code": "@@ -49,3 +52,15 @@ def list_messages(\n         self, session_id: str, agent_id: str, limit: Optional[int] = None, offset: int = 0, **kwargs: Any\n     ) -> list[SessionMessage]:\n         \"\"\"List Messages from an Agent with pagination.\"\"\"\n+\n+    @abstractmethod",
        "comment_created_at": "2025-10-27T21:27:20+00:00",
        "comment_author": "JackYPCOnline",
        "comment_body": "If we want to introduce new interface it has to be non-breaking?",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2391778773",
    "pr_number": 943,
    "pr_file": "tests/strands/tools/test_structured_output.py",
    "created_at": "2025-09-30T14:28:36+00:00",
    "commented_code": "import pytest\n from pydantic import BaseModel, Field\n \n-from strands.tools.structured_output import convert_pydantic_to_tool_spec\n+from strands.tools.structured_output.structured_output_utils import convert_pydantic_to_tool_spec",
    "repo_full_name": "strands-agents/sdk-python",
    "discussion_comments": [
      {
        "comment_id": "2391778773",
        "repo_full_name": "strands-agents/sdk-python",
        "pr_number": 943,
        "pr_file": "tests/strands/tools/test_structured_output.py",
        "discussion_id": "2391778773",
        "commented_code": "@@ -3,7 +3,7 @@\n import pytest\n from pydantic import BaseModel, Field\n \n-from strands.tools.structured_output import convert_pydantic_to_tool_spec\n+from strands.tools.structured_output.structured_output_utils import convert_pydantic_to_tool_spec",
        "comment_created_at": "2025-09-30T14:28:36+00:00",
        "comment_author": "zastrowm",
        "comment_body": "I think this move would be a breaking change no?",
        "pr_file_module": null
      },
      {
        "comment_id": "2392848422",
        "repo_full_name": "strands-agents/sdk-python",
        "pr_number": 943,
        "pr_file": "tests/strands/tools/test_structured_output.py",
        "discussion_id": "2391778773",
        "commented_code": "@@ -3,7 +3,7 @@\n import pytest\n from pydantic import BaseModel, Field\n \n-from strands.tools.structured_output import convert_pydantic_to_tool_spec\n+from strands.tools.structured_output.structured_output_utils import convert_pydantic_to_tool_spec",
        "comment_created_at": "2025-09-30T21:13:27+00:00",
        "comment_author": "afarntrog",
        "comment_body": "hmmm. I't really an internal helper tool for the sdk (even though it's not prefixed with `_`). are concerned customers are using and will continue using the old import? ",
        "pr_file_module": null
      },
      {
        "comment_id": "2395359915",
        "repo_full_name": "strands-agents/sdk-python",
        "pr_number": 943,
        "pr_file": "tests/strands/tools/test_structured_output.py",
        "discussion_id": "2391778773",
        "commented_code": "@@ -3,7 +3,7 @@\n import pytest\n from pydantic import BaseModel, Field\n \n-from strands.tools.structured_output import convert_pydantic_to_tool_spec\n+from strands.tools.structured_output.structured_output_utils import convert_pydantic_to_tool_spec",
        "comment_created_at": "2025-10-01T17:42:58+00:00",
        "comment_author": "zastrowm",
        "comment_body": "In the past, anything that doesn't have _ we've maintained backwards compatibility for\n\nThus why everything should be private unless we have a reason to make it public",
        "pr_file_module": null
      },
      {
        "comment_id": "2406836430",
        "repo_full_name": "strands-agents/sdk-python",
        "pr_number": 943,
        "pr_file": "tests/strands/tools/test_structured_output.py",
        "discussion_id": "2391778773",
        "commented_code": "@@ -3,7 +3,7 @@\n import pytest\n from pydantic import BaseModel, Field\n \n-from strands.tools.structured_output import convert_pydantic_to_tool_spec\n+from strands.tools.structured_output.structured_output_utils import convert_pydantic_to_tool_spec",
        "comment_created_at": "2025-10-06T14:58:13+00:00",
        "comment_author": "afarntrog",
        "comment_body": "updated by adding it to the `__init__` so that we maintain the backwards compatible import \ud83d\ude80 ",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2392266662",
    "pr_number": 943,
    "pr_file": "src/strands/agent/agent.py",
    "created_at": "2025-09-30T16:58:22+00:00",
    "commented_code": "all_tools = self.tool_registry.get_all_tools_config()\n         return list(all_tools.keys())\n \n-    def __call__(self, prompt: AgentInput = None, **kwargs: Any) -> AgentResult:\n+    def __call__(\n+        self, prompt: AgentInput = None, structured_output_type: Optional[Type[BaseModel]] = None, **kwargs: Any",
    "repo_full_name": "strands-agents/sdk-python",
    "discussion_comments": [
      {
        "comment_id": "2392266662",
        "repo_full_name": "strands-agents/sdk-python",
        "pr_number": 943,
        "pr_file": "src/strands/agent/agent.py",
        "discussion_id": "2392266662",
        "commented_code": "@@ -374,7 +382,9 @@ def tool_names(self) -> list[str]:\n         all_tools = self.tool_registry.get_all_tools_config()\n         return list(all_tools.keys())\n \n-    def __call__(self, prompt: AgentInput = None, **kwargs: Any) -> AgentResult:\n+    def __call__(\n+        self, prompt: AgentInput = None, structured_output_type: Optional[Type[BaseModel]] = None, **kwargs: Any",
        "comment_created_at": "2025-09-30T16:58:22+00:00",
        "comment_author": "Unshure",
        "comment_body": "Chatted offline about this, but lets add support for invocation_state first before adding this new field: #919\n\nAlso, we need to include a `*` to ensure backwards compatibility\n\n```suggestion\n        self, prompt: AgentInput = None, *, structured_output_type:Type[BaseModel] | None = None, **kwargs: Any\n```",
        "pr_file_module": null
      },
      {
        "comment_id": "2406783599",
        "repo_full_name": "strands-agents/sdk-python",
        "pr_number": 943,
        "pr_file": "src/strands/agent/agent.py",
        "discussion_id": "2392266662",
        "commented_code": "@@ -374,7 +382,9 @@ def tool_names(self) -> list[str]:\n         all_tools = self.tool_registry.get_all_tools_config()\n         return list(all_tools.keys())\n \n-    def __call__(self, prompt: AgentInput = None, **kwargs: Any) -> AgentResult:\n+    def __call__(\n+        self, prompt: AgentInput = None, structured_output_type: Optional[Type[BaseModel]] = None, **kwargs: Any",
        "comment_created_at": "2025-10-06T14:49:34+00:00",
        "comment_author": "afarntrog",
        "comment_body": "https://github.com/strands-agents/sdk-python/pull/966",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2392267394",
    "pr_number": 943,
    "pr_file": "src/strands/agent/agent.py",
    "created_at": "2025-09-30T16:58:43+00:00",
    "commented_code": "- message: The final message from the model\n                 - metrics: Performance metrics from the event loop\n                 - state: The final state of the event loop\n+                - structured_output: Parsed structured output when structured_output_type was specified\n         \"\"\"\n \n         def execute() -> AgentResult:\n-            return asyncio.run(self.invoke_async(prompt, **kwargs))\n+            return asyncio.run(self.invoke_async(prompt, structured_output_type, **kwargs))\n \n         with ThreadPoolExecutor() as executor:\n             future = executor.submit(execute)\n             return future.result()\n \n-    async def invoke_async(self, prompt: AgentInput = None, **kwargs: Any) -> AgentResult:\n+    async def invoke_async(\n+        self, prompt: AgentInput = None, structured_output_type: Optional[Type[BaseModel]] = None, **kwargs: Any",
    "repo_full_name": "strands-agents/sdk-python",
    "discussion_comments": [
      {
        "comment_id": "2392267394",
        "repo_full_name": "strands-agents/sdk-python",
        "pr_number": 943,
        "pr_file": "src/strands/agent/agent.py",
        "discussion_id": "2392267394",
        "commented_code": "@@ -398,16 +409,19 @@ def __call__(self, prompt: AgentInput = None, **kwargs: Any) -> AgentResult:\n                 - message: The final message from the model\n                 - metrics: Performance metrics from the event loop\n                 - state: The final state of the event loop\n+                - structured_output: Parsed structured output when structured_output_type was specified\n         \"\"\"\n \n         def execute() -> AgentResult:\n-            return asyncio.run(self.invoke_async(prompt, **kwargs))\n+            return asyncio.run(self.invoke_async(prompt, structured_output_type, **kwargs))\n \n         with ThreadPoolExecutor() as executor:\n             future = executor.submit(execute)\n             return future.result()\n \n-    async def invoke_async(self, prompt: AgentInput = None, **kwargs: Any) -> AgentResult:\n+    async def invoke_async(\n+        self, prompt: AgentInput = None, structured_output_type: Optional[Type[BaseModel]] = None, **kwargs: Any",
        "comment_created_at": "2025-09-30T16:58:43+00:00",
        "comment_author": "Unshure",
        "comment_body": "```suggestion\n        self, prompt: AgentInput = None, *,  structured_output_type:Type[BaseModel] | None = None, **kwargs: Any\n```",
        "pr_file_module": null
      },
      {
        "comment_id": "2406782922",
        "repo_full_name": "strands-agents/sdk-python",
        "pr_number": 943,
        "pr_file": "src/strands/agent/agent.py",
        "discussion_id": "2392267394",
        "commented_code": "@@ -398,16 +409,19 @@ def __call__(self, prompt: AgentInput = None, **kwargs: Any) -> AgentResult:\n                 - message: The final message from the model\n                 - metrics: Performance metrics from the event loop\n                 - state: The final state of the event loop\n+                - structured_output: Parsed structured output when structured_output_type was specified\n         \"\"\"\n \n         def execute() -> AgentResult:\n-            return asyncio.run(self.invoke_async(prompt, **kwargs))\n+            return asyncio.run(self.invoke_async(prompt, structured_output_type, **kwargs))\n \n         with ThreadPoolExecutor() as executor:\n             future = executor.submit(execute)\n             return future.result()\n \n-    async def invoke_async(self, prompt: AgentInput = None, **kwargs: Any) -> AgentResult:\n+    async def invoke_async(\n+        self, prompt: AgentInput = None, structured_output_type: Optional[Type[BaseModel]] = None, **kwargs: Any",
        "comment_created_at": "2025-10-06T14:49:27+00:00",
        "comment_author": "afarntrog",
        "comment_body": "https://github.com/strands-agents/sdk-python/pull/966",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2310315758",
    "pr_number": 742,
    "pr_file": "src/strands/tools/loader.py",
    "created_at": "2025-08-29T14:23:36+00:00",
    "commented_code": "\"\"\"Handles loading of tools from different sources.\"\"\"\n \n     @staticmethod\n-    def load_python_tool(tool_path: str, tool_name: str) -> AgentTool:\n+    def load_python_tool(tool_path: str, tool_name: str) -> Union[AgentTool, List[AgentTool]]:",
    "repo_full_name": "strands-agents/sdk-python",
    "discussion_comments": [
      {
        "comment_id": "2310315758",
        "repo_full_name": "strands-agents/sdk-python",
        "pr_number": 742,
        "pr_file": "src/strands/tools/loader.py",
        "discussion_id": "2310315758",
        "commented_code": "@@ -18,15 +18,17 @@ class ToolLoader:\n     \"\"\"Handles loading of tools from different sources.\"\"\"\n \n     @staticmethod\n-    def load_python_tool(tool_path: str, tool_name: str) -> AgentTool:\n+    def load_python_tool(tool_path: str, tool_name: str) -> Union[AgentTool, List[AgentTool]]:",
        "comment_created_at": "2025-08-29T14:23:36+00:00",
        "comment_author": "zastrowm",
        "comment_body": "For backwards compatibility, we need to keep this signature as-is.\r\n\r\nLet's add a new method, `load_python_tools` that does what you're doing here but always turns an array.  Then `load_python_tool` can be updated to reference the new api, returning the first element in the array.  Let's then document that `load_python_tool` is deprecated and emit a warning if it's invoked.  We can then remove the method in 2.0",
        "pr_file_module": null
      }
    ]
  }
]