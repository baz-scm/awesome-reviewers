[
  {
    "discussion_id": "2447472638",
    "pr_number": 40056,
    "pr_file": "tests/wpt/meta/resize-observer/devicepixel2.html.ini",
    "created_at": "2025-10-21T09:27:47+00:00",
    "commented_code": "+[devicepixel2.html]\n+  expected: FAIL",
    "repo_full_name": "servo/servo",
    "discussion_comments": [
      {
        "comment_id": "2447472638",
        "repo_full_name": "servo/servo",
        "pr_number": 40056,
        "pr_file": "tests/wpt/meta/resize-observer/devicepixel2.html.ini",
        "discussion_id": "2447472638",
        "commented_code": "@@ -0,0 +1,2 @@\n+[devicepixel2.html]\n+  expected: FAIL",
        "comment_created_at": "2025-10-21T09:27:47+00:00",
        "comment_author": "simonwuelker",
        "comment_body": "This test should not have passed previously. We fail it because we don't do subpixel snapping when calculating the device-pixel-content-box yet.\r\n\r\nSee https://searchfox.org/firefox-main/rev/8e5d58cfed616cb90586c614e53d8ab1ffc8af27/dom/base/ResizeObserver.cpp#123-127 for reference.\r\n\r\nI'll file a follow up issue once this merges.",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2227407673",
    "pr_number": 38112,
    "pr_file": "tests/wpt/meta/encoding/streams/realms.window.js.ini",
    "created_at": "2025-07-24T05:43:37+00:00",
    "commented_code": "[TypeError for unconvertable chunk should come from constructor realm of TextEncoderStream]\n     expected: FAIL\n \n-  [a TextDecoderStream object should be associated with the realm the constructor came from]\n-    expected: FAIL\n-\n-  [TextDecoderStream's readable and writable attributes should come from the same realm as the constructor definition]\n-    expected: FAIL\n-\n-  [the result object when read is called after write should come from the same realm as the constructor of TextDecoderStream]\n-    expected: FAIL\n-\n-  [the result object when write is called with a pending read should come from the same realm as the constructor of TextDecoderStream]\n-    expected: FAIL\n-\n-  [TypeError for chunk with the wrong type should come from constructor realm of TextDecoderStream]\n-    expected: FAIL\n-\n   [TypeError for invalid chunk should come from constructor realm of TextDecoderStream]",
    "repo_full_name": "servo/servo",
    "discussion_comments": [
      {
        "comment_id": "2227407673",
        "repo_full_name": "servo/servo",
        "pr_number": 38112,
        "pr_file": "tests/wpt/meta/encoding/streams/realms.window.js.ini",
        "discussion_id": "2227407673",
        "commented_code": "@@ -14,23 +14,5 @@\n   [TypeError for unconvertable chunk should come from constructor realm of TextEncoderStream]\n     expected: FAIL\n \n-  [a TextDecoderStream object should be associated with the realm the constructor came from]\n-    expected: FAIL\n-\n-  [TextDecoderStream's readable and writable attributes should come from the same realm as the constructor definition]\n-    expected: FAIL\n-\n-  [the result object when read is called after write should come from the same realm as the constructor of TextDecoderStream]\n-    expected: FAIL\n-\n-  [the result object when write is called with a pending read should come from the same realm as the constructor of TextDecoderStream]\n-    expected: FAIL\n-\n-  [TypeError for chunk with the wrong type should come from constructor realm of TextDecoderStream]\n-    expected: FAIL\n-\n   [TypeError for invalid chunk should come from constructor realm of TextDecoderStream]",
        "comment_created_at": "2025-07-24T05:43:37+00:00",
        "comment_author": "minghuaw",
        "comment_body": "This is still failing because `encoding_rs::Decoder::decode_to_string_without_replacement` fails to return `DecoderResult::Malformed` with invalid input `[0xFF]`. This can be reproduced with this: https://play.rust-lang.org/?version=stable&mode=debug&edition=2024&gist=8225345ee8ffedee5a4b6ecd0161beb2",
        "pr_file_module": null
      },
      {
        "comment_id": "2227436774",
        "repo_full_name": "servo/servo",
        "pr_number": 38112,
        "pr_file": "tests/wpt/meta/encoding/streams/realms.window.js.ini",
        "discussion_id": "2227407673",
        "commented_code": "@@ -14,23 +14,5 @@\n   [TypeError for unconvertable chunk should come from constructor realm of TextEncoderStream]\n     expected: FAIL\n \n-  [a TextDecoderStream object should be associated with the realm the constructor came from]\n-    expected: FAIL\n-\n-  [TextDecoderStream's readable and writable attributes should come from the same realm as the constructor definition]\n-    expected: FAIL\n-\n-  [the result object when read is called after write should come from the same realm as the constructor of TextDecoderStream]\n-    expected: FAIL\n-\n-  [the result object when write is called with a pending read should come from the same realm as the constructor of TextDecoderStream]\n-    expected: FAIL\n-\n-  [TypeError for chunk with the wrong type should come from constructor realm of TextDecoderStream]\n-    expected: FAIL\n-\n   [TypeError for invalid chunk should come from constructor realm of TextDecoderStream]",
        "comment_created_at": "2025-07-24T05:51:22+00:00",
        "comment_author": "minghuaw",
        "comment_body": "Opened an issue in `encoding_rs` repo: https://github.com/hsivonen/encoding_rs/issues/122",
        "pr_file_module": null
      },
      {
        "comment_id": "2227452789",
        "repo_full_name": "servo/servo",
        "pr_number": 38112,
        "pr_file": "tests/wpt/meta/encoding/streams/realms.window.js.ini",
        "discussion_id": "2227407673",
        "commented_code": "@@ -14,23 +14,5 @@\n   [TypeError for unconvertable chunk should come from constructor realm of TextEncoderStream]\n     expected: FAIL\n \n-  [a TextDecoderStream object should be associated with the realm the constructor came from]\n-    expected: FAIL\n-\n-  [TextDecoderStream's readable and writable attributes should come from the same realm as the constructor definition]\n-    expected: FAIL\n-\n-  [the result object when read is called after write should come from the same realm as the constructor of TextDecoderStream]\n-    expected: FAIL\n-\n-  [the result object when write is called with a pending read should come from the same realm as the constructor of TextDecoderStream]\n-    expected: FAIL\n-\n-  [TypeError for chunk with the wrong type should come from constructor realm of TextDecoderStream]\n-    expected: FAIL\n-\n   [TypeError for invalid chunk should come from constructor realm of TextDecoderStream]",
        "comment_created_at": "2025-07-24T05:55:37+00:00",
        "comment_author": "minghuaw",
        "comment_body": "This might be just me using it wrong though because changing `last` to `true` would indeed give `Malformed`",
        "pr_file_module": null
      },
      {
        "comment_id": "2227498925",
        "repo_full_name": "servo/servo",
        "pr_number": 38112,
        "pr_file": "tests/wpt/meta/encoding/streams/realms.window.js.ini",
        "discussion_id": "2227407673",
        "commented_code": "@@ -14,23 +14,5 @@\n   [TypeError for unconvertable chunk should come from constructor realm of TextEncoderStream]\n     expected: FAIL\n \n-  [a TextDecoderStream object should be associated with the realm the constructor came from]\n-    expected: FAIL\n-\n-  [TextDecoderStream's readable and writable attributes should come from the same realm as the constructor definition]\n-    expected: FAIL\n-\n-  [the result object when read is called after write should come from the same realm as the constructor of TextDecoderStream]\n-    expected: FAIL\n-\n-  [the result object when write is called with a pending read should come from the same realm as the constructor of TextDecoderStream]\n-    expected: FAIL\n-\n-  [TypeError for chunk with the wrong type should come from constructor realm of TextDecoderStream]\n-    expected: FAIL\n-\n   [TypeError for invalid chunk should come from constructor realm of TextDecoderStream]",
        "comment_created_at": "2025-07-24T06:07:14+00:00",
        "comment_author": "minghuaw",
        "comment_body": "Actually, the problem is that when `last` is set to `false` (not flushing), the number of bytes read would actually include the malformed byte, so when it gets to flushing, ie. `last` is set to `true`, it sees an empty slice because the malformed bytes are already removed.",
        "pr_file_module": null
      },
      {
        "comment_id": "2228021924",
        "repo_full_name": "servo/servo",
        "pr_number": 38112,
        "pr_file": "tests/wpt/meta/encoding/streams/realms.window.js.ini",
        "discussion_id": "2227407673",
        "commented_code": "@@ -14,23 +14,5 @@\n   [TypeError for unconvertable chunk should come from constructor realm of TextEncoderStream]\n     expected: FAIL\n \n-  [a TextDecoderStream object should be associated with the realm the constructor came from]\n-    expected: FAIL\n-\n-  [TextDecoderStream's readable and writable attributes should come from the same realm as the constructor definition]\n-    expected: FAIL\n-\n-  [the result object when read is called after write should come from the same realm as the constructor of TextDecoderStream]\n-    expected: FAIL\n-\n-  [the result object when write is called with a pending read should come from the same realm as the constructor of TextDecoderStream]\n-    expected: FAIL\n-\n-  [TypeError for chunk with the wrong type should come from constructor realm of TextDecoderStream]\n-    expected: FAIL\n-\n   [TypeError for invalid chunk should come from constructor realm of TextDecoderStream]",
        "comment_created_at": "2025-07-24T09:45:44+00:00",
        "comment_author": "minghuaw",
        "comment_body": "It seems like that encoding_rs::Decoder only shows this problem when decoding an invalid input of length 1 with last set to false, which is exactly how the WPT test case is written",
        "pr_file_module": null
      },
      {
        "comment_id": "2229156147",
        "repo_full_name": "servo/servo",
        "pr_number": 38112,
        "pr_file": "tests/wpt/meta/encoding/streams/realms.window.js.ini",
        "discussion_id": "2227407673",
        "commented_code": "@@ -14,23 +14,5 @@\n   [TypeError for unconvertable chunk should come from constructor realm of TextEncoderStream]\n     expected: FAIL\n \n-  [a TextDecoderStream object should be associated with the realm the constructor came from]\n-    expected: FAIL\n-\n-  [TextDecoderStream's readable and writable attributes should come from the same realm as the constructor definition]\n-    expected: FAIL\n-\n-  [the result object when read is called after write should come from the same realm as the constructor of TextDecoderStream]\n-    expected: FAIL\n-\n-  [the result object when write is called with a pending read should come from the same realm as the constructor of TextDecoderStream]\n-    expected: FAIL\n-\n-  [TypeError for chunk with the wrong type should come from constructor realm of TextDecoderStream]\n-    expected: FAIL\n-\n   [TypeError for invalid chunk should come from constructor realm of TextDecoderStream]",
        "comment_created_at": "2025-07-24T17:43:03+00:00",
        "comment_author": "gterzian",
        "comment_body": "Good for a follow-up.",
        "pr_file_module": null
      },
      {
        "comment_id": "2229928491",
        "repo_full_name": "servo/servo",
        "pr_number": 38112,
        "pr_file": "tests/wpt/meta/encoding/streams/realms.window.js.ini",
        "discussion_id": "2227407673",
        "commented_code": "@@ -14,23 +14,5 @@\n   [TypeError for unconvertable chunk should come from constructor realm of TextEncoderStream]\n     expected: FAIL\n \n-  [a TextDecoderStream object should be associated with the realm the constructor came from]\n-    expected: FAIL\n-\n-  [TextDecoderStream's readable and writable attributes should come from the same realm as the constructor definition]\n-    expected: FAIL\n-\n-  [the result object when read is called after write should come from the same realm as the constructor of TextDecoderStream]\n-    expected: FAIL\n-\n-  [the result object when write is called with a pending read should come from the same realm as the constructor of TextDecoderStream]\n-    expected: FAIL\n-\n-  [TypeError for chunk with the wrong type should come from constructor realm of TextDecoderStream]\n-    expected: FAIL\n-\n   [TypeError for invalid chunk should come from constructor realm of TextDecoderStream]",
        "comment_created_at": "2025-07-25T01:27:29+00:00",
        "comment_author": "minghuaw",
        "comment_body": "Do we want an issue in Servo tracking this?",
        "pr_file_module": null
      },
      {
        "comment_id": "2230148507",
        "repo_full_name": "servo/servo",
        "pr_number": 38112,
        "pr_file": "tests/wpt/meta/encoding/streams/realms.window.js.ini",
        "discussion_id": "2227407673",
        "commented_code": "@@ -14,23 +14,5 @@\n   [TypeError for unconvertable chunk should come from constructor realm of TextEncoderStream]\n     expected: FAIL\n \n-  [a TextDecoderStream object should be associated with the realm the constructor came from]\n-    expected: FAIL\n-\n-  [TextDecoderStream's readable and writable attributes should come from the same realm as the constructor definition]\n-    expected: FAIL\n-\n-  [the result object when read is called after write should come from the same realm as the constructor of TextDecoderStream]\n-    expected: FAIL\n-\n-  [the result object when write is called with a pending read should come from the same realm as the constructor of TextDecoderStream]\n-    expected: FAIL\n-\n-  [TypeError for chunk with the wrong type should come from constructor realm of TextDecoderStream]\n-    expected: FAIL\n-\n   [TypeError for invalid chunk should come from constructor realm of TextDecoderStream]",
        "comment_created_at": "2025-07-25T05:07:05+00:00",
        "comment_author": "minghuaw",
        "comment_body": "Solved in [3039820](https://github.com/servo/servo/pull/38112/commits/3039820594ac47c14567459eb98d3bad2e5839f5)",
        "pr_file_module": null
      }
    ]
  }
]