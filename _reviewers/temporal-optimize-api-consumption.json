[
  {
    "discussion_id": "2057101066",
    "pr_number": 7638,
    "pr_file": ".github/workflows/trigger-publish.yml",
    "created_at": "2025-04-24T00:35:00+00:00",
    "commented_code": "REPO: ${{ toJSON('temporal') }}\n           BRANCH: ${{ toJSON(steps.get_branch.outputs.branch) }}\n         run: |\n+          # Dispatch the workflow",
    "repo_full_name": "temporalio/temporal",
    "discussion_comments": [
      {
        "comment_id": "2057101066",
        "repo_full_name": "temporalio/temporal",
        "pr_number": 7638,
        "pr_file": ".github/workflows/trigger-publish.yml",
        "discussion_id": "2057101066",
        "commented_code": "@@ -39,4 +39,30 @@ jobs:\n           REPO: ${{ toJSON('temporal') }}\n           BRANCH: ${{ toJSON(steps.get_branch.outputs.branch) }}\n         run: |\n+          # Dispatch the workflow",
        "comment_created_at": "2025-04-24T00:35:00+00:00",
        "comment_author": "dnr",
        "comment_body": "let's factor out:\r\n```\r\ncall() {\r\n  curl -fL -X POST -H \"Accept: application/vnd.github.v3+json\" -H \"Authorization: token $PAT\" \"$@\"\r\n}\r\n```\r\nthen use it like\r\n```\r\ncall \"https://api.github.com/repos/$PARENT_REPO/actions/workflows/$WORKFLOW_ID/dispatches\" -d '{\"ref\":'\"$PARENT_BRANCH\"', \"inputs\": { \"repo\":'\"$REPO\"', \"branch\":'\"$BRANCH\"' }}'\r\n```",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2057103390",
    "pr_number": 7638,
    "pr_file": ".github/workflows/trigger-publish.yml",
    "created_at": "2025-04-24T00:38:12+00:00",
    "commented_code": "REPO: ${{ toJSON('temporal') }}\n           BRANCH: ${{ toJSON(steps.get_branch.outputs.branch) }}\n         run: |\n+          # Dispatch the workflow\n           curl -fL -X POST -H \"Accept: application/vnd.github.v3+json\" -H \"Authorization: token $PAT\" \"https://api.github.com/repos/$PARENT_REPO/actions/workflows/$WORKFLOW_ID/dispatches\" -d '{\"ref\":'\"$PARENT_BRANCH\"', \"inputs\": { \"repo\":'\"$REPO\"', \"branch\":'\"$BRANCH\"' }}'\n+          \n+          # Wait a few seconds for the workflow to start\n+          sleep 10\n+          \n+          # Get the latest workflow run for this workflow\n+          run_id=$(curl -fL -H \"Accept: application/vnd.github.v3+json\" -H \"Authorization: token $PAT\" \"https://api.github.com/repos/$PARENT_REPO/actions/workflows/$WORKFLOW_ID/runs\" | jq -r '.workflow_runs[0].id')\n+          \n+          # Poll the workflow run status until it completes\n+          while true; do\n+            status=$(curl -fL -H \"Accept: application/vnd.github.v3+json\" -H \"Authorization: token $PAT\" \"https://api.github.com/repos/$PARENT_REPO/actions/runs/$run_id\" | jq -r '.status')\n+            conclusion=$(curl -fL -H \"Accept: application/vnd.github.v3+json\" -H \"Authorization: token $PAT\" \"https://api.github.com/repos/$PARENT_REPO/actions/runs/$run_id\" | jq -r '.conclusion')",
    "repo_full_name": "temporalio/temporal",
    "discussion_comments": [
      {
        "comment_id": "2057103390",
        "repo_full_name": "temporalio/temporal",
        "pr_number": 7638,
        "pr_file": ".github/workflows/trigger-publish.yml",
        "discussion_id": "2057103390",
        "commented_code": "@@ -39,4 +39,30 @@ jobs:\n           REPO: ${{ toJSON('temporal') }}\n           BRANCH: ${{ toJSON(steps.get_branch.outputs.branch) }}\n         run: |\n+          # Dispatch the workflow\n           curl -fL -X POST -H \"Accept: application/vnd.github.v3+json\" -H \"Authorization: token $PAT\" \"https://api.github.com/repos/$PARENT_REPO/actions/workflows/$WORKFLOW_ID/dispatches\" -d '{\"ref\":'\"$PARENT_BRANCH\"', \"inputs\": { \"repo\":'\"$REPO\"', \"branch\":'\"$BRANCH\"' }}'\n+          \n+          # Wait a few seconds for the workflow to start\n+          sleep 10\n+          \n+          # Get the latest workflow run for this workflow\n+          run_id=$(curl -fL -H \"Accept: application/vnd.github.v3+json\" -H \"Authorization: token $PAT\" \"https://api.github.com/repos/$PARENT_REPO/actions/workflows/$WORKFLOW_ID/runs\" | jq -r '.workflow_runs[0].id')\n+          \n+          # Poll the workflow run status until it completes\n+          while true; do\n+            status=$(curl -fL -H \"Accept: application/vnd.github.v3+json\" -H \"Authorization: token $PAT\" \"https://api.github.com/repos/$PARENT_REPO/actions/runs/$run_id\" | jq -r '.status')\n+            conclusion=$(curl -fL -H \"Accept: application/vnd.github.v3+json\" -H \"Authorization: token $PAT\" \"https://api.github.com/repos/$PARENT_REPO/actions/runs/$run_id\" | jq -r '.conclusion')",
        "comment_created_at": "2025-04-24T00:38:12+00:00",
        "comment_author": "dnr",
        "comment_body": "get both of these with one call, like\r\n```suggestion\r\n  result=$(call \"https://api.github.com/repos/$PARENT_REPO/actions/runs/$run_id\")\r\n  status=$(echo \"$result\" | jq -r .status)\r\n  conclusion=$(echo \"$result\" | jq -r .conclusion)\r\n```",
        "pr_file_module": null
      }
    ]
  }
]