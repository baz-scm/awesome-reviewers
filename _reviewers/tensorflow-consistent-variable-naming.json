[
  {
    "discussion_id": "1996540675",
    "pr_number": 89271,
    "pr_file": "tools/tf_env_collect.sh",
    "created_at": "2025-03-15T03:11:31+00:00",
    "commented_code": "echo \"Collecting system information...\"\n \n OUTPUT_FILE=tf_env.txt\n-python_bin_path=$(which python || which python3 || die \"Cannot find Python binary\")\n+PYTHON_BIN_PATH=\"$(which python || which python3 || die \"Cannot find Python binary\")\"",
    "repo_full_name": "tensorflow/tensorflow",
    "discussion_comments": [
      {
        "comment_id": "1996540675",
        "repo_full_name": "tensorflow/tensorflow",
        "pr_number": 89271,
        "pr_file": "tools/tf_env_collect.sh",
        "discussion_id": "1996540675",
        "commented_code": "@@ -29,14 +29,29 @@ die() {\n echo \"Collecting system information...\"\n \n OUTPUT_FILE=tf_env.txt\n-python_bin_path=$(which python || which python3 || die \"Cannot find Python binary\")\n+PYTHON_BIN_PATH=\"$(which python || which python3 || die \"Cannot find Python binary\")\"",
        "comment_created_at": "2025-03-15T03:11:31+00:00",
        "comment_author": "maludwig",
        "comment_body": "All the other variables were ALL_CAPS",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1996546793",
    "pr_number": 89271,
    "pr_file": "tools/tf_env_collect.sh",
    "created_at": "2025-03-15T03:30:11+00:00",
    "commented_code": "fi\n   \n   \n-  echo\n-  echo '== nvidia-smi ==================================================='\n+  print_header nvidia-smi\n   nvidia-smi 2>&1\n   \n-  echo\n-  echo '== cuda libs  ==================================================='\n-} >> ${OUTPUT_FILE}\n+  print_header 'cuda libs'\n \n-find /usr/local -type f -name 'libcudart*'  2>/dev/null | grep cuda |  grep -v \"\\\\.cache\" >> ${OUTPUT_FILE}\n-find /usr/local -type f -name 'libudnn*'  2>/dev/null | grep cuda |  grep -v \"\\\\.cache\" >> ${OUTPUT_FILE}\n+  # Find cudart/cudnn files\n+  find /usr -type f -name 'libcud*'  2>/dev/null | grep -E 'cuda.*(cudart|cudnn)' | grep -v -F '.cache'\n \n-{\n-  echo\n-  echo '== tensorflow installed from info =================='\n-  pip show tensorflow\n+  print_header 'tensorflow installation'\n+  if ! pip show tensorflow; then\n+    echo \"tensorflow not found\"\n+  fi\n \n-  echo\n-  echo '== python version  =============================================='\n+  print_header 'tf_nightly installation'\n+  if ! pip show tf_nightly; then\n+    echo \"tf_nightly not found\"\n+  fi\n+\n+  print_header 'python version'\n   echo '(major, minor, micro, releaselevel, serial)'\n-  python -c 'import sys; print(sys.version_info[:])'\n+  \"${PYTHON_BIN_PATH}\" -c 'import sys; print(sys.version_info[:])'",
    "repo_full_name": "tensorflow/tensorflow",
    "discussion_comments": [
      {
        "comment_id": "1996546793",
        "repo_full_name": "tensorflow/tensorflow",
        "pr_number": 89271,
        "pr_file": "tools/tf_env_collect.sh",
        "discussion_id": "1996546793",
        "commented_code": "@@ -142,35 +159,33 @@ LD_DEBUG=libs ${python_bin_path} -c \"import tensorflow\"  2>>${OUTPUT_FILE} > /tm\n   fi\n   \n   \n-  echo\n-  echo '== nvidia-smi ==================================================='\n+  print_header nvidia-smi\n   nvidia-smi 2>&1\n   \n-  echo\n-  echo '== cuda libs  ==================================================='\n-} >> ${OUTPUT_FILE}\n+  print_header 'cuda libs'\n \n-find /usr/local -type f -name 'libcudart*'  2>/dev/null | grep cuda |  grep -v \"\\\\.cache\" >> ${OUTPUT_FILE}\n-find /usr/local -type f -name 'libudnn*'  2>/dev/null | grep cuda |  grep -v \"\\\\.cache\" >> ${OUTPUT_FILE}\n+  # Find cudart/cudnn files\n+  find /usr -type f -name 'libcud*'  2>/dev/null | grep -E 'cuda.*(cudart|cudnn)' | grep -v -F '.cache'\n \n-{\n-  echo\n-  echo '== tensorflow installed from info =================='\n-  pip show tensorflow\n+  print_header 'tensorflow installation'\n+  if ! pip show tensorflow; then\n+    echo \"tensorflow not found\"\n+  fi\n \n-  echo\n-  echo '== python version  =============================================='\n+  print_header 'tf_nightly installation'\n+  if ! pip show tf_nightly; then\n+    echo \"tf_nightly not found\"\n+  fi\n+\n+  print_header 'python version'\n   echo '(major, minor, micro, releaselevel, serial)'\n-  python -c 'import sys; print(sys.version_info[:])'\n+  \"${PYTHON_BIN_PATH}\" -c 'import sys; print(sys.version_info[:])'",
        "comment_created_at": "2025-03-15T03:30:11+00:00",
        "comment_author": "maludwig",
        "comment_body": "I wasn't sure why we'd want this twice, but I figured I wouldn't touch it. Previously it was using \"python\" as opposed to PYTHON_BIN_PATH used by everything else. The double-quotes around the path ensure that if someone has python in a directory with a space, it's not all ruined.",
        "pr_file_module": null
      }
    ]
  }
]