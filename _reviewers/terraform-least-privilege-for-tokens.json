[
  {
    "discussion_id": "1191876737",
    "pr_number": 33173,
    "pr_file": ".github/workflows/release-promotion.yml",
    "created_at": "2023-05-12T03:45:20+00:00",
    "commented_code": "+name: Promote Release\n+\n+on:\n+  workflow_dispatch:\n+    inputs:\n+      environment:\n+        description: 'Environment'\n+        required: true\n+        type: choice\n+        options:\n+          - staging\n+          - production\n+      version:\n+        description: 'Product version'\n+        required: true\n+        type: string\n+      sha:\n+        description: 'SHA'\n+        required: true\n+        type: string\n+      branch:\n+        description: 'BRANCH'\n+        required: true\n+        type: string\n+\n+jobs:\n+  promote:\n+    name: \"Promote release\"\n+    runs-on: [self-hosted, linux]\n+    steps:\n+      - name: Setup bob\n+        uses: hashicorp/action-setup-bob@v1\n+        with:\n+          github-token:\n+            ${{ secrets.ELEVATED_GITHUB_TOKEN}}\n+      - name: Promote to ${{ inputs.environment }}\n+        env:\n+          BOB_GITHUB_TOKEN: ${{ secrets.ELEVATED_GITHUB_TOKEN }}\n+          VERSION: ${{ github.event.inputs.version }}\n+          SHA: ${{ github.event.inputs.sha }}\n+          BRANCH: ${{ github.event.inputs.branch }}\n+          ENVIRONMENT: ${{ github.event.inputs.environment }}\n+        run: |\n+          bob trigger-promotion \\",
    "repo_full_name": "hashicorp/terraform",
    "discussion_comments": [
      {
        "comment_id": "1191876737",
        "repo_full_name": "hashicorp/terraform",
        "pr_number": 33173,
        "pr_file": ".github/workflows/release-promotion.yml",
        "discussion_id": "1191876737",
        "commented_code": "@@ -0,0 +1,53 @@\n+name: Promote Release\n+\n+on:\n+  workflow_dispatch:\n+    inputs:\n+      environment:\n+        description: 'Environment'\n+        required: true\n+        type: choice\n+        options:\n+          - staging\n+          - production\n+      version:\n+        description: 'Product version'\n+        required: true\n+        type: string\n+      sha:\n+        description: 'SHA'\n+        required: true\n+        type: string\n+      branch:\n+        description: 'BRANCH'\n+        required: true\n+        type: string\n+\n+jobs:\n+  promote:\n+    name: \"Promote release\"\n+    runs-on: [self-hosted, linux]\n+    steps:\n+      - name: Setup bob\n+        uses: hashicorp/action-setup-bob@v1\n+        with:\n+          github-token:\n+            ${{ secrets.ELEVATED_GITHUB_TOKEN}}\n+      - name: Promote to ${{ inputs.environment }}\n+        env:\n+          BOB_GITHUB_TOKEN: ${{ secrets.ELEVATED_GITHUB_TOKEN }}\n+          VERSION: ${{ github.event.inputs.version }}\n+          SHA: ${{ github.event.inputs.sha }}\n+          BRANCH: ${{ github.event.inputs.branch }}\n+          ENVIRONMENT: ${{ github.event.inputs.environment }}\n+        run: |\n+          bob trigger-promotion \\",
        "comment_created_at": "2023-05-12T03:45:20+00:00",
        "comment_author": "radditude",
        "comment_body": "\ud83e\udd73 very excited for this! Last time we discussed it there were concerns around secrets management and having this workflow in a public repo - I assume that's not something we still need to worry about?",
        "pr_file_module": null
      },
      {
        "comment_id": "1192423005",
        "repo_full_name": "hashicorp/terraform",
        "pr_number": 33173,
        "pr_file": ".github/workflows/release-promotion.yml",
        "discussion_id": "1191876737",
        "commented_code": "@@ -0,0 +1,53 @@\n+name: Promote Release\n+\n+on:\n+  workflow_dispatch:\n+    inputs:\n+      environment:\n+        description: 'Environment'\n+        required: true\n+        type: choice\n+        options:\n+          - staging\n+          - production\n+      version:\n+        description: 'Product version'\n+        required: true\n+        type: string\n+      sha:\n+        description: 'SHA'\n+        required: true\n+        type: string\n+      branch:\n+        description: 'BRANCH'\n+        required: true\n+        type: string\n+\n+jobs:\n+  promote:\n+    name: \"Promote release\"\n+    runs-on: [self-hosted, linux]\n+    steps:\n+      - name: Setup bob\n+        uses: hashicorp/action-setup-bob@v1\n+        with:\n+          github-token:\n+            ${{ secrets.ELEVATED_GITHUB_TOKEN}}\n+      - name: Promote to ${{ inputs.environment }}\n+        env:\n+          BOB_GITHUB_TOKEN: ${{ secrets.ELEVATED_GITHUB_TOKEN }}\n+          VERSION: ${{ github.event.inputs.version }}\n+          SHA: ${{ github.event.inputs.sha }}\n+          BRANCH: ${{ github.event.inputs.branch }}\n+          ENVIRONMENT: ${{ github.event.inputs.environment }}\n+        run: |\n+          bob trigger-promotion \\",
        "comment_created_at": "2023-05-12T14:03:14+00:00",
        "comment_author": "sarahethompson",
        "comment_body": "I don't think this is a concern given that we can tightly control the token's permissions now by using fine grained tokens. I specified `secrets.ELEVATED_GITHUB_TOKEN` just as an example as I saw it existed in the repo. But we would want to generate a new finely grained token (as the terraform bot user) and give it access to the `hashicorp/crt-workflows-common` repo and add Actions (Read and write) as the only repo permissions. This would have to be done by someone on the Terraform team with access to log in as this user.",
        "pr_file_module": null
      }
    ]
  }
]