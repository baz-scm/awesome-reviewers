[
  {
    "discussion_id": "2135505377",
    "pr_number": 4671,
    "pr_file": "app2/src/lib/stores/banner.svelte.ts",
    "created_at": "2025-06-09T10:51:16+00:00",
    "commented_code": "+import type { FetchDecodeError } from \"$lib/utils/queries\"\n+import { Option } from \"effect\"\n+\n+export type BannerType = \"info\" | \"warning\" | \"error\"\n+\n+export type BannerConfig = {\n+  enabled: boolean\n+  type: BannerType\n+  message: string\n+}\n+\n+export type BannerData = {\n+  app: {\n+    banner: BannerConfig\n+  }\n+  btc: {\n+    banner: BannerConfig\n+  }\n+}\n+\n+class BannerStore {\n+  data: Option.Option<BannerData> = $state(Option.none())\n+  error: Option.Option<FetchDecodeError> = $state(Option.none())\n+\n+  // Get banner for specific edition\n+  getBannerForEdition(edition: \"app\" | \"btc\"): BannerConfig | null {",
    "repo_full_name": "unionlabs/union",
    "discussion_comments": [
      {
        "comment_id": "2135505377",
        "repo_full_name": "unionlabs/union",
        "pr_number": 4671,
        "pr_file": "app2/src/lib/stores/banner.svelte.ts",
        "discussion_id": "2135505377",
        "commented_code": "@@ -0,0 +1,34 @@\n+import type { FetchDecodeError } from \"$lib/utils/queries\"\n+import { Option } from \"effect\"\n+\n+export type BannerType = \"info\" | \"warning\" | \"error\"\n+\n+export type BannerConfig = {\n+  enabled: boolean\n+  type: BannerType\n+  message: string\n+}\n+\n+export type BannerData = {\n+  app: {\n+    banner: BannerConfig\n+  }\n+  btc: {\n+    banner: BannerConfig\n+  }\n+}\n+\n+class BannerStore {\n+  data: Option.Option<BannerData> = $state(Option.none())\n+  error: Option.Option<FetchDecodeError> = $state(Option.none())\n+\n+  // Get banner for specific edition\n+  getBannerForEdition(edition: \"app\" | \"btc\"): BannerConfig | null {",
        "comment_created_at": "2025-06-09T10:51:16+00:00",
        "comment_author": "cor",
        "comment_body": "this should return an option",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1991593702",
    "pr_number": 3981,
    "pr_file": "app2/src/lib/utils/convert-display.ts",
    "created_at": "2025-03-12T14:12:13+00:00",
    "commented_code": "+import { bech32 } from \"@scure/base\"\n+import { Schema } from \"effect\"\n+import { AddressAptosDisplay, AddressCosmosDisplay, AddressEvmDisplay } from \"$lib/schema/address\"\n+\n+/**\n+ * Convert a bech32 display address to canonical bytes\n+ */\n+export function cosmosDisplayToCanonical(displayAddress: string): Uint8Array {\n+  try {\n+    const decoded = bech32.decode(displayAddress as `${string}1${string}`)\n+    const canonicalAddress = bech32.fromWords(decoded.words)\n+    return new Uint8Array(canonicalAddress)\n+  } catch (error: any) {\n+    throw new Error(`Invalid Cosmos bech32 address: ${error.message}`)\n+  }\n+}\n+\n+/**\n+ * Convert an EVM display address (hex) to canonical bytes\n+ */\n+export function evmDisplayToCanonical(displayAddress: string): Uint8Array {\n+  // Validate EVM address format (0x + 40 hex characters)\n+  if (!/^0x[0-9a-fA-F]{40}$/.test(displayAddress)) {\n+    throw new Error(\"EVM address must be 0x followed by 40 hex characters\")\n+  }\n+\n+  // Remove 0x prefix and convert to bytes\n+  const hexWithoutPrefix = displayAddress.slice(2)\n+  const bytes = new Uint8Array(20)\n+\n+  for (let i = 0; i < 40; i += 2) {\n+    bytes[i / 2] = Number.parseInt(hexWithoutPrefix.substring(i, i + 2), 16)\n+  }\n+\n+  return bytes\n+}\n+\n+/**\n+ * Convert an Aptos display address (hex) to canonical bytes\n+ */\n+export function aptosDisplayToCanonical(displayAddress: string): Uint8Array {\n+  // Validate Aptos address format (0x + 64 hex characters)\n+  if (!/^0x[0-9a-fA-F]{64}$/.test(displayAddress)) {\n+    throw new Error(\"Aptos address must be 0x followed by 64 hex characters\")\n+  }\n+\n+  // Remove 0x prefix and convert to bytes",
    "repo_full_name": "unionlabs/union",
    "discussion_comments": [
      {
        "comment_id": "1991593702",
        "repo_full_name": "unionlabs/union",
        "pr_number": 3981,
        "pr_file": "app2/src/lib/utils/convert-display.ts",
        "discussion_id": "1991593702",
        "commented_code": "@@ -0,0 +1,137 @@\n+import { bech32 } from \"@scure/base\"\n+import { Schema } from \"effect\"\n+import { AddressAptosDisplay, AddressCosmosDisplay, AddressEvmDisplay } from \"$lib/schema/address\"\n+\n+/**\n+ * Convert a bech32 display address to canonical bytes\n+ */\n+export function cosmosDisplayToCanonical(displayAddress: string): Uint8Array {\n+  try {\n+    const decoded = bech32.decode(displayAddress as `${string}1${string}`)\n+    const canonicalAddress = bech32.fromWords(decoded.words)\n+    return new Uint8Array(canonicalAddress)\n+  } catch (error: any) {\n+    throw new Error(`Invalid Cosmos bech32 address: ${error.message}`)\n+  }\n+}\n+\n+/**\n+ * Convert an EVM display address (hex) to canonical bytes\n+ */\n+export function evmDisplayToCanonical(displayAddress: string): Uint8Array {\n+  // Validate EVM address format (0x + 40 hex characters)\n+  if (!/^0x[0-9a-fA-F]{40}$/.test(displayAddress)) {\n+    throw new Error(\"EVM address must be 0x followed by 40 hex characters\")\n+  }\n+\n+  // Remove 0x prefix and convert to bytes\n+  const hexWithoutPrefix = displayAddress.slice(2)\n+  const bytes = new Uint8Array(20)\n+\n+  for (let i = 0; i < 40; i += 2) {\n+    bytes[i / 2] = Number.parseInt(hexWithoutPrefix.substring(i, i + 2), 16)\n+  }\n+\n+  return bytes\n+}\n+\n+/**\n+ * Convert an Aptos display address (hex) to canonical bytes\n+ */\n+export function aptosDisplayToCanonical(displayAddress: string): Uint8Array {\n+  // Validate Aptos address format (0x + 64 hex characters)\n+  if (!/^0x[0-9a-fA-F]{64}$/.test(displayAddress)) {\n+    throw new Error(\"Aptos address must be 0x followed by 64 hex characters\")\n+  }\n+\n+  // Remove 0x prefix and convert to bytes",
        "comment_created_at": "2025-03-12T14:12:13+00:00",
        "comment_author": "cor",
        "comment_body": "for these functions, make the displayAddress inputs the appropiate displayaddress types: https://github.com/unionlabs/union/blob/main/app2/src/lib/schema/address.ts\r\n\r\nand the return type AddressCanonicalBytes. This prevents misuse (ie you put a cosmos display address into the aptos function). Once that is done, don't throw an error but return an `Option<T>`. It will in practice never be `None` unless we mess something up in our translation logic, because we have already ensured that the incoming displayAddress has the correct pattern for each of the variants as those regexes are encoded in the schema ",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1974025444",
    "pr_number": 3882,
    "pr_file": "app2/src/lib/wallet/aptos/config.svelte.ts",
    "created_at": "2025-02-27T17:19:31+00:00",
    "commented_code": "+import type { Hex } from \"viem\"\n+import { Option } from \"effect\"\n+\n+import type { AptosBrowserWallet } from \"@unionlabs/client\"\n+import { AddressAptosCanonical } from \"$lib/schema/address.ts\"\n+import { wallets } from \"$lib/stores/wallets.svelte.ts\"\n+\n+export const aptosWalletsInformation = (\n+  [\n+    // https://petra.app/docs\n+    {\n+      id: \"petra\",\n+      name: \"Petra\",\n+      icon: \"/images/icons/petra.svg\",\n+      download: \"https://petra.app\",\n+      deepLink: \"https://petra.app/explore?link=https://app.union.build\"\n+    },\n+    // https://docs.martianwallet.xyz/docs\n+    {\n+      id: \"martian\",\n+      name: \"Martian Wallet\",\n+      // could not find a good svg for martian\n+      icon: \"/images/icons/martian.png\",\n+      download: \"https://martianwallet.xyz/aptos-wallet\",\n+      deepLink: \"\"\n+    },\n+    // https://www.okx.com/web3/build/docs/sdks/chains/aptos/provider\n+    {\n+      id: \"okxwallet\",\n+      name: \"OKX Wallet\",\n+      icon: \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAJDSURBVHgB7Zq9jtpAEMfHlhEgQLiioXEkoAGECwoKxMcTRHmC5E3IoyRPkPAEkI7unJYmTgEFTYwA8a3NTKScLnCHN6c9r1e3P2llWQy7M/s1Gv1twCP0ej37dDq9x+Zut1t3t9vZjDEHIiSRSPg4ZpDL5fxkMvn1cDh8m0wmfugfO53OoFQq/crn8wxfY9EymQyrVCqMfHvScZx1p9ls3pFxXBy/bKlUipGPrVbLuQqAfsCliq3zl0H84zwtjQrOw4Mt1W63P5LvBm2d+Xz+YzqdgkqUy2WgWCy+Mc/nc282m4FqLBYL+3g8fjDxenq72WxANZbLJeA13zDX67UDioL5ybXwafMYu64Ltn3bdDweQ5R97fd7GyhBQMipx4POeEDHIu2LfDdBIGGz+hJ9CQ1ABjoA2egAZPM6AgiCAEQhsi/C4jHyPA/6/f5NG3Ks2+3CYDC4aTccDrn6ojG54MnEvG00GoVmWLIRNZ7wTCwDHYBsdACy0QHIhiuRETxlICWpMMhGZHmqS8qH6JLyGegAZKMDkI0uKf8X4SWlaZo+Pp1bRrwlJU8ZKLIvUjKh0WiQ3sRUbNVq9c5Ebew7KEo2m/1p4jJ4qAmDaqDQBzj5XyiAT4VCQezJigAU+IDU+z8vJFnGWeC+bKQV/5VZ71FV6L7PA3gg3tXrdQ+DgLhC+75Wq3no69P3MC0NFQpx2lL04Ql9gHK1bRDjsSBIvScBnDTk1WrlGIZBorIDEYJj+rhdgnQ67VmWRe0zlplXl81vcyEt0rSoYDUAAAAASUVORK5CYII=\",\n+      download: \"https://www.okx.com/download\",\n+      deepLink: `https://www.okx.com/download?deeplink=${encodeURIComponent(`okx://wallet/dapp/url?dappUrl=${encodeURIComponent(window.location.href)}`)}`\n+    }\n+  ] as const\n+)\n+  /**\n+   * Temporary filtering out reasons:\n+   *\n+   * `okxwallet` because it uses the deprecated payload API where\n+   * instead of `.signAndSubmitTransaction({ payload: ... })`, it uses `.signAndSubmitTransaction({ ... })`.\n+   * In our SDK we use the current, non-deprecated API.\n+   *\n+   * `martian` because it doesn't implement `.getNetwork()` and `.getAccount()` methods yet.\n+   * We will stop filtering them out once they use the new API.\n+   */\n+  .filter(wallet => ![\"okxwallet\", \"martian\"].includes(wallet.id))\n+\n+export type AptosWalletId = (typeof aptosWalletsInformation)[number][\"id\"]\n+\n+/**\n+ * TODO:\n+ * - check with Petra wallet team for proper `window.aptos` types\n+ */\n+\n+export function getAptosWallet(walletId: AptosWalletId = \"petra\") {\n+  // handle okx wallet special case since it's nested\n+  if (!window) return\n+  if (\n+    walletId === \"okxwallet\" &&\n+    Object.hasOwn(window, \"okxwallet\") &&\n+    Object.hasOwn(window.okxwallet, \"aptos\")\n+  ) {\n+    return window.okxwallet.aptos\n+  }\n+  if (Object.hasOwn(window, walletId)) return window[walletId] as AptosBrowserWallet\n+  if (Object.hasOwn(window, \"aptos\")) return window.aptos\n+\n+  window.open(\"https://petra.app/\", \"_blank\", \"noopener noreferrer\")\n+}\n+\n+class AptosStore {\n+  chain = $state(\"aptos\")\n+  address = $state<Hex | undefined>(undefined)",
    "repo_full_name": "unionlabs/union",
    "discussion_comments": [
      {
        "comment_id": "1974025444",
        "repo_full_name": "unionlabs/union",
        "pr_number": 3882,
        "pr_file": "app2/src/lib/wallet/aptos/config.svelte.ts",
        "discussion_id": "1974025444",
        "commented_code": "@@ -0,0 +1,193 @@\n+import type { Hex } from \"viem\"\n+import { Option } from \"effect\"\n+\n+import type { AptosBrowserWallet } from \"@unionlabs/client\"\n+import { AddressAptosCanonical } from \"$lib/schema/address.ts\"\n+import { wallets } from \"$lib/stores/wallets.svelte.ts\"\n+\n+export const aptosWalletsInformation = (\n+  [\n+    // https://petra.app/docs\n+    {\n+      id: \"petra\",\n+      name: \"Petra\",\n+      icon: \"/images/icons/petra.svg\",\n+      download: \"https://petra.app\",\n+      deepLink: \"https://petra.app/explore?link=https://app.union.build\"\n+    },\n+    // https://docs.martianwallet.xyz/docs\n+    {\n+      id: \"martian\",\n+      name: \"Martian Wallet\",\n+      // could not find a good svg for martian\n+      icon: \"/images/icons/martian.png\",\n+      download: \"https://martianwallet.xyz/aptos-wallet\",\n+      deepLink: \"\"\n+    },\n+    // https://www.okx.com/web3/build/docs/sdks/chains/aptos/provider\n+    {\n+      id: \"okxwallet\",\n+      name: \"OKX Wallet\",\n+      icon: \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAJDSURBVHgB7Zq9jtpAEMfHlhEgQLiioXEkoAGECwoKxMcTRHmC5E3IoyRPkPAEkI7unJYmTgEFTYwA8a3NTKScLnCHN6c9r1e3P2llWQy7M/s1Gv1twCP0ej37dDq9x+Zut1t3t9vZjDEHIiSRSPg4ZpDL5fxkMvn1cDh8m0wmfugfO53OoFQq/crn8wxfY9EymQyrVCqMfHvScZx1p9ls3pFxXBy/bKlUipGPrVbLuQqAfsCliq3zl0H84zwtjQrOw4Mt1W63P5LvBm2d+Xz+YzqdgkqUy2WgWCy+Mc/nc282m4FqLBYL+3g8fjDxenq72WxANZbLJeA13zDX67UDioL5ybXwafMYu64Ltn3bdDweQ5R97fd7GyhBQMipx4POeEDHIu2LfDdBIGGz+hJ9CQ1ABjoA2egAZPM6AgiCAEQhsi/C4jHyPA/6/f5NG3Ks2+3CYDC4aTccDrn6ojG54MnEvG00GoVmWLIRNZ7wTCwDHYBsdACy0QHIhiuRETxlICWpMMhGZHmqS8qH6JLyGegAZKMDkI0uKf8X4SWlaZo+Pp1bRrwlJU8ZKLIvUjKh0WiQ3sRUbNVq9c5Ebew7KEo2m/1p4jJ4qAmDaqDQBzj5XyiAT4VCQezJigAU+IDU+z8vJFnGWeC+bKQV/5VZ71FV6L7PA3gg3tXrdQ+DgLhC+75Wq3no69P3MC0NFQpx2lL04Ql9gHK1bRDjsSBIvScBnDTk1WrlGIZBorIDEYJj+rhdgnQ67VmWRe0zlplXl81vcyEt0rSoYDUAAAAASUVORK5CYII=\",\n+      download: \"https://www.okx.com/download\",\n+      deepLink: `https://www.okx.com/download?deeplink=${encodeURIComponent(`okx://wallet/dapp/url?dappUrl=${encodeURIComponent(window.location.href)}`)}`\n+    }\n+  ] as const\n+)\n+  /**\n+   * Temporary filtering out reasons:\n+   *\n+   * `okxwallet` because it uses the deprecated payload API where\n+   * instead of `.signAndSubmitTransaction({ payload: ... })`, it uses `.signAndSubmitTransaction({ ... })`.\n+   * In our SDK we use the current, non-deprecated API.\n+   *\n+   * `martian` because it doesn't implement `.getNetwork()` and `.getAccount()` methods yet.\n+   * We will stop filtering them out once they use the new API.\n+   */\n+  .filter(wallet => ![\"okxwallet\", \"martian\"].includes(wallet.id))\n+\n+export type AptosWalletId = (typeof aptosWalletsInformation)[number][\"id\"]\n+\n+/**\n+ * TODO:\n+ * - check with Petra wallet team for proper `window.aptos` types\n+ */\n+\n+export function getAptosWallet(walletId: AptosWalletId = \"petra\") {\n+  // handle okx wallet special case since it's nested\n+  if (!window) return\n+  if (\n+    walletId === \"okxwallet\" &&\n+    Object.hasOwn(window, \"okxwallet\") &&\n+    Object.hasOwn(window.okxwallet, \"aptos\")\n+  ) {\n+    return window.okxwallet.aptos\n+  }\n+  if (Object.hasOwn(window, walletId)) return window[walletId] as AptosBrowserWallet\n+  if (Object.hasOwn(window, \"aptos\")) return window.aptos\n+\n+  window.open(\"https://petra.app/\", \"_blank\", \"noopener noreferrer\")\n+}\n+\n+class AptosStore {\n+  chain = $state(\"aptos\")\n+  address = $state<Hex | undefined>(undefined)",
        "comment_created_at": "2025-02-27T17:19:31+00:00",
        "comment_author": "cor",
        "comment_body": "Don't use `Undefined`, use `Option` instead: https://effect.website/docs/data-types/option/",
        "pr_file_module": null
      }
    ]
  }
]