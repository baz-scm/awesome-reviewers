[
  {
    "discussion_id": "1447252891",
    "pr_number": 20438,
    "pr_file": "vlib/net/tcp.c.v",
    "created_at": "2024-01-10T11:29:41+00:00",
    "commented_code": "continue\n \t\t}\n \n-\t\treturn &TcpConn{\n+\t\tmut conn := &TcpConn{\n \t\t\tsock: s\n \t\t\tread_timeout: net.tcp_default_read_timeout\n \t\t\twrite_timeout: net.tcp_default_write_timeout\n \t\t}\n+\t\tconn.set_blocking(true)!",
    "repo_full_name": "vlang/v",
    "discussion_comments": [
      {
        "comment_id": "1447252891",
        "repo_full_name": "vlang/v",
        "pr_number": 20438,
        "pr_file": "vlib/net/tcp.c.v",
        "discussion_id": "1447252891",
        "commented_code": "@@ -49,11 +49,13 @@ pub fn dial_tcp(oaddress string) !&TcpConn {\n \t\t\tcontinue\n \t\t}\n \n-\t\treturn &TcpConn{\n+\t\tmut conn := &TcpConn{\n \t\t\tsock: s\n \t\t\tread_timeout: net.tcp_default_read_timeout\n \t\t\twrite_timeout: net.tcp_default_write_timeout\n \t\t}\n+\t\tconn.set_blocking(true)!",
        "comment_created_at": "2024-01-10T11:29:41+00:00",
        "comment_author": "spytheman",
        "comment_body": "```suggestion\r\n\t\t$if !net_nonblocking_sockets ? {\r\n\t\t\tconn.set_blocking(true)!\r\n\t\t}\r\n```",
        "pr_file_module": null
      },
      {
        "comment_id": "1447253619",
        "repo_full_name": "vlang/v",
        "pr_number": 20438,
        "pr_file": "vlib/net/tcp.c.v",
        "discussion_id": "1447252891",
        "commented_code": "@@ -49,11 +49,13 @@ pub fn dial_tcp(oaddress string) !&TcpConn {\n \t\t\tcontinue\n \t\t}\n \n-\t\treturn &TcpConn{\n+\t\tmut conn := &TcpConn{\n \t\t\tsock: s\n \t\t\tread_timeout: net.tcp_default_read_timeout\n \t\t\twrite_timeout: net.tcp_default_write_timeout\n \t\t}\n+\t\tconn.set_blocking(true)!",
        "comment_created_at": "2024-01-10T11:30:25+00:00",
        "comment_author": "spytheman",
        "comment_body": "`-d net_nonblocking_sockets` will not be defined by default, but will provide a way for people to opt in for the old behavior for their old projects, if needed.",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1447254374",
    "pr_number": 20438,
    "pr_file": "vlib/net/tcp.c.v",
    "created_at": "2024-01-10T11:31:11+00:00",
    "commented_code": "continue\n \t\t}\n \n-\t\treturn &TcpConn{\n+\t\tmut conn := &TcpConn{\n \t\t\tsock: s\n \t\t\tread_timeout: net.tcp_default_read_timeout\n \t\t\twrite_timeout: net.tcp_default_write_timeout\n \t\t}\n+\t\tconn.set_blocking(true)!",
    "repo_full_name": "vlang/v",
    "discussion_comments": [
      {
        "comment_id": "1447254374",
        "repo_full_name": "vlang/v",
        "pr_number": 20438,
        "pr_file": "vlib/net/tcp.c.v",
        "discussion_id": "1447254374",
        "commented_code": "@@ -92,11 +94,13 @@ pub fn dial_tcp_with_bind(saddr string, laddr string) !&TcpConn {\n \t\t\tcontinue\n \t\t}\n \n-\t\treturn &TcpConn{\n+\t\tmut conn := &TcpConn{\n \t\t\tsock: s\n \t\t\tread_timeout: net.tcp_default_read_timeout\n \t\t\twrite_timeout: net.tcp_default_write_timeout\n \t\t}\n+\t\tconn.set_blocking(true)!",
        "comment_created_at": "2024-01-10T11:31:11+00:00",
        "comment_author": "spytheman",
        "comment_body": "```suggestion\r\n\t\t$if !net_nonblocking_sockets ? {\r\n\t\t\tconn.set_blocking(true)!\r\n\t\t}\r\n```",
        "pr_file_module": null
      },
      {
        "comment_id": "1447360195",
        "repo_full_name": "vlang/v",
        "pr_number": 20438,
        "pr_file": "vlib/net/tcp.c.v",
        "discussion_id": "1447254374",
        "commented_code": "@@ -92,11 +94,13 @@ pub fn dial_tcp_with_bind(saddr string, laddr string) !&TcpConn {\n \t\t\tcontinue\n \t\t}\n \n-\t\treturn &TcpConn{\n+\t\tmut conn := &TcpConn{\n \t\t\tsock: s\n \t\t\tread_timeout: net.tcp_default_read_timeout\n \t\t\twrite_timeout: net.tcp_default_write_timeout\n \t\t}\n+\t\tconn.set_blocking(true)!",
        "comment_created_at": "2024-01-10T13:05:11+00:00",
        "comment_author": "kbkpbot",
        "comment_body": "```v\r\n\t\t$if !net_blocking_sockets {\r\n\t\t\tconn.set_blocking(true)!\r\n\t\t}\r\n\r\n```\r\nnet_blocking_sockets ?",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1447255050",
    "pr_number": 20438,
    "pr_file": "vlib/net/tcp.c.v",
    "created_at": "2024-01-10T11:31:55+00:00",
    "commented_code": "pub fn (mut l TcpListener) accept() !&TcpConn {\n \tmut res := l.accept_only()!\n \tres.set_sock()!\n+\tres.set_blocking(true)!",
    "repo_full_name": "vlang/v",
    "discussion_comments": [
      {
        "comment_id": "1447255050",
        "repo_full_name": "vlang/v",
        "pr_number": 20438,
        "pr_file": "vlib/net/tcp.c.v",
        "discussion_id": "1447255050",
        "commented_code": "@@ -328,12 +306,13 @@ pub fn listen_tcp(family AddrFamily, saddr string, options ListenOptions) !&TcpL\n pub fn (mut l TcpListener) accept() !&TcpConn {\n \tmut res := l.accept_only()!\n \tres.set_sock()!\n+\tres.set_blocking(true)!",
        "comment_created_at": "2024-01-10T11:31:55+00:00",
        "comment_author": "spytheman",
        "comment_body": "```suggestion\r\n\t$if !net_nonblocking_sockets ? {\r\n\t\tres.set_blocking(true)!\r\n\t}\r\n```",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1447544667",
    "pr_number": 20438,
    "pr_file": "vlib/net/tcp.c.v",
    "created_at": "2024-01-10T15:28:24+00:00",
    "commented_code": "pub fn (mut l TcpListener) accept() !&TcpConn {\n \tmut res := l.accept_only()!\n \tres.set_sock()!\n-\t$if !net_blocking_sockets ? {\n+\t$if !net_nonblocking_sockets ? {\n \t\tres.set_blocking(true)!",
    "repo_full_name": "vlang/v",
    "discussion_comments": [
      {
        "comment_id": "1447544667",
        "repo_full_name": "vlang/v",
        "pr_number": 20438,
        "pr_file": "vlib/net/tcp.c.v",
        "discussion_id": "1447544667",
        "commented_code": "@@ -310,7 +310,7 @@ pub fn listen_tcp(family AddrFamily, saddr string, options ListenOptions) !&TcpL\n pub fn (mut l TcpListener) accept() !&TcpConn {\n \tmut res := l.accept_only()!\n \tres.set_sock()!\n-\t$if !net_blocking_sockets ? {\n+\t$if !net_nonblocking_sockets ? {\n \t\tres.set_blocking(true)!",
        "comment_created_at": "2024-01-10T15:28:24+00:00",
        "comment_author": "JalonSolov",
        "comment_body": "```suggestion\r\n\t\tres.set_blocking(false)!\r\n```",
        "pr_file_module": null
      },
      {
        "comment_id": "1447579496",
        "repo_full_name": "vlang/v",
        "pr_number": 20438,
        "pr_file": "vlib/net/tcp.c.v",
        "discussion_id": "1447544667",
        "commented_code": "@@ -310,7 +310,7 @@ pub fn listen_tcp(family AddrFamily, saddr string, options ListenOptions) !&TcpL\n pub fn (mut l TcpListener) accept() !&TcpConn {\n \tmut res := l.accept_only()!\n \tres.set_sock()!\n-\t$if !net_blocking_sockets ? {\n+\t$if !net_nonblocking_sockets ? {\n \t\tres.set_blocking(true)!",
        "comment_created_at": "2024-01-10T15:52:14+00:00",
        "comment_author": "spytheman",
        "comment_body": "No, it should be `res.set_blocking(true)!` , the PR is changing the default.",
        "pr_file_module": null
      },
      {
        "comment_id": "1447616386",
        "repo_full_name": "vlang/v",
        "pr_number": 20438,
        "pr_file": "vlib/net/tcp.c.v",
        "discussion_id": "1447544667",
        "commented_code": "@@ -310,7 +310,7 @@ pub fn listen_tcp(family AddrFamily, saddr string, options ListenOptions) !&TcpL\n pub fn (mut l TcpListener) accept() !&TcpConn {\n \tmut res := l.accept_only()!\n \tres.set_sock()!\n-\t$if !net_blocking_sockets ? {\n+\t$if !net_nonblocking_sockets ? {\n \t\tres.set_blocking(true)!",
        "comment_created_at": "2024-01-10T16:20:03+00:00",
        "comment_author": "JalonSolov",
        "comment_body": "Doesn't make sense for `-d net_nonblocking_sockets` to call `res.set_blocking(true)`, since that makes it block... `res.set_blocking(false)` would make it not block, which would match the `-d` option.",
        "pr_file_module": null
      },
      {
        "comment_id": "1448006066",
        "repo_full_name": "vlang/v",
        "pr_number": 20438,
        "pr_file": "vlib/net/tcp.c.v",
        "discussion_id": "1447544667",
        "commented_code": "@@ -310,7 +310,7 @@ pub fn listen_tcp(family AddrFamily, saddr string, options ListenOptions) !&TcpL\n pub fn (mut l TcpListener) accept() !&TcpConn {\n \tmut res := l.accept_only()!\n \tres.set_sock()!\n-\t$if !net_blocking_sockets ? {\n+\t$if !net_nonblocking_sockets ? {\n \t\tres.set_blocking(true)!",
        "comment_created_at": "2024-01-10T21:37:25+00:00",
        "comment_author": "spytheman",
        "comment_body": "Note that there is inversion, it is `$if !net_nonblocking_sockets ? {`, not `$if net_nonblocking_sockets ? {` .\r\nIn other words, that code inside the comptime if body, will be executed only if `-d net_nonblocking_sockets` *is not* passed, i.e. by default, which is what we want.",
        "pr_file_module": null
      },
      {
        "comment_id": "1448008475",
        "repo_full_name": "vlang/v",
        "pr_number": 20438,
        "pr_file": "vlib/net/tcp.c.v",
        "discussion_id": "1447544667",
        "commented_code": "@@ -310,7 +310,7 @@ pub fn listen_tcp(family AddrFamily, saddr string, options ListenOptions) !&TcpL\n pub fn (mut l TcpListener) accept() !&TcpConn {\n \tmut res := l.accept_only()!\n \tres.set_sock()!\n-\t$if !net_blocking_sockets ? {\n+\t$if !net_nonblocking_sockets ? {\n \t\tres.set_blocking(true)!",
        "comment_created_at": "2024-01-10T21:40:13+00:00",
        "comment_author": "JalonSolov",
        "comment_body": "... ok.  I was never a fan of double negatives, but if it works, it works, I suppose.",
        "pr_file_module": null
      }
    ]
  }
]