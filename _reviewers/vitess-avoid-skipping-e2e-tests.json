[
  {
    "discussion_id": "2002672379",
    "pr_number": 17963,
    "pr_file": "go/vt/vtgate/planbuilder/testdata/select_cases.json",
    "created_at": "2025-03-19T07:57:28+00:00",
    "commented_code": "]\n     }\n   },\n+  {\n+    \"comment\": \"derived table join with NOT IN subquery can be merged after applying join merging with predicates\",\n+    \"query\": \"SELECT m1.id FROM music as m1 JOIN (SELECT max(id) as id FROM music WHERE music.user_id = 1234 AND music.foobar NOT IN (SELECT foobar FROM user_extra WHERE user_extra.user_id = 1234)) as m2 ON m1.id = m2.id\",\n+    \"plan\": {\n+      \"Type\": \"Passthrough\",\n+      \"QueryType\": \"SELECT\",\n+      \"Original\": \"SELECT m1.id FROM music as m1 JOIN (SELECT max(id) as id FROM music WHERE music.user_id = 1234 AND music.foobar NOT IN (SELECT foobar FROM user_extra WHERE user_extra.user_id = 1234)) as m2 ON m1.id = m2.id\",\n+      \"Instructions\": {\n+        \"OperatorType\": \"Route\",\n+        \"Variant\": \"EqualUnique\",\n+        \"Keyspace\": {\n+          \"Name\": \"user\",\n+          \"Sharded\": true\n+        },\n+        \"FieldQuery\": \"select m1.id from (select max(id) as id from music where 1 != 1) as m2, music as m1 where 1 != 1\",\n+        \"Query\": \"select m1.id from (select max(id) as id from music where music.user_id = 1234 and music.foobar not in (select foobar from user_extra where user_extra.user_id = 1234)) as m2, music as m1 where m1.id = m2.id\",\n+        \"Table\": \"music\",\n+        \"Values\": [\n+          \"1234\"\n+        ],\n+        \"Vindex\": \"user_index\"\n+      },\n+      \"TablesUsed\": [\n+        \"user.music\"\n+      ]\n+    },\n+    \"skip_e2e\": true",
    "repo_full_name": "vitessio/vitess",
    "discussion_comments": [
      {
        "comment_id": "2002672379",
        "repo_full_name": "vitessio/vitess",
        "pr_number": 17963,
        "pr_file": "go/vt/vtgate/planbuilder/testdata/select_cases.json",
        "discussion_id": "2002672379",
        "commented_code": "@@ -22,6 +22,34 @@\n       ]\n     }\n   },\n+  {\n+    \"comment\": \"derived table join with NOT IN subquery can be merged after applying join merging with predicates\",\n+    \"query\": \"SELECT m1.id FROM music as m1 JOIN (SELECT max(id) as id FROM music WHERE music.user_id = 1234 AND music.foobar NOT IN (SELECT foobar FROM user_extra WHERE user_extra.user_id = 1234)) as m2 ON m1.id = m2.id\",\n+    \"plan\": {\n+      \"Type\": \"Passthrough\",\n+      \"QueryType\": \"SELECT\",\n+      \"Original\": \"SELECT m1.id FROM music as m1 JOIN (SELECT max(id) as id FROM music WHERE music.user_id = 1234 AND music.foobar NOT IN (SELECT foobar FROM user_extra WHERE user_extra.user_id = 1234)) as m2 ON m1.id = m2.id\",\n+      \"Instructions\": {\n+        \"OperatorType\": \"Route\",\n+        \"Variant\": \"EqualUnique\",\n+        \"Keyspace\": {\n+          \"Name\": \"user\",\n+          \"Sharded\": true\n+        },\n+        \"FieldQuery\": \"select m1.id from (select max(id) as id from music where 1 != 1) as m2, music as m1 where 1 != 1\",\n+        \"Query\": \"select m1.id from (select max(id) as id from music where music.user_id = 1234 and music.foobar not in (select foobar from user_extra where user_extra.user_id = 1234)) as m2, music as m1 where m1.id = m2.id\",\n+        \"Table\": \"music\",\n+        \"Values\": [\n+          \"1234\"\n+        ],\n+        \"Vindex\": \"user_index\"\n+      },\n+      \"TablesUsed\": [\n+        \"user.music\"\n+      ]\n+    },\n+    \"skip_e2e\": true",
        "comment_created_at": "2025-03-19T07:57:28+00:00",
        "comment_author": "harshit-gangal",
        "comment_body": "@gopoto we should not do `skip_e2e` instead make sure planner e2e test passes",
        "pr_file_module": null
      },
      {
        "comment_id": "2004631811",
        "repo_full_name": "vitessio/vitess",
        "pr_number": 17963,
        "pr_file": "go/vt/vtgate/planbuilder/testdata/select_cases.json",
        "discussion_id": "2002672379",
        "commented_code": "@@ -22,6 +22,34 @@\n       ]\n     }\n   },\n+  {\n+    \"comment\": \"derived table join with NOT IN subquery can be merged after applying join merging with predicates\",\n+    \"query\": \"SELECT m1.id FROM music as m1 JOIN (SELECT max(id) as id FROM music WHERE music.user_id = 1234 AND music.foobar NOT IN (SELECT foobar FROM user_extra WHERE user_extra.user_id = 1234)) as m2 ON m1.id = m2.id\",\n+    \"plan\": {\n+      \"Type\": \"Passthrough\",\n+      \"QueryType\": \"SELECT\",\n+      \"Original\": \"SELECT m1.id FROM music as m1 JOIN (SELECT max(id) as id FROM music WHERE music.user_id = 1234 AND music.foobar NOT IN (SELECT foobar FROM user_extra WHERE user_extra.user_id = 1234)) as m2 ON m1.id = m2.id\",\n+      \"Instructions\": {\n+        \"OperatorType\": \"Route\",\n+        \"Variant\": \"EqualUnique\",\n+        \"Keyspace\": {\n+          \"Name\": \"user\",\n+          \"Sharded\": true\n+        },\n+        \"FieldQuery\": \"select m1.id from (select max(id) as id from music where 1 != 1) as m2, music as m1 where 1 != 1\",\n+        \"Query\": \"select m1.id from (select max(id) as id from music where music.user_id = 1234 and music.foobar not in (select foobar from user_extra where user_extra.user_id = 1234)) as m2, music as m1 where m1.id = m2.id\",\n+        \"Table\": \"music\",\n+        \"Values\": [\n+          \"1234\"\n+        ],\n+        \"Vindex\": \"user_index\"\n+      },\n+      \"TablesUsed\": [\n+        \"user.music\"\n+      ]\n+    },\n+    \"skip_e2e\": true",
        "comment_created_at": "2025-03-20T01:41:57+00:00",
        "comment_author": "gopoto",
        "comment_body": "Good catch. Dropped the `skip_e2e` on the new derived-table join case so the planner e2e test will exercise the updated plan.",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "1886206836",
    "pr_number": 17342,
    "pr_file": "go/vt/vtgate/planbuilder/testdata/filter_cases.json",
    "created_at": "2024-12-16T05:45:05+00:00",
    "commented_code": "\"user.authoritative\"\n       ]\n     }\n+  },\n+  {\n+    \"comment\": \"Between clause on primary indexed id column (binary vindex on id)\",\n+    \"query\": \"select id from unq_binary_idx where id between 1 and 5\",\n+    \"plan\": {\n+      \"QueryType\": \"SELECT\",\n+      \"Original\": \"select id from unq_binary_idx where id between 1 and 5\",\n+      \"Instructions\": {\n+        \"OperatorType\": \"Route\",\n+        \"Variant\": \"Between\",\n+        \"Keyspace\": {\n+          \"Name\": \"user\",\n+          \"Sharded\": true\n+        },\n+        \"FieldQuery\": \"select id from unq_binary_idx where 1 != 1\",\n+        \"Query\": \"select id from unq_binary_idx where id between 1 and 5\",\n+        \"Table\": \"unq_binary_idx\",\n+        \"Values\": [\n+          \"(1, 5)\"\n+        ],\n+        \"Vindex\": \"binary\"\n+      },\n+      \"TablesUsed\": [\n+        \"user.unq_binary_idx\"\n+      ]\n+    }\n+  },\n+{\n+    \"comment\": \"Between clause on customer.id column (xxhash vindex on id)\",\n+    \"query\": \"select id from customer where id between 1 and 5\",\n+    \"plan\": {\n+      \"QueryType\": \"SELECT\",\n+      \"Original\": \"select id from customer where id between 1 and 5\",\n+      \"Instructions\": {\n+        \"OperatorType\": \"Route\",\n+        \"Variant\": \"Scatter\",\n+        \"Keyspace\": {\n+          \"Name\": \"user\",\n+          \"Sharded\": true\n+        },\n+        \"FieldQuery\": \"select id from customer where 1 != 1\",\n+        \"Query\": \"select id from customer where id between 1 and 5\",\n+        \"Table\": \"customer\"\n+      },\n+      \"TablesUsed\": [\n+        \"user.customer\"\n+      ]\n+    }\n+  },\n+{\n+    \"comment\": \"Between clause on col1 column (there is no vindex on this column)\",\n+    \"query\": \"select id, col1 from unq_binary_idx where col1 between 10 and 50\",\n+    \"plan\": {\n+      \"QueryType\": \"SELECT\",\n+      \"Original\": \"select id, col1 from unq_binary_idx where col1 between 10 and 50\",\n+      \"Instructions\": {\n+        \"OperatorType\": \"Route\",\n+        \"Variant\": \"Scatter\",\n+        \"Keyspace\": {\n+          \"Name\": \"user\",\n+          \"Sharded\": true\n+        },\n+        \"FieldQuery\": \"select id, col1 from unq_binary_idx where 1 != 1\",\n+        \"Query\": \"select id, col1 from unq_binary_idx where col1 between 10 and 50\",\n+        \"Table\": \"unq_binary_idx\"\n+      },\n+      \"TablesUsed\": [\n+        \"user.unq_binary_idx\"\n+      ]\n+    }\n+},\n+{\n+  \"comment\": \"Between clause on multicolumn vindex (cola,colb)\",\n+  \"query\": \"select cola,colb,colc from multicol_tbl where cola between 1 and 5\",\n+  \"plan\": {\n+    \"QueryType\": \"SELECT\",\n+    \"Original\": \"select cola,colb,colc from multicol_tbl where cola between 1 and 5\",\n+    \"Instructions\": {\n+      \"OperatorType\": \"Route\",\n+      \"Variant\": \"Scatter\",\n+      \"Keyspace\": {\n+        \"Name\": \"user\",\n+        \"Sharded\": true\n+      },\n+      \"FieldQuery\": \"select cola, colb, colc from multicol_tbl where 1 != 1\",\n+      \"Query\": \"select cola, colb, colc from multicol_tbl where cola between 1 and 5\",\n+      \"Table\": \"multicol_tbl\"\n+    },\n+    \"TablesUsed\": [\n+      \"user.multicol_tbl\"\n+    ]\n   }\n+},\n+{\n+  \"comment\": \"Between clause on a binary vindex field with values from a different table\",\n+  \"query\": \"select s.oid,s.col1, se.colb from sales s join sales_extra se on s.col1 = se.cola where s.oid between se.start and se.end\",\n+  \"plan\": {\n+    \"QueryType\": \"SELECT\",\n+    \"Original\": \"select s.oid,s.col1, se.colb from sales s join sales_extra se on s.col1 = se.cola where s.oid between se.start and se.end\",\n+    \"Instructions\": {\n+      \"OperatorType\": \"Join\",\n+      \"Variant\": \"Join\",\n+      \"JoinColumnIndexes\": \"R:0,R:1,L:0\",\n+      \"JoinVars\": {\n+        \"se_cola\": 1,\n+        \"se_end\": 3,\n+        \"se_start\": 2\n+      },\n+      \"TableName\": \"sales_extra_sales\",\n+      \"Inputs\": [\n+        {\n+          \"OperatorType\": \"Route\",\n+          \"Variant\": \"Scatter\",\n+          \"Keyspace\": {\n+            \"Name\": \"user\",\n+            \"Sharded\": true\n+          },\n+          \"FieldQuery\": \"select se.colb, se.cola, se.`start`, se.`end` from sales_extra as se where 1 != 1\",\n+          \"Query\": \"select se.colb, se.cola, se.`start`, se.`end` from sales_extra as se\",\n+          \"Table\": \"sales_extra\"\n+        },\n+        {\n+          \"OperatorType\": \"Route\",\n+          \"Variant\": \"Between\",\n+          \"Keyspace\": {\n+            \"Name\": \"user\",\n+            \"Sharded\": true\n+          },\n+          \"FieldQuery\": \"select s.oid, s.col1 from sales as s where 1 != 1\",\n+          \"Query\": \"select s.oid, s.col1 from sales as s where s.oid between :se_start /* INT16 */ and :se_end /* INT16 */ and s.col1 = :se_cola /* VARCHAR */\",\n+          \"Table\": \"sales\",\n+          \"Values\": [\n+            \"(:se_start, :se_end)\"\n+          ],\n+          \"Vindex\": \"binary\"\n+        }\n+      ]\n+    },\n+    \"TablesUsed\": [\n+      \"user.sales\",\n+      \"user.sales_extra\"\n+    ]\n+  },\n+  \"skip_e2e\":true\n+}",
    "repo_full_name": "vitessio/vitess",
    "discussion_comments": [
      {
        "comment_id": "1886206836",
        "repo_full_name": "vitessio/vitess",
        "pr_number": 17342,
        "pr_file": "go/vt/vtgate/planbuilder/testdata/filter_cases.json",
        "discussion_id": "1886206836",
        "commented_code": "@@ -4920,5 +4965,149 @@\n         \"user.authoritative\"\n       ]\n     }\n+  },\n+  {\n+    \"comment\": \"Between clause on primary indexed id column (binary vindex on id)\",\n+    \"query\": \"select id from unq_binary_idx where id between 1 and 5\",\n+    \"plan\": {\n+      \"QueryType\": \"SELECT\",\n+      \"Original\": \"select id from unq_binary_idx where id between 1 and 5\",\n+      \"Instructions\": {\n+        \"OperatorType\": \"Route\",\n+        \"Variant\": \"Between\",\n+        \"Keyspace\": {\n+          \"Name\": \"user\",\n+          \"Sharded\": true\n+        },\n+        \"FieldQuery\": \"select id from unq_binary_idx where 1 != 1\",\n+        \"Query\": \"select id from unq_binary_idx where id between 1 and 5\",\n+        \"Table\": \"unq_binary_idx\",\n+        \"Values\": [\n+          \"(1, 5)\"\n+        ],\n+        \"Vindex\": \"binary\"\n+      },\n+      \"TablesUsed\": [\n+        \"user.unq_binary_idx\"\n+      ]\n+    }\n+  },\n+{\n+    \"comment\": \"Between clause on customer.id column (xxhash vindex on id)\",\n+    \"query\": \"select id from customer where id between 1 and 5\",\n+    \"plan\": {\n+      \"QueryType\": \"SELECT\",\n+      \"Original\": \"select id from customer where id between 1 and 5\",\n+      \"Instructions\": {\n+        \"OperatorType\": \"Route\",\n+        \"Variant\": \"Scatter\",\n+        \"Keyspace\": {\n+          \"Name\": \"user\",\n+          \"Sharded\": true\n+        },\n+        \"FieldQuery\": \"select id from customer where 1 != 1\",\n+        \"Query\": \"select id from customer where id between 1 and 5\",\n+        \"Table\": \"customer\"\n+      },\n+      \"TablesUsed\": [\n+        \"user.customer\"\n+      ]\n+    }\n+  },\n+{\n+    \"comment\": \"Between clause on col1 column (there is no vindex on this column)\",\n+    \"query\": \"select id, col1 from unq_binary_idx where col1 between 10 and 50\",\n+    \"plan\": {\n+      \"QueryType\": \"SELECT\",\n+      \"Original\": \"select id, col1 from unq_binary_idx where col1 between 10 and 50\",\n+      \"Instructions\": {\n+        \"OperatorType\": \"Route\",\n+        \"Variant\": \"Scatter\",\n+        \"Keyspace\": {\n+          \"Name\": \"user\",\n+          \"Sharded\": true\n+        },\n+        \"FieldQuery\": \"select id, col1 from unq_binary_idx where 1 != 1\",\n+        \"Query\": \"select id, col1 from unq_binary_idx where col1 between 10 and 50\",\n+        \"Table\": \"unq_binary_idx\"\n+      },\n+      \"TablesUsed\": [\n+        \"user.unq_binary_idx\"\n+      ]\n+    }\n+},\n+{\n+  \"comment\": \"Between clause on multicolumn vindex (cola,colb)\",\n+  \"query\": \"select cola,colb,colc from multicol_tbl where cola between 1 and 5\",\n+  \"plan\": {\n+    \"QueryType\": \"SELECT\",\n+    \"Original\": \"select cola,colb,colc from multicol_tbl where cola between 1 and 5\",\n+    \"Instructions\": {\n+      \"OperatorType\": \"Route\",\n+      \"Variant\": \"Scatter\",\n+      \"Keyspace\": {\n+        \"Name\": \"user\",\n+        \"Sharded\": true\n+      },\n+      \"FieldQuery\": \"select cola, colb, colc from multicol_tbl where 1 != 1\",\n+      \"Query\": \"select cola, colb, colc from multicol_tbl where cola between 1 and 5\",\n+      \"Table\": \"multicol_tbl\"\n+    },\n+    \"TablesUsed\": [\n+      \"user.multicol_tbl\"\n+    ]\n   }\n+},\n+{\n+  \"comment\": \"Between clause on a binary vindex field with values from a different table\",\n+  \"query\": \"select s.oid,s.col1, se.colb from sales s join sales_extra se on s.col1 = se.cola where s.oid between se.start and se.end\",\n+  \"plan\": {\n+    \"QueryType\": \"SELECT\",\n+    \"Original\": \"select s.oid,s.col1, se.colb from sales s join sales_extra se on s.col1 = se.cola where s.oid between se.start and se.end\",\n+    \"Instructions\": {\n+      \"OperatorType\": \"Join\",\n+      \"Variant\": \"Join\",\n+      \"JoinColumnIndexes\": \"R:0,R:1,L:0\",\n+      \"JoinVars\": {\n+        \"se_cola\": 1,\n+        \"se_end\": 3,\n+        \"se_start\": 2\n+      },\n+      \"TableName\": \"sales_extra_sales\",\n+      \"Inputs\": [\n+        {\n+          \"OperatorType\": \"Route\",\n+          \"Variant\": \"Scatter\",\n+          \"Keyspace\": {\n+            \"Name\": \"user\",\n+            \"Sharded\": true\n+          },\n+          \"FieldQuery\": \"select se.colb, se.cola, se.`start`, se.`end` from sales_extra as se where 1 != 1\",\n+          \"Query\": \"select se.colb, se.cola, se.`start`, se.`end` from sales_extra as se\",\n+          \"Table\": \"sales_extra\"\n+        },\n+        {\n+          \"OperatorType\": \"Route\",\n+          \"Variant\": \"Between\",\n+          \"Keyspace\": {\n+            \"Name\": \"user\",\n+            \"Sharded\": true\n+          },\n+          \"FieldQuery\": \"select s.oid, s.col1 from sales as s where 1 != 1\",\n+          \"Query\": \"select s.oid, s.col1 from sales as s where s.oid between :se_start /* INT16 */ and :se_end /* INT16 */ and s.col1 = :se_cola /* VARCHAR */\",\n+          \"Table\": \"sales\",\n+          \"Values\": [\n+            \"(:se_start, :se_end)\"\n+          ],\n+          \"Vindex\": \"binary\"\n+        }\n+      ]\n+    },\n+    \"TablesUsed\": [\n+      \"user.sales\",\n+      \"user.sales_extra\"\n+    ]\n+  },\n+  \"skip_e2e\":true\n+}",
        "comment_created_at": "2024-12-16T05:45:05+00:00",
        "comment_author": "harshit-gangal",
        "comment_body": "new test should not be skipped",
        "pr_file_module": null
      },
      {
        "comment_id": "1887594512",
        "repo_full_name": "vitessio/vitess",
        "pr_number": 17342,
        "pr_file": "go/vt/vtgate/planbuilder/testdata/filter_cases.json",
        "discussion_id": "1886206836",
        "commented_code": "@@ -4920,5 +4965,149 @@\n         \"user.authoritative\"\n       ]\n     }\n+  },\n+  {\n+    \"comment\": \"Between clause on primary indexed id column (binary vindex on id)\",\n+    \"query\": \"select id from unq_binary_idx where id between 1 and 5\",\n+    \"plan\": {\n+      \"QueryType\": \"SELECT\",\n+      \"Original\": \"select id from unq_binary_idx where id between 1 and 5\",\n+      \"Instructions\": {\n+        \"OperatorType\": \"Route\",\n+        \"Variant\": \"Between\",\n+        \"Keyspace\": {\n+          \"Name\": \"user\",\n+          \"Sharded\": true\n+        },\n+        \"FieldQuery\": \"select id from unq_binary_idx where 1 != 1\",\n+        \"Query\": \"select id from unq_binary_idx where id between 1 and 5\",\n+        \"Table\": \"unq_binary_idx\",\n+        \"Values\": [\n+          \"(1, 5)\"\n+        ],\n+        \"Vindex\": \"binary\"\n+      },\n+      \"TablesUsed\": [\n+        \"user.unq_binary_idx\"\n+      ]\n+    }\n+  },\n+{\n+    \"comment\": \"Between clause on customer.id column (xxhash vindex on id)\",\n+    \"query\": \"select id from customer where id between 1 and 5\",\n+    \"plan\": {\n+      \"QueryType\": \"SELECT\",\n+      \"Original\": \"select id from customer where id between 1 and 5\",\n+      \"Instructions\": {\n+        \"OperatorType\": \"Route\",\n+        \"Variant\": \"Scatter\",\n+        \"Keyspace\": {\n+          \"Name\": \"user\",\n+          \"Sharded\": true\n+        },\n+        \"FieldQuery\": \"select id from customer where 1 != 1\",\n+        \"Query\": \"select id from customer where id between 1 and 5\",\n+        \"Table\": \"customer\"\n+      },\n+      \"TablesUsed\": [\n+        \"user.customer\"\n+      ]\n+    }\n+  },\n+{\n+    \"comment\": \"Between clause on col1 column (there is no vindex on this column)\",\n+    \"query\": \"select id, col1 from unq_binary_idx where col1 between 10 and 50\",\n+    \"plan\": {\n+      \"QueryType\": \"SELECT\",\n+      \"Original\": \"select id, col1 from unq_binary_idx where col1 between 10 and 50\",\n+      \"Instructions\": {\n+        \"OperatorType\": \"Route\",\n+        \"Variant\": \"Scatter\",\n+        \"Keyspace\": {\n+          \"Name\": \"user\",\n+          \"Sharded\": true\n+        },\n+        \"FieldQuery\": \"select id, col1 from unq_binary_idx where 1 != 1\",\n+        \"Query\": \"select id, col1 from unq_binary_idx where col1 between 10 and 50\",\n+        \"Table\": \"unq_binary_idx\"\n+      },\n+      \"TablesUsed\": [\n+        \"user.unq_binary_idx\"\n+      ]\n+    }\n+},\n+{\n+  \"comment\": \"Between clause on multicolumn vindex (cola,colb)\",\n+  \"query\": \"select cola,colb,colc from multicol_tbl where cola between 1 and 5\",\n+  \"plan\": {\n+    \"QueryType\": \"SELECT\",\n+    \"Original\": \"select cola,colb,colc from multicol_tbl where cola between 1 and 5\",\n+    \"Instructions\": {\n+      \"OperatorType\": \"Route\",\n+      \"Variant\": \"Scatter\",\n+      \"Keyspace\": {\n+        \"Name\": \"user\",\n+        \"Sharded\": true\n+      },\n+      \"FieldQuery\": \"select cola, colb, colc from multicol_tbl where 1 != 1\",\n+      \"Query\": \"select cola, colb, colc from multicol_tbl where cola between 1 and 5\",\n+      \"Table\": \"multicol_tbl\"\n+    },\n+    \"TablesUsed\": [\n+      \"user.multicol_tbl\"\n+    ]\n   }\n+},\n+{\n+  \"comment\": \"Between clause on a binary vindex field with values from a different table\",\n+  \"query\": \"select s.oid,s.col1, se.colb from sales s join sales_extra se on s.col1 = se.cola where s.oid between se.start and se.end\",\n+  \"plan\": {\n+    \"QueryType\": \"SELECT\",\n+    \"Original\": \"select s.oid,s.col1, se.colb from sales s join sales_extra se on s.col1 = se.cola where s.oid between se.start and se.end\",\n+    \"Instructions\": {\n+      \"OperatorType\": \"Join\",\n+      \"Variant\": \"Join\",\n+      \"JoinColumnIndexes\": \"R:0,R:1,L:0\",\n+      \"JoinVars\": {\n+        \"se_cola\": 1,\n+        \"se_end\": 3,\n+        \"se_start\": 2\n+      },\n+      \"TableName\": \"sales_extra_sales\",\n+      \"Inputs\": [\n+        {\n+          \"OperatorType\": \"Route\",\n+          \"Variant\": \"Scatter\",\n+          \"Keyspace\": {\n+            \"Name\": \"user\",\n+            \"Sharded\": true\n+          },\n+          \"FieldQuery\": \"select se.colb, se.cola, se.`start`, se.`end` from sales_extra as se where 1 != 1\",\n+          \"Query\": \"select se.colb, se.cola, se.`start`, se.`end` from sales_extra as se\",\n+          \"Table\": \"sales_extra\"\n+        },\n+        {\n+          \"OperatorType\": \"Route\",\n+          \"Variant\": \"Between\",\n+          \"Keyspace\": {\n+            \"Name\": \"user\",\n+            \"Sharded\": true\n+          },\n+          \"FieldQuery\": \"select s.oid, s.col1 from sales as s where 1 != 1\",\n+          \"Query\": \"select s.oid, s.col1 from sales as s where s.oid between :se_start /* INT16 */ and :se_end /* INT16 */ and s.col1 = :se_cola /* VARCHAR */\",\n+          \"Table\": \"sales\",\n+          \"Values\": [\n+            \"(:se_start, :se_end)\"\n+          ],\n+          \"Vindex\": \"binary\"\n+        }\n+      ]\n+    },\n+    \"TablesUsed\": [\n+      \"user.sales\",\n+      \"user.sales_extra\"\n+    ]\n+  },\n+  \"skip_e2e\":true\n+}",
        "comment_created_at": "2024-12-16T21:15:20+00:00",
        "comment_author": "c-r-dev",
        "comment_body": "thanks , out of the [5 new test cases](https://github.com/c-r-dev/vitess/blob/b99ebabe960b49792dd426509d68fbad73a3fda3/go/vt/vtgate/planbuilder/testdata/filter_cases.json#L4972-L5113)  added for `between` , marked the final one related to [join](https://github.com/c-r-dev/vitess/blob/b99ebabe960b49792dd426509d68fbad73a3fda3/go/vt/vtgate/planbuilder/testdata/filter_cases.json#L5064)  as skip_e2e.\r\n\r\nReason for marking this skip , is because of [\"OperatorType\": \"Join\"](https://github.com/c-r-dev/vitess/blob/b99ebabe960b49792dd426509d68fbad73a3fda3/go/vt/vtgate/planbuilder/testdata/filter_cases.json#L5070) , verifyTestExpectations for `join` cases verifies -> [Verify that the Join primitive sees atleast 1 row on the left side](https://github.com/c-r-dev/vitess/blob/b99ebabe960b49792dd426509d68fbad73a3fda3/go/test/endtoend/vtgate/plan_tests/main_test.go#L154-L155). Currently we don't have any sample data in these test schema tables. (pls let me know if we can put some test data in these tables for e2e testing)\r\n\r\n@harshit-gangal please help to let me know if I have missed any thing , or if there is a better way to write this test for \"Between clause on a binary vindex field with values from a different table\"",
        "pr_file_module": null
      },
      {
        "comment_id": "1887953418",
        "repo_full_name": "vitessio/vitess",
        "pr_number": 17342,
        "pr_file": "go/vt/vtgate/planbuilder/testdata/filter_cases.json",
        "discussion_id": "1886206836",
        "commented_code": "@@ -4920,5 +4965,149 @@\n         \"user.authoritative\"\n       ]\n     }\n+  },\n+  {\n+    \"comment\": \"Between clause on primary indexed id column (binary vindex on id)\",\n+    \"query\": \"select id from unq_binary_idx where id between 1 and 5\",\n+    \"plan\": {\n+      \"QueryType\": \"SELECT\",\n+      \"Original\": \"select id from unq_binary_idx where id between 1 and 5\",\n+      \"Instructions\": {\n+        \"OperatorType\": \"Route\",\n+        \"Variant\": \"Between\",\n+        \"Keyspace\": {\n+          \"Name\": \"user\",\n+          \"Sharded\": true\n+        },\n+        \"FieldQuery\": \"select id from unq_binary_idx where 1 != 1\",\n+        \"Query\": \"select id from unq_binary_idx where id between 1 and 5\",\n+        \"Table\": \"unq_binary_idx\",\n+        \"Values\": [\n+          \"(1, 5)\"\n+        ],\n+        \"Vindex\": \"binary\"\n+      },\n+      \"TablesUsed\": [\n+        \"user.unq_binary_idx\"\n+      ]\n+    }\n+  },\n+{\n+    \"comment\": \"Between clause on customer.id column (xxhash vindex on id)\",\n+    \"query\": \"select id from customer where id between 1 and 5\",\n+    \"plan\": {\n+      \"QueryType\": \"SELECT\",\n+      \"Original\": \"select id from customer where id between 1 and 5\",\n+      \"Instructions\": {\n+        \"OperatorType\": \"Route\",\n+        \"Variant\": \"Scatter\",\n+        \"Keyspace\": {\n+          \"Name\": \"user\",\n+          \"Sharded\": true\n+        },\n+        \"FieldQuery\": \"select id from customer where 1 != 1\",\n+        \"Query\": \"select id from customer where id between 1 and 5\",\n+        \"Table\": \"customer\"\n+      },\n+      \"TablesUsed\": [\n+        \"user.customer\"\n+      ]\n+    }\n+  },\n+{\n+    \"comment\": \"Between clause on col1 column (there is no vindex on this column)\",\n+    \"query\": \"select id, col1 from unq_binary_idx where col1 between 10 and 50\",\n+    \"plan\": {\n+      \"QueryType\": \"SELECT\",\n+      \"Original\": \"select id, col1 from unq_binary_idx where col1 between 10 and 50\",\n+      \"Instructions\": {\n+        \"OperatorType\": \"Route\",\n+        \"Variant\": \"Scatter\",\n+        \"Keyspace\": {\n+          \"Name\": \"user\",\n+          \"Sharded\": true\n+        },\n+        \"FieldQuery\": \"select id, col1 from unq_binary_idx where 1 != 1\",\n+        \"Query\": \"select id, col1 from unq_binary_idx where col1 between 10 and 50\",\n+        \"Table\": \"unq_binary_idx\"\n+      },\n+      \"TablesUsed\": [\n+        \"user.unq_binary_idx\"\n+      ]\n+    }\n+},\n+{\n+  \"comment\": \"Between clause on multicolumn vindex (cola,colb)\",\n+  \"query\": \"select cola,colb,colc from multicol_tbl where cola between 1 and 5\",\n+  \"plan\": {\n+    \"QueryType\": \"SELECT\",\n+    \"Original\": \"select cola,colb,colc from multicol_tbl where cola between 1 and 5\",\n+    \"Instructions\": {\n+      \"OperatorType\": \"Route\",\n+      \"Variant\": \"Scatter\",\n+      \"Keyspace\": {\n+        \"Name\": \"user\",\n+        \"Sharded\": true\n+      },\n+      \"FieldQuery\": \"select cola, colb, colc from multicol_tbl where 1 != 1\",\n+      \"Query\": \"select cola, colb, colc from multicol_tbl where cola between 1 and 5\",\n+      \"Table\": \"multicol_tbl\"\n+    },\n+    \"TablesUsed\": [\n+      \"user.multicol_tbl\"\n+    ]\n   }\n+},\n+{\n+  \"comment\": \"Between clause on a binary vindex field with values from a different table\",\n+  \"query\": \"select s.oid,s.col1, se.colb from sales s join sales_extra se on s.col1 = se.cola where s.oid between se.start and se.end\",\n+  \"plan\": {\n+    \"QueryType\": \"SELECT\",\n+    \"Original\": \"select s.oid,s.col1, se.colb from sales s join sales_extra se on s.col1 = se.cola where s.oid between se.start and se.end\",\n+    \"Instructions\": {\n+      \"OperatorType\": \"Join\",\n+      \"Variant\": \"Join\",\n+      \"JoinColumnIndexes\": \"R:0,R:1,L:0\",\n+      \"JoinVars\": {\n+        \"se_cola\": 1,\n+        \"se_end\": 3,\n+        \"se_start\": 2\n+      },\n+      \"TableName\": \"sales_extra_sales\",\n+      \"Inputs\": [\n+        {\n+          \"OperatorType\": \"Route\",\n+          \"Variant\": \"Scatter\",\n+          \"Keyspace\": {\n+            \"Name\": \"user\",\n+            \"Sharded\": true\n+          },\n+          \"FieldQuery\": \"select se.colb, se.cola, se.`start`, se.`end` from sales_extra as se where 1 != 1\",\n+          \"Query\": \"select se.colb, se.cola, se.`start`, se.`end` from sales_extra as se\",\n+          \"Table\": \"sales_extra\"\n+        },\n+        {\n+          \"OperatorType\": \"Route\",\n+          \"Variant\": \"Between\",\n+          \"Keyspace\": {\n+            \"Name\": \"user\",\n+            \"Sharded\": true\n+          },\n+          \"FieldQuery\": \"select s.oid, s.col1 from sales as s where 1 != 1\",\n+          \"Query\": \"select s.oid, s.col1 from sales as s where s.oid between :se_start /* INT16 */ and :se_end /* INT16 */ and s.col1 = :se_cola /* VARCHAR */\",\n+          \"Table\": \"sales\",\n+          \"Values\": [\n+            \"(:se_start, :se_end)\"\n+          ],\n+          \"Vindex\": \"binary\"\n+        }\n+      ]\n+    },\n+    \"TablesUsed\": [\n+      \"user.sales\",\n+      \"user.sales_extra\"\n+    ]\n+  },\n+  \"skip_e2e\":true\n+}",
        "comment_created_at": "2024-12-17T06:15:11+00:00",
        "comment_author": "harshit-gangal",
        "comment_body": "We need to add the sample data to have data on left and right side of the join.\r\nThe policy after adding these plan test is that we need to ensure that new tests does not add `skip_e2e` flag.\r\nFor that we have to keep modifying the sample input data.",
        "pr_file_module": null
      },
      {
        "comment_id": "1889215163",
        "repo_full_name": "vitessio/vitess",
        "pr_number": 17342,
        "pr_file": "go/vt/vtgate/planbuilder/testdata/filter_cases.json",
        "discussion_id": "1886206836",
        "commented_code": "@@ -4920,5 +4965,149 @@\n         \"user.authoritative\"\n       ]\n     }\n+  },\n+  {\n+    \"comment\": \"Between clause on primary indexed id column (binary vindex on id)\",\n+    \"query\": \"select id from unq_binary_idx where id between 1 and 5\",\n+    \"plan\": {\n+      \"QueryType\": \"SELECT\",\n+      \"Original\": \"select id from unq_binary_idx where id between 1 and 5\",\n+      \"Instructions\": {\n+        \"OperatorType\": \"Route\",\n+        \"Variant\": \"Between\",\n+        \"Keyspace\": {\n+          \"Name\": \"user\",\n+          \"Sharded\": true\n+        },\n+        \"FieldQuery\": \"select id from unq_binary_idx where 1 != 1\",\n+        \"Query\": \"select id from unq_binary_idx where id between 1 and 5\",\n+        \"Table\": \"unq_binary_idx\",\n+        \"Values\": [\n+          \"(1, 5)\"\n+        ],\n+        \"Vindex\": \"binary\"\n+      },\n+      \"TablesUsed\": [\n+        \"user.unq_binary_idx\"\n+      ]\n+    }\n+  },\n+{\n+    \"comment\": \"Between clause on customer.id column (xxhash vindex on id)\",\n+    \"query\": \"select id from customer where id between 1 and 5\",\n+    \"plan\": {\n+      \"QueryType\": \"SELECT\",\n+      \"Original\": \"select id from customer where id between 1 and 5\",\n+      \"Instructions\": {\n+        \"OperatorType\": \"Route\",\n+        \"Variant\": \"Scatter\",\n+        \"Keyspace\": {\n+          \"Name\": \"user\",\n+          \"Sharded\": true\n+        },\n+        \"FieldQuery\": \"select id from customer where 1 != 1\",\n+        \"Query\": \"select id from customer where id between 1 and 5\",\n+        \"Table\": \"customer\"\n+      },\n+      \"TablesUsed\": [\n+        \"user.customer\"\n+      ]\n+    }\n+  },\n+{\n+    \"comment\": \"Between clause on col1 column (there is no vindex on this column)\",\n+    \"query\": \"select id, col1 from unq_binary_idx where col1 between 10 and 50\",\n+    \"plan\": {\n+      \"QueryType\": \"SELECT\",\n+      \"Original\": \"select id, col1 from unq_binary_idx where col1 between 10 and 50\",\n+      \"Instructions\": {\n+        \"OperatorType\": \"Route\",\n+        \"Variant\": \"Scatter\",\n+        \"Keyspace\": {\n+          \"Name\": \"user\",\n+          \"Sharded\": true\n+        },\n+        \"FieldQuery\": \"select id, col1 from unq_binary_idx where 1 != 1\",\n+        \"Query\": \"select id, col1 from unq_binary_idx where col1 between 10 and 50\",\n+        \"Table\": \"unq_binary_idx\"\n+      },\n+      \"TablesUsed\": [\n+        \"user.unq_binary_idx\"\n+      ]\n+    }\n+},\n+{\n+  \"comment\": \"Between clause on multicolumn vindex (cola,colb)\",\n+  \"query\": \"select cola,colb,colc from multicol_tbl where cola between 1 and 5\",\n+  \"plan\": {\n+    \"QueryType\": \"SELECT\",\n+    \"Original\": \"select cola,colb,colc from multicol_tbl where cola between 1 and 5\",\n+    \"Instructions\": {\n+      \"OperatorType\": \"Route\",\n+      \"Variant\": \"Scatter\",\n+      \"Keyspace\": {\n+        \"Name\": \"user\",\n+        \"Sharded\": true\n+      },\n+      \"FieldQuery\": \"select cola, colb, colc from multicol_tbl where 1 != 1\",\n+      \"Query\": \"select cola, colb, colc from multicol_tbl where cola between 1 and 5\",\n+      \"Table\": \"multicol_tbl\"\n+    },\n+    \"TablesUsed\": [\n+      \"user.multicol_tbl\"\n+    ]\n   }\n+},\n+{\n+  \"comment\": \"Between clause on a binary vindex field with values from a different table\",\n+  \"query\": \"select s.oid,s.col1, se.colb from sales s join sales_extra se on s.col1 = se.cola where s.oid between se.start and se.end\",\n+  \"plan\": {\n+    \"QueryType\": \"SELECT\",\n+    \"Original\": \"select s.oid,s.col1, se.colb from sales s join sales_extra se on s.col1 = se.cola where s.oid between se.start and se.end\",\n+    \"Instructions\": {\n+      \"OperatorType\": \"Join\",\n+      \"Variant\": \"Join\",\n+      \"JoinColumnIndexes\": \"R:0,R:1,L:0\",\n+      \"JoinVars\": {\n+        \"se_cola\": 1,\n+        \"se_end\": 3,\n+        \"se_start\": 2\n+      },\n+      \"TableName\": \"sales_extra_sales\",\n+      \"Inputs\": [\n+        {\n+          \"OperatorType\": \"Route\",\n+          \"Variant\": \"Scatter\",\n+          \"Keyspace\": {\n+            \"Name\": \"user\",\n+            \"Sharded\": true\n+          },\n+          \"FieldQuery\": \"select se.colb, se.cola, se.`start`, se.`end` from sales_extra as se where 1 != 1\",\n+          \"Query\": \"select se.colb, se.cola, se.`start`, se.`end` from sales_extra as se\",\n+          \"Table\": \"sales_extra\"\n+        },\n+        {\n+          \"OperatorType\": \"Route\",\n+          \"Variant\": \"Between\",\n+          \"Keyspace\": {\n+            \"Name\": \"user\",\n+            \"Sharded\": true\n+          },\n+          \"FieldQuery\": \"select s.oid, s.col1 from sales as s where 1 != 1\",\n+          \"Query\": \"select s.oid, s.col1 from sales as s where s.oid between :se_start /* INT16 */ and :se_end /* INT16 */ and s.col1 = :se_cola /* VARCHAR */\",\n+          \"Table\": \"sales\",\n+          \"Values\": [\n+            \"(:se_start, :se_end)\"\n+          ],\n+          \"Vindex\": \"binary\"\n+        }\n+      ]\n+    },\n+    \"TablesUsed\": [\n+      \"user.sales\",\n+      \"user.sales_extra\"\n+    ]\n+  },\n+  \"skip_e2e\":true\n+}",
        "comment_created_at": "2024-12-17T21:01:38+00:00",
        "comment_author": "c-r-dev",
        "comment_body": "thanks @harshit-gangal , added sample data loading with https://github.com/vitessio/vitess/pull/17342/commits/1400fea144a1542314e7c1dee4ad1d7798f63ee2 , and removed `skip_e2e`.  All new tests are passing with out skipping.\r\n\r\nPlease help to review.",
        "pr_file_module": null
      }
    ]
  }
]