[
  {
    "discussion_id": "2150796458",
    "pr_number": 18365,
    "pr_file": ".github/workflows/cluster_endtoend_12.yml",
    "created_at": "2025-06-16T20:16:05+00:00",
    "commented_code": "timeout-minutes: 10\n       run: |\n         \n-        # Get key to latest MySQL repo\n         sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys A8D3785C\n-        # Setup MySQL 8.0\n-        wget -c https://dev.mysql.com/get/mysql-apt-config_0.8.33-1_all.deb\n-        echo mysql-apt-config mysql-apt-config/select-server select mysql-8.0 | sudo debconf-set-selections\n-        sudo DEBIAN_FRONTEND=\"noninteractive\" dpkg -i mysql-apt-config*\n-        sudo apt-get -qq update\n-\n-        # We have to install this old version of libaio1 in case we end up testing with MySQL 5.7. See also:\n-        # https://bugs.launchpad.net/ubuntu/+source/libaio/+bug/2067501\n-        curl -L -O http://mirrors.kernel.org/ubuntu/pool/main/liba/libaio/libaio1_0.3.112-13build1_amd64.deb\n-        sudo dpkg -i libaio1_0.3.112-13build1_amd64.deb\n-        # libtinfo5 is also needed for older MySQL 5.7 builds.\n-        curl -L -O http://mirrors.kernel.org/ubuntu/pool/universe/n/ncurses/libtinfo5_6.3-2ubuntu0.1_amd64.deb\n-        sudo dpkg -i libtinfo5_6.3-2ubuntu0.1_amd64.deb\n-\n-        # Install everything else we need, and configure\n-        sudo apt-get -qq install -y mysql-server mysql-shell mysql-client make unzip g++ etcd-client etcd-server curl git wget eatmydata xz-utils libncurses6\n+        if [ \"$ARCH\" = \"arm64\" ]; then\n+          wget https://github.com/ranimandepudi/vitess/releases/download/mysql-arm64-deb/mysql-server_8.0.35_arm64.deb\n+          wget https://github.com/ranimandepudi/vitess/releases/download/mysql-arm64-deb/libssl1.1_1.1.1f-1ubuntu2.16_arm64.deb\n+          wget https://github.com/ranimandepudi/vitess/releases/download/mysql-arm64-deb/libaio1_0.3.112-5_arm64.deb",
    "repo_full_name": "vitessio/vitess",
    "discussion_comments": [
      {
        "comment_id": "2150796458",
        "repo_full_name": "vitessio/vitess",
        "pr_number": 18365,
        "pr_file": ".github/workflows/cluster_endtoend_12.yml",
        "discussion_id": "2150796458",
        "commented_code": "@@ -98,25 +107,29 @@ jobs:\n       timeout-minutes: 10\n       run: |\n         \n-        # Get key to latest MySQL repo\n         sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys A8D3785C\n-        # Setup MySQL 8.0\n-        wget -c https://dev.mysql.com/get/mysql-apt-config_0.8.33-1_all.deb\n-        echo mysql-apt-config mysql-apt-config/select-server select mysql-8.0 | sudo debconf-set-selections\n-        sudo DEBIAN_FRONTEND=\"noninteractive\" dpkg -i mysql-apt-config*\n-        sudo apt-get -qq update\n-\n-        # We have to install this old version of libaio1 in case we end up testing with MySQL 5.7. See also:\n-        # https://bugs.launchpad.net/ubuntu/+source/libaio/+bug/2067501\n-        curl -L -O http://mirrors.kernel.org/ubuntu/pool/main/liba/libaio/libaio1_0.3.112-13build1_amd64.deb\n-        sudo dpkg -i libaio1_0.3.112-13build1_amd64.deb\n-        # libtinfo5 is also needed for older MySQL 5.7 builds.\n-        curl -L -O http://mirrors.kernel.org/ubuntu/pool/universe/n/ncurses/libtinfo5_6.3-2ubuntu0.1_amd64.deb\n-        sudo dpkg -i libtinfo5_6.3-2ubuntu0.1_amd64.deb\n-\n-        # Install everything else we need, and configure\n-        sudo apt-get -qq install -y mysql-server mysql-shell mysql-client make unzip g++ etcd-client etcd-server curl git wget eatmydata xz-utils libncurses6\n+        if [ \"$ARCH\" = \"arm64\" ]; then\n+          wget https://github.com/ranimandepudi/vitess/releases/download/mysql-arm64-deb/mysql-server_8.0.35_arm64.deb\n+          wget https://github.com/ranimandepudi/vitess/releases/download/mysql-arm64-deb/libssl1.1_1.1.1f-1ubuntu2.16_arm64.deb\n+          wget https://github.com/ranimandepudi/vitess/releases/download/mysql-arm64-deb/libaio1_0.3.112-5_arm64.deb",
        "comment_created_at": "2025-06-16T20:16:05+00:00",
        "comment_author": "dbussink",
        "comment_body": "I don't think we should have the ARM packages built against these older library versions? Can't we build them against the default versions in 24.04? ",
        "pr_file_module": null
      },
      {
        "comment_id": "2151107590",
        "repo_full_name": "vitessio/vitess",
        "pr_number": 18365,
        "pr_file": ".github/workflows/cluster_endtoend_12.yml",
        "discussion_id": "2150796458",
        "commented_code": "@@ -98,25 +107,29 @@ jobs:\n       timeout-minutes: 10\n       run: |\n         \n-        # Get key to latest MySQL repo\n         sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys A8D3785C\n-        # Setup MySQL 8.0\n-        wget -c https://dev.mysql.com/get/mysql-apt-config_0.8.33-1_all.deb\n-        echo mysql-apt-config mysql-apt-config/select-server select mysql-8.0 | sudo debconf-set-selections\n-        sudo DEBIAN_FRONTEND=\"noninteractive\" dpkg -i mysql-apt-config*\n-        sudo apt-get -qq update\n-\n-        # We have to install this old version of libaio1 in case we end up testing with MySQL 5.7. See also:\n-        # https://bugs.launchpad.net/ubuntu/+source/libaio/+bug/2067501\n-        curl -L -O http://mirrors.kernel.org/ubuntu/pool/main/liba/libaio/libaio1_0.3.112-13build1_amd64.deb\n-        sudo dpkg -i libaio1_0.3.112-13build1_amd64.deb\n-        # libtinfo5 is also needed for older MySQL 5.7 builds.\n-        curl -L -O http://mirrors.kernel.org/ubuntu/pool/universe/n/ncurses/libtinfo5_6.3-2ubuntu0.1_amd64.deb\n-        sudo dpkg -i libtinfo5_6.3-2ubuntu0.1_amd64.deb\n-\n-        # Install everything else we need, and configure\n-        sudo apt-get -qq install -y mysql-server mysql-shell mysql-client make unzip g++ etcd-client etcd-server curl git wget eatmydata xz-utils libncurses6\n+        if [ \"$ARCH\" = \"arm64\" ]; then\n+          wget https://github.com/ranimandepudi/vitess/releases/download/mysql-arm64-deb/mysql-server_8.0.35_arm64.deb\n+          wget https://github.com/ranimandepudi/vitess/releases/download/mysql-arm64-deb/libssl1.1_1.1.1f-1ubuntu2.16_arm64.deb\n+          wget https://github.com/ranimandepudi/vitess/releases/download/mysql-arm64-deb/libaio1_0.3.112-5_arm64.deb",
        "comment_created_at": "2025-06-17T00:34:15+00:00",
        "comment_author": "ranimandepudi",
        "comment_body": "Thanks for the clarification @dbussink !!\r\nI now understand that Ubuntu 24.04 already provides official MySQL 8.0 packages via `apt-get install mysql-server` for both Amd64 and Arm64 architectures, and these packages are properly built against modern system libraries like libssl3 and libncurses6.\r\n\r\nSo now for both arm64 and amd64:\r\nCan I change it to : \r\n`sudo apt-get update`\r\n`sudo DEBIAN_FRONTEND=\"noninteractive\" apt-get install -y mysql-server mysql-client`\r\n\r\nBefore doing this, could you please confirm this approach aligns with Vitess’s expectations, especially since the Amd64 flow currently uses Oracle’s mysql-apt-config? I would prefer to unify both arches under the native Ubuntu packages if that’s acceptable from a support/security standpoint.\r\n\r\nThanks again for your time and guidance!\r\n\r\n\r\n\r\n",
        "pr_file_module": null
      },
      {
        "comment_id": "2152898706",
        "repo_full_name": "vitessio/vitess",
        "pr_number": 18365,
        "pr_file": ".github/workflows/cluster_endtoend_12.yml",
        "discussion_id": "2150796458",
        "commented_code": "@@ -98,25 +107,29 @@ jobs:\n       timeout-minutes: 10\n       run: |\n         \n-        # Get key to latest MySQL repo\n         sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys A8D3785C\n-        # Setup MySQL 8.0\n-        wget -c https://dev.mysql.com/get/mysql-apt-config_0.8.33-1_all.deb\n-        echo mysql-apt-config mysql-apt-config/select-server select mysql-8.0 | sudo debconf-set-selections\n-        sudo DEBIAN_FRONTEND=\"noninteractive\" dpkg -i mysql-apt-config*\n-        sudo apt-get -qq update\n-\n-        # We have to install this old version of libaio1 in case we end up testing with MySQL 5.7. See also:\n-        # https://bugs.launchpad.net/ubuntu/+source/libaio/+bug/2067501\n-        curl -L -O http://mirrors.kernel.org/ubuntu/pool/main/liba/libaio/libaio1_0.3.112-13build1_amd64.deb\n-        sudo dpkg -i libaio1_0.3.112-13build1_amd64.deb\n-        # libtinfo5 is also needed for older MySQL 5.7 builds.\n-        curl -L -O http://mirrors.kernel.org/ubuntu/pool/universe/n/ncurses/libtinfo5_6.3-2ubuntu0.1_amd64.deb\n-        sudo dpkg -i libtinfo5_6.3-2ubuntu0.1_amd64.deb\n-\n-        # Install everything else we need, and configure\n-        sudo apt-get -qq install -y mysql-server mysql-shell mysql-client make unzip g++ etcd-client etcd-server curl git wget eatmydata xz-utils libncurses6\n+        if [ \"$ARCH\" = \"arm64\" ]; then\n+          wget https://github.com/ranimandepudi/vitess/releases/download/mysql-arm64-deb/mysql-server_8.0.35_arm64.deb\n+          wget https://github.com/ranimandepudi/vitess/releases/download/mysql-arm64-deb/libssl1.1_1.1.1f-1ubuntu2.16_arm64.deb\n+          wget https://github.com/ranimandepudi/vitess/releases/download/mysql-arm64-deb/libaio1_0.3.112-5_arm64.deb",
        "comment_created_at": "2025-06-17T18:22:12+00:00",
        "comment_author": "dbussink",
        "comment_body": "No, that's not what I am saying. What I'm saying here is that it looks like these are self-built packages and those should be built then against up-to-date dependencies. \r\n\r\nAlso, these comments really look like straight up LLM generated comments and they look like a confused AI that goes back and forth on things and shows there's no real understanding. I'd like to make sure we're actually working with someone who really understands the task at hand. ",
        "pr_file_module": null
      },
      {
        "comment_id": "2153015961",
        "repo_full_name": "vitessio/vitess",
        "pr_number": 18365,
        "pr_file": ".github/workflows/cluster_endtoend_12.yml",
        "discussion_id": "2150796458",
        "commented_code": "@@ -98,25 +107,29 @@ jobs:\n       timeout-minutes: 10\n       run: |\n         \n-        # Get key to latest MySQL repo\n         sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys A8D3785C\n-        # Setup MySQL 8.0\n-        wget -c https://dev.mysql.com/get/mysql-apt-config_0.8.33-1_all.deb\n-        echo mysql-apt-config mysql-apt-config/select-server select mysql-8.0 | sudo debconf-set-selections\n-        sudo DEBIAN_FRONTEND=\"noninteractive\" dpkg -i mysql-apt-config*\n-        sudo apt-get -qq update\n-\n-        # We have to install this old version of libaio1 in case we end up testing with MySQL 5.7. See also:\n-        # https://bugs.launchpad.net/ubuntu/+source/libaio/+bug/2067501\n-        curl -L -O http://mirrors.kernel.org/ubuntu/pool/main/liba/libaio/libaio1_0.3.112-13build1_amd64.deb\n-        sudo dpkg -i libaio1_0.3.112-13build1_amd64.deb\n-        # libtinfo5 is also needed for older MySQL 5.7 builds.\n-        curl -L -O http://mirrors.kernel.org/ubuntu/pool/universe/n/ncurses/libtinfo5_6.3-2ubuntu0.1_amd64.deb\n-        sudo dpkg -i libtinfo5_6.3-2ubuntu0.1_amd64.deb\n-\n-        # Install everything else we need, and configure\n-        sudo apt-get -qq install -y mysql-server mysql-shell mysql-client make unzip g++ etcd-client etcd-server curl git wget eatmydata xz-utils libncurses6\n+        if [ \"$ARCH\" = \"arm64\" ]; then\n+          wget https://github.com/ranimandepudi/vitess/releases/download/mysql-arm64-deb/mysql-server_8.0.35_arm64.deb\n+          wget https://github.com/ranimandepudi/vitess/releases/download/mysql-arm64-deb/libssl1.1_1.1.1f-1ubuntu2.16_arm64.deb\n+          wget https://github.com/ranimandepudi/vitess/releases/download/mysql-arm64-deb/libaio1_0.3.112-5_arm64.deb",
        "comment_created_at": "2025-06-17T19:23:13+00:00",
        "comment_author": "ranimandepudi",
        "comment_body": "Ok got your point. But I just want to clarify that I did this by fully understanding:\r\n\r\nI built MySQL 8.0.35 from source inside arm64 container packed into a .deb : https://hub.docker.com/repository/docker/ranichowdary/mysql-arm64-builder/general\r\nI chose this approach because I saw that the official MySQL Amd64 images are also based on Debian Bullseye\r\n\r\nBut I totally understand as the Vitess CI runs on 24.04 so building it on ubuntu24.04 makes clear \r\nI will rebuild MySQL 8.0.35 Arm .deb and update the workflow of arm64 without disturbing the amd64 !! \r\nSorry if my previous comments came across the way. I have not generated them, but just tried to be detailed to make sure I am on right path. But overexplaining make things seem unclear. \r\nI will make sure to keep more clear by technical reasoning. Just want to highlight that I fully understood the task and I am working on it \r\n\r\n",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "2010388062",
    "pr_number": 18015,
    "pr_file": ".github/workflows/upgrade_downgrade_test_backups_e2e.yml",
    "created_at": "2025-03-24T15:15:19+00:00",
    "commented_code": "sudo apt-get update\n         sudo apt-get install -y mysql-server mysql-client make unzip g++ etcd-client etcd-server curl git wget eatmydata\n         \n-        # Running on CNCF ARC Runners no longer needs this\n-        # Leaving this in as a tombstone for now\n-        #sudo service mysql stop\n-        #sudo service etcd stop\n-        #sudo ln -s /etc/apparmor.d/usr.sbin.mysqld /etc/apparmor.d/disable/\n-        #sudo apparmor_parser -R /etc/apparmor.d/usr.sbin.mysqld\n+        sudo service mysql stop\n+        sudo service etcd stop\n+        sudo ln -s /etc/apparmor.d/usr.sbin.mysqld /etc/apparmor.d/disable/\n+        sudo apparmor_parser -R /etc/apparmor.d/usr.sbin.mysqld",
    "repo_full_name": "vitessio/vitess",
    "discussion_comments": [
      {
        "comment_id": "2010388062",
        "repo_full_name": "vitessio/vitess",
        "pr_number": 18015,
        "pr_file": ".github/workflows/upgrade_downgrade_test_backups_e2e.yml",
        "discussion_id": "2010388062",
        "commented_code": "@@ -92,12 +92,10 @@ jobs:\n         sudo apt-get update\n         sudo apt-get install -y mysql-server mysql-client make unzip g++ etcd-client etcd-server curl git wget eatmydata\n         \n-        # Running on CNCF ARC Runners no longer needs this\n-        # Leaving this in as a tombstone for now\n-        #sudo service mysql stop\n-        #sudo service etcd stop\n-        #sudo ln -s /etc/apparmor.d/usr.sbin.mysqld /etc/apparmor.d/disable/\n-        #sudo apparmor_parser -R /etc/apparmor.d/usr.sbin.mysqld\n+        sudo service mysql stop\n+        sudo service etcd stop\n+        sudo ln -s /etc/apparmor.d/usr.sbin.mysqld /etc/apparmor.d/disable/\n+        sudo apparmor_parser -R /etc/apparmor.d/usr.sbin.mysqld",
        "comment_created_at": "2025-03-24T15:15:19+00:00",
        "comment_author": "dbussink",
        "comment_body": "We're seeing failures in multiple PRs on this job that very suspiciously look like the errors we get on the GitHub runners when this is missing. The problem is that it's not always 100% failing, but we fail still regularly and it looks like `mysqlctld` can't start MySQL which can be due to these kinds of app armor rules still being enforced. \r\n\r\nThis also matches where I can't reproduce the problem locally. \r\n\r\nAlso FYI @jeefy @krook & @RobertKielty",
        "pr_file_module": null
      }
    ]
  }
]