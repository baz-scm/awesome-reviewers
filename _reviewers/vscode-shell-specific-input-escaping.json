[
  {
    "discussion_id": "2128560876",
    "pr_number": 250731,
    "pr_file": "src/vs/platform/terminal/common/terminalEnvironment.ts",
    "created_at": "2025-06-05T10:56:31+00:00",
    "commented_code": "if (newPath.includes('\\\\')) {\n \t\tnewPath = newPath.replace(/\\\\/g, '\\\\\\\\');\n \t}\n-\tconst bannedChars = /[\\`\\$\\|\\&\\>\\~\\#\\!\\^\\*\\;\\<\\\"\\']/g;\n+\t// Remove dangerous characters except single quotes, which we'll escape properly\n+\tconst bannedChars = /[\\`\\$\\|\\&\\>\\~\\#\\!\\^\\*\\;\\<\\\"]/g;\n \tnewPath = newPath.replace(bannedChars, '');\n+\t\n+\t// Properly escape single quotes by ending the current single-quoted string,\n+\t// adding an escaped single quote, then starting a new single-quoted string\n+\tif (newPath.includes(\"'\")) {\n+\t\tnewPath = newPath.replace(/'/g, \"'\\\\''\");\n+\t}",
    "repo_full_name": "microsoft/vscode",
    "discussion_comments": [
      {
        "comment_id": "2128560876",
        "repo_full_name": "microsoft/vscode",
        "pr_number": 250731,
        "pr_file": "src/vs/platform/terminal/common/terminalEnvironment.ts",
        "discussion_id": "2128560876",
        "commented_code": "@@ -16,8 +16,16 @@ export function escapeNonWindowsPath(path: string): string {\n \tif (newPath.includes('\\\\')) {\n \t\tnewPath = newPath.replace(/\\\\/g, '\\\\\\\\');\n \t}\n-\tconst bannedChars = /[\\`\\$\\|\\&\\>\\~\\#\\!\\^\\*\\;\\<\\\"\\']/g;\n+\t// Remove dangerous characters except single quotes, which we'll escape properly\n+\tconst bannedChars = /[\\`\\$\\|\\&\\>\\~\\#\\!\\^\\*\\;\\<\\\"]/g;\n \tnewPath = newPath.replace(bannedChars, '');\n+\t\n+\t// Properly escape single quotes by ending the current single-quoted string,\n+\t// adding an escaped single quote, then starting a new single-quoted string\n+\tif (newPath.includes(\"'\")) {\n+\t\tnewPath = newPath.replace(/'/g, \"'\\\\''\");\n+\t}",
        "comment_created_at": "2025-06-05T10:56:31+00:00",
        "comment_author": "Tyriar",
        "comment_body": "This should be done in a shell specific way to prevent security problems. Add support for both ' and \" in bash, git bash, powershell, zsh and fish.",
        "pr_file_module": null
      }
    ]
  }
]