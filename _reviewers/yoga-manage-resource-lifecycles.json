[
  {
    "discussion_id": "100741606",
    "pr_number": 386,
    "pr_file": "csharp/Facebook.Yoga/YogaNode.cs",
    "created_at": "2017-02-13T08:16:55+00:00",
    "commented_code": "{\n             _measureFunction = measureFunction;\n             _ygMeasureFunc = measureFunction != null ? MeasureInternal : (YogaMeasureFunc)null;\n+\n+            var handle = GCHandle.Alloc(this);\n+            Native.YGNodeSetContext(_ygNode, GCHandle.ToIntPtr(handle));\n+\n             Native.YGNodeSetMeasureFunc(_ygNode, _ygMeasureFunc);\n         }\n \n         public void SetBaselineFunction(BaselineFunction baselineFunction)\n         {\n             _baselineFunction = baselineFunction;\n             _ygBaselineFunc = baselineFunction != null ? BaselineInternal : (YogaBaselineFunc)null;\n+\n+            var handle = GCHandle.Alloc(this);",
    "repo_full_name": "facebook/yoga",
    "discussion_comments": [
      {
        "comment_id": "100741606",
        "repo_full_name": "facebook/yoga",
        "pr_number": 386,
        "pr_file": "csharp/Facebook.Yoga/YogaNode.cs",
        "discussion_id": "100741606",
        "commented_code": "@@ -546,13 +547,21 @@ public void SetMeasureFunction(MeasureFunction measureFunction)\n         {\n             _measureFunction = measureFunction;\n             _ygMeasureFunc = measureFunction != null ? MeasureInternal : (YogaMeasureFunc)null;\n+\n+            var handle = GCHandle.Alloc(this);\n+            Native.YGNodeSetContext(_ygNode, GCHandle.ToIntPtr(handle));\n+\n             Native.YGNodeSetMeasureFunc(_ygNode, _ygMeasureFunc);\n         }\n \n         public void SetBaselineFunction(BaselineFunction baselineFunction)\n         {\n             _baselineFunction = baselineFunction;\n             _ygBaselineFunc = baselineFunction != null ? BaselineInternal : (YogaBaselineFunc)null;\n+\n+            var handle = GCHandle.Alloc(this);",
        "comment_created_at": "2017-02-13T08:16:55+00:00",
        "comment_author": "rolfbjarne",
        "comment_body": "Your patch never calls `GCHandle.Free`.\r\n\r\nAlso you allocate a GCHandle both SetMeasureFunction and SetBaselineFunction, if both are called one of the values stored with YGNodeSetContext will be overwritten. The same will happen if either function is called more than once.",
        "pr_file_module": null
      },
      {
        "comment_id": "100764570",
        "repo_full_name": "facebook/yoga",
        "pr_number": 386,
        "pr_file": "csharp/Facebook.Yoga/YogaNode.cs",
        "discussion_id": "100741606",
        "commented_code": "@@ -546,13 +547,21 @@ public void SetMeasureFunction(MeasureFunction measureFunction)\n         {\n             _measureFunction = measureFunction;\n             _ygMeasureFunc = measureFunction != null ? MeasureInternal : (YogaMeasureFunc)null;\n+\n+            var handle = GCHandle.Alloc(this);\n+            Native.YGNodeSetContext(_ygNode, GCHandle.ToIntPtr(handle));\n+\n             Native.YGNodeSetMeasureFunc(_ygNode, _ygMeasureFunc);\n         }\n \n         public void SetBaselineFunction(BaselineFunction baselineFunction)\n         {\n             _baselineFunction = baselineFunction;\n             _ygBaselineFunc = baselineFunction != null ? BaselineInternal : (YogaBaselineFunc)null;\n+\n+            var handle = GCHandle.Alloc(this);",
        "comment_created_at": "2017-02-13T10:34:15+00:00",
        "comment_author": "rmarinho",
        "comment_body": "@splhack pr #388 fixes this.",
        "pr_file_module": null
      }
    ]
  },
  {
    "discussion_id": "93732812",
    "pr_number": 297,
    "pr_file": "csharp/Facebook.Yoga/Native.cs",
    "created_at": "2016-12-23T06:12:54+00:00",
    "commented_code": "YogaExperimentalFeature feature);\n \n         [DllImport(DllName)]\n-        public static extern void YGNodeInsertChild(IntPtr node, IntPtr child, uint index);\n+        public static extern void YGNodeInsertChild(YGNodeHandle node, YGNodeHandle child, uint index);\n \n         [DllImport(DllName)]\n-        public static extern void YGNodeRemoveChild(IntPtr node, IntPtr child);\n+        public static extern void YGNodeRemoveChild(YGNodeHandle node, YGNodeHandle child);\n \n         [DllImport(DllName)]\n-        public static extern IntPtr YGNodeGetChild(IntPtr node, uint index);\n+        public static extern YGNodeHandle YGNodeGetChild(YGNodeHandle node, uint index);",
    "repo_full_name": "facebook/yoga",
    "discussion_comments": [
      {
        "comment_id": "93732812",
        "repo_full_name": "facebook/yoga",
        "pr_number": 297,
        "pr_file": "csharp/Facebook.Yoga/Native.cs",
        "discussion_id": "93732812",
        "commented_code": "@@ -46,237 +68,237 @@ internal static class Native\n             YogaExperimentalFeature feature);\n \n         [DllImport(DllName)]\n-        public static extern void YGNodeInsertChild(IntPtr node, IntPtr child, uint index);\n+        public static extern void YGNodeInsertChild(YGNodeHandle node, YGNodeHandle child, uint index);\n \n         [DllImport(DllName)]\n-        public static extern void YGNodeRemoveChild(IntPtr node, IntPtr child);\n+        public static extern void YGNodeRemoveChild(YGNodeHandle node, YGNodeHandle child);\n \n         [DllImport(DllName)]\n-        public static extern IntPtr YGNodeGetChild(IntPtr node, uint index);\n+        public static extern YGNodeHandle YGNodeGetChild(YGNodeHandle node, uint index);",
        "comment_created_at": "2016-12-23T06:12:54+00:00",
        "comment_author": "woehrl01",
        "comment_body": "I think this must return only intptr as we don't own the underlying node here.",
        "pr_file_module": null
      },
      {
        "comment_id": "93779254",
        "repo_full_name": "facebook/yoga",
        "pr_number": 297,
        "pr_file": "csharp/Facebook.Yoga/Native.cs",
        "discussion_id": "93732812",
        "commented_code": "@@ -46,237 +68,237 @@ internal static class Native\n             YogaExperimentalFeature feature);\n \n         [DllImport(DllName)]\n-        public static extern void YGNodeInsertChild(IntPtr node, IntPtr child, uint index);\n+        public static extern void YGNodeInsertChild(YGNodeHandle node, YGNodeHandle child, uint index);\n \n         [DllImport(DllName)]\n-        public static extern void YGNodeRemoveChild(IntPtr node, IntPtr child);\n+        public static extern void YGNodeRemoveChild(YGNodeHandle node, YGNodeHandle child);\n \n         [DllImport(DllName)]\n-        public static extern IntPtr YGNodeGetChild(IntPtr node, uint index);\n+        public static extern YGNodeHandle YGNodeGetChild(YGNodeHandle node, uint index);",
        "comment_created_at": "2016-12-23T15:55:40+00:00",
        "comment_author": "splhack",
        "comment_body": "I'll remove this declaration in merge commit since managed code doesn't use it",
        "pr_file_module": null
      },
      {
        "comment_id": "93789907",
        "repo_full_name": "facebook/yoga",
        "pr_number": 297,
        "pr_file": "csharp/Facebook.Yoga/Native.cs",
        "discussion_id": "93732812",
        "commented_code": "@@ -46,237 +68,237 @@ internal static class Native\n             YogaExperimentalFeature feature);\n \n         [DllImport(DllName)]\n-        public static extern void YGNodeInsertChild(IntPtr node, IntPtr child, uint index);\n+        public static extern void YGNodeInsertChild(YGNodeHandle node, YGNodeHandle child, uint index);\n \n         [DllImport(DllName)]\n-        public static extern void YGNodeRemoveChild(IntPtr node, IntPtr child);\n+        public static extern void YGNodeRemoveChild(YGNodeHandle node, YGNodeHandle child);\n \n         [DllImport(DllName)]\n-        public static extern IntPtr YGNodeGetChild(IntPtr node, uint index);\n+        public static extern YGNodeHandle YGNodeGetChild(YGNodeHandle node, uint index);",
        "comment_created_at": "2016-12-23T18:06:04+00:00",
        "comment_author": "itsff",
        "comment_body": "You guys beat me to it. Thank you for noticing this one (@woehrl01)  and removing it (@splhack). It could have caused some confusion and lifetime problems. We should similarly remove `YGNodeSetContext` and `YGNodeSetContext` since this functionality is achieved by the `YogaNode::Data` property.",
        "pr_file_module": null
      }
    ]
  }
]